{"version":3,"file":"js/main.a4b321e0b46aad929718.js","mappings":"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","sources":["webpack://XCmaps/webpack/runtime/chunk loaded","webpack://XCmaps/./node_modules/moment/locale/ sync ^\\.\\/.*$","webpack://XCmaps/./src/public/assets/js/L.Control.Layers.Tree.js","webpack://XCmaps/./src/public/assets/js/leaflet.responsive.popup.js","webpack://XCmaps/./src/components/InfoControl.js","webpack://XCmaps/./src/components/airspaces.js","webpack://XCmaps/./src/components/deprecated/airspaces-gliding.js","webpack://XCmaps/./src/components/deprecated/airspaces-notam.js","webpack://XCmaps/./src/components/airspaces-xc.js","webpack://XCmaps/./src/components/windstations.js","webpack://XCmaps/./src/components/spots-helper.js","webpack://XCmaps/./src/components/spots-pg.js","webpack://XCmaps/./src/components/spots-hg.js","webpack://XCmaps/./src/components/spots-lz.js","webpack://XCmaps/./src/components/obstacles.js","webpack://XCmaps/./src/public/assets/js/index.js","webpack://XCmaps/./src/components/rainviewer.js","webpack://XCmaps/webpack/bootstrap","webpack://XCmaps/webpack/runtime/define property getters","webpack://XCmaps/webpack/runtime/hasOwnProperty shorthand","webpack://XCmaps/webpack/runtime/node module decorator","webpack://XCmaps/webpack/runtime/jsonp chunk loading","webpack://XCmaps/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","var map = {\n\t\"./af\": 5177,\n\t\"./af.js\": 5177,\n\t\"./ar\": 1509,\n\t\"./ar-dz\": 1488,\n\t\"./ar-dz.js\": 1488,\n\t\"./ar-kw\": 8676,\n\t\"./ar-kw.js\": 8676,\n\t\"./ar-ly\": 2353,\n\t\"./ar-ly.js\": 2353,\n\t\"./ar-ma\": 4496,\n\t\"./ar-ma.js\": 4496,\n\t\"./ar-ps\": 6947,\n\t\"./ar-ps.js\": 6947,\n\t\"./ar-sa\": 2682,\n\t\"./ar-sa.js\": 2682,\n\t\"./ar-tn\": 9756,\n\t\"./ar-tn.js\": 9756,\n\t\"./ar.js\": 1509,\n\t\"./az\": 5533,\n\t\"./az.js\": 5533,\n\t\"./be\": 8959,\n\t\"./be.js\": 8959,\n\t\"./bg\": 7777,\n\t\"./bg.js\": 7777,\n\t\"./bm\": 4903,\n\t\"./bm.js\": 4903,\n\t\"./bn\": 1290,\n\t\"./bn-bd\": 7357,\n\t\"./bn-bd.js\": 7357,\n\t\"./bn.js\": 1290,\n\t\"./bo\": 1545,\n\t\"./bo.js\": 1545,\n\t\"./br\": 1470,\n\t\"./br.js\": 1470,\n\t\"./bs\": 4429,\n\t\"./bs.js\": 4429,\n\t\"./ca\": 7306,\n\t\"./ca.js\": 7306,\n\t\"./cs\": 6464,\n\t\"./cs.js\": 6464,\n\t\"./cv\": 3635,\n\t\"./cv.js\": 3635,\n\t\"./cy\": 4226,\n\t\"./cy.js\": 4226,\n\t\"./da\": 3601,\n\t\"./da.js\": 3601,\n\t\"./de\": 7853,\n\t\"./de-at\": 6111,\n\t\"./de-at.js\": 6111,\n\t\"./de-ch\": 4697,\n\t\"./de-ch.js\": 4697,\n\t\"./de.js\": 7853,\n\t\"./dv\": 708,\n\t\"./dv.js\": 708,\n\t\"./el\": 4691,\n\t\"./el.js\": 4691,\n\t\"./en-au\": 3872,\n\t\"./en-au.js\": 3872,\n\t\"./en-ca\": 8298,\n\t\"./en-ca.js\": 8298,\n\t\"./en-gb\": 6195,\n\t\"./en-gb.js\": 6195,\n\t\"./en-ie\": 6584,\n\t\"./en-ie.js\": 6584,\n\t\"./en-il\": 5543,\n\t\"./en-il.js\": 5543,\n\t\"./en-in\": 9033,\n\t\"./en-in.js\": 9033,\n\t\"./en-nz\": 9402,\n\t\"./en-nz.js\": 9402,\n\t\"./en-sg\": 3004,\n\t\"./en-sg.js\": 3004,\n\t\"./eo\": 2934,\n\t\"./eo.js\": 2934,\n\t\"./es\": 7650,\n\t\"./es-do\": 838,\n\t\"./es-do.js\": 838,\n\t\"./es-mx\": 7730,\n\t\"./es-mx.js\": 7730,\n\t\"./es-us\": 6575,\n\t\"./es-us.js\": 6575,\n\t\"./es.js\": 7650,\n\t\"./et\": 3035,\n\t\"./et.js\": 3035,\n\t\"./eu\": 3508,\n\t\"./eu.js\": 3508,\n\t\"./fa\": 119,\n\t\"./fa.js\": 119,\n\t\"./fi\": 527,\n\t\"./fi.js\": 527,\n\t\"./fil\": 5995,\n\t\"./fil.js\": 5995,\n\t\"./fo\": 2477,\n\t\"./fo.js\": 2477,\n\t\"./fr\": 5498,\n\t\"./fr-ca\": 6435,\n\t\"./fr-ca.js\": 6435,\n\t\"./fr-ch\": 7892,\n\t\"./fr-ch.js\": 7892,\n\t\"./fr.js\": 5498,\n\t\"./fy\": 7071,\n\t\"./fy.js\": 7071,\n\t\"./ga\": 1734,\n\t\"./ga.js\": 1734,\n\t\"./gd\": 217,\n\t\"./gd.js\": 217,\n\t\"./gl\": 7329,\n\t\"./gl.js\": 7329,\n\t\"./gom-deva\": 2124,\n\t\"./gom-deva.js\": 2124,\n\t\"./gom-latn\": 3383,\n\t\"./gom-latn.js\": 3383,\n\t\"./gu\": 5050,\n\t\"./gu.js\": 5050,\n\t\"./he\": 1713,\n\t\"./he.js\": 1713,\n\t\"./hi\": 3861,\n\t\"./hi.js\": 3861,\n\t\"./hr\": 6308,\n\t\"./hr.js\": 6308,\n\t\"./hu\": 609,\n\t\"./hu.js\": 609,\n\t\"./hy-am\": 7160,\n\t\"./hy-am.js\": 7160,\n\t\"./id\": 4063,\n\t\"./id.js\": 4063,\n\t\"./is\": 9374,\n\t\"./is.js\": 9374,\n\t\"./it\": 8383,\n\t\"./it-ch\": 1827,\n\t\"./it-ch.js\": 1827,\n\t\"./it.js\": 8383,\n\t\"./ja\": 3827,\n\t\"./ja.js\": 3827,\n\t\"./jv\": 9722,\n\t\"./jv.js\": 9722,\n\t\"./ka\": 1794,\n\t\"./ka.js\": 1794,\n\t\"./kk\": 7088,\n\t\"./kk.js\": 7088,\n\t\"./km\": 6870,\n\t\"./km.js\": 6870,\n\t\"./kn\": 4451,\n\t\"./kn.js\": 4451,\n\t\"./ko\": 3164,\n\t\"./ko.js\": 3164,\n\t\"./ku\": 8174,\n\t\"./ku-kmr\": 6181,\n\t\"./ku-kmr.js\": 6181,\n\t\"./ku.js\": 8174,\n\t\"./ky\": 8474,\n\t\"./ky.js\": 8474,\n\t\"./lb\": 9680,\n\t\"./lb.js\": 9680,\n\t\"./lo\": 5867,\n\t\"./lo.js\": 5867,\n\t\"./lt\": 5766,\n\t\"./lt.js\": 5766,\n\t\"./lv\": 9532,\n\t\"./lv.js\": 9532,\n\t\"./me\": 8076,\n\t\"./me.js\": 8076,\n\t\"./mi\": 1848,\n\t\"./mi.js\": 1848,\n\t\"./mk\": 306,\n\t\"./mk.js\": 306,\n\t\"./ml\": 3739,\n\t\"./ml.js\": 3739,\n\t\"./mn\": 9053,\n\t\"./mn.js\": 9053,\n\t\"./mr\": 6169,\n\t\"./mr.js\": 6169,\n\t\"./ms\": 3386,\n\t\"./ms-my\": 2297,\n\t\"./ms-my.js\": 2297,\n\t\"./ms.js\": 3386,\n\t\"./mt\": 7075,\n\t\"./mt.js\": 7075,\n\t\"./my\": 2264,\n\t\"./my.js\": 2264,\n\t\"./nb\": 2274,\n\t\"./nb.js\": 2274,\n\t\"./ne\": 8235,\n\t\"./ne.js\": 8235,\n\t\"./nl\": 2572,\n\t\"./nl-be\": 3784,\n\t\"./nl-be.js\": 3784,\n\t\"./nl.js\": 2572,\n\t\"./nn\": 4566,\n\t\"./nn.js\": 4566,\n\t\"./oc-lnc\": 9330,\n\t\"./oc-lnc.js\": 9330,\n\t\"./pa-in\": 9849,\n\t\"./pa-in.js\": 9849,\n\t\"./pl\": 4418,\n\t\"./pl.js\": 4418,\n\t\"./pt\": 9834,\n\t\"./pt-br\": 8303,\n\t\"./pt-br.js\": 8303,\n\t\"./pt.js\": 9834,\n\t\"./ro\": 4457,\n\t\"./ro.js\": 4457,\n\t\"./ru\": 2271,\n\t\"./ru.js\": 2271,\n\t\"./sd\": 1221,\n\t\"./sd.js\": 1221,\n\t\"./se\": 3478,\n\t\"./se.js\": 3478,\n\t\"./si\": 7538,\n\t\"./si.js\": 7538,\n\t\"./sk\": 5784,\n\t\"./sk.js\": 5784,\n\t\"./sl\": 6637,\n\t\"./sl.js\": 6637,\n\t\"./sq\": 6794,\n\t\"./sq.js\": 6794,\n\t\"./sr\": 5719,\n\t\"./sr-cyrl\": 3322,\n\t\"./sr-cyrl.js\": 3322,\n\t\"./sr.js\": 5719,\n\t\"./ss\": 6000,\n\t\"./ss.js\": 6000,\n\t\"./sv\": 1011,\n\t\"./sv.js\": 1011,\n\t\"./sw\": 748,\n\t\"./sw.js\": 748,\n\t\"./ta\": 1025,\n\t\"./ta.js\": 1025,\n\t\"./te\": 1885,\n\t\"./te.js\": 1885,\n\t\"./tet\": 8861,\n\t\"./tet.js\": 8861,\n\t\"./tg\": 6571,\n\t\"./tg.js\": 6571,\n\t\"./th\": 5802,\n\t\"./th.js\": 5802,\n\t\"./tk\": 9527,\n\t\"./tk.js\": 9527,\n\t\"./tl-ph\": 9231,\n\t\"./tl-ph.js\": 9231,\n\t\"./tlh\": 1052,\n\t\"./tlh.js\": 1052,\n\t\"./tr\": 5096,\n\t\"./tr.js\": 5096,\n\t\"./tzl\": 9846,\n\t\"./tzl.js\": 9846,\n\t\"./tzm\": 1765,\n\t\"./tzm-latn\": 7711,\n\t\"./tzm-latn.js\": 7711,\n\t\"./tzm.js\": 1765,\n\t\"./ug-cn\": 8414,\n\t\"./ug-cn.js\": 8414,\n\t\"./uk\": 6618,\n\t\"./uk.js\": 6618,\n\t\"./ur\": 158,\n\t\"./ur.js\": 158,\n\t\"./uz\": 7609,\n\t\"./uz-latn\": 2475,\n\t\"./uz-latn.js\": 2475,\n\t\"./uz.js\": 7609,\n\t\"./vi\": 1135,\n\t\"./vi.js\": 1135,\n\t\"./x-pseudo\": 4051,\n\t\"./x-pseudo.js\": 4051,\n\t\"./yo\": 2218,\n\t\"./yo.js\": 2218,\n\t\"./zh-cn\": 2648,\n\t\"./zh-cn.js\": 2648,\n\t\"./zh-hk\": 1632,\n\t\"./zh-hk.js\": 1632,\n\t\"./zh-mo\": 1541,\n\t\"./zh-mo.js\": 1541,\n\t\"./zh-tw\": 304,\n\t\"./zh-tw.js\": 304\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 5358;","/*\r\n * Control like L.Control.Layers, but showing layers in a tree.\r\n * Do not forget to include the css file.\r\n */\r\nconsole.log(\"L.Control.Layers.Tree has been loaded!\");\r\n(function(L) {\r\n    if (typeof L === 'undefined') {\r\n        throw new Error('Leaflet must be included first');\r\n    }\r\n\r\n    /*\r\n     * L.Control.Layers.Tree extends L.Control.Layers because it reuses\r\n     * most of its functionality. Only the HTML creation is different.\r\n     */\r\n    L.Control.Layers.Tree = L.Control.Layers.extend({\r\n        options: {\r\n            closedSymbol: '+',\r\n            openedSymbol: '&minus;',\r\n            spaceSymbol: ' ',\r\n            selectorBack: false,\r\n            namedToggle: false,\r\n            collapseAll: '',\r\n            expandAll: '',\r\n            labelIsSelector: 'both',\r\n        },\r\n\r\n        // Class names are error prone texts, so write them once here\r\n        _initClassesNames: function() {\r\n            this.cls = {\r\n                children: 'leaflet-layerstree-children',\r\n                childrenNopad: 'leaflet-layerstree-children-nopad',\r\n                hide: 'leaflet-layerstree-hide',\r\n                closed: 'leaflet-layerstree-closed',\r\n                opened: 'leaflet-layerstree-opened',\r\n                space: 'leaflet-layerstree-header-space',\r\n                pointer: 'leaflet-layerstree-header-pointer',\r\n                header: 'leaflet-layerstree-header',\r\n                neverShow: 'leaflet-layerstree-nevershow',\r\n                node: 'leaflet-layerstree-node',\r\n                name: 'leaflet-layerstree-header-name',\r\n                label: 'leaflet-layerstree-header-label',\r\n                selAllCheckbox: 'leaflet-layerstree-sel-all-checkbox',\r\n            };\r\n        },\r\n\r\n        initialize: function(baseTree, overlaysTree, options) {\r\n            this._scrollTop = 0;\r\n            this._initClassesNames();\r\n            this._baseTree = null;\r\n            this._overlaysTree = null;\r\n            L.Util.setOptions(this, options);\r\n            L.Control.Layers.prototype.initialize.call(this, null, null, options);\r\n            this._setTrees(baseTree, overlaysTree);\r\n        },\r\n\r\n        setBaseTree: function(tree) {\r\n            return this._setTrees(tree);\r\n        },\r\n\r\n        setOverlayTree: function(tree) {\r\n            return this._setTrees(undefined, tree);\r\n        },\r\n\r\n        addBaseLayer: function(_layer, _name) {\r\n            throw 'addBaseLayer is disabled';\r\n        },\r\n\r\n        addOverlay: function(_layer, _name) {\r\n            throw 'addOverlay is disabled';\r\n        },\r\n\r\n        removeLayer: function(_layer) {\r\n            throw 'removeLayer is disabled';\r\n        },\r\n\r\n        collapse: function() {\r\n            this._scrollTop = this._sect().scrollTop;\r\n            return L.Control.Layers.prototype.collapse.call(this);\r\n        },\r\n\r\n        expand: function() {\r\n            L.Control.Layers.prototype.expand.call(this);\r\n            this._sect().scrollTop = this._scrollTop;\r\n        },\r\n\r\n        onAdd: function(map) {\r\n            function changeName(layer) {\r\n                if (layer._layersTreeName) {\r\n                    toggle.innerHTML = layer._layersTreeName;\r\n                }\r\n            }\r\n\r\n            var ret = L.Control.Layers.prototype.onAdd.call(this, map);\r\n            if (this.options.namedToggle) {\r\n                var toggle = this._container.getElementsByClassName('leaflet-control-layers-toggle')[0];\r\n                L.DomUtil.addClass(toggle, 'leaflet-layerstree-named-toggle');\r\n                // Start with this value...\r\n                map.eachLayer(function(layer) {changeName(layer);});\r\n                // ... and change it whenever the baselayer is changed.\r\n                map.on('baselayerchange', function(e) {changeName(e.layer);}, this);\r\n            }\r\n            return ret;\r\n        },\r\n\r\n        // Expands the whole tree (base other overlays)\r\n        expandTree: function(overlay) {\r\n            var container = overlay ? this._overlaysList : this._baseLayersList;\r\n            if (container) {\r\n                this._applyOnTree(container, false);\r\n            }\r\n            return this._localExpand();\r\n        },\r\n\r\n        // Collapses the whole tree (base other overlays)\r\n        collapseTree: function(overlay) {\r\n            var container = overlay ? this._overlaysList : this._baseLayersList;\r\n            if (container) {\r\n                this._applyOnTree(container, true);\r\n            }\r\n            return this._localExpand();\r\n        },\r\n\r\n        // Expands the tree, only to show the selected inputs\r\n        expandSelected: function(overlay) {\r\n            function iter(el) {\r\n                // Function to iterate the whole DOM upwards\r\n                var p = el.parentElement;\r\n                if (p) {\r\n                    if (L.DomUtil.hasClass(p, that.cls.children) &&\r\n                        !L.DomUtil.hasClass(el, that.cls.childrenNopad)) {\r\n                        L.DomUtil.removeClass(p, hide);\r\n                    }\r\n\r\n                    if (L.DomUtil.hasClass(p, that.cls.node)) {\r\n                        var h = p.getElementsByClassName(that.cls.header)[0];\r\n                        that._applyOnTree(h, false);\r\n                    }\r\n                    iter(p);\r\n                }\r\n            }\r\n\r\n            var that = this;\r\n            var container = overlay ? this._overlaysList : this._baseLayersList;\r\n            if (!container) return this;\r\n            var hide = this.cls.hide;\r\n            var inputs = this._layerControlInputs || container.getElementsByTagName('input');\r\n            for (var i = 0; i < inputs.length; i++) {\r\n                // Loop over every (valid) input.\r\n                var input = inputs[i];\r\n                if (this._getLayer && !!this._getLayer(input.layerId).overlay != !!overlay) continue;\r\n                if (input.checked) {\r\n                    // Get out of the header,\r\n                    // to not open the possible (but rare) children\r\n                    iter(input.parentElement.parentElement.parentElement.parentElement);\r\n                }\r\n            }\r\n            return this._localExpand();\r\n        },\r\n\r\n        // \"private\" methods, not exposed in the API\r\n        _sect: function() {\r\n            // to keep compatibility after 1.3 https://github.com/Leaflet/Leaflet/pull/6380\r\n            return this._section || this._form;\r\n        },\r\n\r\n        _setTrees: function(base, overlays) {\r\n            var id = 0; // to keep unique id\r\n            function iterate(tree, output, overlays) {\r\n                if (tree && tree.layer) {\r\n                    if (!overlays) {\r\n                        tree.layer._layersTreeName = tree.name || tree.label;\r\n                    }\r\n                    output[id++] = tree.layer;\r\n                }\r\n                if (tree && tree.children && tree.children.length) {\r\n                    tree.children.forEach(function(child) {\r\n                        iterate(child, output, overlays);\r\n                    });\r\n                }\r\n                return output;\r\n            }\r\n\r\n            // We accept arrays, but convert into an object with children\r\n            function forArrays(input) {\r\n                if (Array.isArray(input)) {\r\n                    return {noShow: true, children: input};\r\n                } else {\r\n                    return input;\r\n                }\r\n            }\r\n\r\n            // Clean everything, and start again.\r\n            if (this._layerControlInputs) {\r\n                this._layerControlInputs = [];\r\n            }\r\n            for (var i = 0; i < this._layers.length; ++i) {\r\n                this._layers[i].layer.off('add remove', this._onLayerChange, this);\r\n            }\r\n            this._layers = [];\r\n\r\n            if (base !== undefined) this._baseTree = forArrays(base);\r\n            if (overlays !== undefined) this._overlaysTree = forArrays(overlays);\r\n\r\n            var bflat = iterate(this._baseTree, {});\r\n            for (var j in bflat) {\r\n                this._addLayer(bflat[j], j);\r\n            }\r\n\r\n            var oflat = iterate(this._overlaysTree, {}, true);\r\n            for (var k in oflat) {\r\n                this._addLayer(oflat[k], k, true);\r\n            }\r\n            return (this._map) ? this._update() : this;\r\n        },\r\n\r\n        // Used to update the vertical scrollbar\r\n        _localExpand: function() {\r\n            if (this._map && L.DomUtil.hasClass(this._container, 'leaflet-control-layers-expanded')) {\r\n                var top = this._sect().scrollTop;\r\n                this.expand();\r\n                this._sect().scrollTop = top; // to keep the scroll location\r\n                this._scrollTop = top;\r\n            }\r\n            return this;\r\n        },\r\n\r\n        // collapses or expands the tree in the container.\r\n        _applyOnTree: function(container, collapse) {\r\n            var iters = [\r\n                {cls: this.cls.children, hide: collapse},\r\n                {cls: this.cls.opened, hide: collapse},\r\n                {cls: this.cls.closed, hide: !collapse},\r\n            ];\r\n            iters.forEach(function(it) {\r\n                var els = container.getElementsByClassName(it.cls);\r\n                for (var i = 0; i < els.length; i++) {\r\n                    var el = els[i];\r\n                    if (L.DomUtil.hasClass(el, this.cls.childrenNopad)) {\r\n                        // do nothing\r\n                    } else if (it.hide) {\r\n                        L.DomUtil.addClass(el, this.cls.hide);\r\n                    } else {\r\n                        L.DomUtil.removeClass(el, this.cls.hide);\r\n                    }\r\n                }\r\n            }, this);\r\n        },\r\n\r\n        // it is called in the original _update, and shouldn't do anything.\r\n        _addItem: function(_obj) {\r\n        },\r\n\r\n        // overwrite _update function in Control.Layers\r\n        _update: function() {\r\n            if (!this._container) { return this; }\r\n            L.Control.Layers.prototype._update.call(this);\r\n            this._addTreeLayout(this._baseTree, false);\r\n            this._addTreeLayout(this._overlaysTree, true);\r\n            return this._localExpand();\r\n        },\r\n\r\n        // Create the DOM objects for the tree\r\n        _addTreeLayout: function(tree, overlay) {\r\n            if (!tree) return;\r\n            var container = overlay ? this._overlaysList : this._baseLayersList;\r\n            this._expandCollapseAll(overlay, this.options.collapseAll, this.collapseTree);\r\n            this._expandCollapseAll(overlay, this.options.expandAll, this.expandTree);\r\n            this._iterateTreeLayout(tree, container, overlay, [], tree.noShow);\r\n            if (this._checkDisabledLayers) {\r\n                // to keep compatibility\r\n                this._checkDisabledLayers();\r\n            }\r\n        },\r\n\r\n        // Create the \"Collapse all\" or expand, if needed.\r\n        _expandCollapseAll: function(overlay, text, fn, ctx) {\r\n            var container = overlay ? this._overlaysList : this._baseLayersList;\r\n            ctx = ctx ? ctx : this;\r\n            if (text) {\r\n                var o = document.createElement('div');\r\n                o.className = 'leaflet-layerstree-expand-collapse';\r\n                container.appendChild(o);\r\n                o.innerHTML = text;\r\n                o.tabIndex = 0;\r\n                L.DomEvent.on(o, 'click keydown', function(e) {\r\n                    if (e.type !== 'keydown' || e.keyCode === 32) {\r\n                        o.blur();\r\n                        fn.call(ctx, overlay);\r\n                        this._localExpand();\r\n                    }\r\n                }, this);\r\n            }\r\n        },\r\n\r\n        // recursive function to create the DOM children\r\n        _iterateTreeLayout: function(tree, container, overlay, selAllNodes, noShow) {\r\n            if (!tree) return;\r\n            function creator(type, cls, append, innerHTML) {\r\n                var obj = L.DomUtil.create(type, cls, append);\r\n                if (innerHTML) obj.innerHTML = innerHTML;\r\n                return obj;\r\n            }\r\n\r\n            // Add this block to handle HTML elements\r\n            if (tree.html) {\r\n                var htmlContainer = creator('div', 'leaflet-layerstree-html-container', container);\r\n                htmlContainer.innerHTML = tree.html;\r\n                return;  // Skip normal processing for HTML nodes\r\n            }\r\n\r\n            // create the header with it fields\r\n            var header = creator('div', this.cls.header, container);\r\n            var sel = creator('span');\r\n            var entry = creator('span');\r\n            var closed = creator('span', this.cls.closed, sel, this.options.closedSymbol);\r\n            var opened = creator('span', this.cls.opened, sel, this.options.openedSymbol);\r\n            var space = creator('span', this.cls.space, null, this.options.spaceSymbol);\r\n            if (this.options.selectorBack) {\r\n                sel.insertBefore(space, closed);\r\n                header.appendChild(entry);\r\n                header.appendChild(sel);\r\n            } else {\r\n                sel.appendChild(space);\r\n                header.appendChild(sel);\r\n                header.appendChild(entry);\r\n            }\r\n\r\n            function updateSelAllCheckbox(ancestor) {\r\n                var selector = ancestor.querySelector('input[type=checkbox]');\r\n                var selectedAll = true;\r\n                var selectedNone = true;\r\n                var inputs = ancestor.querySelectorAll('input[type=checkbox]');\r\n                [].forEach.call(inputs, function(inp) { // to work in node for tests\r\n                    if (inp === selector) {\r\n                        // ignore\r\n                    } else if (inp.indeterminate) {\r\n                        selectedAll = false;\r\n                        selectedNone = false;\r\n                    } else if (inp.checked) {\r\n                        selectedNone = false;\r\n                    } else if (!inp.checked) {\r\n                        selectedAll = false;\r\n                    }\r\n                });\r\n                if (selectedAll) {\r\n                    selector.indeterminate = false;\r\n                    selector.checked = true;\r\n                } else if (selectedNone) {\r\n                    selector.indeterminate = false;\r\n                    selector.checked = false;\r\n                } else {\r\n                    selector.indeterminate = true;\r\n                    selector.checked = false;\r\n                }\r\n            }\r\n\r\n            function manageSelectorsAll(input, ctx) {\r\n                selAllNodes.forEach(function(ancestor) {\r\n                    L.DomEvent.on(input, 'click', function(_ev) {\r\n                        updateSelAllCheckbox(ancestor);\r\n                    }, ctx);\r\n                }, ctx);\r\n            }\r\n\r\n            var selAll;\r\n            if (tree.selectAllCheckbox) {\r\n                selAll = this._createCheckboxElement(false);\r\n                selAll.className += ' ' + this.cls.selAllCheckbox;\r\n            }\r\n\r\n            var hide = this.cls.hide; // To toggle state\r\n            // create the children group, with the header event click\r\n            if (tree.children) {\r\n                var children = creator('div', this.cls.children, container);\r\n                var sensible = tree.layer ? sel : header;\r\n                L.DomUtil.addClass(sensible, this.cls.pointer);\r\n                sensible.tabIndex = 0;\r\n                L.DomEvent.on(sensible, 'click keydown', function(e) {\r\n                    // leaflet internal flag to prevent click propagation and collapsing tree on mobile browsers\r\n                    if (this._preventClick) {\r\n                        return;\r\n                    }\r\n                    if (e.type === 'keydown' && e.keyCode !== 32) {\r\n                        return;\r\n                    }\r\n                    sensible.blur();\r\n\r\n                    if (L.DomUtil.hasClass(opened, hide)) {\r\n                        // it is not opened, so open it\r\n                        L.DomUtil.addClass(closed, hide);\r\n                        L.DomUtil.removeClass(opened, hide);\r\n                        L.DomUtil.removeClass(children, hide);\r\n                    } else {\r\n                        // close it\r\n                        L.DomUtil.removeClass(closed, hide);\r\n                        L.DomUtil.addClass(opened, hide);\r\n                        L.DomUtil.addClass(children, hide);\r\n                    }\r\n                    this._localExpand();\r\n                }, this);\r\n                if (selAll) {\r\n                    selAllNodes.splice(0, 0, container);\r\n                }\r\n                tree.children.forEach(function(child) {\r\n                    var node = creator('div', this.cls.node, children);\r\n                    this._iterateTreeLayout(child, node, overlay, selAllNodes);\r\n                }, this);\r\n                if (selAll) {\r\n                    selAllNodes.splice(0, 1);\r\n                }\r\n            } else {\r\n                // no children, so the selector makes no sense.\r\n                L.DomUtil.addClass(sel, this.cls.neverShow);\r\n            }\r\n\r\n            // make (or not) the label clickable to toggle the layer\r\n            var labelType;\r\n            if (tree.layer) {\r\n                if ((this.options.labelIsSelector === 'both') || // if option is set to both\r\n                    (overlay && this.options.labelIsSelector === 'overlay') || // if an overlay layer and options is set to overlay\r\n                    (!overlay && this.options.labelIsSelector === 'base')) { // if a base layer and option is set to base\r\n                    labelType = 'label';\r\n                } else { // if option is set to something else\r\n                    labelType = 'span';\r\n                }\r\n            } else {\r\n                labelType = 'span';\r\n            }\r\n            // create the input and label\r\n            var label = creator(labelType, this.cls.label, entry);\r\n            if (tree.layer) {\r\n                // now create the element like in _addItem\r\n                var checked = this._map.hasLayer(tree.layer);\r\n                var input;\r\n                var radioGroup = overlay ? tree.radioGroup : 'leaflet-base-layers_' + L.Util.stamp(this);\r\n                if (radioGroup) {\r\n                    input = this._createRadioElement(radioGroup, checked);\r\n                } else {\r\n                    input = this._createCheckboxElement(checked);\r\n                    manageSelectorsAll(input, this);\r\n                }\r\n                if (this._layerControlInputs) {\r\n                    // to keep compatibility with 1.0.3\r\n                    this._layerControlInputs.push(input);\r\n                }\r\n                input.layerId = L.Util.stamp(tree.layer);\r\n                L.DomEvent.on(input, 'click', this._onInputClick, this);\r\n                label.appendChild(input);\r\n            }\r\n\r\n            function isText(variable) {\r\n                return (typeof variable === 'string' || variable instanceof String);\r\n            }\r\n\r\n            function isFunction(functionToCheck) {\r\n                return functionToCheck && {}.toString.call(functionToCheck) === '[object Function]';\r\n            }\r\n\r\n            function selectAllCheckboxes(select, ctx) {\r\n                var inputs = container.getElementsByTagName('input');\r\n                for (var i = 0; i < inputs.length; i++) {\r\n                    var input = inputs[i];\r\n                    if (input.type !== 'checkbox') continue;\r\n                    input.checked = select;\r\n                    input.indeterminate = false;\r\n                }\r\n                ctx._onInputClick();\r\n            }\r\n            if (tree.selectAllCheckbox) {\r\n                // selAll is already created\r\n                label.appendChild(selAll);\r\n                if (isText(tree.selectAllCheckbox)) {\r\n                    selAll.title = tree.selectAllCheckbox;\r\n                }\r\n                L.DomEvent.on(selAll, 'click', function(ev) {\r\n                    ev.stopPropagation();\r\n                    selectAllCheckboxes(selAll.checked, this);\r\n                }, this);\r\n                updateSelAllCheckbox(container);\r\n                manageSelectorsAll(selAll, this);\r\n            }\r\n\r\n            creator('span', this.cls.name, label, tree.label);\r\n\r\n            // hide the button which doesn't fit the collapsed state, then hide children conditionally\r\n            L.DomUtil.addClass(tree.collapsed ? opened : closed, hide);\r\n            tree.collapsed && children && L.DomUtil.addClass(children, hide);\r\n\r\n            if (noShow) {\r\n                L.DomUtil.addClass(header, this.cls.neverShow);\r\n                L.DomUtil.addClass(children, this.cls.childrenNopad);\r\n            }\r\n\r\n            var eventeds = tree.eventedClasses;\r\n            if (!(eventeds instanceof Array)) {\r\n                eventeds = [eventeds];\r\n            }\r\n\r\n            for (var e = 0; e < eventeds.length; e++) {\r\n                var evented = eventeds[e];\r\n                if (evented && evented.className) {\r\n                    var obj = container.querySelector('.' + evented.className);\r\n                    if (obj) {\r\n                        L.DomEvent.on(obj, evented.event || 'click', (function(selectAll) {\r\n                            return function(ev) {\r\n                                ev.stopPropagation();\r\n                                var select = isFunction(selectAll) ? selectAll(ev, container, tree, this._map) : selectAll;\r\n                                if (select !== undefined && select !== null) {\r\n                                    selectAllCheckboxes(select, this);\r\n                                }\r\n                            };\r\n                        })(evented.selectAll), this);\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        _createCheckboxElement: function(checked) {\r\n            var input = document.createElement('input');\r\n            input.type = 'checkbox';\r\n            input.className = 'leaflet-control-layers-selector';\r\n            input.defaultChecked = checked;\r\n            return input;\r\n        },\r\n\r\n    });\r\n\r\n    L.control.layers.tree = function(base, overlays, options) {\r\n        return new L.Control.Layers.Tree(base, overlays, options);\r\n    };\r\n \r\n})(L);\r\nconsole.log(\"L.Control.Layers.Tree has been loaded!\");\r\n","/*\r\n leaflet.responsive.popup 1.0.0\r\n (c) 20222 https://github.com/yafred\r\n*/\r\n\r\nL.ResponsivePopup = L.Popup.extend({\r\n\t\t\r\n\toptions: {\r\n\t\thasTip: true\r\n\t\t/*\r\n\t\t * Inherited from L.Popup\r\n\t\t * \r\n\t\t * - offset\r\n\t\t * \r\n\t\t * - autoPanPadding\r\n\t\t * - autoPanPaddingTopLeft\r\n\t\t * - autoPanPaddingBottomRight\r\n\t\t */\r\n\t},\r\n\t\r\n\t/**\r\n\t * Overrides https://github.com/Leaflet/Leaflet/blob/399ed2105220f10b79e69b57420597e03502e611/src/layer/Popup.js#L183\r\n\t * This is to add hasTip option\r\n\t */\r\n\t_initLayout: function () {\r\n\r\n\t\tvar prefix = 'leaflet-popup',\r\n\t\t    container = this._container = L.DomUtil.create('div',\r\n\t\t\tprefix + ' ' + (this.options.className || '') +\r\n\t\t\t' leaflet-zoom-animated');\r\n\r\n\t\tvar wrapper = this._wrapper = L.DomUtil.create('div', prefix + '-content-wrapper', container);\r\n\t\tthis._contentNode = L.DomUtil.create('div', prefix + '-content', wrapper);\r\n\r\n\t\tL.DomEvent.disableClickPropagation(container);\r\n\t\tL.DomEvent.disableScrollPropagation(this._contentNode);\r\n\t\tL.DomEvent.on(container, 'contextmenu', L.DomEvent.stopPropagation);\r\n\r\n\t\tthis._tipContainer = L.DomUtil.create('div', prefix + '-tip-container', container);\r\n\t\tif(!this.options.hasTip) {\r\n\t\t\tthis._tipContainer.style.visibility = 'hidden';\r\n\t\t}\r\n\t\tthis._tip = L.DomUtil.create('div', prefix + '-tip', this._tipContainer);\r\n\r\n\t\tif (this.options.closeButton) {\r\n\t\t\tvar closeButton = this._closeButton = L.DomUtil.create('a', prefix + '-close-button', container);\r\n\t\t\tcloseButton.setAttribute('role', 'button'); // overrides the implicit role=link of <a> elements #7399\r\n\t\t\tcloseButton.setAttribute('aria-label', 'Close popup');\r\n\t\t\tcloseButton.href = '#close';\r\n\t\t\tcloseButton.innerHTML = '<span aria-hidden=\"true\">&#215;</span>';\r\n\r\n\t\t\tL.DomEvent.on(closeButton, 'click', function (ev) {\r\n\t\t\t\tL.DomEvent.preventDefault(ev);\r\n\t\t\t\tthis.close();\r\n\t\t\t}, this);\r\n\t\t}\r\n\t},\r\n\t\r\n\t\r\n\t\r\n\t/**\r\n\t * Overrides https://github.com/Leaflet/Leaflet/blob/v1.3.4/src/layer/DivOverlay.js#L178\r\n\t */\r\n\t_updatePosition: function () {\r\n\r\n\t\tif (!this._map) { return; }\r\n\t\t\r\n\t\tvar pos = this._map.latLngToLayerPoint(this._latlng),\r\n\t        basePoint = this._map.layerPointToContainerPoint(pos),\r\n\t        containerWidth = this._container.offsetWidth,\r\n\t        containerHeight = this._container.offsetHeight,\r\n\t\t    padding = L.point(this.options.autoPanPadding),\r\n\t\t    paddingTL = L.point(this.options.autoPanPaddingTopLeft || padding),\r\n\t\t    paddingBR = L.point(this.options.autoPanPaddingBottomRight || padding),\r\n\t        mapSize = this._map.getSize(),\r\n\t        anchor = this._getAnchor(),  // popup anchor\r\n        \toffset = L.point(this.options.offset); // offset relative to anchor (option from L.DivOverlay. We only use absolute values).\r\n  \r\n\t\t// Leaflet default dimensions (should not be hard coded in the future)\r\n  \t\tvar tipHeight = 11; //px\r\n  \t\tvar tipWidth = 22; //px\r\n  \t\tvar containerRadius = 12; //px  \r\n\t\t\r\n  \t\t// Tweak offset to include tip dimensions \r\n  \t\tvar offsetX = Math.abs(offset.x);\r\n   \t\tvar offsetY = Math.abs(offset.y);\r\n   \t\tif(this.options.hasTip) {\r\n  \t\t\toffsetX += tipHeight;\r\n  \t\t\toffsetY += tipHeight;  \r\n  \t\t\t\r\n  \t\t\t// clear CSS\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-north');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-south');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-east');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-west');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-north-east');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-north-west');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-south-east');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-south-west');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-east-north');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-east-south');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-west-north');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-west-south');\r\n  \t\t\t// this._container.style.display = 'initial'; // this does not work\r\n  \t\t}\r\n\t\t\r\n\t\t// Where can we fit the popup ?\r\n\t\tvar canGoTop = true,\r\n\t\t    canGoBottom = true,\r\n\t\t    canGoLeft = true,\r\n\t\t    canGoRight = true,\r\n\t\t    containerPos = false;\r\n\t\t\r\n\t\tif(basePoint.y + anchor.y - offsetY - containerHeight - Math.abs(paddingTL.y) < 0) {\r\n\t\t\tcanGoTop = false;\r\n\t\t}\r\n\t\tif(basePoint.y + anchor.y + offsetY + containerHeight + Math.abs(paddingBR.y) > mapSize.y) {\r\n\t\t\tcanGoBottom = false;\r\n\t\t}\r\n\t\tif(basePoint.x + anchor.x - offsetX - containerWidth - Math.abs(paddingTL.x) < 0) {\r\n\t\t\tcanGoLeft = false;\r\n\t\t}\r\n\t\tif(basePoint.x + anchor.x + offsetX + containerWidth + Math.abs(paddingBR.x) > mapSize.x) {\r\n\t\t\tcanGoRight = false;\r\n\t\t}\r\n\t\t\r\n\t\t// manage overflows\r\n\t\tvar subtractX = containerWidth / 2 - anchor.x,\r\n\t\t    subtractY = containerHeight / 2 - anchor.y;\r\n\t\t\r\n\t\tif(canGoTop || canGoBottom) {\t\t\r\n\t\t\tvar containerLeft = basePoint.x + anchor.x - (containerWidth / 2);\r\n\t\t\tvar containerRight = basePoint.x + anchor.x + (containerWidth / 2);\r\n\t\t\tif(containerLeft < Math.abs(paddingTL.x)) { // left overflow\r\n\t\t\t\tsubtractX = containerWidth / 2 - anchor.x - Math.abs(paddingTL.x) + containerLeft;\r\n\t\t\t}\t\t\r\n\t\t\tif(containerRight > mapSize.x - Math.abs(paddingBR.x)) { // right overflow\r\n\t\t\t\tsubtractX = containerWidth / 2 - anchor.x + containerRight - mapSize.x + Math.abs(paddingBR.x);\r\n\t\t\t}\t\t\t\t\t\t\r\n\t\t}\t\r\n\t\tif(canGoLeft || canGoRight) {\r\n\t\t\tvar containerTop = basePoint.y + anchor.y - (containerHeight / 2);\r\n\t\t\tvar containerBottom = basePoint.y + anchor.y + (containerHeight / 2);\r\n\t\t\tif(containerTop < Math.abs(paddingTL.y)) { // top overflow\r\n\t\t\t\tsubtractY = containerHeight / 2 - anchor.y - Math.abs(paddingTL.y) + containerTop;\r\n\t\t\t}\t\t\r\n\t\t\tif(containerBottom > mapSize.y - Math.abs(paddingBR.y)) { // bottom overflow\r\n\t\t\t\tsubtractY = containerHeight / 2 - anchor.y + containerBottom - mapSize.y + Math.abs(paddingBR.y);\r\n\t\t\t}\t\t\t\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\t// position the popup (order of preference is: top, left, bottom, right, centerOnMap)\r\n\t\tif(canGoTop) {\r\n\t\t\tcontainerPos = pos.subtract(L.point(subtractX, -anchor.y + containerHeight + offsetY, true));\r\n\t\t\tif(this.options.hasTip) {\r\n\t\t\t\tif(basePoint.x + anchor.x < paddingTL.x + containerRadius + tipWidth/2) {\r\n\t\t\t\t\tcontainerPos.x = pos.x + anchor.x;\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-north-east');\r\n\t\t\t\t\tthis._tipContainer.style.top = containerHeight + 'px';\r\n\t\t\t\t\tthis._tipContainer.style.left = '0px';\r\n\t\t\t\t}\r\n\t\t\t\telse if(basePoint.x + anchor.x > mapSize.x - paddingBR.x - containerRadius - tipWidth/2) {\r\n\t\t\t\t\tcontainerPos.x = pos.x + anchor.x - containerWidth;\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-north-west');\t\r\n\t\t\t\t\tthis._tipContainer.style.top = containerHeight + 'px';\r\n\t\t\t\t\tthis._tipContainer.style.left = containerWidth + 'px';\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-north');\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tthis._tipContainer.style.top = containerHeight + 'px';\r\n\t\t\t\t\tthis._tipContainer.style.left = (pos.x + anchor.x - containerPos.x) + 'px';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(canGoLeft) {\r\n\t\t\tcontainerPos = pos.subtract(L.point(-anchor.x + containerWidth + offsetX, subtractY, true));\r\n\t\t\tif(this.options.hasTip) {\r\n\t\t\t\tif(basePoint.y + anchor.y < paddingTL.y + containerRadius + tipWidth/2) {\r\n\t\t\t\t\tcontainerPos.y = pos.y + anchor.y;\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-west-south');\r\n\t\t\t\t\tthis._tipContainer.style.top = '0px';\r\n\t\t\t\t\tthis._tipContainer.style.left = containerWidth + 'px';\r\n\t\t\t\t}\r\n\t\t\t\telse if(basePoint.y + anchor.y > mapSize.y - paddingBR.y - containerRadius - tipWidth/2) {\r\n\t\t\t\t\tcontainerPos.y = pos.y + anchor.y - containerHeight;\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-west-north');\t\t\t\t\t\r\n\t\t\t\t\tthis._tipContainer.style.top = containerHeight + 'px';\r\n\t\t\t\t\tthis._tipContainer.style.left = containerWidth + 'px';\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-west');\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tthis._tipContainer.style.top = (pos.y + anchor.y - containerPos.y) + 'px';\r\n\t\t\t\t\tthis._tipContainer.style.left = containerWidth + 'px';\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(canGoBottom) {\r\n\t\t\tcontainerPos = pos.subtract(L.point(subtractX, -anchor.y - offsetY, true));\r\n\t\t\tif(this.options.hasTip) {\r\n\t\t\t\tif(basePoint.x + anchor.x < paddingTL.x + containerRadius + tipWidth/2) {\r\n\t\t\t\t\tcontainerPos.x = pos.x + anchor.x;\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-south-east');\r\n\t\t\t\t\tthis._tipContainer.style.top = '0px';\r\n\t\t\t\t\tthis._tipContainer.style.left = '0px';\r\n\t\t\t\t}\r\n\t\t\t\telse if(basePoint.x + anchor.x > mapSize.x - paddingBR.x - containerRadius - tipWidth/2) {\r\n\t\t\t\t\tcontainerPos.x = pos.x + anchor.x - containerWidth;\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-south-west');\t\t\t\t\t\r\n\t\t\t\t\tthis._tipContainer.style.top = '0px';\r\n\t\t\t\t\tthis._tipContainer.style.left = containerWidth + 'px';\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-south');\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tthis._tipContainer.style.top = '0px';\r\n\t\t\t\t\tthis._tipContainer.style.left = (pos.x + anchor.x - containerPos.x) + 'px';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(canGoRight) {\r\n\t\t\tcontainerPos = pos.subtract(L.point(-anchor.x - offsetX, subtractY, true));\r\n\t\t\tif(this.options.hasTip) {\r\n\t\t\t\tif(basePoint.y + anchor.y < paddingTL.y + containerRadius + tipWidth/2) {\r\n\t\t\t\t\tcontainerPos.y = pos.y + anchor.y;\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-east-south');\r\n\t\t\t\t\tthis._tipContainer.style.top = '0px';\r\n\t\t\t\t\tthis._tipContainer.style.left = '0px';\r\n\t\t\t\t}\r\n\t\t\t\telse if(basePoint.y + anchor.y > mapSize.y - paddingBR.y - containerRadius - tipWidth/2) {\r\n\t\t\t\t\tcontainerPos.y = pos.y + anchor.y - containerHeight;\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-east-north');\t\t\t\t\t\r\n\t\t\t\t\tthis._tipContainer.style.top = containerHeight + 'px';\r\n\t\t\t\t\tthis._tipContainer.style.left = '0px';\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-east');\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tthis._tipContainer.style.top = (pos.y + anchor.y - containerPos.y) + 'px';\r\n\t\t\t\t\tthis._tipContainer.style.left = '0px';\r\n\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar pos = this._map.latLngToLayerPoint(this._map.getCenter());\r\n\t\t\tcontainerPos = pos.subtract(L.point(containerWidth / 2, containerHeight / 2));\r\n\t\t\tif(this.options.hasTip) {\r\n\t\t\t\t// this._tipContainer.style.display = 'none'; // this does not work\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t\t\r\n\t\t// if point is not visible, just hide the popup\r\n\t\tif(basePoint.x < 0 || basePoint.y < 0 || basePoint.x > mapSize.x || basePoint.y > mapSize.y) {\r\n\t\t\t// this._container.style.display = 'none';  // this does not work\r\n\t\t}\r\n\t\t\r\n\t\t// if container is too big, just hide the popup\r\n\t\tif(containerWidth - Math.abs(paddingTL.x) - Math.abs(paddingBR.x) > mapSize.x || containerHeight - Math.abs(paddingTL.y) - Math.abs(paddingBR.y) > mapSize.y) {\r\n\t\t\t// this._container.style.display = 'none'; // this does not work\r\n\t\t}\r\n\t\t\r\n\t\tL.DomUtil.setPosition(this._container, containerPos);\r\n\t}\r\n\t\r\n});\r\n\r\n\r\n//Instantiates a `ResponsivePopup` object given an optional `options` object that describes its appearance and location and an optional `source` object that is used to tag the popup with a reference to the Layer to which it refers.\r\nL.responsivePopup = function (options, source) {\r\n\treturn new L.ResponsivePopup(options, source);\r\n};\r\n\r\n//Adds Angular support\r\nif( typeof exports === 'object' && typeof module !== 'undefined') {\r\n\texports.responsivePopup = L.responsivePopup;\r\n\texports.ResponsivePopup = L.ResponsivePopup;\r\n}","\r\n\r\nconst InfoControl = L.Control.extend({\r\n    onAdd: function(map) {\r\n        var container = L.DomUtil.create('div', 'info-control leaflet-bar leaflet-control');\r\n        var link = L.DomUtil.create('a', 'leaflet-control-button', container);\r\n        link.href = '#';\r\n        var img = L.DomUtil.create('img', 'info-control-icon', link);\r\n        img.src = 'assets/images/info.png';\r\n        img.alt = 'Information';\r\n        img.style.width = '24px';\r\n        img.style.height = '24px';\r\n        img.style.padding = '4px';\r\n\r\n        L.DomEvent.disableClickPropagation(container);\r\n        L.DomEvent.on(link, 'click', function(e) {\r\n            L.DomEvent.stop(e);\r\n            var popupContent = '<div class=\"info-popup-content\" style=\"padding: 10px;\">' +\r\n                // '<h3 class=\"popup-logo-container\"><img class=\"popup-logo\" src=\"/assets/images/XCmapsLogo.png\" alt=\"XCmaps \"></h3>' +\r\n                '<h3>About XCmaps</h3>'+\r\n                '<p>XCmaps combines various data sources for aerial sports navigation.</p>'+\r\n                '<p>You can contact us by <a href=\"mailto:info@XCmaps.com\" target=\"_blank\">email</a>, or report any issue on github.</p>'+\r\n                '<p><strong>Credits:</strong></p>' +\r\n                '<ul>' +\r\n                '<li>Terrain tiles by <a href=\"https://www.jawg.io\" target=\"_blank\"></a></li>' +\r\n                '<li>OpenStreetMap</li>' +\r\n                '<li>XContest terrain data</li>' +\r\n                '<li>MapTiler for GL layer</li>' +\r\n                '<li>Airspaces: Airspaces are imported from openaip:\"OpenAIP data is not certified and must not be used for primary navigation or flight planning. Never rely on openAIP data! OpenAIP data contains errors. Using openAIP data may result in serious injury or death.\"</li>' +\r\n                '<li>Wind Stations: based on <a href=\"https://github.com/winds-mobi/\" target=\"_blank\">winds.mobi</a> by Yann Savary and additional data sources</li>' +\r\n                '<li>Spots:  <a href=\"https://paraglidingspots.com\" target=\"_blank\">paraglidingspots.com</a> by Karsten Ehlers</li>' +\r\n                '<li>and many more open source libraries, projects, and artwork</li>' +\r\n                '</ul>' +\r\n                '<p>This map combines various data sources for aerial sports navigation.</p>' +\r\n                '<p><a href=\"https://buymeacoffee.com/XCmaps\" target=\"_blank\" class=\"donation-button\">  Buy us a Landing Beer</a></p></div>';\r\n            \r\n            // Create the standard Leaflet popup\r\n            var popup = L.popup({\r\n                className: 'info-popup',\r\n                autoPan: true,\r\n                maxWidth: 700,\r\n                offset: [0, 300]\r\n            })\r\n                .setLatLng(map.getCenter())\r\n                .setContent(popupContent)\r\n                .openOn(map);\r\n        });\r\n\r\n        return container;\r\n    }\r\n});\r\n\r\nexport default InfoControl;\r\n\r\n","// airspaces.js\r\n// Store the airspace click handler as a module-level variable so we can reference it later\r\nlet airspaceClickHandler = null;\r\nlet currentLowerLimit = 3000; // Default value matching dropdown\r\nlet airspaceDebounceTimer;\r\n\r\n\r\n// Add the convertToMeters function\r\nfunction convertToMeters(value, unitCode) {\r\n  switch (unitCode) {\r\n    case 1: // Feet to meters\r\n      return value * 0.3048;\r\n    case 2: // Meters (no conversion)\r\n      return value;\r\n    case 6: // Flight Level (FL * 100 ft to meters)\r\n      return value * 100 * 0.3048;\r\n    default:\r\n      return null; // Unknown unit\r\n  }\r\n}\r\n\r\nfunction fetchAirspaces() {\r\n  // Make sure map is available\r\n  if (!window.map) {\r\n    console.error(\"Map not initialized yet\");\r\n    return;\r\n  }\r\n  \r\n  const center = window.map.getCenter();\r\n  const lat = center.lat.toFixed(6);\r\n  const lng = center.lng.toFixed(6);\r\n  const types = [0, 1, 3, 4, 5, 7, 26, 28];\r\n\r\n  const apiUrl = `/api/airspaces?lat=${lat}&lng=${lng}&dist=200000&types=${encodeURIComponent(types.join(','))}`;\r\n\r\n  fetch(apiUrl)\r\n    .then(response => response.json())\r\n    .then(data => {\r\n      // Clear existing layers\r\n      window.airspaceEFG.clearLayers();\r\n\r\n      const airspaces = []; // Store polygons and data for later use\r\n\r\n      data.items.forEach(airspace => {\r\n        if (airspace.type === 0 && airspace.icaoClass === 4) {\r\n          return;\r\n        }\r\n\r\n        // Get current limit from dropdown\r\n        const selectedLimit = parseInt(document.getElementById('airspaceLowerLimit').value, 10);\r\n\r\n        // Filter based on lower limit converted to meters\r\n        const lowerLimit = airspace.lowerLimit;\r\n        if (!lowerLimit) return; // Skip if no lower limit data\r\n\r\n        const lowerLimitMeters = convertToMeters(lowerLimit.value, lowerLimit.unit);\r\n        if (lowerLimitMeters === null || lowerLimitMeters >= selectedLimit) {  // Modified line\r\n            return; // Now using dynamic limit from dropdown\r\n        }\r\n\r\n        if (airspace.geometry && airspace.geometry.type === \"Polygon\") {\r\n          const coordinates = airspace.geometry.coordinates[0].map(coord => [coord[1], coord[0]]);\r\n\r\n          const lowerLimit = airspace.lowerLimit.value;\r\n          const color = lowerLimit === 0 ? \"red\" : \"blue\";\r\n\r\n          const airspaceTypeText = airspaceTypes[airspace.type] || \"Unknown\";\r\n          const icaoClassText = icaoClasses[airspace.icaoClass] || \"Unknown\";\r\n\r\n          const polygon = L.polygon(coordinates, {\r\n            color: color,\r\n            weight: 2,\r\n            fillOpacity: 0.3\r\n          });\r\n\r\n          // Store airspace data with its polygon\r\n          airspaces.push({ polygon, data: airspace });\r\n\r\n          window.airspaceEFG.addLayer(polygon);\r\n        }\r\n      });\r\n\r\n      console.log(`Added ${airspaces.length} airspaces to the map`);\r\n\r\n      // Remove any existing click listeners to avoid duplicates\r\n      if (airspaceClickHandler) {\r\n        window.map.off(\"click\", airspaceClickHandler);\r\n      }\r\n\r\n      // Create a new click handler that captures the airspaces in its closure\r\n      airspaceClickHandler = function(e) {\r\n        // Check if the airspace layer is actually visible before processing clicks\r\n        if (!window.map.hasLayer(window.airspaceEFG)) {\r\n          return; // Exit if airspace layer is not visible\r\n        }\r\n\r\n        const clickedPoint = e.latlng;\r\n        const overlappingAirspaces = [];\r\n\r\n        airspaces.forEach(({ polygon, data }) => {\r\n          if (polygon.getBounds().contains(clickedPoint)) {\r\n            overlappingAirspaces.push(data);\r\n          }\r\n        });\r\n\r\n        if (overlappingAirspaces.length > 0) {\r\n          const popupContent = overlappingAirspaces.map(a => `\r\n            <b>${a.name}</b><br>\r\n            Type: ${airspaceTypes[a.type] || \"Unknown\"}<br>\r\n            ICAO Class: ${icaoClasses[a.icaoClass] || \"Unknown\"}<br>\r\n            ID: ${a._id}<br>\r\n            ${a.lowerLimit.value} ${getUnit(a.lowerLimit.unit)}  ${a.upperLimit.value} ${getUnit(a.upperLimit.unit)}<br>\r\n          `).join(\"<hr>\");\r\n\r\n          L.popup()\r\n            .setLatLng(clickedPoint)\r\n            .setContent(popupContent)\r\n            .openOn(window.map);\r\n        }\r\n      };\r\n      \r\n      // Add the new click handler\r\n      window.map.on(\"click\", airspaceClickHandler);\r\n    })\r\n    .catch(error => console.error(\"Error fetching airspaces:\", error));\r\n}\r\n\r\n// Lookup tables for airspace type and ICAO class\r\n\r\nconst airspaceTypes = {\r\n  0: \"Other\",\r\n  1: \"Restricted\",\r\n  2: \"Danger (D)\",\r\n  3: \"Prohibited (Parc reserve)\",\r\n  4: \"Controlled Tower Region (CTR)\",\r\n  5: \"Transponder Mandatory Zone (TMZ)\",\r\n  6: \"Radio Mandatory Zone (RMZ)\",\r\n  7: \"Terminal Maneuvering Area (TMA)\",\r\n  8: \"Temporary Reserved Area (TRA)\",\r\n  9: \"Temporary Segregated Area (TSA)\",\r\n  10: \"Flight Information Region (FIR)\",\r\n  11: \"Upper Flight Information Region (UIR)\",\r\n  12: \"Air Defense Identification Zone (ADIZ)\",\r\n  13: \"Airport Traffic Zone (ATZ)\",\r\n  14: \"Military Airport Traffic Zone (MATZ)\",\r\n  15: \"Airway\",\r\n  16: \"Military Training Route (MTR)\",\r\n  17: \"Alert Area\",\r\n  18: \"Warning Area\",\r\n  19: \"Protected Area\",\r\n  20: \"Helicopter Traffic Zone (HTZ)\",\r\n  21: \"Gliding Sector\",\r\n  22: \"Transponder Setting (TRP)\",\r\n  23: \"Traffic Information Zone (TIZ)\",\r\n  24: \"Traffic Information Area (TIA)\",\r\n  25: \"Military Training Area (MTA)\",\r\n  26: \"Control Area (CTA)\",\r\n  27: \"ACC Sector (ACC)\",\r\n  28: \"Aerial Sporting Or Recreational Activity\",\r\n  29: \"Low Altitude Overflight Restriction\",\r\n  30: \"Military Route (MRT)\",\r\n  31: \"TSA/TRA Feeding Route (TFR)\",\r\n  32: \"VFR Sector\",\r\n  33: \"FIS Sector\",\r\n  34: \"Lower Traffic Area (LTA)\",\r\n  35: \"Upper Traffic Area (UTA)\"\r\n};\r\n\r\nconst icaoClasses = {\r\n  0: \"A\",\r\n  1: \"B\",\r\n  2: \"C\",\r\n  3: \"D\",\r\n  4: \"E\",\r\n  5: \"F\",\r\n  6: \"G\",\r\n  8: \"Special Use Airspace (SUA)\"\r\n};\r\n\r\nfunction getUnit(unitCode) {\r\n  const units = {\r\n    1: \"ft\", // Feet\r\n    2: \"m\",\r\n    6: \"FL\"  // Flight Level\r\n  };\r\n  return units[unitCode] || \"Unknown\";\r\n}\r\n\r\n\r\n// Export the fetchAirspaces function to make it globally available\r\nwindow.fetchAirspaces = fetchAirspaces;\r\n\r\n// Listen for map layer visibility changes\r\ndocument.addEventListener('map_initialized', function() {\r\n  console.log(\"Setting up airspace layer events\");\r\n  \r\n  // Add event listener for when the airspace layer is added to the map\r\n  window.map.on('overlayadd', function(e) {\r\n    if (e.name === 'Airspaces' || e.name === 'Gliding' || e.name === 'Notam') {\r\n      console.log(`Overlay added: ${e.name}, fetching airspaces`);\r\n      fetchAirspaces();\r\n    }\r\n  });\r\n\r\n  // Add event listener with debouncing\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n  document.body.addEventListener('change', function(e) {\r\n    if (e.target && e.target.id === 'airspaceLowerLimit') {\r\n      const newLimit = parseInt(e.target.value, 10);\r\n      \r\n      // Only update if value changed\r\n      if (newLimit !== currentLowerLimit) {\r\n        currentLowerLimit = newLimit;\r\n        \r\n        // Clear any pending debounce\r\n        clearTimeout(airspaceDebounceTimer);\r\n        \r\n        // Debounce to prevent rapid successive requests\r\n        airspaceDebounceTimer = setTimeout(() => {\r\n          if (window.map.hasLayer(window.airspaceEFG)) {\r\n            console.log(`Lower limit changed to ${newLimit}m, reloading airspaces`);\r\n            fetchAirspaces();\r\n          }\r\n        }, 300); // 300ms debounce delay\r\n      }\r\n    }\r\n  });\r\n});\r\n\r\n\r\n  // Also set up the moveend event to refresh airspaces when panning/zooming\r\n  window.map.on('moveend', function() {\r\n    // Only fetch if the layer is currently visible\r\n    if (window.map.hasLayer(window.airspaceEFG)) {\r\n      console.log(\"Map moved, refreshing airspaces\");\r\n      fetchAirspaces();\r\n    }\r\n  });\r\n});\r\n\r\n\r\n// Don't auto-fetch on script load - wait for the layer to be enabled\r\n// Remove or comment out: fetchAirspaces();","// airspaces.js\r\n// Store the airspace click handler as a module-level variable so we can reference it later\r\nlet airspaceClickHandler = null;\r\n\r\nfunction fetchAirspacesGliding() {\r\n  // Make sure map is available\r\n  if (!window.map) {\r\n    console.error(\"Map not initialized yet\");\r\n    return;\r\n  }\r\n  \r\n  const center = window.map.getCenter();\r\n  const lat = center.lat.toFixed(6);\r\n  const lng = center.lng.toFixed(6);\r\n  const types = [21];\r\n\r\n  const apiUrl = `${process.env.APP_DOMAIN}/api/airspaces?lat=${lat}&lng=${lng}&dist=200000&types=${encodeURIComponent(types.join(','))}`;\r\n\r\n  fetch(apiUrl)\r\n    .then(response => response.json())\r\n    .then(data => {\r\n      // Clear existing layers\r\n      window.airspaceGliding.clearLayers();\r\n\r\n      const airspaces = []; // Store polygons and data for later use\r\n\r\n      data.items.forEach(airspace => {\r\n        if (airspace.type === 0 && airspace.icaoClass === 4) {\r\n          return;\r\n        }\r\n\r\n        if (airspace.geometry && airspace.geometry.type === \"Polygon\") {\r\n          const coordinates = airspace.geometry.coordinates[0].map(coord => [coord[1], coord[0]]);\r\n\r\n          const lowerLimit = airspace.lowerLimit.value;\r\n          const color = lowerLimit === 0 ? \"red\" : \"green\";\r\n\r\n          const airspaceTypeText = airspaceTypes[airspace.type] || \"Unknown\";\r\n          const icaoClassText = icaoClasses[airspace.icaoClass] || \"Unknown\";\r\n\r\n          const polygon = L.polygon(coordinates, {\r\n            color: color,\r\n            weight: 2,\r\n            fillOpacity: 0.3\r\n          });\r\n\r\n          // Store airspace data with its polygon\r\n          airspaces.push({ polygon, data: airspace });\r\n\r\n          window.airspaceGliding.addLayer(polygon);\r\n        }\r\n      });\r\n\r\n      console.log(`Added ${airspaces.length} airspaces to the map`);\r\n\r\n      // Remove any existing click listeners to avoid duplicates\r\n      if (airspaceClickHandler) {\r\n        window.map.off(\"click\", airspaceClickHandler);\r\n      }\r\n\r\n      // Create a new click handler that captures the airspaces in its closure\r\n      airspaceClickHandler = function(e) {\r\n        // Check if the airspace layer is actually visible before processing clicks\r\n        if (!window.map.hasLayer(window.airspaceGliding)) {\r\n          return; // Exit if airspace layer is not visible\r\n        }\r\n\r\n        const clickedPoint = e.latlng;\r\n        const overlappingAirspaces = [];\r\n\r\n        airspaces.forEach(({ polygon, data }) => {\r\n          if (polygon.getBounds().contains(clickedPoint)) {\r\n            overlappingAirspaces.push(data);\r\n          }\r\n        });\r\n\r\n        if (overlappingAirspaces.length > 0) {\r\n          const popupContent = overlappingAirspaces.map(a => `\r\n            <b>${a.name}</b><br>\r\n            Type: ${airspaceTypes[a.type] || \"Unknown\"}<br>\r\n            ICAO Class: ${icaoClasses[a.icaoClass] || \"Unknown\"}<br>\r\n            ${a.lowerLimit.value} ${getUnit(a.lowerLimit.unit)}  ${a.upperLimit.value} ${getUnit(a.upperLimit.unit)}<br>\r\n          `).join(\"<hr>\");\r\n\r\n          L.popup()\r\n            .setLatLng(clickedPoint)\r\n            .setContent(popupContent)\r\n            .openOn(window.map);\r\n        }\r\n      };\r\n      \r\n      // Add the new click handler\r\n      window.map.on(\"click\", airspaceClickHandler);\r\n    })\r\n    .catch(error => console.error(\"Error fetching airspaces:\", error));\r\n}\r\n\r\n// Lookup tables for airspace type and ICAO class\r\n\r\nconst airspaceTypes = {\r\n  0: \"Other\",\r\n  1: \"Restricted\",\r\n  2: \"Danger (D)\",\r\n  3: \"Prohibited (Parc reserve)\",\r\n  4: \"Controlled Tower Region (CTR)\",\r\n  5: \"Transponder Mandatory Zone (TMZ)\",\r\n  6: \"Radio Mandatory Zone (RMZ)\",\r\n  7: \"Terminal Maneuvering Area (TMA)\",\r\n  8: \"Temporary Reserved Area (TRA)\",\r\n  9: \"Temporary Segregated Area (TSA)\",\r\n  10: \"Flight Information Region (FIR)\",\r\n  11: \"Upper Flight Information Region (UIR)\",\r\n  12: \"Air Defense Identification Zone (ADIZ)\",\r\n  13: \"Airport Traffic Zone (ATZ)\",\r\n  14: \"Military Airport Traffic Zone (MATZ)\",\r\n  15: \"Airway\",\r\n  16: \"Military Training Route (MTR)\",\r\n  17: \"Alert Area\",\r\n  18: \"Warning Area\",\r\n  19: \"Protected Area\",\r\n  20: \"Helicopter Traffic Zone (HTZ)\",\r\n  21: \"Gliding Sector\",\r\n  22: \"Transponder Setting (TRP)\",\r\n  23: \"Traffic Information Zone (TIZ)\",\r\n  24: \"Traffic Information Area (TIA)\",\r\n  25: \"Military Training Area (MTA)\",\r\n  26: \"Control Area (CTA)\",\r\n  27: \"ACC Sector (ACC)\",\r\n  28: \"Aerial Sporting Or Recreational Activity\",\r\n  29: \"Low Altitude Overflight Restriction\",\r\n  30: \"Military Route (MRT)\",\r\n  31: \"TSA/TRA Feeding Route (TFR)\",\r\n  32: \"VFR Sector\",\r\n  33: \"FIS Sector\",\r\n  34: \"Lower Traffic Area (LTA)\",\r\n  35: \"Upper Traffic Area (UTA)\"\r\n};\r\n\r\nconst icaoClasses = {\r\n  0: \"A\",\r\n  1: \"B\",\r\n  2: \"C\",\r\n  3: \"D\",\r\n  4: \"E\",\r\n  5: \"F\",\r\n  6: \"G\",\r\n  8: \"Special Use Airspace (SUA)\"\r\n};\r\n\r\nfunction getUnit(unitCode) {\r\n  const units = {\r\n    1: \"ft\", // Feet\r\n    6: \"FL\"  // Flight Level\r\n  };\r\n  return units[unitCode] || \"Unknown\";\r\n}\r\n\r\n\r\n// Export the fetchAirspacesGliding function to make it globally available\r\nwindow.fetchAirspacesGliding = fetchAirspacesGliding;\r\n\r\n// Listen for map layer visibility changes\r\ndocument.addEventListener('map_initialized', function() {\r\n  console.log(\"Setting up airspace layer events\");\r\n  \r\n  // Add event listener for when the airspace layer is added to the map\r\n  window.map.on('overlayadd', function(e) {\r\n    if (e.name === 'Airspaces' || e.name === 'Gliding' || e.name === 'Notam') {\r\n      console.log(`Overlay added: ${e.name}, fetching airspaces`);\r\n      fetchAirspacesGliding();\r\n    }\r\n  });\r\n  \r\n  // Also set up the moveend event to refresh airspaces when panning/zooming\r\n  window.map.on('moveend', function() {\r\n    // Only fetch if the layer is currently visible\r\n    if (window.map.hasLayer(window.airspaceGliding)) {\r\n      console.log(\"Map moved, refreshing airspaces\");\r\n      fetchAirspacesGliding();\r\n    }\r\n  });\r\n});\r\n\r\n// Don't auto-fetch on script load - wait for the layer to be enabled\r\n// Remove or comment out: fetchAirspacesGliding();","// airspaces.js\r\n// Store the airspace click handler as a module-level variable so we can reference it later\r\nlet airspaceClickHandler = null;\r\n\r\nfunction fetchAirspacesNotam() {\r\n  // Make sure map is available\r\n  if (!window.map) {\r\n    console.error(\"Map not initialized yet\");\r\n    return;\r\n  }\r\n  \r\n  const center = window.map.getCenter();\r\n  const lat = center.lat.toFixed(6);\r\n  const lng = center.lng.toFixed(6);\r\n  const types = [8, 9];\r\n\r\n  const apiUrl = `${process.env.APP_DOMAIN}/api/airspaces?lat=${lat}&lng=${lng}&dist=200000&types=${encodeURIComponent(types.join(','))}`;\r\n\r\n  fetch(apiUrl)\r\n    .then(response => response.json())\r\n    .then(data => {\r\n      // Clear existing layers\r\n      window.airspaceNotam.clearLayers();\r\n\r\n      const airspaces = []; // Store polygons and data for later use\r\n\r\n      data.items.forEach(airspace => {\r\n        if (airspace.type === 0 && airspace.icaoClass === 4) {\r\n          return;\r\n        }\r\n\r\n        if (airspace.geometry && airspace.geometry.type === \"Polygon\") {\r\n          const coordinates = airspace.geometry.coordinates[0].map(coord => [coord[1], coord[0]]);\r\n\r\n          const lowerLimit = airspace.lowerLimit.value;\r\n          const color = lowerLimit === 0 ? \"red\" : \"blue\";\r\n\r\n          const airspaceTypeText = airspaceTypes[airspace.type] || \"Unknown\";\r\n          const icaoClassText = icaoClasses[airspace.icaoClass] || \"Unknown\";\r\n\r\n          const polygon = L.polygon(coordinates, {\r\n            color: color,\r\n            weight: 2,\r\n            fillOpacity: 0.3\r\n          });\r\n\r\n          // Store airspace data with its polygon\r\n          airspaces.push({ polygon, data: airspace });\r\n\r\n          window.airspaceNotam.addLayer(polygon);\r\n        }\r\n      });\r\n\r\n      console.log(`Added ${airspaces.length} airspaces to the map`);\r\n\r\n      // Remove any existing click listeners to avoid duplicates\r\n      if (airspaceClickHandler) {\r\n        window.map.off(\"click\", airspaceClickHandler);\r\n      }\r\n\r\n      // Create a new click handler that captures the airspaces in its closure\r\n      airspaceClickHandler = function(e) {\r\n        // Check if the airspace layer is actually visible before processing clicks\r\n        if (!window.map.hasLayer(window.airspaceNotam)) {\r\n          return; // Exit if airspace layer is not visible\r\n        }\r\n\r\n        const clickedPoint = e.latlng;\r\n        const overlappingAirspaces = [];\r\n\r\n        airspaces.forEach(({ polygon, data }) => {\r\n          if (polygon.getBounds().contains(clickedPoint)) {\r\n            overlappingAirspaces.push(data);\r\n          }\r\n        });\r\n\r\n        if (overlappingAirspaces.length > 0) {\r\n          const popupContent = overlappingAirspaces.map(a => `\r\n            <b>${a.name}</b><br>\r\n            Type: ${airspaceTypes[a.type] || \"Unknown\"}<br>\r\n            ICAO Class: ${icaoClasses[a.icaoClass] || \"Unknown\"}<br>\r\n            ${a.lowerLimit.value} ${getUnit(a.lowerLimit.unit)}  ${a.upperLimit.value} ${getUnit(a.upperLimit.unit)}<br>\r\n          `).join(\"<hr>\");\r\n\r\n          L.popup()\r\n            .setLatLng(clickedPoint)\r\n            .setContent(popupContent)\r\n            .openOn(window.map);\r\n        }\r\n      };\r\n      \r\n      // Add the new click handler\r\n      window.map.on(\"click\", airspaceClickHandler);\r\n    })\r\n    .catch(error => console.error(\"Error fetching airspaces:\", error));\r\n}\r\n\r\n// Lookup tables for airspace type and ICAO class\r\n\r\nconst airspaceTypes = {\r\n  0: \"Other\",\r\n  1: \"Restricted\",\r\n  2: \"Danger (D)\",\r\n  3: \"Prohibited (Parc reserve)\",\r\n  4: \"Controlled Tower Region (CTR)\",\r\n  5: \"Transponder Mandatory Zone (TMZ)\",\r\n  6: \"Radio Mandatory Zone (RMZ)\",\r\n  7: \"Terminal Maneuvering Area (TMA)\",\r\n  8: \"Temporary Reserved Area (TRA)\",\r\n  9: \"Temporary Segregated Area (TSA)\",\r\n  10: \"Flight Information Region (FIR)\",\r\n  11: \"Upper Flight Information Region (UIR)\",\r\n  12: \"Air Defense Identification Zone (ADIZ)\",\r\n  13: \"Airport Traffic Zone (ATZ)\",\r\n  14: \"Military Airport Traffic Zone (MATZ)\",\r\n  15: \"Airway\",\r\n  16: \"Military Training Route (MTR)\",\r\n  17: \"Alert Area\",\r\n  18: \"Warning Area\",\r\n  19: \"Protected Area\",\r\n  20: \"Helicopter Traffic Zone (HTZ)\",\r\n  21: \"Gliding Sector\",\r\n  22: \"Transponder Setting (TRP)\",\r\n  23: \"Traffic Information Zone (TIZ)\",\r\n  24: \"Traffic Information Area (TIA)\",\r\n  25: \"Military Training Area (MTA)\",\r\n  26: \"Control Area (CTA)\",\r\n  27: \"ACC Sector (ACC)\",\r\n  28: \"Aerial Sporting Or Recreational Activity\",\r\n  29: \"Low Altitude Overflight Restriction\",\r\n  30: \"Military Route (MRT)\",\r\n  31: \"TSA/TRA Feeding Route (TFR)\",\r\n  32: \"VFR Sector\",\r\n  33: \"FIS Sector\",\r\n  34: \"Lower Traffic Area (LTA)\",\r\n  35: \"Upper Traffic Area (UTA)\"\r\n};\r\n\r\nconst icaoClasses = {\r\n  0: \"A\",\r\n  1: \"B\",\r\n  2: \"C\",\r\n  3: \"D\",\r\n  4: \"E\",\r\n  5: \"F\",\r\n  6: \"G\",\r\n  8: \"Special Use Airspace (SUA)\"\r\n};\r\n\r\nfunction getUnit(unitCode) {\r\n  const units = {\r\n    1: \"ft\", // Feet\r\n    6: \"FL\"  // Flight Level\r\n  };\r\n  return units[unitCode] || \"Unknown\";\r\n}\r\n\r\n\r\n// Export the fetchAirspacesNotam function to make it globally available\r\nwindow.fetchAirspacesNotam = fetchAirspacesNotam;\r\n\r\n// Listen for map layer visibility changes\r\ndocument.addEventListener('map_initialized', function() {\r\n  console.log(\"Setting up airspace layer events\");\r\n  \r\n  // Add event listener for when the airspace layer is added to the map\r\n  window.map.on('overlayadd', function(e) {\r\n    if (e.name === 'Airspaces' || e.name === 'Gliding' || e.name === 'Notam') {\r\n      console.log(`Overlay added: ${e.name}, fetching airspaces`);\r\n      fetchAirspacesNotam();\r\n    }\r\n  });\r\n  \r\n  // Also set up the moveend event to refresh airspaces when panning/zooming\r\n  window.map.on('moveend', function() {\r\n    // Only fetch if the layer is currently visible\r\n    if (window.map.hasLayer(window.airspaceNotam)) {\r\n      console.log(\"Map moved, refreshing airspaces\");\r\n      fetchAirspacesNotam();\r\n    }\r\n  });\r\n});\r\n\r\n// Don't auto-fetch on script load - wait for the layer to be enabled\r\n// Remove or comment out: fetchAirspacesNotam();","import moment from 'moment';\r\nimport 'moment-timezone'; \r\nimport * as turf from '@turf/turf';\r\n\r\nlet airspaceClickHandler = null;\r\nlet currentLowerLimit = 3000; // Default matches dropdown\r\nlet airspaceDebounceTimer;\r\nlet selectedDateStr = getCurrentDateStr(); // Store the selected date\r\n\r\n// Helper function to get current date string in YYYY-MM-DD format\r\nfunction getCurrentDateStr() {\r\n  const today = new Date();\r\n  return `${today.getFullYear()}-${(today.getMonth() + 1).toString().padStart(2, '0')}-${today.getDate().toString().padStart(2, '0')}`;\r\n}\r\n\r\n// Helper function to convert limit to meters\r\nfunction getLimitMeters(limit) {\r\n  if (!limit) return null;\r\n  \r\n  switch (limit.type) {\r\n    case 'FL': // Flight level (already in hundreds of feet)\r\n      return limit.height * 0.3048; // Convert feet to meters\r\n    case 'AMSL': // Feet above mean sea level\r\n    case 'AGL': // Feet above ground level\r\n      return limit.height * 0.3048;\r\n    default:\r\n      return null;\r\n  }\r\n}\r\n\r\nfunction fetchAirspacesXC() {\r\n    // Make sure map is available\r\n\r\n    if (!window.map) {\r\n      console.error(\"Map not initialized yet\");\r\n      return;\r\n    }\r\n    \r\n    const center = window.map.getCenter();\r\n    const lat = center.lat.toFixed(6);\r\n    const lng = center.lng.toFixed(6);\r\n\r\n    // Get map bounds for the query\r\n    const bounds = window.map.getBounds();\r\n    const nw = bounds.getNorthWest();\r\n    const se = bounds.getSouthEast();\r\n\r\n    // Use the selected date instead of current date\r\n    const dateStr = selectedDateStr;\r\n    \r\n   // Build API URL with parameters\r\n   const apiUrl = `/api/airspacesXCdb?startDate=${dateStr}&nw_lat=${nw.lat.toFixed(6)}&nw_lng=${nw.lng.toFixed(6)}&se_lat=${se.lat.toFixed(6)}&se_lng=${se.lng.toFixed(6)}`;\r\n \r\n    fetch(apiUrl)\r\n    .then(response => response.json())\r\n    \r\n      .then(data => {\r\n        // Clear existing layers\r\n        window.airspaceXC.clearLayers();\r\n  \r\n        const airspaces = []; // Store polygons and data for later use\r\n\r\n      // Remove any existing click listeners to avoid duplicates\r\n      if (airspaceClickHandler) {\r\n        window.map.off(\"click\", airspaceClickHandler);\r\n        airspaceClickHandler = null; // Clean up reference\r\n      }\r\n  \r\n        // Check if data is a GeoJSON FeatureCollection\r\n        const features = data.features || [];\r\n\r\n\r\n        let filteredCount = 0;\r\n        let filteredAirspaces = [];\r\n        let includedAirspaces = [];\r\n\r\n        // Precompute the selected date's start in UTC once\r\n        const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\r\n        const selectedDateStartLocal = moment.tz(selectedDateStr, \"YYYY-MM-DD\", userTimezone).startOf('day');\r\n        const selectedDateStartUTC = selectedDateStartLocal.utc().toDate();\r\n            \r\n        \r\n        features.forEach(feature => {\r\n          if (feature.geometry && feature.geometry.type === \"Polygon\") {\r\n        \r\n            // Skip V00 names\r\n            if (feature.properties.name && feature.properties.name.startsWith(\"V00\")) {\r\n              return;\r\n            }\r\n        \r\n            // Check lower limit\r\n            const lowerLimitMeters = getLimitMeters(feature.properties.airlower_j);\r\n            const shouldFilter = lowerLimitMeters === null || lowerLimitMeters > currentLowerLimit;\r\n            if (shouldFilter) {\r\n              filteredAirspaces.push({ name: feature.properties.name, limit: lowerLimitMeters });\r\n              return;\r\n            } else {\r\n              includedAirspaces.push({ name: feature.properties.name, limit: lowerLimitMeters });\r\n            }\r\n        \r\n            // Check expiration date\r\n            let isExpired = false;\r\n            if (feature.properties.descriptions && Array.isArray(feature.properties.descriptions)) {\r\n              for (const desc of feature.properties.descriptions) {\r\n                const description = desc.airdescription || '';\r\n                const cMatch = description.match(/C\\)\\s*(\\d{10})/);\r\n                if (cMatch && cMatch[1]) {\r\n                  // Parse expiration date\r\n                  const dateStr = cMatch[1];\r\n                  try {\r\n                    const year = 2000 + parseInt(dateStr.substring(0, 2));\r\n                    const month = parseInt(dateStr.substring(2, 4)) - 1;\r\n                    const day = parseInt(dateStr.substring(4, 6));\r\n                    const hour = parseInt(dateStr.substring(6, 8));\r\n                    const minute = parseInt(dateStr.substring(8, 10));\r\n                    const expirationDate = new Date(Date.UTC(year, month, day, hour, minute));\r\n                    if (expirationDate < selectedDateStartUTC) {\r\n                      isExpired = true;\r\n                      break;\r\n                    }\r\n                  } catch (error) {\r\n                    console.error(\"Error parsing expiration date:\", error);\r\n                  }\r\n                }\r\n              }\r\n            }\r\n            if (isExpired) return;\r\n        \r\n            // Check activations\r\n            let hasActiveActivation = false;\r\n            if (feature.properties.activations && Array.isArray(feature.properties.activations) && feature.properties.activations.length > 0) {\r\n              const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\r\n              const selectedDateEndLocal = moment.tz(selectedDateStr, \"YYYY-MM-DD\", userTimezone).endOf('day');\r\n              const selectedDateEndUTC = selectedDateEndLocal.utc().toDate();\r\n        \r\n              for (const activation of feature.properties.activations) {\r\n                const activationStart = new Date(activation[0]);\r\n                const activationEnd = new Date(activation[1]);\r\n                if (activationStart <= selectedDateEndUTC && activationEnd >= selectedDateStartUTC) {\r\n                  hasActiveActivation = true;\r\n                  break;\r\n                }\r\n              }\r\n        \r\n              if (!hasActiveActivation) {\r\n                return;\r\n              }\r\n            }\r\n        \r\n            // Additional check for R class airspaces\r\n            if (feature.properties.airspaceClass === \"R\") {\r\n              let hasExpirationDate = false;\r\n              if (feature.properties.descriptions && Array.isArray(feature.properties.descriptions)) {\r\n                for (const desc of feature.properties.descriptions) {\r\n                  const description = desc.airdescription || '';\r\n                  if (description.match(/C\\)\\s*(\\d{10})/)) {\r\n                    hasExpirationDate = true;\r\n                    break;\r\n                  }\r\n                }\r\n              }\r\n        \r\n              // Skip R airspaces without expiration date and active activation\r\n              if (!hasExpirationDate && !hasActiveActivation) {\r\n                return;\r\n              }\r\n            }\r\n        \r\n            // Proceed to create and add the polygon to the map\r\n            const coordinates = feature.geometry.coordinates[0].map(coord => [coord[1], coord[0]]);\r\n            const polygon = L.polygon(coordinates, {\r\n              color: feature.properties.strokeColor || \"blue\",\r\n              weight: feature.properties.strokeWeight || 2,\r\n              fillColor: feature.properties.fillColor || \"blue\",\r\n              fillOpacity: feature.properties.fillOpacity || 0.3\r\n            });\r\n            \r\n            // Add popup with airspace-popup class and full content\r\n            polygon.bindPopup(() => {\r\n              const tzName = moment.tz.guess();\r\n              const tzAbbreviation = moment.tz(tzName).zoneAbbr();\r\n              const tzOffset = moment.tz(tzName).format('Z');\r\n              const timezoneInfo = `<div class=\"timezone-info\" style=\"margin-top: 5px; font-size: 0.85em;\">Local timezone: ${tzAbbreviation} (UTC${tzOffset})</div>`;\r\n\r\n              // Create the description HTML if there are any descriptions\r\n              let descriptionsHtml = '';\r\n              if (feature.properties.descriptions && Array.isArray(feature.properties.descriptions) && feature.properties.descriptions.length > 0) {\r\n                const formatDescription = (text) => {\r\n                  if (!text) return '';\r\n                  return text.replace(/([ABCDEFGQ]\\))/g, '<br>$1');\r\n                };\r\n                \r\n                descriptionsHtml = `\r\n                  <div class=\"airspace-descriptions\" style=\"font-size: 0.8em;\">\r\n                      ${feature.properties.descriptions.map(desc => {\r\n                        const formattedDesc = formatDescription(desc.airdescription || '');\r\n                        return `${formattedDesc} ${desc.airlanguage ? `(${desc.airlanguage})` : ''}`;\r\n                      }).join('')}\r\n                  </div>\r\n                `;\r\n              }\r\n\r\n              // Create activations HTML if any\r\n              let activationsHtml = '';\r\n              if (feature.properties.activations && Array.isArray(feature.properties.activations) && feature.properties.activations.length > 0) {\r\n                activationsHtml = `\r\n                  <div class=\"airspace-activations\">\r\n                    <b>Activations:</b><br>\r\n                    ${feature.properties.activations.map(activation => {\r\n                      const startMoment = moment.utc(activation[0]).tz(tzName);\r\n                      const endMoment = moment.utc(activation[1]).tz(tzName);\r\n                      return `${startMoment.format('MMM D, HH:mm z')} - ${endMoment.format('MMM D, HH:mm z')}`;\r\n                    }).join('<br>')}\r\n                  </div>\r\n                `;\r\n              }\r\n\r\n              // Format limits\r\n              const formatLimit = (limit, original) => {\r\n                if (!limit) return original || 'N/A';\r\n                const type = limit.type;\r\n                const height = limit.height;\r\n                \r\n                if (type === 'FL') {\r\n                  const meters = Math.round(height * 0.3048);\r\n                  const flNumber = height / 100;\r\n                  return `${meters}m (FL${flNumber})`;\r\n                }\r\n                else if (type === 'AMSL' || type === 'AGL') {\r\n                  const meters = Math.round(height * 0.3048);\r\n                  return `${meters}m`;\r\n                }\r\n                else {\r\n                  return original || 'N/A';\r\n                }\r\n              };\r\n\r\n              const lower = formatLimit(feature.properties.airlower_j, feature.properties.lowerLimit);\r\n              const upper = formatLimit(feature.properties.airupper_j, feature.properties.upperLimit);\r\n                          \r\n              return `\r\n              <b>${feature.properties.name} (${feature.properties.airspaceClass})</b><br>\r\n              <b> </b>${lower} - <b> </b>${upper}<br>\r\n              ${descriptionsHtml}\r\n              ${activationsHtml}\r\n              ${timezoneInfo}\r\n              `;\r\n            }, { className: 'airspace-popup' });\r\n            \r\n            // MODIFIED: Single push with all required properties\r\n            airspaces.push({ \r\n              polygon,\r\n              data: feature.properties,\r\n              geometry: feature.geometry // Store original GeoJSON geometry\r\n            });\r\n            window.airspaceXC.addLayer(polygon);\r\n          }\r\n        });\r\n\r\n        // After processing all features \r\n        // Create a new click handler that captures the airspaces in its closure\r\n        airspaceClickHandler = function(e) {\r\n          // Check if the airspace layer is actually visible before processing clicks\r\n          if (!window.map.hasLayer(window.airspaceXC)) {\r\n            return; // Exit if airspace layer is not visible\r\n          }\r\n  \r\n          const clickedPoint = e.latlng;\r\n          const overlappingAirspaces = [];\r\n\r\n          // Convert clicked point to GeoJSON format [lng, lat]\r\n          const pt = turf.point([clickedPoint.lng, clickedPoint.lat]);\r\n  \r\n          airspaces.forEach(({ polygon, data, geometry }) => {\r\n            try {\r\n              // Convert stored GeoJSON geometry to Turf polygon\r\n              const poly = turf.polygon(geometry.coordinates);\r\n              \r\n              // Perform accurate point-in-polygon check\r\n              if (turf.booleanPointInPolygon(pt, poly)) {\r\n                overlappingAirspaces.push(data);\r\n              }\r\n            } catch (error) {\r\n              console.error(\"Error checking point in polygon:\", error);\r\n            }\r\n          });\r\n  \r\n          if (overlappingAirspaces.length > 0) {\r\n              // Inside your click handler:\r\n              const tzName = moment.tz.guess(); // Gets the user's timezone like \"Europe/Berlin\"\r\n              const tzAbbreviation = moment.tz(tzName).zoneAbbr(); // Gets \"CET\"\r\n              const tzOffset = moment.tz(tzName).format('Z'); // Gets \"+01:00\"\r\n\r\n              const timezoneInfo = `<div class=\"timezone-info\" style=\"margin-top: 5px; font-size: 0.85em;\">Local timezone: ${tzAbbreviation} (UTC${tzOffset})</div>`;\r\n\r\n              const popupContent = overlappingAirspaces.map(a => {\r\n              // Create the description HTML if there are any descriptions\r\n              let descriptionsHtml = '';\r\n              // Check if descriptions exists and is actually an array with elements\r\n              if (a.descriptions && Array.isArray(a.descriptions) && a.descriptions.length > 0) {\r\n                // Function to format description text with line breaks before A), B), etc.\r\n                const formatDescription = (text) => {\r\n                  if (!text) return '';\r\n                  \r\n                  // Add line breaks before A), B), C), etc.\r\n                  return text.replace(/([ABCDEFGQ]\\))/g, '<br>$1');\r\n                };\r\n                \r\n                descriptionsHtml = `\r\n                  <div class=\"airspace-descriptions\" style=\"font-size: 0.8em;\">\r\n                      ${a.descriptions.map(desc => {\r\n                        const formattedDesc = formatDescription(desc.airdescription || '');\r\n                        return `${formattedDesc} ${desc.airlanguage ? `(${desc.airlanguage})` : ''}`;\r\n                      }).join('')}\r\n                  </div>\r\n                `;\r\n              }\r\n\r\n              // Create the description HTML if there are any descriptions\r\n              let activationsHtml = '';\r\n\r\n              // Add null check and array validation\r\n              if (a.descriptions && Array.isArray(a.descriptions) && a.descriptions.length > 0) {\r\n                // existing description formatting code\r\n              }\r\n\r\n              // Check if activations exists and is actually an array with elements\r\n              if (a.activations && Array.isArray(a.activations) && a.activations.length > 0) {\r\n                activationsHtml = `\r\n                  <div class=\"airspace-activations\">\r\n                    <b>Activations:</b><br>\r\n                    ${a.activations.map(activation => {\r\n                      const startMoment = moment.utc(activation[0]).tz(tzName);\r\n                      const endMoment = moment.utc(activation[1]).tz(tzName);\r\n                      return `${startMoment.format('MMM D, HH:mm z')} - ${endMoment.format('MMM D, HH:mm z')}`;\r\n                    }).join('<br>')}\r\n                  </div>\r\n                `;\r\n              }\r\n\r\n                // Define helper function to format lower/upper limits\r\n              const formatLimit = (limit, original) => {\r\n                if (!limit) return original || 'N/A'; // Fallback to original string if no structured data\r\n                const type = limit.type;\r\n                const height = limit.height;\r\n                \r\n                // Flight Level (FL) handling\r\n                if (type === 'FL') {\r\n                  const meters = Math.round(height * 0.3048); // Convert feet to meters\r\n                  const flNumber = height / 100; // Calculate FL (e.g., 10000ft  FL100)\r\n                  return `${meters}m (FL${flNumber})`;\r\n                }\r\n                // AMSL or AGL handling (feet)\r\n                else if (type === 'AMSL' || type === 'AGL') {\r\n                  const meters = Math.round(height * 0.3048);\r\n                  return `${meters}m`;\r\n                }\r\n                // Unknown type: fallback to original string\r\n                else {\r\n                  return original || 'N/A';\r\n                }\r\n              };\r\n\r\n                // Format lower and upper limits\r\n              const lower = formatLimit(a.airlower_j, a.lowerLimit);\r\n              const upper = formatLimit(a.airupper_j, a.upperLimit);\r\n                          \r\n              return `\r\n              <b>${a.name} (${a.airspaceClass})</b><br>\r\n              <b> </b>${lower} - <b> </b>${upper}<br>\r\n              </div>\r\n                ${descriptionsHtml}\r\n                ${activationsHtml}\r\n              </div>\r\n              `;\r\n            }).join(\"<hr style='margin: 3px 0;'>\");\r\n          \r\n            L.popup({\r\n              className: 'airspace-popup',\r\n              closeOnClick: false,\r\n              autoClose: false,\r\n              tap: false,\r\n              closeButton: true\r\n            })\r\n              .setLatLng(clickedPoint)\r\n              .setContent(popupContent)\r\n              .openOn(window.map);\r\n          }\r\n        };\r\n        \r\n        // Add the new click handler\r\n        window.map.on(\"click\", airspaceClickHandler);\r\n      })\r\n      .catch(error => console.error(\"Error fetching airspaces:\", error));\r\n  }\r\n\r\n\r\n  document.addEventListener('change', function(e) {\r\n    //close open popups\r\n    if (e.target && (e.target.id === 'airspaceLowerLimit' || e.target.id === 'airspaceTime')) {\r\n      // Close any open popup\r\n      if (window.map && window.map._popup) {\r\n        window.map.closePopup();\r\n      }\r\n    }\r\n    // Handle airspaceLowerLimit changes\r\n    if (e.target && e.target.id === 'airspaceLowerLimit') {\r\n        const newLimit = parseInt(e.target.value, 10);\r\n        \r\n        console.log(`Dropdown changed: old limit=${currentLowerLimit}m, new limit=${newLimit}m`);\r\n        \r\n        if (newLimit !== currentLowerLimit) {\r\n            currentLowerLimit = newLimit;\r\n            console.log(`Current limit updated to ${currentLowerLimit}m`);\r\n            \r\n            clearTimeout(airspaceDebounceTimer);\r\n            airspaceDebounceTimer = setTimeout(() => {\r\n                if (window.map.hasLayer(window.airspaceXC)) {\r\n                    console.log(`Triggering XC airspaces reload with limit=${currentLowerLimit}m`);\r\n                    fetchAirspacesXC();\r\n                }\r\n            }, 300);\r\n        }\r\n    }\r\n    // Handle date selection changes\r\n    if (e.target && e.target.id === 'airspaceTime') {\r\n      const newDate = e.target.value;\r\n      console.log('Selected airspace date:', newDate);\r\n\r\n      if (newDate !== selectedDateStr) {\r\n        selectedDateStr = newDate;\r\n        \r\n        // Debounce and refetch airspaces\r\n        clearTimeout(airspaceDebounceTimer);\r\n        airspaceDebounceTimer = setTimeout(() => {\r\n          if (window.map.hasLayer(window.airspaceXC)) {\r\n            console.log('Refetching airspaces with new date:', selectedDateStr);\r\n            fetchAirspacesXC();\r\n          }\r\n        }, 300);\r\n      }\r\n    }\r\n  });\r\n\r\nwindow.fetchAirspacesXC = fetchAirspacesXC;\r\n\r\n","// spotsHelper.js - Common functionality for loading and displaying spots on a map\n\n// Module-scoped variable to track Dropzone instance\nlet feedbackDropzone = null;\nlet currentFeedbackForm = null;\n\n// Swiper related functions\nfunction changeSwiper() {\n    if (typeof swiperc !== \"undefined\") {\n        $(\".swiper2\").removeClass(\"swiper-small swiper-medium swiper-large\"); // Remove all classes first\n        if (window.innerWidth < 576) {\n            $(\".swiper2\").addClass(\"swiper-small\");\n            swiperc.changeDirection('horizontal', true);\n        }\n        else {\n            if (window.innerWidth < 840) {\n                $(\".swiper2\").addClass(\"swiper-medium\");\n            }\n            else {\n                $(\".swiper2\").addClass(\"swiper-large\");\n            }\n            swiperc.changeDirection('vertical', true);\n        }\n    }\n}\n\nfunction initSwiper(idImg) {\n    let swiperv, swiperc;\n    // USED 09/24 Beschreibung: Initialisierung der Image-Swiper\n    var swiperLoop3 = (idImg < 4) ? false : true;\n    var swiperLoop4 = (idImg < 5) ? false : true;\n\n    swiperv = new Swiper('.swiper1', {\n        autoHeight: true,\n        direction: 'horizontal',\n        allowTouchMove: false,\n        mousewheel: false,\n        slidesPerView: 1,\n        loop: false,\n    });\n\n    swiperc = new Swiper('.swiper2', {\n        direction: 'vertical',\n        allowTouchMove: true,\n        mousewheel: true,\n        slidesPerView: 3,\n        spaceBetween: 10,\n        loop: swiperLoop3,\n        breakpoints: {\n            840: {\n                slidesPerView: 4,\n                loop: swiperLoop4\n            }\n        },\n        scrollbar: {\n            el: '.swiper-scrollbar',\n            hide: false,\n            draggable: true,\n        },\n        on: {\n            click: function() {\n                let iR = (this.clickedSlide.firstChild.id).substring(3) - 1;\n                swiperv.slideTo(iR, 1);\n            },\n            transitionEnd: function () {\n                let iR = this.realIndex;\n                swiperv.slideTo(iR, 1);\n            }\n        }\n    });\n\n    changeSwiper();\n}\n\n// Mapping wind directions to angles\nfunction getCompassDirection(deg) {\n    const directions = [\n        \"N\", \"NNE\", \"NE\", \"ENE\", \"E\", \"ESE\", \"SE\", \"SSE\",\n        \"S\", \"SSW\", \"SW\", \"WSW\", \"W\", \"WNW\", \"NW\", \"NNW\",\n    ];\n    return directions[Math.round(deg / 22.5) % 16];\n}\n\nfunction getFillColor(speed) {\n    if (speed >= 7 && speed <= 14) return \"LimeGreen\";\n    if (speed >= 15 && speed <= 24) return \"yellow\";\n    if (speed >= 25 && speed <= 30) return \"orange\";\n    if (speed >= 31 && speed <= 36) return \"red\";\n    if (speed > 36) return \"black\";\n    return \"Aquamarine\";\n}\n\nfunction getStrokeColor(speed) {\n    if (speed >= 15 && speed <= 24) return \"LimeGreen\";\n    if (speed >= 25 && speed <= 32) return \"yellow\";\n    if (speed >= 33 && speed <= 38) return \"orange\";\n    if (speed >= 39 && speed <= 44) return \"red\";\n    if (speed > 44) return \"black\";\n    return \"Aquamarine\";\n}\n\nfunction getTextColor(backgroundColor) {\n    return backgroundColor === \"black\" ? \"white\" : \"black\";\n}\n\n// Helper: Process raw historical data into 10minute averages.\nfunction processHistoricalData(data) {\n    const grouped = {};\n    data.forEach((entry) => {\n        const dt = new Date(entry._id * 1000);\n        // Round down to the nearest 10minute mark.\n        dt.setMinutes(Math.floor(dt.getMinutes() / 10) * 10);\n        dt.setSeconds(0);\n        dt.setMilliseconds(0);\n        const key = dt.getTime();\n        if (!grouped[key]) {\n            grouped[key] = { count: 0, wAvgSum: 0, wMaxSum: 0, wDirSum: 0, tempSum: 0, tempCount: 0 };\n        }\n        grouped[key].count++;\n        grouped[key].wAvgSum += entry[\"w-avg\"];\n        grouped[key].wMaxSum += entry[\"w-max\"];\n        grouped[key].wDirSum += entry[\"w-dir\"];\n        if (entry[\"temp\"] !== undefined) {\n            grouped[key].tempSum += entry[\"temp\"];\n            grouped[key].tempCount++;\n        }\n    });\n    const result = Object.keys(grouped).map((key) => ({\n        _id: parseInt(key) / 1000, // back to seconds\n        \"w-avg\": grouped[key].wAvgSum / grouped[key].count,\n        \"w-max\": grouped[key].wMaxSum / grouped[key].count,\n        \"w-dir\": grouped[key].wDirSum / grouped[key].count,\n        \"temp\": grouped[key].tempCount > 0 ? grouped[key].tempSum / grouped[key].tempCount : undefined,\n    }));\n    // For the table we want descending order (most recent first).\n    result.sort((a, b) => b._id - a._id);\n    return result;\n}\n\n// Main function to fetch and display wind stations.\nfunction fetchWindStations() {\n    // Make sure the map exists before trying to use it\n    if (!window.map || typeof window.map.getBounds !== 'function') {\n      console.error('Map not properly initialized');\n      return;\n    }\n\n  const bounds = window.map.getBounds();\n  const nwLat = bounds.getNorthWest().lat;\n  const nwLng = bounds.getNorthWest().lng;\n  const seLat = bounds.getSouthEast().lat;\n  const seLng = bounds.getSouthEast().lng;\n  fetch(\n    `/api/wind-data-getCurrent?nwLat=${nwLat}&nwLng=${nwLng}&seLat=${seLat}&seLng=${seLng}`\n  )\n    .then((response) => response.json())\n    .then((responseData) => {\n      if (!Array.isArray(responseData)) {\n        throw new Error(\"Invalid data format received from API\");\n      }\n      // Clear previous markers.\n      windLayer.clearLayers();\n      console.log('Wind layers cleared'); // Add this\n\n      responseData.forEach((station) => {\n        const [lon, lat] = station.loc.coordinates;\n        const windDirection = station.last[\"w-dir\"];\n        const windAvg = station.last[\"w-avg\"];\n        const windMax = station.last[\"w-max\"];\n        const tempC = station.last[\"temp\"];\n        const compassDirection = getCompassDirection(windDirection);\n        const lastUpdate = new Date(station.last[\"_id\"] * 1000).toLocaleTimeString(\"de-DE\", {hour: \"2-digit\", minute: \"2-digit\", });\n        const fillColor = getFillColor(windAvg);\n        const strokeColor = getStrokeColor(windMax);\n        const peakArrow = station.peak ? \"\" : \"\";\n        const isHolfuy = station._id.includes(\"holfuy\");\n        let holfuyStationId = '';\n        if (isHolfuy) {\n          holfuyStationId = station._id.split(\"-\")[1];\n        }\n\n        // Create the SVG arrow icon.\n        const arrowSvg = `\n          <svg width=\"30\" height=\"30\" viewBox=\"0 0 800 900\" xmlns=\"http://www.w3.org/2000/svg\">\n            <g transform=\"rotate(${windDirection + 90}, 400, 400)\" stroke=\"${strokeColor}\" stroke-width=\"60\">\n              <path d=\"M203,391 L75,144 L738,391 L75,637 L203,391 Z\" fill=\"${fillColor}\"/>\n            </g>\n            <text x=\"330\" y=\"850\" font-size=\"220\" text-anchor=\"middle\" fill=\"black\" font-weight=\"bold\">\n              ${peakArrow}${Math.round(windAvg)} / ${Math.round(windMax)}\n            </text>\n          </svg>`;\n\n        const arrowIcon = L.divIcon({\n          className: \"wind-arrow\",\n          html: arrowSvg,\n          iconSize: [30, 30],\n          iconAnchor: [12, 15],\n        });\n\n        // Create the marker.\n        const marker = L.marker([lat, lon], { icon: arrowIcon }).addTo(windLayer);\n\n        // Fetch historical data for this station.\n        fetch(\n          `https://winds.mobi/api/2.3/stations/${station._id}/historic/?duration=21000&keys=w-dir&keys=w-avg&keys=w-max&keys=temp`\n        )\n          .then((response) => response.json())\n          .then((historyData) => {\n            // Process historyData into 10minute averages.\n            const aggregatedData = processHistoricalData(historyData);\n\n            // --- TABLE SETUP (10minute averages, limited to last 5 hours) ---\n            const fiveHoursAgo = Date.now() - 5 * 60 * 60 * 1000;\n            const limitedData = aggregatedData.filter(\n              (entry) => entry._id * 1000 >= fiveHoursAgo\n            ).slice(0, 24); // Limit to 24 most recent entries\n            let historyTable = `<div class=\"table-responsive\"><table class=\"wind-data-table table\">\n              <thead>\n                <tr>\n                  <th>Wind (m/s)</th>\n                  <th>Gusts (m/s)</th>\n                  <th>Direction</th>\n                  <th>Temp C</th>\n                  <th>Time</th>\n                </tr>\n              </thead>\n              <tbody>`;\n            limitedData.forEach((entry) => {\n              const timeFormatted = new Date(entry._id * 1000).toLocaleTimeString(\"de-DE\", {\n                hour: \"2-digit\",\n                minute: \"2-digit\",\n              });\n              const compassDir = getCompassDirection(entry[\"w-dir\"]);\n              historyTable += `<tr>\n                <td class=\"wind-avg-cell\" style=\"color: ${getTextColor(getFillColor(entry[\"w-avg\"]))}; background-color: ${getFillColor(entry[\"w-avg\"])};\">\n                  ${entry[\"w-avg\"].toFixed(1)}\n                </td>\n                <td class=\"wind-max-cell\" style=\"color: ${getTextColor(getStrokeColor(entry[\"w-max\"]))}; background-color: ${getStrokeColor(entry[\"w-max\"])};\">\n                  ${entry[\"w-max\"].toFixed(1)}\n                </td>\n                <td style=\"white-space: nowrap;\">\n                  <span class=\"wind-direction-arrow\" style=\"transform: rotate(${entry[\"w-dir\"] + 180}deg);\">\n                      <i class=\"fa fa-long-arrow-up\"></i>\n                  </span>\n                  &nbsp;&nbsp;${compassDir}\n                </td>\n                <td>${entry[\"temp\"] !== undefined ? entry[\"temp\"].toFixed(1) : \"N/A\"}</td>\n                <td>${timeFormatted}</td>\n              </tr>`;\n            });\n            historyTable += `</tbody></table></div>`;\n\n            // --- CHART SETUP (10minute averages with hourly vertical grid lines) ---\n            // For the chart we want ascending order (oldest first).\n            const chartData = aggregatedData.slice().reverse();\n\n            // Build the popup HTML with tabs.\n            const popupHtml = `\n              <div style=\"display: flex; gap: 1px; align-items: flex-end; max-width: 700px\">\n                <div style=\"flex: 1;\" class=\"wind-station-popup-content\">\n                  <strong>${station.short}</strong><br><br>\n                  <tag-name>Wind Speed:&#9;&#9;${windAvg} km/h<br></tag-name>\n                  <tag-name>Max Wind:&#9;&#9;${windMax} km/h<br></tag-name>\n                  <tag-name>Wind Direction:&#9;${windDirection} (${compassDirection})<br></tag-name>\n                  <tag-name>Last Update:&#9;&#9;${lastUpdate}<br><br></tag-name>\n                </div>\n                ${isHolfuy ? `\n                  <div style=\"flex: 0 0 auto; width: 110px; margin-right: 15px; position: relative;\">\n                    <iframe src=\"https://widget.holfuy.com/?station=${holfuyStationId}&su=km/h&t=C&lang=en&mode=rose&size=110\"\n                      width=\"110\"\n                      height=\"110\"\n                      frameborder=\"0\"\n                      scrolling=\"no\"\n                      style=\"pointer-events: none;\">\n                    </iframe>\n                    <div style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10;\"></div>\n                  </div>\n                ` : ''}\n              </div>\n              \n              <div class=\"tab-container\">\n                <div class=\"tab active\" onclick=\"showTab('table-${station._id}', this)\">Table</div>\n                <div class=\"tab\" onclick=\"showTab('chart-${station._id}', this)\">Chart</div>\n                <div class=\"tab\" id=\"camera-tab-${station._id}\" style=\"display: none;\" onclick=\"showTab('camera-${station._id}', this)\">Camera</div>\n              </div>\n              <div id=\"table-${station._id}\" class=\"tab-content\">\n                ${historyTable}\n              </div>\n              <div id=\"chart-${station._id}\" class=\"tab-content\" style=\"display: none;\">\n                <canvas id=\"canvas-${station._id}\" width=\"400\" height=\"200\"></canvas>\n              </div>\n              <div id=\"camera-${station._id}\" class=\"tab-content\" style=\"display: none;\">\n                <img id=\"camera-image-${station._id}\" src=\"\" alt=\"Camera Image\" class=\"camera-image\">\n              </div>\n            `;\n\n            // Bind a responsive popup using the plugin.\n            marker.bindPopup(\n              L.responsivePopup({\n                hasTip: true,\n                autoPan: false,\n                offset: [15, 25],\n                maxWidth: 700,\n                minWidth: 400,\n                maxHeight: 800,\n              }).setContent(popupHtml)\n            );\n\n            // When the popup is opened, initialize the chart.\n            // When the popup is opened, initialize the chart.\n            marker.on(\"popupopen\", () => {\n              setTimeout(() => {\n                const canvas = document.getElementById(`canvas-${station._id}`);\n                if (canvas) {\n                  canvas.style.height = \"300px\";\n                  const ctx = canvas.getContext(\"2d\");\n                  if (ctx) {\n                    // Transform chartData so that each point has an x (timestamp) and y (value)\n                    const chartDataPointsAvg = chartData.map((entry) => ({\n                      x: entry._id * 1000, // convert seconds to ms\n                      y: entry[\"w-avg\"],\n                    }));\n                    const chartDataPointsMax = chartData.map((entry) => ({\n                      x: entry._id * 1000,\n                      y: entry[\"w-max\"],\n                    }));\n\n                    const chartInstance = new Chart(ctx, {\n                      type: \"line\",\n                      data: {\n                        datasets: [\n                          {\n                            label: \"Wind Avg (km/h)\",\n                            data: chartDataPointsAvg,\n                            borderColor: \"blue\",\n                            fill: false,\n                            pointRadius: 3,\n                          },\n                          {\n                            label: \"Wind Max (km/h)\",\n                            data: chartDataPointsMax,\n                            borderColor: \"red\",\n                            fill: false,\n                            pointRadius: 3,\n                          },\n                        ],\n                      },\n                      options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        layout: {\n                          // Add extra bottom padding so there's room for the arrows.\n                          padding: { bottom: 5 },\n                        },\n                        scales: {\n                          x: {\n                            type: \"time\",\n                            time: {\n                              unit: \"hour\",\n                              displayFormats: {\n                                hour: \"HH:mm\",\n                              },\n                              tooltipFormat: \"HH:mm\",\n                            },\n                            grid: {\n                              drawBorder: true,\n                            },\n                            ticks: {\n                              autoSkip: true,\n                              maxRotation: 0,\n                              minRotation: 0,\n                              padding: 30,\n                            },\n                          },\n                          y: {\n                            beginAtZero: true,\n                            ticks: {\n                              stepSize: 10,\n                              maxTicksLimit: 10,\n                              font: { size: 14 },\n                            },\n                          },\n                        },\n                        plugins: {\n                          legend: { display: false },\n                        },\n                      },\n                      plugins: [\n                        {\n                          id: \"windDirectionArrows\",\n                          afterDraw: (chart) => {\n                            const ctx = chart.ctx;\n                            const xAxis = chart.scales.x;\n                            ctx.save();\n                            // Position arrows just below the x-axis line \n                            const arrowRowY = xAxis.top + 20;\n                            \n                            // Set text properties for centered alignment\n                            ctx.textAlign = \"center\";\n                            ctx.textBaseline = \"middle\";\n                            \n                            chartData.forEach((entry) => {\n                              const x = xAxis.getPixelForValue(entry._id * 1000);\n                              ctx.save();\n                              ctx.translate(x, arrowRowY);\n                              ctx.rotate(((entry[\"w-dir\"] + 180) * Math.PI) / 180);\n                              ctx.font = \"extra-bold 12px 'Roboto', sans-serif\";\n                              ctx.fillText(\"\", 0, 0);\n                              ctx.restore();\n                            });\n                            ctx.restore();\n                          },\n                        },\n                      ],\n                      \n                    });\n                    canvas.chartInstance = chartInstance;\n                  } else {\n                    console.error(\"Failed to get 2D context from canvas.\");\n                  }\n                } else {\n                  console.error(\"Canvas element not found.\");\n                }\n                // Inside the popupopen event handler where camera handling happens:\n                const cameraTabElement = document.getElementById(`camera-tab-${station._id}`);\n                const cameraImageElement = document.getElementById(`camera-image-${station._id}`);\n                \n                // Special cases for Moselfalken webcams\n                if (station._id === \"holfuy-361\" || station._id === \"holfuy-362\" || station._id === \"holfuy-363\") {\n                  console.log(`Handling special case for ${station._id}`);\n                  \n                  // Create a container div for better layout control\n                  const container = document.createElement('div');\n                  container.classList.add('holfuy-container');\n\n                  // No heading needed\n                  \n                  // Add a loading indicator\n                  const loadingText = document.createElement('div');\n                  loadingText.textContent = 'Loading webcam image...';\n                  loadingText.classList.add('loading-text');\n                  container.appendChild(loadingText);\n                  \n                  // Replace the image element with our container\n                  if (cameraImageElement.parentNode) {\n                      cameraImageElement.parentNode.replaceChild(container, cameraImageElement);\n                      cameraTabElement.style.display = \"block\";\n                      console.log(\"Successfully replaced image with container\");\n                  } else {\n                      console.error(\"Cannot find parent of image element for replacement\");\n                      cameraTabElement.style.display = \"none\";\n                      return;\n                  }\n                  \n                  // First fetch the Moselfalken website to extract the current image URL\n                  \n                  // Show loading state\n                  const extractingText = document.createElement('div');\n                  extractingText.textContent = 'Loading webcam image...';\n                  extractingText.classList.add('loading-text');\n                  container.innerHTML = '';\n                  container.appendChild(extractingText);\n                  \n                  // Determine the website URL based on the station ID\n                  let websiteUrl = 'https://www.moselfalken.de/zeltingen-rachtig'; // Default for holfuy-361\n                  if (station._id === \"holfuy-362\") {\n                      websiteUrl = 'https://www.moselfalken.de/ockfen';\n                  } else if (station._id === \"holfuy-363\") {\n                      websiteUrl = 'https://www.moselfalken.de/meerfeld';\n                  }\n                  \n                  \n                  // Fetch the website via our proxy\n                  const websiteProxyUrl = `/api/proxy?imageUrl=${websiteUrl}`;\n                  console.log(`[${station._id}] Fetching website HTML from: ${websiteProxyUrl}`); // Added logging\n                  fetch(websiteProxyUrl)\n                    .then(response => { // Added missing .then() and opening brace\n                      if (!response.ok) {\n                        throw new Error(`HTTP error! Status: ${response.status}`);\n                      }\n                      return response.text();\n                    }) // Corrected closing brace placement\n                    .then(html => {\n                      // Parse the HTML\n                      const parser = new DOMParser();\n                      const doc = parser.parseFromString(html, 'text/html');\n                      \n                      // Find all picture elements\n                      const pictureElements = doc.querySelectorAll('picture');\n                      \n                      if (pictureElements.length === 0) {\n                        throw new Error('No picture elements found in HTML');\n                      }\n                      \n                      // Look for a picture element that might contain the webcam image\n                      let webcamPicture = null;\n                      for (const picture of pictureElements) {\n                        const img = picture.querySelector('img');\n                        if (img && (img.src.includes('cam') || (img.alt && img.alt.includes('Webcam')))) {\n                          webcamPicture = picture;\n                          break;\n                        }\n                      }\n                      \n                      // If we didn't find a specific webcam picture, use the first one\n                      if (!webcamPicture) {\n                        webcamPicture = pictureElements[0];\n                      }\n                      \n                      // Find all source elements and the img element in the picture\n                      const sourceElements = webcamPicture.querySelectorAll('source');\n                      const imgElement = webcamPicture.querySelector('img');\n                      \n                      let imageUrl = '';\n                      \n                      // Try to get URL from the last source element (highest resolution)\n                      if (sourceElements.length > 0) {\n                        const lastSource = sourceElements[sourceElements.length - 1];\n                        const srcset = lastSource.getAttribute('srcset');\n                        if (srcset) {\n                          // Extract the URL part before \" 1x\" if present\n                          imageUrl = srcset.split(' ')[0];\n                        }\n                      }\n                      \n                      // Fallback to img src if no source element found\n                      if (!imageUrl && imgElement) {\n                        imageUrl = imgElement.getAttribute('src');\n                      }\n                      \n                      if (!imageUrl) {\n                        throw new Error('Could not extract image URL from HTML');\n                      }\n                      \n                      // Convert relative URL to absolute URL\n                      if (imageUrl.startsWith('/')) {\n                        imageUrl = 'https://www.moselfalken.de' + imageUrl;\n                      } else if (!imageUrl.startsWith('http')) {\n                        imageUrl = 'https://www.moselfalken.de/' + imageUrl;\n                      }\n                      console.log(`[${station._id}] Extracted image URL: ${imageUrl}`); // Added logging\n                      \n                      // Now fetch the image via the proxy\n                      const imageProxyUrl = `/api/proxy?imageUrl=${imageUrl}`;\n                      \n                      // Create a new image element\n                      const img = document.createElement('img');\n                      img.alt = \"Moselfalken Webcam\";\n                      img.classList.add('webcam-image');\n                      console.log(`[${station._id}] Setting image src to proxy: ${imageProxyUrl}`); // Added logging\n                      img.src = imageProxyUrl; // Added missing src assignment\n                      \n                      // Replace the loading text with just the image\n                      container.innerHTML = '';\n                      container.appendChild(img);\n                    })\n                    .catch(error => {\n                      console.error(`[${station._id}] Error fetching/parsing website or extracting image URL:`, error); // Added logging\n                      // If there's an error, hide the camera tab\n                      cameraTabElement.style.display = \"none\";\n                    });\n                } else {\n                  // Original behavior for other Holfuy stations\n                  const cameraImageUrl = `https://holfuy.com/en/takeit/cam/s${holfuyStationId}.jpg`;\n                  \n                  // Create temporary image to test validity\n                  const testImage = new Image();\n                  testImage.onload = function() {\n                    // Only show tab if image loads successfully\n                    cameraImageElement.src = cameraImageUrl;\n                    cameraTabElement.style.display = \"block\";\n                  };\n                  testImage.onerror = function() {\n                    // Hide tab if image fails to load\n                    cameraTabElement.style.display = \"none\";\n                  };\n                  testImage.src = cameraImageUrl;\n                  \n                  // Set timeout as fallback in case responses are slow\n                  setTimeout(() => {\n                    if (!testImage.complete || testImage.naturalWidth === 0) {\n                      cameraTabElement.style.display = \"none\";\n                    }\n                  }, 2000);\n                }\n              }, 500);\n            });\n\n          })\n          .catch((error) =>\n            console.error(\"Error fetching historical wind data:\", error)\n          );\n      });\n    })\n    .catch((error) =>\n      console.error(\"Error fetching wind station data:\", error)\n    );\n}\n\n\n// Enhanced tab switching function.\nwindow.showTab = function (tabId, element) {\n  console.log(\"Switching to tab:\", tabId);\n\n  document.querySelectorAll(\".tab-content\").forEach((tab) => {\n    tab.style.display = \"none\";\n  });\n\n  document.querySelectorAll(\".tab\").forEach((tab) => {\n    tab.classList.remove(\"active\");\n  });\n\n  const targetTab = document.getElementById(tabId);\n  if (targetTab) {\n    targetTab.style.display = \"block\";\n  } else {\n    console.error(\"Tab not found:\", tabId);\n  }\n\n  if (element) {\n    element.classList.add(\"active\");\n  } else {\n    console.error(\"Element is null or undefined\");\n  }\n\n  if (tabId.startsWith(\"chart-\")) {\n    const stationId = tabId.split(\"chart-\")[1];\n    console.log(\"Station ID:\", stationId);\n    const canvas = document.getElementById(`canvas-${stationId}`);\n    if (canvas && canvas.chartInstance) {\n      canvas.chartInstance.resize();\n    }\n  }\n};\n\nwindow.fetchWindStations = fetchWindStations;\n\n","// spotsHelper.js - Common functionality for loading and displaying spots on a map\r\n\r\n// Module-scoped variable to track Dropzone instance\r\nlet feedbackDropzone = null;\r\nlet currentFeedbackForm = null;\r\n\r\n// Swiper related functions\r\nfunction changeSwiper() {\r\n    if (typeof swiperc !== \"undefined\") {\r\n        if (window.innerWidth < 576) {\r\n            $(\".swiper2\").css(\"height\", \"\"); $(\".swiper2\").css(\"width\", \"320px\");\r\n            $(\".swiper2\").css(\"padding-left\", \"\"); $(\".swiper2\").css(\"padding-top\", \"30px\");\r\n            $(\".swiper2 > .swiper-wrapper\").css(\"width\", \"\"); $(\".swiper2 > .swiper-wrapper\").css(\"height\", \"100px\");\r\n            swiperc.changeDirection('horizontal', true);\r\n        }\r\n        else {\r\n            if (window.innerWidth < 840) {\r\n                $(\".swiper2\").css(\"width\", \"\"); $(\".swiper2\").css(\"height\", \"320px\");\r\n            }\r\n            else {\r\n                $(\".swiper2\").css(\"width\", \"\"); $(\".swiper2\").css(\"height\", \"460px\");\r\n            }\r\n            $(\".swiper2\").css(\"padding-top\", \"\"); $(\".swiper2\").css(\"padding-left\", \"30px\");\r\n            $(\".swiper2 > .swiper-wrapper\").css(\"height\", \"\"); $(\".swiper2 > .swiper-wrapper\").css(\"width\", \"100px\");\r\n            swiperc.changeDirection('vertical', true);\r\n        }\r\n    }\r\n}\r\n\r\nfunction initSwiper(idImg) {\r\n    let swiperv, swiperc;\r\n    // USED 09/24 Beschreibung: Initialisierung der Image-Swiper\r\n    var swiperLoop3 = (idImg < 4) ? false : true;\r\n    var swiperLoop4 = (idImg < 5) ? false : true;\r\n\r\n    swiperv = new Swiper('.swiper1', {\r\n        autoHeight: true,\r\n        direction: 'horizontal',\r\n        allowTouchMove: false,\r\n        mousewheel: false,\r\n        slidesPerView: 1,\r\n        loop: false,\r\n    });\r\n\r\n    swiperc = new Swiper('.swiper2', {\r\n        direction: 'vertical',\r\n        allowTouchMove: true,\r\n        mousewheel: true,\r\n        slidesPerView: 3,\r\n        spaceBetween: 10,\r\n        loop: swiperLoop3,\r\n        breakpoints: {\r\n            840: {\r\n                slidesPerView: 4,\r\n                loop: swiperLoop4\r\n            }\r\n        },\r\n        scrollbar: {\r\n            el: '.swiper-scrollbar',\r\n            hide: false,\r\n            draggable: true,\r\n        },\r\n        on: {\r\n            click: function() {\r\n                let iR = (this.clickedSlide.firstChild.id).substring(3) - 1;\r\n                swiperv.slideTo(iR, 1);\r\n            },\r\n            transitionEnd: function () {\r\n                let iR = this.realIndex;\r\n                swiperv.slideTo(iR, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    changeSwiper();\r\n}\r\n\r\n// Mapping wind directions to angles\r\nfunction getAngleRange(direction) {\r\n    const dirToAngle = {\r\n        \"N\": 0, \"NNE\": 22.5, \"NE\": 45, \"ENE\": 67.5,\r\n        \"E\": 90, \"ESE\": 112.5, \"SE\": 135, \"SSE\": 157.5,\r\n        \"S\": 180, \"SSW\": 202.5, \"SW\": 225, \"WSW\": 247.5,\r\n        \"W\": 270, \"WNW\": 292.5, \"NW\": 315, \"NNW\": 337.5\r\n    };\r\n\r\n    let angleRanges = [];\r\n    let parts = direction.split(',').map(part => part.trim());\r\n\r\n    parts.forEach(part => {\r\n        let range = part.split('-').map(dir => dir.trim());\r\n        if (range.length === 1) {\r\n            let angle = dirToAngle[range[0]];\r\n            if (angle !== undefined) {\r\n                angleRanges.push([angle - 22.5, angle + 22.5]);\r\n            }\r\n        } else if (range.length === 2) {\r\n            let start = dirToAngle[range[0]];\r\n            let end = dirToAngle[range[1]];\r\n            if (start !== undefined && end !== undefined) {\r\n                if (end < start) {\r\n                    [start, end] = [end, start];\r\n                }\r\n                if (end - start > 180) {\r\n                    [start, end] = [end, start];\r\n                }\r\n                angleRanges.push([start, end]);\r\n            }\r\n        }\r\n    });\r\n\r\n    return angleRanges;\r\n}\r\n\r\n// Fetch full place details when a popup is opened\r\nasync function loadPlaceDetails(layer, placeId) {\r\n    try {\r\n        const response = await fetch(`/api/places/${placeId}`);\r\n        const data = await response.json();\r\n\r\n        if (data.error) {\r\n            console.error(\"Error fetching place details:\", data.error);\r\n            return;\r\n        }\r\n\r\n        let regex1 = /<center><b><a href=\"http:\\/\\/www\\.paraglidingearth\\.com\\/index\\.php\\?site=\\d+\">More information on ParaglidingEarth<\\/a><\\/b><\\/center>\\n?/g;\r\n        let regex2 = /<br>\\n<b>Take off : <\\/b><br>\\n?/g;\r\n        let regexHeight = /H \\d+(-\\d+)? m(?:, |<br>)/g;\r\n        let regexHD = /HD \\d+ m(?:<br>| \\/)/g;\r\n        let regexRating = /\\nrating \\d+\\/\\d+(?:\\n|<br>)*/gi;\r\n\r\n        let description = (data.properties.description || \"\")\r\n            .replace(regex1, \"\")\r\n            .replace(regex2, \"\")\r\n            .replace(regexHeight, \"\")\r\n            .replace(regexHD, \"\")\r\n            .replace(regexRating, \"\")\r\n            .trim();\r\n\r\n        window.currentPlaceName = data.properties.name;\r\n        window.currentPlaceId = data.properties.id; \r\n        window.currentStrPlacemarkId = data.properties.strPlacemarkId; \r\n\r\n        let popupContent = `<span style=\"color: #0087F7;\"><h5>${data.properties.name}</h5></span>\r\n                            <table style=\"border-collapse: collapse; width: 70%;\">\r\n                            <tr>\r\n                                <th style=\"text-align: left; vertical-align: top;\">Type:</th>\r\n                                <td style=\"text-align: left; vertical-align: top;\">${data.properties.type}</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <th style=\"text-align: left; vertical-align: top;\">Direction:</th>\r\n                                <td style=\"text-align: left; vertical-align: top;\">${data.properties.direction}</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <th style=\"text-align: left; vertical-align: top;\">Rating:</th>\r\n                                <td style=\"text-align: left; vertical-align: top;\">${data.properties.rating != null ? data.properties.rating + '/6' : ' -'}</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <th style=\"text-align: left; vertical-align: top;\">Height:</th>\r\n                                <td style=\"text-align: left; vertical-align: top;\">${data.properties.height != null ? data.properties.height : ' -'}</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <th style=\"text-align: left; vertical-align: top;\">Height difference:</th>\r\n                                <td style=\"text-align: left; vertical-align: top;\">${data.properties.heightdifference != null ? data.properties.heightdifference : ' -'}</td>\r\n                            </tr>\r\n                            <tr>\r\n                                <th style=\"text-align: left; vertical-align: top;\">Last Update:</th>\r\n                                <td style=\"text-align: left; vertical-align: top;\">${data.properties.lastupdate}</td>\r\n                            </tr>\r\n                            </table><br>\r\n                            <b>Description:</b> <div class=\"spot-description\">${description}</div><br>\r\n                            <b> <a href=\"https://paraglidingspots.com\" target=\"_blank\">paraglidingspots.com</a></b>\r\n                            <div class=\"modal-footer d-flex justify-content-between\">\r\n                            <div id=\"feedback-message\" class=\"text-start\"></div> <!-- Message on the left -->\r\n                            <div class=\"d-flex ms-auto\">\r\n                                <button class=\"btn btn-primary btn-sm me-2\" onclick=\"showFeebackForm()\">Feedback/Correction</button>\r\n                                <button class=\"btn btn-dark btn-sm close-popup\">Close</button>\r\n                            </div>\r\n                            </div>\r\n                            `;\r\n\r\n        // Apply maxWidth CSS directly to popup content if needed\r\n        popupContent += `<style>\r\n        /* Limit the height of the Swiper container */\r\n        .swiper-container {\r\n            max-height: 460px !important;\r\n            height: 460px !important;\r\n            overflow: hidden !important;\r\n        }\r\n\r\n        /* Ensure individual Swipers don't expand beyond this height */\r\n        .swiper, .swiper1, .swiper2 {\r\n            max-height: 460px !important;\r\n            height: 460px !important;\r\n            overflow: hidden !important;\r\n        }\r\n\r\n        /* Limit Swiper wrapper height */\r\n        .swiper-wrapper {\r\n            max-height: 460px !important;\r\n        }\r\n\r\n        /* Ensure Swiper slides don't stretch */\r\n        .swiper-slide {\r\n            max-height: 460px !important;\r\n            display: flex !important;\r\n            align-items: center !important; /* Keep images centered */\r\n            justify-content: center !important;\r\n        }\r\n\r\n        /* Prevent images from exceeding the swiper height */\r\n        .swiper-slide img {\r\n            max-height: 100% !important;\r\n            width: auto !important;\r\n        }\r\n        \r\n        /* Keep the overall popup size unchanged */\r\n        .leaflet-popup-content {\r\n            max-height: 780px !important; /* Keep original popup height */\r\n            overflow-y: auto; /* Allow scrolling inside the popup if needed */\r\n        }\r\n\r\n        .swiper-clear {\r\n            clear: both;\r\n            margin-bottom: 1px;\r\n        }\r\n        </style>`;\r\n\r\n        // Check if fullscreen info is visible and update its content area\r\n        const fullScreenInfo = document.getElementById('fullScreenInfo');\r\n        const fullScreenContentArea = document.getElementById('fullscreen-content-area');\r\n        if (fullScreenInfo && fullScreenInfo.classList.contains('visible') && fullScreenContentArea) {\r\n            console.log(\"Updating fullscreen info content area for spot\"); // Updated logging\r\n            \r\n            // Remove default button/footer added by index.js\r\n            const defaultCloseBtn = fullScreenInfo.querySelector('#default-fullscreen-close-btn');\r\n            const defaultFooter = fullScreenInfo.querySelector('#default-fullscreen-footer');\r\n            if (defaultCloseBtn) defaultCloseBtn.remove();\r\n            if (defaultFooter) defaultFooter.remove();\r\n            \r\n            // Set the spot-specific content (which includes its own buttons/footer)\r\n            fullScreenContentArea.innerHTML = popupContent;\r\n        }\r\n\r\n        // Update the original Leaflet popup (still useful for larger screens or if fullscreen fails)\r\n        layer.setPopupContent(popupContent);\r\n\r\n        // Wait for the popup to open before initializing Swiper\r\n        setTimeout(() => {\r\n            let firstImg = document.querySelector(\".swiper1 .swiper-slide img\");\r\n            if (firstImg) {\r\n                let idImg = parseInt(firstImg.id.replace(/\\D/g, \"\"), 10) || 1;\r\n                initSwiper(idImg); // Call existing Swiper function\r\n            }\r\n    \r\n        }, 300);\r\n\r\n        // Attach close button listener, considering fullscreen context\r\n        setTimeout(() => {\r\n            const fullScreenInfo = document.getElementById('fullScreenInfo');\r\n            let closeButton = null;\r\n\r\n            if (fullScreenInfo && fullScreenInfo.classList.contains('visible')) {\r\n                // Target close button within fullscreen view\r\n                closeButton = fullScreenInfo.querySelector('#fullscreen-content-area .close-popup');\r\n                if (closeButton) {\r\n                    // Remove potential old listeners before adding new one\r\n                    closeButton.replaceWith(closeButton.cloneNode(true));\r\n                    closeButton = fullScreenInfo.querySelector('#fullscreen-content-area .close-popup'); // Re-select after clone\r\n                    \r\n                    closeButton.addEventListener(\"click\", function () {\r\n                        console.log(\"Fullscreen close button clicked\"); // Logging\r\n                        window.closeFullscreenInfo(); // Use the fullscreen close function\r\n                    });\r\n                } else {\r\n                    console.error(\"Close button not found in fullscreen view\");\r\n                }\r\n            } else {\r\n                // Target close button within the standard Leaflet popup\r\n                // Assuming the popup is the context, query within the layer's popup element\r\n                const popupElement = layer.getPopup().getElement();\r\n                if (popupElement) {\r\n                    closeButton = popupElement.querySelector(\".close-popup\");\r\n                    if (closeButton) {\r\n                        // Remove potential old listeners before adding new one\r\n                        closeButton.replaceWith(closeButton.cloneNode(true));\r\n                        closeButton = popupElement.querySelector(\".close-popup\"); // Re-select after clone\r\n                        \r\n                        closeButton.addEventListener(\"click\", function () {\r\n                            console.log(\"Standard popup close button clicked\"); // Logging\r\n                            if (window.map) {\r\n                                window.map.closePopup(); // Use standard map close\r\n                            }\r\n                        });\r\n                    } else {\r\n                        console.error(\"Close button not found in standard popup\");\r\n                    }\r\n                }\r\n            }\r\n        }, 350); // Slightly increased delay to ensure content is rendered\r\n\r\n    } catch (error) {\r\n        console.error(\"Error fetching place details:\", error);\r\n    }\r\n}\r\n\r\nfunction showFeebackForm() {\r\n    // Cleanup any existing feedback form\r\n    if (currentFeedbackForm) {\r\n        currentFeedbackForm.remove();\r\n        currentFeedbackForm = null;\r\n    }\r\n    if (feedbackDropzone) {\r\n        feedbackDropzone.destroy();\r\n        feedbackDropzone = null;\r\n    }\r\n    // Clear previous feedback message\r\n    const messageDiv = document.getElementById(\"feedback-message\");\r\n    if (messageDiv) {\r\n        messageDiv.textContent = \"\";\r\n         messageDiv.classList.remove(\"text-success\", \"text-danger\");\r\n    }\r\n\r\n    // Determine the context (fullscreen or standard popup)\r\n    const fullScreenInfo = document.getElementById('fullScreenInfo');\r\n    const isFullScreen = fullScreenInfo && fullScreenInfo.classList.contains('visible');\r\n    const contextElement = isFullScreen ? fullScreenInfo.querySelector('#fullscreen-content-area') : document.querySelector(\".leaflet-popup-content\");\r\n\r\n    if (!contextElement) {\r\n        console.error(\"Could not find context element for feedback form.\");\r\n        return;\r\n    }\r\n\r\n    // Hide the original footer within the correct context\r\n    let modalFooter = contextElement.querySelector(\".modal-footer\");\r\n    if (modalFooter) modalFooter.style.display = \"none\";\r\n\r\n    const feedbackFormHtml = `\r\n        <div id=\"feedbackFormHtml\">\r\n            <div class=\"feedback-modal\">\r\n                <span style=\"color: #0087F7;\"><h5>Feedback for ${window.currentPlaceName}</h5></span>\r\n                <form id=\"feedbackForm\">\r\n                    <div class=\"form-group\">\r\n                        <label for=\"feedbackText\">Feedback / Correction / Comment:</label>\r\n                        <textarea id=\"feedbackText\" class=\"form-control\" required style=\"height: 130px;\"></textarea>\r\n                    </div>\r\n                    <div class=\"form-group\">\r\n                        <label>Upload Images (optional):</label>\r\n                        <div id=\"dropzoneFeedback\" class=\"dropzone mt-4 border-dashed rounded-2 min-h-0\"></div>\r\n                    </div>\r\n                    <div class=\"form-group d-flex justify-content-between\">\r\n                        <div style=\"width: 48%;\">\r\n                            <label for=\"userName\">Name:</label>\r\n                            <input type=\"text\" id=\"userName\" class=\"form-control\" required>\r\n                        </div>\r\n                        <div style=\"width: 48%;\">\r\n                            <label for=\"userEmail\">E-Mail:</label>\r\n                            <input type=\"email\" id=\"userEmail\" class=\"form-control\" required>\r\n                            <small class=\"text-danger d-none\" id=\"emailError\">Please enter a valid email address.</small>\r\n                        </div>\r\n                    </div>\r\n                    <button type=\"submit\" class=\"btn btn-sm btn-success\">Submit</button>\r\n                    <button type=\"button\" class=\"btn btn-sm btn-secondary\" onclick=\"cancelFeedback()\">Cancel</button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    `;\r\n\r\n    // Append the form HTML to the correct context element\r\n    if (contextElement) {\r\n        contextElement.insertAdjacentHTML(\"beforeend\", feedbackFormHtml);\r\n        // Find the newly added form within the specific context\r\n        currentFeedbackForm = contextElement.querySelector(\"#feedbackFormHtml\");\r\n\r\n        // Auto-scroll implementation (scroll the context element)\r\n        setTimeout(() => {\r\n            // Use the contextElement determined earlier\r\n            if (contextElement) {\r\n                // First try the standard scrollTo method\r\n                contextElement.scrollTo({\r\n                    top: contextElement.scrollHeight,\r\n                    behavior: 'smooth'\r\n                });\r\n                \r\n                // As a fallback, also set scrollTop directly\r\n                contextElement.scrollTop = contextElement.scrollHeight;\r\n                \r\n                // If we're in fullscreen mode, also try to scroll the entire fullscreen container\r\n                if (isFullScreen && fullScreenInfo) {\r\n                    fullScreenInfo.scrollTo({\r\n                        top: fullScreenInfo.scrollHeight,\r\n                        behavior: 'smooth'\r\n                    });\r\n                    fullScreenInfo.scrollTop = fullScreenInfo.scrollHeight;\r\n                }\r\n                \r\n                // Focus on the feedback text area to bring it into view\r\n                setTimeout(() => {\r\n                    const feedbackText = document.getElementById(\"feedbackText\");\r\n                    if (feedbackText) {\r\n                        feedbackText.focus();\r\n                    }\r\n                }, 100);\r\n            }\r\n        }, 200); // Increased delay to ensure DOM rendering\r\n    } else {\r\n        console.error(\"Popup content not found!\");\r\n        return;\r\n    }\r\n\r\n    // Initialize Dropzone\r\n    feedbackDropzone = new Dropzone(\"#dropzoneFeedback\", {\r\n        url: \"/upload\",\r\n        autoProcessQueue: false,\r\n        maxFiles: 5,\r\n        maxFilesize: 100,\r\n        acceptedFiles: \"image/*\",\r\n        addRemoveLinks: false,\r\n        dictDefaultMessage: \"Drag & drop files here or click to upload\",\r\n        clickable: true,\r\n        init: function() {\r\n            const dzInstance = this;\r\n            this.on(\"addedfile\", function(file) {\r\n                const previewElement = file.previewElement;\r\n                const deleteIcon = document.createElement(\"img\");\r\n                deleteIcon.src = \"/assets/images/imgdelete.png\";\r\n                deleteIcon.alt = \"Delete\";\r\n                deleteIcon.classList.add(\"delete-icon\");\r\n                previewElement.querySelector(\".dz-image\").appendChild(deleteIcon);\r\n\r\n                deleteIcon.addEventListener(\"click\", function(e) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    dzInstance.removeFile(file);\r\n                });\r\n            });\r\n\r\n            this.on(\"removedfile\", function(file) {\r\n                console.log(\"File removed:\", file.name);\r\n            });\r\n        }\r\n    });\r\n\r\n    // Email validation\r\n    document.getElementById(\"userEmail\").addEventListener(\"input\", function() {\r\n        const isValid = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(this.value);\r\n        document.getElementById(\"emailError\").classList.toggle(\"d-none\", isValid);\r\n    });\r\n\r\n    // Form submission\r\n    document.getElementById(\"feedbackForm\").addEventListener(\"submit\", async function(event) {\r\n        event.preventDefault();\r\n\r\n        const formData = new FormData();\r\n        formData.append(\"name\", window.currentPlaceName);\r\n        formData.append(\"id\", window.currentPlaceId);\r\n        formData.append(\"strPlacemarkId\", window.currentStrPlacemarkId);    \r\n        formData.append(\"feedbackText\", document.getElementById(\"feedbackText\").value);\r\n        formData.append(\"userName\", document.getElementById(\"userName\").value);\r\n        formData.append(\"userEmail\", document.getElementById(\"userEmail\").value);\r\n\r\n        feedbackDropzone.files.forEach(file => {\r\n            formData.append(\"images\", file);\r\n        });\r\n\r\n        try {\r\n            const response = await fetch(`/api/send-feedback`, {\r\n                method: \"POST\",\r\n                body: formData\r\n            });\r\n            const result = await response.json();\r\n\r\n            // Cleanup after submission\r\n            if (currentFeedbackForm) {\r\n                currentFeedbackForm.remove();\r\n                currentFeedbackForm = null;\r\n            }\r\n            if (feedbackDropzone) {\r\n                feedbackDropzone.destroy();\r\n                feedbackDropzone = null;\r\n            }\r\n\r\n            // Find the message div and footer within the correct context\r\n            const messageDiv = contextElement ? contextElement.querySelector(\"#feedback-message\") : document.getElementById(\"feedback-message\");\r\n            const modalFooter = contextElement ? contextElement.querySelector(\".modal-footer\") : document.querySelector(\".modal-footer\");\r\n\r\n            if (messageDiv) {\r\n                if (result.success) {\r\n                    messageDiv.textContent = result.message || \"Feedback submitted successfully!\";\r\n                    messageDiv.classList.remove(\"text-danger\");\r\n                    messageDiv.classList.add(\"text-success\");\r\n                } else {\r\n                    messageDiv.textContent = result.error || \"An error occurred.\";\r\n                    messageDiv.classList.remove(\"text-success\");\r\n                    messageDiv.classList.add(\"text-danger\");\r\n                }\r\n            } else {\r\n                console.error(\"Feedback message div not found in context.\");\r\n            }\r\n            \r\n            if (modalFooter) {\r\n                modalFooter.style.display = \"flex\"; // Restore footer visibility\r\n            } else {\r\n                console.error(\"Modal footer not found in context.\");\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error(\"Submission error:\", error);\r\n            // Attempt to restore footer even on error\r\n            const modalFooter = contextElement ? contextElement.querySelector(\".modal-footer\") : document.querySelector(\".modal-footer\");\r\n            if (modalFooter) modalFooter.style.display = \"flex\";\r\n        }\r\n    });\r\n}\r\n\r\nfunction cancelFeedback() {\r\n    // Cleanup feedback form and Dropzone\r\n    if (currentFeedbackForm) {\r\n        currentFeedbackForm.remove();\r\n        currentFeedbackForm = null;\r\n    }\r\n    if (feedbackDropzone) {\r\n        feedbackDropzone.destroy();\r\n        feedbackDropzone = null;\r\n    }\r\n    // Find the correct context and footer to restore\r\n    const fullScreenInfo = document.getElementById('fullScreenInfo');\r\n    const isFullScreen = fullScreenInfo && fullScreenInfo.classList.contains('visible');\r\n    const contextElement = isFullScreen ? fullScreenInfo.querySelector('#fullscreen-content-area') : document.querySelector(\".leaflet-popup-content\");\r\n    if (contextElement) {\r\n        let modalFooter = contextElement.querySelector(\".modal-footer\");\r\n        if (modalFooter) modalFooter.style.display = \"flex\";\r\n    } else {\r\n        // Fallback for safety, though contextElement should exist if form was shown\r\n        let fallbackFooter = document.querySelector(\".modal-footer\");\r\n        if (fallbackFooter) fallbackFooter.style.display = \"flex\";\r\n    }\r\n}\r\n\r\n// Export functions\r\nexport {\r\n    changeSwiper,\r\n    initSwiper,\r\n    getAngleRange,\r\n    loadPlaceDetails,\r\n    showFeebackForm,\r\n    cancelFeedback\r\n};","import { \r\n    getAngleRange, \r\n    loadPlaceDetails, \r\n    showFeebackForm, \r\n    cancelFeedback \r\n} from './spots-helper.js';\r\n\r\n// Use a module initialization function that waits for map to be ready\r\nexport function initSpotPG() {\r\n    // Check if map and placesLayerPG are available in the window object\r\n    if (!window.map || !window.placesLayerPG) {\r\n        console.error(\"Map or placesLayerPG is not defined. Retrying in 500ms...\");\r\n        setTimeout(initSpotPG, 500);\r\n        return;\r\n    }\r\n\r\n    console.log(\"Initializing PG spots module...\");\r\n\r\n    // Expose needed functions to global scope for event handlers\r\n    window.showFeebackForm = showFeebackForm;\r\n    window.cancelFeedback = cancelFeedback;\r\n\r\n    // Create cluster group and nest it in the existing layer group\r\n    const clusterGroup = L.markerClusterGroup({\r\n        disableClusteringAtZoom: 9,\r\n        spiderfyOnMaxZoom: true,\r\n        showCoverageOnHover: true,\r\n        zoomToBoundsOnClick: true,\r\n        maxClusterRadius: 250,\r\n        iconCreateFunction: function(cluster) {\r\n            return L.divIcon({ \r\n                html: `<div class=\"cluster-marker\">${cluster.getChildCount()}</div>`,\r\n                className: 'pg-cluster-icon',\r\n                iconSize: L.point(30, 30)\r\n            });\r\n        }\r\n    });\r\n\r\n    window.placesLayerPG.addLayer(clusterGroup);\r\n\r\n    // Track current fetch controller to allow cancellation\r\n    let currentFetchController = null;\r\n    // Add debounce timer\r\n    let fetchDebounceTimer = null;\r\n    const DEBOUNCE_DELAY = 300; // ms\r\n\r\n    // Fetch places without descriptions\r\n    function fetchPlaces() {\r\n        // Only proceed if the layer is on the map\r\n        if (!window.map.hasLayer(window.placesLayerPG)) {\r\n            console.log(\"PG layer not visible, skipping fetch\");\r\n            return;\r\n        }\r\n        \r\n        // Clear any pending debounce\r\n        if (fetchDebounceTimer) {\r\n            clearTimeout(fetchDebounceTimer);\r\n        }\r\n        \r\n        // Debounce the fetch call to prevent rapid successive requests\r\n        fetchDebounceTimer = setTimeout(() => {\r\n            // Cancel any ongoing fetch\r\n            if (currentFetchController) {\r\n                currentFetchController.abort();\r\n            }\r\n\r\n            // Create a new controller for this fetch\r\n            currentFetchController = new AbortController();\r\n            const signal = currentFetchController.signal;\r\n\r\n            const bounds = window.map.getBounds();\r\n            const nw_lat = bounds.getNorthWest().lat;\r\n            const nw_lng = bounds.getNorthWest().lng;\r\n            const se_lat = bounds.getSouthEast().lat;\r\n            const se_lng = bounds.getSouthEast().lng;\r\n\r\n            fetch(`/api/places?nw_lat=${nw_lat}&nw_lng=${nw_lng}&se_lat=${se_lat}&se_lng=${se_lng}&type=TO&type=TOW&type=TH`, {\r\n                signal // Attach the abort signal to the fetch call\r\n            })\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    // Only process if this is still the active request\r\n                    if (signal.aborted) return;\r\n                    \r\n                    clusterGroup.clearLayers();\r\n\r\n                    L.geoJSON(data, {\r\n                        pointToLayer: function (feature, latlng) {\r\n                            return L.marker(latlng, {\r\n                                icon: L.canvasIcon({\r\n                                    iconSize: [50, 50],\r\n                                    iconAnchor: [15, 15],\r\n                                    drawIcon: function (icon, type) {\r\n                                        if (type === 'icon') {\r\n                                            var ctx = icon.getContext('2d');\r\n                                            var size = L.point(this.options.iconSize);\r\n                                            var center = L.point(size.x / 2, size.y / 2);\r\n                                            ctx.clearRect(0, 0, size.x, size.y);\r\n\r\n                                            let direction = feature.properties.direction || \"\";\r\n                                            let angleRanges = getAngleRange(direction);\r\n\r\n                                            ctx.beginPath();\r\n                                            angleRanges.forEach(([start, end]) => {\r\n                                                ctx.moveTo(center.x, center.y);\r\n                                                ctx.arc(center.x, center.y, center.x, (start - 90) * Math.PI / 180, (end - 90) * Math.PI / 180, false);\r\n                                                ctx.lineTo(center.x, center.y);\r\n                                            });\r\n                                            ctx.fillStyle = 'orange';\r\n                                            ctx.fill();\r\n                                            ctx.closePath();\r\n\r\n                                            ctx.beginPath();\r\n                                            ctx.arc(center.x, center.y, center.x / 4, 0, Math.PI * 2);\r\n                                            ctx.fillStyle = 'green';\r\n                                            ctx.fill();\r\n                                            ctx.closePath();\r\n                                        }\r\n                                    }\r\n                                })\r\n                            });\r\n                        },\r\n                        onEachFeature: function (feature, layer) {\r\n                            if (feature.properties) {\r\n                                let popupContent = `<b>${feature.properties.name}</b><br>\r\n                                                    Type: ${feature.properties.type}<br>\r\n                                                    Direction: ${feature.properties.direction}<br>\r\n                                                    <i>Loading details...</i>`;\r\n\r\n                                let responsivePopup = L.responsivePopup({\r\n                                    hasTip: true,\r\n                                    autoPan: false,\r\n                                    offset: [15, 25],\r\n                                    maxWidth: 900,\r\n                                    maxHeight: 780\r\n                                }).setContent(popupContent);\r\n\r\n                                layer.bindPopup(responsivePopup);\r\n\r\n                                layer.on(\"popupopen\", async function () {\r\n                                    await loadPlaceDetails(layer, feature.properties.id);\r\n                                });\r\n                            }\r\n                            \r\n                            clusterGroup.addLayer(layer);\r\n                        }\r\n                    });\r\n                    \r\n                    // Clear the controller reference when done\r\n                    currentFetchController = null;\r\n                })\r\n                .catch(error => {\r\n                    // Don't log aborted requests as errors\r\n                    if (error.name !== 'AbortError') {\r\n                        console.error(\"Error fetching PG places:\", error);\r\n                    }\r\n                });\r\n        }, DEBOUNCE_DELAY);\r\n    }\r\n\r\n    // IMPORTANT: Expose fetchPlaces to window so it can be called from index.js\r\n    window.fetchPlacesPG = fetchPlaces;\r\n\r\n    // REMOVED: Don't attach moveend listener here anymore\r\n    // The central handler in index.js will call fetchPlacesPG when needed\r\n\r\n    // Initial load only if layer is visible\r\n    if (window.map.hasLayer(window.placesLayerPG)) {\r\n        fetchPlaces();\r\n    }\r\n    \r\n    console.log(\"PG spots module initialized\");\r\n}\r\n\r\n// Listen for map initialization event\r\ndocument.addEventListener(\"map_initialized\", function() {\r\n    console.log(\"Map initialized event received in PG spots module\");\r\n    setTimeout(initSpotPG, 100);\r\n});\r\n\r\n// Alternative initialization approach\r\nsetTimeout(() => {\r\n    if (window.mapInitialized) {\r\n        console.log(\"Backup initialization for PG spots module\");\r\n        initSpotPG();\r\n    }\r\n}, 1000);","import { \r\n    getAngleRange, \r\n    loadPlaceDetails, \r\n    showFeebackForm, \r\n    cancelFeedback \r\n} from './spots-helper.js';\r\n\r\n// Use a module initialization function that waits for map to be ready\r\nexport function initSpotHG() {\r\n    // Check if map and placesLayerHG are available in the window object\r\n    if (!window.map || !window.placesLayerHG) {\r\n        console.error(\"Map or placesLayerHG is not defined. Retrying in 500ms...\");\r\n        setTimeout(initSpotHG, 500);\r\n        return;\r\n    }\r\n\r\n    console.log(\"Initializing HG spots module...\");\r\n\r\n    // Expose needed functions to global scope for event handlers\r\n    window.showFeebackForm = showFeebackForm;\r\n    window.cancelFeedback = cancelFeedback;\r\n\r\n    // Create cluster group and nest it in the existing layer group\r\n    const clusterGroup = L.markerClusterGroup({\r\n        disableClusteringAtZoom: 9,\r\n        spiderfyOnMaxZoom: true,\r\n        showCoverageOnHover: true,\r\n        zoomToBoundsOnClick: true,\r\n        maxClusterRadius: 250,\r\n        iconCreateFunction: function(cluster) {\r\n            return L.divIcon({ \r\n                html: `<div class=\"cluster-marker\">${cluster.getChildCount()}</div>`,\r\n                className: 'hg-cluster-icon',\r\n                iconSize: L.point(30, 30)\r\n            });\r\n        }\r\n    });\r\n\r\n    window.placesLayerHG.addLayer(clusterGroup);\r\n\r\n    // Track current fetch controller to allow cancellation\r\n    let currentFetchController = null;\r\n    // Add debounce timer\r\n    let fetchDebounceTimer = null;\r\n    const DEBOUNCE_DELAY = 300; // ms\r\n\r\n    // Fetch places without descriptions\r\n    function fetchPlaces() {\r\n        // Clear any pending debounce\r\n        if (fetchDebounceTimer) {\r\n            clearTimeout(fetchDebounceTimer);\r\n        }\r\n        \r\n        // Debounce the fetch call to prevent rapid successive requests\r\n        fetchDebounceTimer = setTimeout(() => {\r\n            // Cancel any ongoing fetch\r\n            if (currentFetchController) {\r\n                currentFetchController.abort();\r\n            }\r\n\r\n            // Create a new controller for this fetch\r\n            currentFetchController = new AbortController();\r\n            const signal = currentFetchController.signal;\r\n\r\n            const bounds = window.map.getBounds();\r\n            const nw_lat = bounds.getNorthWest().lat;\r\n            const nw_lng = bounds.getNorthWest().lng;\r\n            const se_lat = bounds.getSouthEast().lat;\r\n            const se_lng = bounds.getSouthEast().lng;\r\n\r\n            fetch(`/api/places?nw_lat=${nw_lat}&nw_lng=${nw_lng}&se_lat=${se_lat}&se_lng=${se_lng}&type=TO-HG&type=TOW-HG`, {\r\n                signal // Attach the abort signal to the fetch call\r\n            })\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    // Only process if this is still the active request\r\n                    if (signal.aborted) return;\r\n                    \r\n                    clusterGroup.clearLayers();\r\n\r\n                    L.geoJSON(data, {\r\n                        pointToLayer: function (feature, latlng) {\r\n                            return L.marker(latlng, {\r\n                                icon: L.canvasIcon({\r\n                                    iconSize: [50, 50],\r\n                                    iconAnchor: [15, 15],\r\n                                    drawIcon: function (icon, type) {\r\n                                        if (type === 'icon') {\r\n                                            var ctx = icon.getContext('2d');\r\n                                            var size = L.point(this.options.iconSize);\r\n                                            var center = L.point(size.x / 2, size.y / 2);\r\n                                            ctx.clearRect(0, 0, size.x, size.y);\r\n\r\n                                            let direction = feature.properties.direction || \"\";\r\n                                            let angleRanges = getAngleRange(direction);\r\n\r\n                                            ctx.beginPath();\r\n                                            angleRanges.forEach(([start, end]) => {\r\n                                                ctx.moveTo(center.x, center.y);\r\n                                                ctx.arc(center.x, center.y, center.x, (start - 90) * Math.PI / 180, (end - 90) * Math.PI / 180, false);\r\n                                                ctx.lineTo(center.x, center.y);\r\n                                            });\r\n                                            ctx.fillStyle = 'orange';\r\n                                            ctx.fill();\r\n                                            ctx.closePath();\r\n\r\n                                            ctx.beginPath();\r\n                                            ctx.arc(center.x, center.y, center.x / 4, 0, Math.PI * 2);\r\n                                            ctx.fillStyle = 'green';\r\n                                            ctx.fill();\r\n                                            ctx.closePath();\r\n                                        }\r\n                                    }\r\n                                })\r\n                            });\r\n                        },\r\n                        onEachFeature: function (feature, layer) {\r\n                            if (feature.properties) {\r\n                                let popupContent = `<b>${feature.properties.name}</b><br>\r\n                                                    Type: ${feature.properties.type}<br>\r\n                                                    Direction: ${feature.properties.direction}<br>\r\n                                                    <i>Loading details...</i>`;\r\n\r\n                                let responsivePopup = L.responsivePopup({\r\n                                    hasTip: true,\r\n                                    autoPan: false,\r\n                                    offset: [15, 25],\r\n                                    maxWidth: 900,\r\n                                    maxHeight: 780\r\n                                }).setContent(popupContent);\r\n\r\n                                layer.bindPopup(responsivePopup);\r\n\r\n                                layer.on(\"popupopen\", async function () {\r\n                                    await loadPlaceDetails(layer, feature.properties.id);\r\n                                });\r\n                            }\r\n                            \r\n                            clusterGroup.addLayer(layer);\r\n                        }\r\n                    });\r\n                    \r\n                    // Clear the controller reference when done\r\n                    currentFetchController = null;\r\n                })\r\n                .catch(error => {\r\n                    // Don't log aborted requests as errors\r\n                    if (error.name !== 'AbortError') {\r\n                        console.error(\"Error fetching HG places:\", error);\r\n                    }\r\n                });\r\n        }, DEBOUNCE_DELAY);\r\n    }\r\n\r\n    // IMPORTANT: Expose fetchPlaces to window so it can be called from index.js\r\n    window.fetchPlacesHG = fetchPlaces;\r\n\r\n    // REMOVED: Don't attach moveend listener here anymore\r\n    // The central handler in index.js will call fetchPlacesPG when needed\r\n\r\n    // Initial load only if layer is visible\r\n    if (window.map.hasLayer(window.placesLayerHG)) {\r\n        fetchPlaces();\r\n    }\r\n    \r\n    console.log(\"PG spots module initialized\");\r\n}\r\n\r\n// Listen for map initialization event\r\ndocument.addEventListener(\"map_initialized\", function() {\r\n    console.log(\"Map initialized event received in HG spots module\");\r\n    setTimeout(initSpotHG, 100);\r\n});\r\n\r\n// Alternative initialization approach\r\nsetTimeout(() => {\r\n    if (window.mapInitialized) {\r\n        console.log(\"Backup initialization for HG spots module\");\r\n        initSpotHG();\r\n    }\r\n}, 1000);","import { \r\n    getAngleRange, \r\n    loadPlaceDetails, \r\n    showFeebackForm, \r\n    cancelFeedback \r\n} from './spots-helper.js';\r\n\r\n// Use a module initialization function that waits for map to be ready\r\nexport function initSpotLZ() {\r\n    if (!window.map || !window.placesLayerLZ) {\r\n        setTimeout(initSpotLZ, 500);\r\n        return;\r\n    }\r\n\r\n    console.log(\"Initializing LZ spots module...\");\r\n\r\n    // Create cluster group and nest it in the existing layer group\r\n    const clusterGroup = L.markerClusterGroup({\r\n        disableClusteringAtZoom: 9,\r\n        spiderfyOnMaxZoom: true,\r\n        showCoverageOnHover: true,\r\n        zoomToBoundsOnClick: true,\r\n        maxClusterRadius: 250,\r\n        iconCreateFunction: function(cluster) {\r\n            return L.divIcon({ \r\n                html: `<div class=\"cluster-marker\">${cluster.getChildCount()}</div>`,\r\n                className: 'lz-cluster-icon',\r\n                iconSize: L.point(30, 30)\r\n            });\r\n        }\r\n    });\r\n\r\n    window.placesLayerLZ.addLayer(clusterGroup); // Add cluster group to the layer group\r\n\r\n    // Track current fetch controller to allow cancellation\r\n    let currentFetchController = null;\r\n    // Add debounce timer\r\n    let fetchDebounceTimer = null;\r\n    const DEBOUNCE_DELAY = 300; // ms\r\n\r\n    // Update fetchPlaces to use clusterGroup\r\n    function fetchPlaces() {\r\n        // Clear any pending debounce\r\n        if (fetchDebounceTimer) {\r\n            clearTimeout(fetchDebounceTimer);\r\n        }\r\n        \r\n        // Debounce the fetch call to prevent rapid successive requests\r\n        fetchDebounceTimer = setTimeout(() => {\r\n            // Cancel any ongoing fetch\r\n            if (currentFetchController) {\r\n                currentFetchController.abort();\r\n            }\r\n\r\n            // Create a new controller for this fetch\r\n            currentFetchController = new AbortController();\r\n            const signal = currentFetchController.signal;\r\n            \r\n            const bounds = window.map.getBounds();\r\n            const nw_lat = bounds.getNorthWest().lat;\r\n            const nw_lng = bounds.getNorthWest().lng;\r\n            const se_lat = bounds.getSouthEast().lat;\r\n            const se_lng = bounds.getSouthEast().lng;\r\n\r\n            fetch(`/api/places?nw_lat=${nw_lat}&nw_lng=${nw_lng}&se_lat=${se_lat}&se_lng=${se_lng}&type=LZ`, {\r\n                signal // Attach the abort signal to the fetch call\r\n            })\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    // Only process if this is still the active request\r\n                    if (signal.aborted) return;\r\n                    \r\n                    clusterGroup.clearLayers(); // Clear the cluster group\r\n\r\n                    L.geoJSON(data, {\r\n                        pointToLayer: function (feature, latlng) {\r\n                            return L.marker(latlng, {\r\n                                icon: L.icon({\r\n                                    iconUrl: '../assets/images/windsock.png', // Replace with the actual path to your PNG\r\n                                    iconSize: [20, 20], // Adjust size as needed\r\n                                    iconAnchor: [20, 20] // Adjust anchor to center the image properly\r\n                                })\r\n                            });\r\n                        },\r\n                        onEachFeature: function (feature, layer) {\r\n                            if (feature.properties) {\r\n                                let popupContent = `<b>${feature.properties.name}</b><br>\r\n                                                    Type: ${feature.properties.type}<br>\r\n                                                    Direction: ${feature.properties.direction}<br>\r\n                                                    <i>Loading details...</i>`;\r\n\r\n                                let responsivePopup = L.responsivePopup({\r\n                                    hasTip: true,\r\n                                    autoPan: false,\r\n                                    offset: [15, 25],\r\n                                    maxWidth: 900,\r\n                                    maxHeight: 780\r\n                                }).setContent(popupContent);\r\n\r\n                                layer.bindPopup(responsivePopup);\r\n\r\n                                // Fetch details when popup is opened\r\n                                layer.on(\"popupopen\", async function () {\r\n                                    await loadPlaceDetails(layer, feature.properties.id);\r\n                                });\r\n                               \r\n                            }\r\n                            \r\n                            clusterGroup.addLayer(layer); // Add to clusterGroup\r\n                        }\r\n                    });\r\n                    \r\n                    // Clear the controller reference when done\r\n                    currentFetchController = null;\r\n                })\r\n                .catch(error => {\r\n                    // Don't log aborted requests as errors\r\n                    if (error.name !== 'AbortError') {\r\n                        console.error(\"Error fetching LZ places:\", error);\r\n                    }\r\n                });\r\n        }, DEBOUNCE_DELAY);\r\n    }\r\n    // IMPORTANT: Expose fetchPlaces to window so it can be called from index.js\r\n    window.fetchPlacesLZ = fetchPlaces;\r\n\r\n    // REMOVED: Don't attach moveend listener here anymore\r\n    // The central handler in index.js will call fetchPlacesPG when needed\r\n\r\n    // Initial load only if layer is visible\r\n    if (window.map.hasLayer(window.placesLayerLZ)) {\r\n        fetchPlaces();\r\n    }\r\n    \r\n    console.log(\"PG spots module initialized\");\r\n}\r\n\r\n// Listen for map initialization event\r\ndocument.addEventListener(\"map_initialized\", function() {\r\n    console.log(\"Map initialized event received in LZ spots module\");\r\n    // Give a slight delay to ensure map is fully ready\r\n    setTimeout(initSpotLZ, 100);\r\n});\r\n\r\n// Alternative initialization approach - also try to init if we missed the event\r\nsetTimeout(() => {\r\n    if (window.mapInitialized) {\r\n        console.log(\"Backup initialization for LZ spots module\");\r\n        initSpotLZ();\r\n    }\r\n}, 1000);","// obstacles.js\r\nlet obstacleClickHandler = null;\r\nlet obstacleDebounceTimer;\r\n\r\n// Initialize the obstacle layer\r\nlet obstacleLayer = L.layerGroup({\r\n    attribution: 'XContest&copy; <a href=\"https://xcontest.org\">XContest</a>'\r\n});\r\nwindow.obstacleLayer = obstacleLayer;\r\n\r\nfunction fetchObstacles() {\r\n  if (!window.map) {\r\n    console.error(\"Map not initialized yet\");\r\n    return;\r\n  }\r\n\r\n  // Get current map bounds\r\n  const bounds = window.map.getBounds();\r\n  const nw = bounds.getNorthWest();\r\n  const se = bounds.getSouthEast();\r\n\r\n  const apiUrl = `/api/obstacles?nw_lat=${nw.lat}&nw_lng=${nw.lng}&se_lat=${se.lat}&se_lng=${se.lng}`;\r\n\r\n  // Clear previous layers\r\n  obstacleLayer.clearLayers();\r\n\r\n  fetch(apiUrl)\r\n    .then(response => response.json())\r\n    .then(geoJson => {\r\n      const obstacles = [];\r\n\r\n      geoJson.features.forEach(feature => {\r\n        if (feature.geometry.type === \"LineString\") {\r\n          // Convert coordinates to LatLng format [lat, lng]\r\n          const coords = feature.geometry.coordinates.map(coord => [\r\n            coord[1],\r\n            coord[0]\r\n          ]);\r\n\r\n          // Create polyline with styling from properties\r\n          const polyline = L.polyline(coords, {\r\n            color: feature.properties.strokeColor || \"#ff0000\",\r\n            weight: feature.properties.strokeWeight || 2\r\n          });\r\n\r\n          // Store obstacle data with its polyline\r\n          obstacles.push({ polyline, data: feature.properties });\r\n\r\n          // Add to layer group\r\n          polyline.addTo(obstacleLayer);\r\n\r\n          // Add popup content (using standard popup)\r\n          polyline.bindPopup(() => {\r\n            const content = [];\r\n            if (feature.properties.name) content.push(`<b>${feature.properties.name}</b>`);\r\n            if (feature.properties.type) content.push(`Type: ${feature.properties.type}`);\r\n            if (feature.properties.description) content.push(`Description: ${feature.properties.description}`);\r\n            if (feature.properties.maxAgl) content.push(`Max AG: ${feature.properties.maxAgl}m`);\r\n            \r\n            return content.join(\"<br>\");\r\n          }, { className: 'obstacle-popup' }); // Add custom class to identify obstacle popups\r\n        }\r\n      });\r\n\r\n      console.log(`Added ${obstacles.length} obstacles to the map`);\r\n\r\n      // Remove existing click handler if any\r\n      if (obstacleClickHandler) {\r\n        window.map.off(\"click\", obstacleClickHandler);\r\n      }\r\n\r\n      // Add new click handler for obstacles\r\n      obstacleClickHandler = function(e) {\r\n        if (!window.map.hasLayer(obstacleLayer)) return;\r\n\r\n        const clickedPoint = e.latlng;\r\n        const clickedObstacles = [];\r\n\r\n        obstacles.forEach(({ polyline, data }) => {\r\n          if (polyline.getBounds().contains(clickedPoint)) {\r\n            clickedObstacles.push(data);\r\n          }\r\n        });\r\n\r\n        if (clickedObstacles.length > 0) {\r\n          const popupContent = clickedObstacles.map(obs => `\r\n            ${obs.name ? `<b>${obs.name}</b><br>` : ''}\r\n            ${obs.type ? `Type: ${obs.type}<br>` : ''}\r\n            ${obs.description ? `Description: ${obs.description}<br>` : ''}\r\n            ${obs.maxAgl ? `Max AG: ${obs.maxAgl}m<br>` : ''}\r\n          `).join(\"<hr>\");\r\n\r\n          L.popup({ className: 'obstacle-popup' }) // Add custom class to identify obstacle popups\r\n            .setLatLng(clickedPoint)\r\n            .setContent(popupContent)\r\n            .openOn(window.map);\r\n        }\r\n      };\r\n\r\n      window.map.on(\"click\", obstacleClickHandler);\r\n    })\r\n    .catch(error => console.error(\"Error fetching obstacles:\", error));\r\n}\r\n\r\n// Export the fetch function\r\nwindow.fetchObstacles = fetchObstacles;\r\n\r\n\r\n","import './L.Control.Layers.Tree.js';\r\nimport '../css/L.Control.Layers.Tree.css';\r\n\r\nimport './leaflet.responsive.popup.js';\r\nimport './leaflet.responsive.popup.css';\r\n\r\nimport '../css/styles.css';\r\nimport InfoControl from './../../../components/InfoControl.js';\r\nimport moment from 'moment';\r\nimport 'moment-timezone';\r\n\r\nimport './../../../components/airspaces.js';\r\nimport '../../../components/deprecated/airspaces-gliding.js';\r\nimport '../../../components/deprecated/airspaces-notam.js';\r\nimport './../../../components/airspaces-xc.js';\r\nimport './../../../components/windstations.js';\r\nimport '../../../components/spots-pg.js';\r\nimport '../../../components/spots-hg.js';\r\nimport '../../../components/spots-lz.js';\r\nimport '../../../components/obstacles.js';\r\nimport '../../../components/rainviewer.js';\r\n\r\n\r\n// Initialize map and make necessary objects globally available\r\nfunction initMap() {\r\n  // Create the map object and make it globally accessible\r\n  window.map = L.map('map', {\r\n      center: [50, 6],\r\n      zoom: 9,\r\n      zoomControl: false,\r\n      layers: [],\r\n      timeDimension: true\r\n  });\r\n\r\n  L.control.zoom({\r\n      position: 'bottomright',\r\n  }).addTo(window.map);\r\n\r\n  // Base Layers\r\n  var awgTerrain = L.tileLayer('https://tile.jawg.io/jawg-terrain/{z}/{x}/{y}{r}.png?access-token=qBDXRu1KSlZGhx4ROlceBD9hcxmrumL34oj29tUkzDVkafqx08tFWPeRNb0KSoKa', {\r\n      attribution: 'Jawg.io terrain'\r\n  }).addTo(window.map);\r\n\r\n  var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n      attribution: ' OpenStreetMap'\r\n  });\r\n\r\n  var xcontest = L.tileLayer('https://topo.xcontest.app/elev/{z}/{x}/{y}.jpg', {\r\n      attribution: 'XContest&copy; <a href=\"https://www.xcontest.org\">XContest</a>',\r\n      className: 'xcontest-layer'\r\n  });\r\n\r\n  /* JS */\r\n    // Modified popupopen handler\r\n  window.map.on('popupopen', function(ev){\r\n    var el = document.getElementById('fullScreenInfo');\r\n    var screenWidthThreshold = 768; // Match CSS media query\r\n\r\n    if (window.innerWidth < screenWidthThreshold) {\r\n      // Skip fullscreen for obstacle popups (check for obstacle-popup class)\r\n      const popupEl = ev.popup.getElement();\r\n      if (popupEl && (\r\n          popupEl.classList.contains('obstacle-popup') ||\r\n          popupEl.classList.contains('airspace-popup')\r\n      )) {\r\n        return;\r\n      }\r\n      \r\n      // Force close any existing popup\r\n      window.map.closePopup();\r\n\r\n      try {\r\n        var content = ev.popup.getContent(); // Get initial content\r\n\r\n        // Always add default close button and footer initially, with IDs for removal\r\n        var closeButton = '<div id=\"default-fullscreen-close-btn\" style=\"position: absolute; top: 10px; right: 10px;\">' + // Added ID\r\n                          '<button onclick=\"closeFullscreenInfo()\" style=\"background: none; border: none; font-size: 20px; cursor: pointer;\"></button>' +\r\n                          '</div>';\r\n        var footer = '<div id=\"default-fullscreen-footer\" style=\"text-align: right; padding: 10px;\">' + // Added ID\r\n                     '<button class=\"btn btn-dark btn-sm\" onclick=\"closeFullscreenInfo()\">Close</button>' +\r\n                     '</div>';\r\n\r\n        // Wrap the main content in a div for easier targeting\r\n        el.innerHTML = closeButton + `<div id=\"fullscreen-content-area\">${content}</div>` + footer;\r\n\r\n        el.classList.add('visible');\r\n        el.style.display = 'block'; // Set display to block\r\n        el.style.zIndex = '10000'; // High z-index\r\n        document.getElementById('map').classList.add('map-covered');\r\n      } catch (error) {\r\n        console.error('Error in popupopen handler:', error);\r\n      }\r\n    }\r\n  });\r\n\r\n  // closeFullscreenInfo function (no changes needed here)\r\n  window.closeFullscreenInfo = function() {\r\n    var el = document.getElementById('fullScreenInfo');\r\n    el.classList.remove('visible');\r\n    el.innerHTML = ''; // Clear the content\r\n    document.getElementById('map').classList.remove('map-covered');\r\n    window.map.closePopup(); // Close the Leaflet popup\r\n  };\r\n\r\n  // MapLibre GL layer\r\n  var mapTilerTerrain = L.mapboxGL({\r\n      style: '/assets/maps/maptiler_terrain_wob_testxc.json',\r\n      apiKey: \"c49iG8J3xvAkgCSZ8M8v\",\r\n      className: 'xcmap-layer',\r\n      attribution: 'MapTiler Terrain'\r\n  });\r\n\r\n  var sat = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}',{\r\n      attribution: 'Map data: Google',\r\n      maxZoom: 20,\r\n      subdomains:['mt0','mt1','mt2','mt3']\r\n  });\r\n\r\n  var mbsat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',{\r\n    attribution: ' Esri',\r\n    id: 'MapID',\r\n  });\r\n\r\n  var mapTilerTerrainOverlay = L.mapboxGL({\r\n    style: '/assets/maps/maptiler_terrain_wob_testxc.json',\r\n    apiKey: \"c49iG8J3xvAkgCSZ8M8v\",\r\n    className: 'xcmap-layer satellite-overlay',\r\n    attribution: 'MapTiler Terrain'\r\n  });\r\n\r\n// Create a simplified contour overlay specifically for use with satellite\r\nvar contourOverlay = L.tileLayer('https://api.maptiler.com/tiles/contours/{z}/{x}/{y}.pbf?key=c49iG8J3xvAkgCSZ8M8v', {\r\n  attribution: 'MapTiler',\r\n  opacity: 0.8,\r\n  className: 'contour-overlay',\r\n  style: {\r\n      color: '#ffffff',\r\n      weight: 1,\r\n      opacity: 0.8\r\n  }\r\n});\r\n  // Layer groups - make them globally accessible\r\n  window.windLayer = L.layerGroup().addTo(window.map);\r\n  window.oaipMap = L.tileLayer(`https://a.api.tiles.openaip.net/api/data/openaip/{z}/{x}/{y}.png?apiKey=${process.env.OAIP_KEY}`, {\r\n      attribution: 'OpenAIP&copy; <a href=\"https://www.openaip.net\">OpenAIP</a>',\r\n      className: 'oaip-layer'\r\n  });\r\n  \r\n  // Initialize RainViewer layers with error handling\r\n  try {\r\n    // Use different endpoints for radar and satellite to prevent conflicts\r\n    window.rainviewerRadarLayer = L.timeDimension.layer.rainviewer(\"https://api.rainviewer.com/public/weather-maps.json\", {\r\n      opacity: 0.7,\r\n      cache: 5 // Limit cache size to improve performance\r\n    }).addTo(window.map); // Add radar layer to map by default\r\n    \r\n    window.rainviewerSatelliteLayer = L.timeDimension.layer.rainviewer(\"https://api.rainviewer.com/public/weather-maps.json\", {\r\n      type: 'satellite',\r\n      opacity: 0.7,\r\n      cache: 5 // Limit cache size to improve performance\r\n    });\r\n    \r\n    console.log('RainViewer layers initialized successfully');\r\n    \r\n    // Ensure TimeDimension control is added to the map\r\n    setTimeout(() => {\r\n      updateTimeDimensionControlVisibility();\r\n    }, 500); // Short delay to ensure the layer is fully added\r\n  } catch (error) {\r\n    console.error('Error initializing RainViewer layers:', error);\r\n    // Create empty layers as fallbacks\r\n    window.rainviewerRadarLayer = L.layerGroup();\r\n    window.rainviewerSatelliteLayer = L.layerGroup();\r\n  }\r\n  \r\n  // Create TimeDimension control with error handling\r\n  try {\r\n    window.timeDimensionControl = L.control.timeDimension({\r\n      position: 'bottomleft',\r\n      playerOptions: {\r\n        transitionTime: 1000,\r\n        loop: true,\r\n        buffer: 2 // Reduce buffer size to improve performance\r\n      },\r\n      timeZones: ['Local'],\r\n      autoPlay: true,\r\n      speedSlider: false // Disable speed slider to simplify UI\r\n    });\r\n    console.log('TimeDimension control initialized successfully');\r\n  } catch (error) {\r\n    console.error('Error initializing TimeDimension control:', error);\r\n    // Create a dummy control as fallback\r\n    window.timeDimensionControl = {\r\n      addTo: function() { console.log('Using dummy TimeDimension control'); }\r\n    };\r\n  }\r\n  \r\n  // Track if the TimeDimension control is added to the map\r\n  window.isTimeDimensionControlAdded = false;\r\n  window.airspaceEFG = L.layerGroup([], {\r\n    attribution: 'OpenAIP&copy; <a href=\"https://www.openaip.net\">OpenAIP</a>',\r\n  });\r\n  window.airspaceGliding = L.layerGroup([], {\r\n    attribution: 'OpenAIP&copy; <a href=\"https://www.openaip.net\">OpenAIP</a>',\r\n  });\r\n  window.airspaceNotam = L.layerGroup([], {\r\n    attribution: 'OpenAIP&copy; <a href=\"https://www.openaip.net\">OpenAIP</a>',\r\n  });\r\n  window.airspaceXC = L.layerGroup([], {\r\n    attribution: 'XContest&copy; <a href=\"https://xcontest.org\">XContest</a>',\r\n  });\r\n\r\n  window.placesLayerPG = L.layerGroup( [], {\r\n    attribution: '&copy; <a href=\"https://paraglidingspots.com\">paraglidingspots.com</a>',\r\n  });\r\n  window.placesLayerHG = L.layerGroup([], {\r\n    attribution: '&copy; <a href=\"https://paraglidingspots.com\">paraglidingspots.com</a>',\r\n  });\r\n  window.placesLayerLZ = L.layerGroup([], {\r\n    attribution: '&copy; <a href=\"https://paraglidingspots.com\">paraglidingspots.com</a>',\r\n  });\r\n\r\n  function debugMapLayers() {\r\n    console.log(\"Current map layers:\");\r\n    window.map.eachLayer(function(layer) {\r\n        console.log(layer);\r\n    });\r\n  }\r\n\r\n  // Generate dynamic airspace time options\r\n  const airspaceTimeOptions = (() => {\r\n    let options = '';\r\n    for (let i = 0; i <= 6; i++) {\r\n      const date = moment().add(i, 'days');\r\n      const dayName = date.format('ddd');\r\n      const dateValue = date.format('YYYY-MM-DD');\r\n      options += `<option value=\"${dateValue}\" ${i === 0 ? 'selected' : ''}>${\r\n        i === 0 ? `Today` : dayName\r\n      }</option>`;\r\n    }\r\n    return options;  // Removed the '+ '<option value=\"All\">All</option>''\r\n  })();\r\n\r\n\r\n  // Tree structure\r\n  var baseTree = {\r\n    label: 'Base Maps',\r\n    children: [\r\n        { label: 'Terrain', layer: awgTerrain },\r\n        { label: 'XContest', layer: L.layerGroup([xcontest, mapTilerTerrain])},\r\n        { label: 'OpenStreetMap', layer: osm },\r\n        { label: 'Satellite',  layer: sat },\r\n    ]\r\n};\r\n\r\n  var overlayTree = {\r\n      label: 'Overlays',\r\n      children: [\r\n          { label: 'Weather Stations',\r\n            children: [\r\n              { label: 'Weather Stations', layer: window.windLayer, checked: true  },\r\n          ]\r\n          },\r\n          \r\n          { label: 'RainViewer',\r\n            children: [\r\n              { label: 'Radar', layer: window.rainviewerRadarLayer, checked: true  },\r\n              { label: 'Satellite', layer: window.rainviewerSatelliteLayer },\r\n            ]\r\n          },\r\n\r\n          { label: 'Spots',\r\n              children: [\r\n                  { label: 'Take-off PG', layer: window.placesLayerPG },\r\n                  { label: 'Take-off HG', layer: window.placesLayerHG },\r\n                  { label: 'Landing Zones', layer: window.placesLayerLZ },\r\n              ]\r\n          },\r\n          { label: 'Airspaces',\r\n              children: [\r\n                      {\r\n                        html: `\r\n                            <div class=\"airspace-time-control\">\r\n                                Active:\r\n                                <select class=\"airspace-time-select\" id=\"airspaceTime\">\r\n                                    ${airspaceTimeOptions}\r\n                                </select>\r\n                                          </div>\r\n                                      `\r\n                      },\r\n                      {\r\n                      html: `\r\n                          <div class=\"airspace-limit-control\">\r\n                               below:\r\n                              <select class=\"lower-limit-select\" id=\"airspaceLowerLimit\">\r\n                                  <option value=\"2000\">2000m</option>\r\n                                  <option value=\"2500\">2500m</option>\r\n                                  <option value=\"3000\" selected>3000m</option>\r\n                                  <option value=\"3500\">3500m</option>\r\n                                  <option value=\"4000\">4000m</option>\r\n                                  <option value=\"4500\">4500m</option>\r\n                              </select>\r\n                          </div>\r\n                      `\r\n                      },\r\n                  // { label: 'Airspaces', layer: window.airspaceEFG },\r\n                  { label: 'Airspaces', layer: window.airspaceXC },\r\n                  { label: 'Obstacles', layer: window.obstacleLayer },\r\n                  { label: 'OpenAIP Map', layer: window.oaipMap},\r\n              ]\r\n          },\r\n      ]\r\n  };\r\n\r\n\r\n  new InfoControl({ position: 'bottomright' }).addTo(window.map);\r\n\r\n  // Add logo control to the top left corner\r\n  L.Control.Logo = L.Control.extend({\r\n    onAdd: function(map) {\r\n      const container = L.DomUtil.create('div', 'leaflet-control-logo');\r\n      const img = L.DomUtil.create('img', 'logo-image', container);\r\n      img.src = '/assets/images/XCmapsLogo.png';\r\n      img.alt = 'XCmaps Logo';\r\n      img.style.width = '120px'; // Adjust size as needed\r\n      img.style.height = 'auto';\r\n\r\n      // Prevent clicks on the logo from propagating to the map\r\n      L.DomEvent.disableClickPropagation(container);\r\n\r\n      return container;\r\n    }\r\n  });\r\n\r\n  L.control.logo = function(opts) {\r\n    return new L.Control.Logo(opts);\r\n  };\r\n\r\n  // Add the logo control to the map\r\n  L.control.logo({ position: 'topleft' }).addTo(window.map);\r\n\r\n  // Add locate control\r\n  var lc = L.control\r\n      .locate({\r\n          drawCircle: false,\r\n          keepCurrentZoomLevel: true,\r\n          position: 'bottomright',\r\n          icon: 'locate',\r\n          iconLoading: 'loading',\r\n          iconElementTag: 'div'\r\n      }).addTo(window.map);\r\n\r\n  // Add layer control tree\r\n\r\n  var treeLayersControl = L.control.layers.tree(baseTree, overlayTree, {\r\n    namedToggle: false,\r\n    collapsed: true\r\n  }).addTo(window.map);\r\n\r\n  // Initialize with collapsed tree but expanded selected layers\r\n  treeLayersControl.collapseTree().expandSelected();\r\n\r\n  // Add touch support for mobile devices\r\n  const layersControlContainer = treeLayersControl.getContainer();\r\n  const layersControlToggle = layersControlContainer.querySelector('.leaflet-control-layers-toggle');\r\n\r\n  // Function to detect if device is touch-only (no hover capability)\r\n  const isTouchDevice = () => {\r\n    return (('ontouchstart' in window) ||\r\n            (navigator.maxTouchPoints > 0) ||\r\n            (navigator.msMaxTouchPoints > 0));\r\n  };\r\n\r\n  // Add click handler for touch devices\r\n  if (isTouchDevice()) {\r\n    L.DomEvent.on(layersControlToggle, 'click', function(e) {\r\n      L.DomEvent.stopPropagation(e);\r\n      if (L.DomUtil.hasClass(layersControlContainer, 'leaflet-control-layers-expanded')) {\r\n        L.DomUtil.removeClass(layersControlContainer, 'leaflet-control-layers-expanded');\r\n      } else {\r\n        L.DomUtil.addClass(layersControlContainer, 'leaflet-control-layers-expanded');\r\n      }\r\n    });\r\n\r\n    // Close the control when clicking outside of it\r\n    L.DomEvent.on(document, 'click', function() {\r\n      if (L.DomUtil.hasClass(layersControlContainer, 'leaflet-control-layers-expanded')) {\r\n        L.DomUtil.removeClass(layersControlContainer, 'leaflet-control-layers-expanded');\r\n      }\r\n    });\r\n\r\n    // Prevent clicks inside the control from closing it\r\n    L.DomEvent.on(layersControlContainer, 'click', function(e) {\r\n      L.DomEvent.stopPropagation(e);\r\n    });\r\n  }\r\n\r\n\r\n\r\n  // Central event handler for map movements\r\n  // This will be the ONLY moveend handler for fetching data\r\n  window.map.on('moveend', function() {\r\n    console.log('Map moveend event triggered');\r\n\r\n    // Check if windLayer is on the map and fetchWindStations exists\r\n    if (window.map.hasLayer(window.windLayer) && typeof window.fetchWindStations === 'function') {\r\n      console.log('Fetching wind stations after map move...');\r\n      window.fetchWindStations();\r\n    }\r\n\r\n    // Only trigger fetch for visible spot layers\r\n    if (window.map.hasLayer(window.placesLayerPG) && window.fetchPlacesPG) {\r\n      console.log('Fetching PG spots after map move...');\r\n      window.fetchPlacesPG();\r\n    }\r\n\r\n    if (window.map.hasLayer(window.placesLayerHG) && window.fetchPlacesHG) {\r\n      console.log('Fetching HG spots after map move...');\r\n      window.fetchPlacesHG();\r\n    }\r\n\r\n    if (window.map.hasLayer(window.placesLayerLZ) && window.fetchPlacesLZ) {\r\n      console.log('Fetching LZ spots after map move...');\r\n      window.fetchPlacesLZ();\r\n    }\r\n\r\n    // Airspaces\r\n    if (window.map.hasLayer(window.airspaceEFG) && typeof window.fetchAirspaces === 'function') {\r\n      console.log('Fetching airspaces after map move...');\r\n      window.fetchAirspaces();\r\n    }\r\n    // Airspaces Gliding\r\n    if (window.map.hasLayer(window.airspaceGliding) && typeof window.fetchAirspacesGliding === 'function') {\r\n      console.log('Fetching airspaces after map move...');\r\n      window.fetchAirspacesGliding();\r\n    }\r\n    // Airspaces Notam\r\n    if (window.map.hasLayer(window.airspaceNotam) && typeof window.fetchAirspacesNotam === 'function') {\r\n      console.log('Fetching airspaces after map move...');\r\n      window.fetchAirspacesNotam();\r\n    }\r\n    // Airspaces XContest\r\n    if (window.map.hasLayer(window.airspaceXC) && typeof window.fetchAirspacesXC === 'function') {\r\n      console.log('Fetching airspaces after map move...');\r\n      window.fetchAirspacesXC();\r\n    }\r\n    // Obstacles XContest\r\n    if (window.map.hasLayer(window.obstacleLayer) && typeof window.fetchObstacles === 'function') {\r\n      console.log('Fetching airspaces after map move...');\r\n      window.fetchObstacles();\r\n    }\r\n  });\r\n\r\n  document.addEventListener('change', function(e) {\r\n    if (e.target && e.target.id === 'airspaceLowerLimit') {\r\n        console.log('Selected limit:', e.target.value);\r\n    }\r\n    // Add this new handler for the time selector\r\n    if (e.target && e.target.id === 'airspaceTime') {\r\n        console.log('Selected airspace date:', e.target.value);\r\n    }\r\n  });\r\n\r\n  // Add layer change event listeners to fetch data when layers are added\r\n  window.map.on('layeradd', function(e) {\r\n    const layer = e.layer;\r\n\r\n    // When a layer is added, fetch its data if needed\r\n    if (layer === window.windLayer && typeof window.fetchWindStations === 'function') {\r\n      window.fetchWindStations();\r\n    } else if (layer === window.placesLayerPG && window.fetchPlacesPG) {\r\n      window.fetchPlacesPG();\r\n    } else if (layer === window.placesLayerHG && window.fetchPlacesHG) {\r\n      window.fetchPlacesHG();\r\n    } else if (layer === window.placesLayerLZ && window.fetchPlacesLZ) {\r\n      window.fetchPlacesLZ();\r\n    } else if (layer === window.airspaceEFG && typeof window.fetchAirspaces === 'function') {\r\n      window.fetchAirspaces();\r\n    } else if (layer === window.airspaceGliding && typeof window.fetchAirspacesGliding === 'function') {\r\n      window.fetchAirspacesGliding();\r\n    } else if (layer === window.airspaceNotam && typeof window.fetchAirspacesNotam === 'function') {\r\n      window.fetchAirspacesNotam();\r\n    } else if (layer === window.airspaceXC && typeof window.fetchAirspacesXC === 'function') {\r\n      window.fetchAirspacesXC();\r\n    } else if (layer === window.obstacleLayer && typeof window.fetchObstacles === 'function') {\r\n      window.fetchObstacles();\r\n    } else if (layer === window.rainviewerRadarLayer) {\r\n      console.log('RainViewer Radar layer added via layeradd');\r\n      updateTimeDimensionControlVisibility();\r\n    } else if (layer === window.rainviewerSatelliteLayer) {\r\n      console.log('RainViewer Satellite layer added via layeradd');\r\n      updateTimeDimensionControlVisibility();\r\n    }\r\n  });\r\n  \r\n  // Function to check if any RainViewer layer is active\r\n  function isAnyRainViewerLayerActive() {\r\n    const hasRadar = window.map.hasLayer(window.rainviewerRadarLayer);\r\n    const hasSatellite = window.map.hasLayer(window.rainviewerSatelliteLayer);\r\n    console.log('RainViewer layer check - Radar:', hasRadar, 'Satellite:', hasSatellite);\r\n    return hasRadar || hasSatellite;\r\n  }\r\n  \r\n  // Function to update TimeDimension control visibility\r\n  function updateTimeDimensionControlVisibility() {\r\n    console.log('Updating TimeDimension control visibility');\r\n    \r\n    // Prevent multiple simultaneous calls\r\n    if (window.isUpdatingTimeDimensionControl) {\r\n      console.log('Already updating TimeDimension control, skipping');\r\n      return;\r\n    }\r\n    \r\n    window.isUpdatingTimeDimensionControl = true;\r\n    \r\n    try {\r\n      const shouldBeVisible = isAnyRainViewerLayerActive();\r\n      console.log('Should TimeDimension control be visible?', shouldBeVisible);\r\n      console.log('Is TimeDimension control currently added?', window.isTimeDimensionControlAdded);\r\n      \r\n      if (shouldBeVisible) {\r\n        if (!window.isTimeDimensionControlAdded) {\r\n          try {\r\n            console.log('Adding TimeDimension control to map');\r\n            \r\n            // Set a timeout to prevent hanging\r\n            const timeoutPromise = new Promise((_, reject) => {\r\n              setTimeout(() => reject(new Error('Adding TimeDimension control timed out')), 5000);\r\n            });\r\n            \r\n            const addControlPromise = new Promise((resolve) => {\r\n              window.timeDimensionControl.addTo(window.map);\r\n              resolve();\r\n            });\r\n            \r\n            // Use Promise.race to implement the timeout\r\n            Promise.race([addControlPromise, timeoutPromise])\r\n              .then(() => {\r\n                window.isTimeDimensionControlAdded = true;\r\n                console.log('TimeDimension control added to map successfully');\r\n              })\r\n              .catch(error => {\r\n                console.error('Error adding TimeDimension control:', error);\r\n              })\r\n              .finally(() => {\r\n                window.isUpdatingTimeDimensionControl = false;\r\n              });\r\n            \r\n            return; // Exit early since we're handling the completion in the promise\r\n          } catch (error) {\r\n            console.error('Error adding TimeDimension control:', error);\r\n          }\r\n        } else {\r\n          console.log('TimeDimension control already added, no action needed');\r\n        }\r\n      } else {\r\n        if (window.isTimeDimensionControlAdded) {\r\n          try {\r\n            console.log('Removing TimeDimension control from map');\r\n            window.map.removeControl(window.timeDimensionControl);\r\n            window.isTimeDimensionControlAdded = false;\r\n            console.log('TimeDimension control removed from map successfully');\r\n          } catch (error) {\r\n            console.error('Error removing TimeDimension control:', error);\r\n          }\r\n        } else {\r\n          console.log('TimeDimension control already removed, no action needed');\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error in updateTimeDimensionControlVisibility:', error);\r\n    }\r\n    \r\n    window.isUpdatingTimeDimensionControl = false;\r\n  }\r\n  \r\n  // Handle RainViewer layer visibility with error handling and debouncing\r\n  let rainviewerUpdateTimeout = null;\r\n  \r\n  // Function to format time display in 24-hour format (HH:MM)\r\n  function updateTimeDisplay() {\r\n    try {\r\n      const timeControls = document.querySelectorAll('.leaflet-control-timecontrol.timecontrol-date');\r\n      timeControls.forEach(control => {\r\n        // Get the original text content\r\n        const originalText = control.textContent || control.innerText;\r\n        \r\n        // Extract the time part including AM/PM using regex\r\n        const timeMatch = originalText.match(/(\\d{1,2}):(\\d{2}):\\d{2}\\s*(AM|PM)?/i);\r\n        if (timeMatch) {\r\n          let hours = parseInt(timeMatch[1]);\r\n          const minutes = timeMatch[2];\r\n          const period = timeMatch[3] ? timeMatch[3].toUpperCase() : null;\r\n          \r\n          // Convert to 24-hour format if period is specified\r\n          if (period === 'PM' && hours < 12) {\r\n            hours += 12;\r\n          } else if (period === 'AM' && hours === 12) {\r\n            hours = 0;\r\n          }\r\n          \r\n          // Format as HH:MM with leading zero\r\n          const formattedTime = `${hours.toString().padStart(2, '0')}:${minutes}`;\r\n          \r\n          // Update the text content\r\n          control.textContent = formattedTime;\r\n          console.log('Updated time display to:', formattedTime);\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.error('Error updating time display:', error);\r\n    }\r\n  }\r\n  \r\n  // Set up a MutationObserver to watch for changes to the time control\r\n  function setupTimeControlObserver() {\r\n    try {\r\n      const observer = new MutationObserver(function(mutations) {\r\n        updateTimeDisplay();\r\n      });\r\n      \r\n      // Start observing the document with the configured parameters\r\n      observer.observe(document.body, {\r\n        childList: true,\r\n        subtree: true\r\n      });\r\n      \r\n      // Also update on initial load and periodically\r\n      updateTimeDisplay();\r\n      setInterval(updateTimeDisplay, 1000);\r\n    } catch (error) {\r\n      console.error('Error setting up time control observer:', error);\r\n    }\r\n  }\r\n  \r\n  // Call the setup function when the map is initialized\r\n  document.addEventListener('map_initialized', setupTimeControlObserver);\r\n\r\n  // Set up periodic refresh for RainViewer layers\r\n  function setupRainViewerRefresh() {\r\n    // Only set up the interval if not already set up\r\n    if (!window.rainviewerRefreshInterval) {\r\n      window.rainviewerRefreshInterval = setInterval(() => {\r\n        try {\r\n          // Check if either RainViewer layer is active\r\n          const hasRadar = window.map.hasLayer(window.rainviewerRadarLayer);\r\n          const hasSatellite = window.map.hasLayer(window.rainviewerSatelliteLayer);\r\n          \r\n          if (hasRadar || hasSatellite) {\r\n            console.log('Refreshing RainViewer data...');\r\n            \r\n            // Refresh radar layer if active\r\n            if (hasRadar) {\r\n              fetchRainviewerMetadata(\"https://api.rainviewer.com/public/weather-maps.json\")\r\n                .then(metadata => {\r\n                  window.rainviewerRadarLayer._metadata = metadata;\r\n                  window.rainviewerRadarLayer._loaded = true;\r\n                  if (window.map.hasLayer(window.rainviewerRadarLayer)) {\r\n                    window.rainviewerRadarLayer._setAvailableTimes();\r\n                  }\r\n                })\r\n                .catch(error => console.error('Error refreshing radar data:', error));\r\n            }\r\n            \r\n            // Refresh satellite layer if active\r\n            if (hasSatellite) {\r\n              fetchRainviewerMetadata(\"https://api.rainviewer.com/public/weather-maps.json\")\r\n                .then(metadata => {\r\n                  window.rainviewerSatelliteLayer._metadata = metadata;\r\n                  window.rainviewerSatelliteLayer._loaded = true;\r\n                  if (window.map.hasLayer(window.rainviewerSatelliteLayer)) {\r\n                    window.rainviewerSatelliteLayer._setAvailableTimes();\r\n                  }\r\n                })\r\n                .catch(error => console.error('Error refreshing satellite data:', error));\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('Error in RainViewer refresh:', error);\r\n        }\r\n      }, 60000); // 1 minute interval\r\n    }\r\n  }\r\n\r\n  // Start the refresh when map is initialized\r\n  document.addEventListener('map_initialized', setupRainViewerRefresh);\r\n  \r\n  function debouncedUpdateTimeDimensionControl() {\r\n    // Clear any existing timeout\r\n    if (rainviewerUpdateTimeout) {\r\n      clearTimeout(rainviewerUpdateTimeout);\r\n    }\r\n    \r\n    // Set a new timeout to update the control after a short delay\r\n    rainviewerUpdateTimeout = setTimeout(() => {\r\n      try {\r\n        updateTimeDimensionControlVisibility();\r\n        // Update time display after visibility is updated\r\n        setTimeout(updateTimeDisplay, 500);\r\n      } catch (error) {\r\n        console.error('Error in debouncedUpdateTimeDimensionControl:', error);\r\n      }\r\n    }, 100); // 100ms debounce time\r\n  }\r\n  \r\n  window.map.on('overlayadd', function(e) {\r\n    try {\r\n      console.log('overlayadd event triggered for layer:', e.name);\r\n      if (e.layer === window.rainviewerRadarLayer) {\r\n        console.log('RainViewer Radar layer added');\r\n        debouncedUpdateTimeDimensionControl();\r\n      } else if (e.layer === window.rainviewerSatelliteLayer) {\r\n        console.log('RainViewer Satellite layer added');\r\n        debouncedUpdateTimeDimensionControl();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error in overlayadd event handler:', error);\r\n    }\r\n  });\r\n  \r\n  window.map.on('overlayremove', function(e) {\r\n    try {\r\n      console.log('overlayremove event triggered for layer:', e.name);\r\n      if (e.layer === window.rainviewerRadarLayer) {\r\n        console.log('RainViewer Radar layer removed');\r\n        debouncedUpdateTimeDimensionControl();\r\n      } else if (e.layer === window.rainviewerSatelliteLayer) {\r\n        console.log('RainViewer Satellite layer removed');\r\n        debouncedUpdateTimeDimensionControl();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error in overlayremove event handler:', error);\r\n    }\r\n  });\r\n\r\n  // Signal that the map is fully initialized\r\n  window.mapInitialized = true;\r\n  console.log(\"Map initialization complete\");\r\n\r\n  // Trigger an event that component scripts can listen for\r\n  const mapReadyEvent = new Event('map_initialized');\r\n  document.dispatchEvent(mapReadyEvent);\r\n  console.log(\"Map initialized event dispatched\");\r\n\r\n  return window.map;\r\n}\r\n\r\n// Wait for DOM to be fully loaded\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\nconsole.log(\"DOM content loaded, initializing map\");\r\n// Initialize the map\r\nconst map = initMap();\r\n\r\n// Setup geolocation after map is initialized\r\nnavigator.geolocation.getCurrentPosition(position => {\r\n    console.log(\"Geolocation received\");\r\n    const userLat = position.coords.latitude;\r\n    const userLng = position.coords.longitude;\r\n    map.setView([userLat, userLng], 10);\r\n\r\n    // Create a user location ready event\r\n    const locationReadyEvent = new CustomEvent('user_location_ready', {\r\n        detail: { lat: userLat, lng: userLng }\r\n    });\r\n    document.dispatchEvent(locationReadyEvent);\r\n    console.log(\"User location event dispatched\");\r\n});\r\n\r\n// Load component scripts after map is initialized\r\n\r\n});\r\n\r\n// Special patch for initial data loading\r\ndocument.addEventListener('user_location_ready', function(e) {\r\nconsole.log(\"Handling user location ready event\");\r\nsetTimeout(() => {\r\n    // Only call these functions if they exist, the map is fully initialized,\r\n    // AND their respective layers are visible\r\n    if (typeof window.fetchWindStations === 'function' &&\r\n        window.mapInitialized &&\r\n        window.map.hasLayer(window.windLayer)) {\r\n        try {\r\n            console.log(\"Fetching wind stations\");\r\n            window.fetchWindStations(e.detail.lat, e.detail.lng);\r\n        } catch (error) {\r\n            console.error('Error fetching wind stations:', error);\r\n        }\r\n    }\r\n\r\n    if (typeof window.fetchAirspaces === 'function' &&\r\n        window.mapInitialized &&\r\n        window.map.hasLayer(window.airspaceEFG)) {\r\n        try {\r\n            console.log(\"Fetching airspaces\");\r\n            window.fetchAirspaces();\r\n        } catch (error) {\r\n            console.error('Error fetching airspaces:', error);\r\n        }\r\n    }\r\n\r\n    if (typeof window.fetchAirspacesGliding === 'function' &&\r\n      window.mapInitialized &&\r\n      window.map.hasLayer(window.airspaceGliding)) {\r\n      try {\r\n          console.log(\"Fetching airspaces\");\r\n          window.fetchAirspacesGliding();\r\n      } catch (error) {\r\n          console.error('Error fetching airspaces:', error);\r\n      }\r\n    }\r\n\r\n    if (typeof window.fetchAirspacesNotam === 'function' &&\r\n      window.mapInitialized &&\r\n      window.map.hasLayer(window.airspaceNotam)) {\r\n      try {\r\n          console.log(\"Fetching airspaces\");\r\n          window.fetchAirspacesNotam();\r\n      } catch (error) {\r\n          console.error('Error fetching airspaces:', error);\r\n      }\r\n    }\r\n\r\n    if (typeof window.fetchAirspacesXC === 'function' &&\r\n      window.mapInitialized &&\r\n      window.map.hasLayer(window.airspaceXC)) {\r\n      try {\r\n          console.log(\"Fetching airspaces\");\r\n          window.fetchAirspacesXC();\r\n      } catch (error) {\r\n          console.error('Error fetching airspaces:', error);\r\n      }\r\n    }\r\n\r\n    if (typeof window.fetchObstacles === 'function' &&\r\n      window.mapInitialized &&\r\n      window.map.hasLayer(window.obstacleLayer)) {\r\n      try {\r\n          console.log(\"Fetching obstacles\");\r\n          window.fetchObstacles();\r\n      } catch (error) {\r\n          console.error('Error fetching obstacles:', error);\r\n      }\r\n    }\r\n}, 500); // Give a short delay to ensure all scripts are loaded\r\n});","\r\n\r\nL.TimeDimension.Layer.Rainviewer = L.TimeDimension.Layer.extend({\r\n\r\n    initialize: function(endpoint, options={}) {\r\n      \r\n      options['attribution'] = options['attribution'] || \"<a href='https://www.rainviewer.com/api.html' rel='noopener noreferrer' target='_blank'>RainViewer</a>\";\r\n  \r\n      L.TimeDimension.Layer.prototype.initialize.call(this, L.tileLayer(''), options);\r\n          this._metadata = {};\r\n          this._frames = {};\r\n          this._layers = {};\r\n          this._defaultTime = 12;\r\n          this._availableTimes = [];\r\n          this._timeCacheBackward = this.options.cacheBackward || this.options.cache || 0;\r\n          this._timeCacheForward = this.options.cacheForward || this.options.cache || 0;\r\n          this._updateTimeDimension = this.options.updateTimeDimension  || true ;\r\n          this._updateTimeDimensionMode = this.options.updateTimeDimensionMode || 'union'; // 'union', 'replace' or extremes\r\n          this._type = this.options.type || 'radar';\r\n          this._loaded = false;\r\n  \r\n          fetchRainviewerMetadata(endpoint).then((metadata) => {\r\n            this._metadata = metadata;\r\n            this._loaded = true;\r\n            if(this._map && this._map.hasLayer(this)){\r\n              this._setAvailableTimes();\r\n            }\r\n          });\r\n  \r\n          this._baseLayer.on('load', (function() {\r\n              this._baseLayer.setLoaded(true);\r\n              this.fire('timeload', {\r\n                  time: this._defaultTime\r\n              });\r\n          }).bind(this));\r\n      },\r\n      onAdd: function(map) {\r\n          L.TimeDimension.Layer.prototype.onAdd.call(this, map);\r\n          if (this._loaded) {\r\n              this._setAvailableTimes();\r\n          }\r\n      },\r\n      _setAvailableTimes() {\r\n        if(this._type == 'radar'){\r\n          let times = [...this._metadata['radar'].nowcast, ...this._metadata['radar'].past];\r\n          times.forEach(frame => this._frames[frame.time * 1000] = frame);\r\n        }else if(this._type == 'satellite'){\r\n          let times = this._metadata['satellite'].infrared;\r\n          times.forEach(frame => this._frames[frame.time * 1000] = frame);\r\n        }\r\n  \r\n        this._availableTimes = L.TimeDimension.Util.sort_and_deduplicate(Object.keys(this._frames).map(time => Number(time)));\r\n        this._updateCurrentTime = this._updateCurrentTime || (this._timeDimension && this._timeDimension.getAvailableTimes().length == 0);\r\n        if (this._timeDimension && (this._updateTimeDimension || this._timeDimension.getAvailableTimes().length == 0)) {\r\n            this._timeDimension.setAvailableTimes(this._availableTimes, this._updateTimeDimensionMode);\r\n        }\r\n        if (this._updateCurrentTime && this._timeDimension && this._availableTimes.length) {\r\n            this._timeDimension.setCurrentTime(this._availableTimes[this._defaultTime]);\r\n        }\r\n      },\r\n      eachLayer: function(method, context) {\r\n          for (var prop in this._layers) {\r\n              if (this._layers.hasOwnProperty(prop)) {\r\n                  method.call(context, this._layers[prop]);\r\n              }\r\n          }\r\n          return L.TimeDimension.Layer.prototype.eachLayer.call(this, method, context);\r\n      },\r\n  \r\n      _onNewTimeLoading: function(ev) {\r\n          var layer = this._getLayerForTime(ev.time);\r\n          if (!this._map.hasLayer(layer)) {\r\n              this._map.addLayer(layer);\r\n          }\r\n      },\r\n  \r\n      isReady: function(time) {\r\n          var layer = this._getLayerForTime(time);\r\n          var currentZoom = this._map.getZoom();\r\n          if (layer.options.minZoom && currentZoom < layer.options.minZoom){\r\n              return true;\r\n          }\r\n          if (layer.options.maxZoom && currentZoom > layer.options.maxZoom){\r\n              return true;\r\n          }\r\n          return layer.isLoaded();\r\n      },\r\n  \r\n      _update: function() {\r\n          if (!this._map)\r\n              return;\r\n          var time = this._timeDimension.getCurrentTime();\r\n          // It will get the layer for this time (create or get)\r\n          // Then, the layer will be loaded if necessary, adding it to the map (and show it after loading).\r\n          // If it already on the map (but probably hidden), it will be shown\r\n          var layer = this._getLayerForTime(time);\r\n          if (this._currentLayer == null) {\r\n              this._currentLayer = layer;\r\n          }\r\n          if (!this._map.hasLayer(layer)) {\r\n              this._map.addLayer(layer);\r\n          } else {\r\n              this._showLayer(layer, time);\r\n          }\r\n      },\r\n  \r\n      setOpacity: function(opacity) {\r\n          L.TimeDimension.Layer.prototype.setOpacity.apply(this, arguments);\r\n          // apply to all preloaded caches\r\n          for (var prop in this._layers) {\r\n              if (this._layers.hasOwnProperty(prop) && this._layers[prop].setOpacity) {\r\n                  this._layers[prop].setOpacity(opacity);\r\n              }\r\n          }\r\n      },\r\n      \r\n      setZIndex: function(zIndex){\r\n          L.TimeDimension.Layer.prototype.setZIndex.apply(this, arguments);\r\n          // apply to all preloaded caches\r\n          for (var prop in this._layers) {\r\n              if (this._layers.hasOwnProperty(prop) && this._layers[prop].setZIndex) {\r\n                  this._layers[prop].setZIndex(zIndex);\r\n              }\r\n          }\r\n      },\r\n  \r\n      _unvalidateCache: function() {\r\n          var time = this._timeDimension.getCurrentTime();\r\n          for (var prop in this._layers) {\r\n              if (time != prop && this._layers.hasOwnProperty(prop)) {\r\n                  this._layers[prop].setLoaded(false); // mark it as unloaded\r\n                  this._layers[prop].redraw();\r\n              }\r\n          }\r\n      },\r\n  \r\n      _evictCachedTimes: function(keepforward, keepbackward) {\r\n          // Cache management\r\n          var times = this._getLoadedTimes();\r\n          var strTime = String(this._currentTime);\r\n          var index = times.indexOf(strTime);\r\n          var remove = [];\r\n          // remove times before current time\r\n          if (keepbackward > -1) {\r\n              var objectsToRemove = index - keepbackward;\r\n              if (objectsToRemove > 0) {\r\n                  remove = times.splice(0, objectsToRemove);\r\n                  this._removeLayers(remove);\r\n              }\r\n          }\r\n          if (keepforward > -1) {\r\n              index = times.indexOf(strTime);\r\n              var objectsToRemove = times.length - index - keepforward - 1;\r\n              if (objectsToRemove > 0) {\r\n                  remove = times.splice(index + keepforward + 1, objectsToRemove);\r\n                  this._removeLayers(remove);\r\n              }\r\n          }\r\n      },\r\n  \r\n      _showLayer: function(layer, time) {\r\n          if (this._currentLayer && this._currentLayer !== layer) {\r\n              this._currentLayer.hide();\r\n          }\r\n          layer.show();\r\n          if (this._currentLayer && this._currentLayer === layer) {\r\n              return;\r\n          }\r\n          this._currentLayer = layer;\r\n          this._currentTime = time;\r\n          console.log('Show layer with time: ' + new Date(time).toISOString());\r\n  \r\n          this._evictCachedTimes(this._timeCacheForward, this._timeCacheBackward);\r\n      },\r\n  \r\n      _getLayerForTime: function(time) {\r\n          if (time == 0 || time == this._defaultTime || time == null || !this._loaded) {\r\n              return this._baseLayer;\r\n          }\r\n          if (this._layers.hasOwnProperty(time)) {\r\n              return this._layers[time];\r\n          }\r\n          var nearestTime = this._getNearestTime(time);\r\n          if (this._layers.hasOwnProperty(nearestTime)) {\r\n              return this._layers[nearestTime];\r\n          }\r\n          if (!this._frames.hasOwnProperty(nearestTime)){\r\n              return this._baseLayer;\r\n          }\r\n  \r\n          var newLayer = this._createLayerForTime(nearestTime);\r\n         \r\n          this._layers[time] = newLayer;\r\n  \r\n          newLayer.on('load', (function(layer, time) {\r\n              layer.setLoaded(true);\r\n              // this time entry should exists inside _layers\r\n              // but it might be deleted by cache management\r\n              if (!this._layers[time]) {\r\n                  this._layers[time] = layer;\r\n              }\r\n              if (this._timeDimension && time == this._timeDimension.getCurrentTime() && !this._timeDimension.isLoading()) {\r\n                  this._showLayer(layer, time);\r\n              }\r\n              // console.log('Loaded layer ' + layer.wmsParams.layers + ' with time: ' + new Date(time).toISOString());\r\n              this.fire('timeload', {\r\n                  time: time\r\n              });\r\n          }).bind(this, newLayer, time));\r\n  \r\n          // Hack to hide the layer when added to the map.\r\n          // It will be shown when timeload event is fired from the map (after all layers are loaded)\r\n          newLayer.onAdd = (function(map) {\r\n              Object.getPrototypeOf(this).onAdd.call(this, map);\r\n              this.hide();\r\n          }).bind(newLayer);\r\n          return newLayer;\r\n      },\r\n      \r\n      _createLayerForTime:function(time){\r\n        var options = this.options;\r\n        var url = this._metadata.host;\r\n        let color = 2;\r\n        if(this._type == 'satellite'){\r\n          color = 0;\r\n        }\r\n  \r\n        return new L.TileLayer(url + this._frames[time].path + \"/256/{z}/{x}/{y}/\" + color + \"/1_1.png\", options);\r\n      },\r\n  \r\n      _getLoadedTimes: function() {\r\n          var result = [];\r\n          for (var prop in this._layers) {\r\n              if (this._layers.hasOwnProperty(prop)) {\r\n                  result.push(prop);\r\n              }\r\n          }\r\n          return result.sort(function(a, b) {\r\n              return a - b;\r\n          });\r\n      },\r\n  \r\n      _removeLayers: function(times) {\r\n          for (var i = 0, l = times.length; i < l; i++) {\r\n              if (this._map)\r\n                  this._map.removeLayer(this._layers[times[i]]);\r\n              delete this._layers[times[i]];\r\n          }\r\n      },\r\n  \r\n      setMinimumForwardCache: function(value) {\r\n          if (value > this._timeCacheForward) {\r\n              this._timeCacheForward = value;\r\n          }\r\n      },\r\n  \r\n      _getNearestTime: function(time) {\r\n          if (this._layers.hasOwnProperty(time)) {\r\n              return time;\r\n          }\r\n          if (this._availableTimes.length == 0) {\r\n              return time;\r\n          }\r\n          var index = 0;\r\n          var len = this._availableTimes.length;\r\n          for (; index < len; index++) {\r\n              if (time < this._availableTimes[index]) {\r\n                  break;\r\n              }\r\n          }\r\n          // We've found the first index greater than the time. Get the previous\r\n          if (index > 0) {\r\n              index--;\r\n          }\r\n          if (time != this._availableTimes[index]) {\r\n              console.log('Search layer time: ' + new Date(time).toISOString());\r\n              console.log('Return layer time: ' + new Date(this._availableTimes[index]).toISOString());\r\n          }\r\n          return this._availableTimes[index];\r\n      },\r\n  });\r\n  \r\n  L.timeDimension.layer.rainviewer = function(endpoint, options) {\r\n      return new L.TimeDimension.Layer.Rainviewer(endpoint, options);\r\n  };\r\n  \r\n  async function fetchRainviewerMetadata(endpoint){\r\n    let response = await fetch(endpoint);\r\n    let metadata = await response.json();\r\n    return metadata;\r\n  \r\n  }","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","__webpack_require__.nmd = (module) => {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t792: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkXCmaps\"] = self[\"webpackChunkXCmaps\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [96], () => (__webpack_require__(9791)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","console","log","L","Control","Layers","Tree","extend","options","closedSymbol","openedSymbol","spaceSymbol","selectorBack","namedToggle","collapseAll","expandAll","labelIsSelector","_initClassesNames","this","cls","children","childrenNopad","hide","closed","opened","space","pointer","header","neverShow","node","name","label","selAllCheckbox","initialize","baseTree","overlaysTree","_scrollTop","_baseTree","_overlaysTree","Util","setOptions","prototype","call","_setTrees","setBaseTree","tree","setOverlayTree","undefined","addBaseLayer","_layer","_name","addOverlay","removeLayer","collapse","_sect","scrollTop","expand","onAdd","changeName","layer","_layersTreeName","toggle","innerHTML","ret","_container","getElementsByClassName","DomUtil","addClass","eachLayer","on","expandTree","overlay","container","_overlaysList","_baseLayersList","_applyOnTree","_localExpand","collapseTree","expandSelected","iter","el","p","parentElement","hasClass","that","removeClass","h","inputs","_layerControlInputs","getElementsByTagName","i","length","input","_getLayer","layerId","checked","_section","_form","base","overlays","iterate","output","forEach","child","forArrays","Array","isArray","noShow","_layers","off","_onLayerChange","bflat","j","_addLayer","oflat","k","_map","_update","top","it","els","_addItem","_obj","_addTreeLayout","_expandCollapseAll","_iterateTreeLayout","_checkDisabledLayers","text","fn","ctx","document","createElement","className","appendChild","tabIndex","DomEvent","type","keyCode","blur","selAllNodes","html","creator","selAll","sel","entry","insertBefore","selectAllCheckbox","_createCheckboxElement","sensible","_preventClick","splice","variable","hasLayer","radioGroup","stamp","_createRadioElement","manageSelectorsAll","push","_onInputClick","String","title","ev","stopPropagation","selectAllCheckboxes","updateSelAllCheckbox","collapsed","eventeds","eventedClasses","evented","obj","querySelector","event","selectAll","functionToCheck","select","toString","append","create","ancestor","selector","selectedAll","selectedNone","querySelectorAll","inp","indeterminate","_ev","defaultChecked","control","layers","ResponsivePopup","Popup","hasTip","_initLayout","prefix","wrapper","_wrapper","_contentNode","disableClickPropagation","disableScrollPropagation","_tipContainer","style","visibility","_tip","closeButton","_closeButton","setAttribute","href","preventDefault","close","_updatePosition","pos","latLngToLayerPoint","_latlng","basePoint","layerPointToContainerPoint","containerWidth","offsetWidth","containerHeight","offsetHeight","padding","point","autoPanPadding","paddingTL","autoPanPaddingTopLeft","paddingBR","autoPanPaddingBottomRight","mapSize","getSize","anchor","_getAnchor","offset","containerRadius","offsetX","Math","abs","x","offsetY","y","canGoTop","canGoBottom","canGoLeft","canGoRight","containerPos","subtractX","subtractY","containerLeft","containerRight","containerTop","containerBottom","subtract","tipWidth","left","getCenter","setPosition","responsivePopup","source","link","img","src","alt","width","height","stop","popup","autoPan","maxWidth","setLatLng","setContent","openOn","airspaceDebounceTimer","airspaceClickHandler","currentLowerLimit","fetchAirspaces","window","error","center","apiUrl","lat","toFixed","lng","encodeURIComponent","join","fetch","then","response","json","data","airspaceEFG","clearLayers","airspaces","items","airspace","icaoClass","selectedLimit","parseInt","getElementById","value","lowerLimit","lowerLimitMeters","unitCode","convertToMeters","unit","geometry","coordinates","coord","color","polygon","airspaceTypes","icaoClasses","weight","fillOpacity","addLayer","clickedPoint","latlng","overlappingAirspaces","_ref","getBounds","contains","popupContent","a","_id","getUnit","upperLimit","catch","addEventListener","body","target","newLimit","clearTimeout","setTimeout","fetchAirspacesGliding","airspaceGliding","fetchAirspacesNotam","airspaceNotam","selectedDateStr","today","Date","getFullYear","getMonth","padStart","getDate","getCurrentDateStr","fetchAirspacesXC","bounds","nw","getNorthWest","se","getSouthEast","airspaceXC","features","filteredAirspaces","includedAirspaces","userTimezone","Intl","DateTimeFormat","resolvedOptions","timeZone","selectedDateStartUTC","moment","tz","startOf","utc","toDate","feature","properties","startsWith","limit","getLimitMeters","airlower_j","isExpired","descriptions","desc","cMatch","airdescription","match","dateStr","year","substring","month","day","hour","minute","UTC","hasActiveActivation","activations","selectedDateEndUTC","endOf","activation","activationStart","activationEnd","airspaceClass","hasExpirationDate","strokeColor","strokeWeight","fillColor","bindPopup","tzName","guess","timezoneInfo","zoneAbbr","format","descriptionsHtml","formatDescription","replace","airlanguage","activationsHtml","startMoment","endMoment","formatLimit","original","round","lower","upper","airupper_j","pt","turf","poly","closeOnClick","autoClose","tap","_popup","closePopup","newDate","getCompassDirection","deg","getFillColor","speed","getStrokeColor","getTextColor","backgroundColor","showTab","tabId","element","tab","display","classList","remove","targetTab","add","stationId","split","canvas","chartInstance","resize","fetchWindStations","nwLat","nwLng","seLat","seLng","responseData","windLayer","station","lon","loc","windDirection","last","windAvg","windMax","compassDirection","lastUpdate","toLocaleTimeString","peakArrow","peak","isHolfuy","includes","holfuyStationId","arrowSvg","arrowIcon","divIcon","iconSize","iconAnchor","marker","icon","addTo","historyData","aggregatedData","grouped","dt","setMinutes","floor","getMinutes","setSeconds","setMilliseconds","key","getTime","count","wAvgSum","wMaxSum","wDirSum","tempSum","tempCount","result","sort","b","processHistoricalData","fiveHoursAgo","now","limitedData","filter","slice","historyTable","timeFormatted","compassDir","chartData","reverse","popupHtml","short","minWidth","maxHeight","getContext","chartDataPointsAvg","chartDataPointsMax","Chart","datasets","borderColor","fill","pointRadius","responsive","maintainAspectRatio","layout","bottom","scales","time","displayFormats","tooltipFormat","grid","drawBorder","ticks","autoSkip","maxRotation","minRotation","beginAtZero","stepSize","maxTicksLimit","font","size","plugins","legend","afterDraw","chart","xAxis","save","arrowRowY","textAlign","textBaseline","getPixelForValue","translate","rotate","PI","fillText","restore","cameraTabElement","cameraImageElement","loadingText","textContent","parentNode","replaceChild","extractingText","websiteUrl","websiteProxyUrl","ok","status","pictureElements","DOMParser","parseFromString","webcamPicture","picture","sourceElements","imgElement","imageUrl","srcset","getAttribute","imageProxyUrl","cameraImageUrl","testImage","Image","onload","onerror","complete","naturalWidth","feedbackDropzone","currentFeedbackForm","changeSwiper","swiperc","innerWidth","$","css","changeDirection","getAngleRange","direction","dirToAngle","angleRanges","part","trim","range","dir","angle","start","end","async","loadPlaceDetails","placeId","regex1","regex2","regexHeight","regexHD","regexRating","description","currentPlaceName","currentPlaceId","currentStrPlacemarkId","strPlacemarkId","rating","heightdifference","lastupdate","fullScreenInfo","fullScreenContentArea","defaultCloseBtn","defaultFooter","setPopupContent","firstImg","idImg","swiperv","swiperLoop3","swiperLoop4","Swiper","autoHeight","allowTouchMove","mousewheel","slidesPerView","loop","spaceBetween","breakpoints","scrollbar","draggable","click","iR","clickedSlide","firstChild","slideTo","transitionEnd","realIndex","initSwiper","replaceWith","cloneNode","closeFullscreenInfo","popupElement","getPopup","getElement","showFeebackForm","destroy","messageDiv","isFullScreen","contextElement","modalFooter","feedbackFormHtml","insertAdjacentHTML","scrollTo","scrollHeight","behavior","feedbackText","focus","Dropzone","url","autoProcessQueue","maxFiles","maxFilesize","acceptedFiles","addRemoveLinks","dictDefaultMessage","clickable","init","dzInstance","file","previewElement","deleteIcon","removeFile","isValid","test","formData","FormData","files","method","success","message","cancelFeedback","fallbackFooter","initSpotPG","placesLayerPG","clusterGroup","markerClusterGroup","disableClusteringAtZoom","spiderfyOnMaxZoom","showCoverageOnHover","zoomToBoundsOnClick","maxClusterRadius","iconCreateFunction","cluster","getChildCount","currentFetchController","fetchDebounceTimer","fetchPlaces","abort","AbortController","signal","nw_lat","nw_lng","se_lat","se_lng","aborted","geoJSON","pointToLayer","canvasIcon","drawIcon","clearRect","beginPath","moveTo","arc","lineTo","fillStyle","closePath","onEachFeature","fetchPlacesPG","initSpotHG","placesLayerHG","fetchPlacesHG","initSpotLZ","placesLayerLZ","iconUrl","fetchPlacesLZ","mapInitialized","obstacleClickHandler","obstacleLayer","layerGroup","attribution","initMap","zoom","zoomControl","timeDimension","position","awgTerrain","tileLayer","osm","xcontest","popupEl","content","getContent","zIndex","mapTilerTerrain","mapboxGL","apiKey","sat","maxZoom","subdomains","opacity","oaipMap","rainviewerRadarLayer","rainviewer","cache","rainviewerSatelliteLayer","updateTimeDimensionControlVisibility","timeDimensionControl","playerOptions","transitionTime","buffer","timeZones","autoPlay","speedSlider","isTimeDimensionControlAdded","airspaceTimeOptions","date","dayName","overlayTree","InfoControl","Logo","logo","opts","locate","drawCircle","keepCurrentZoomLevel","iconLoading","iconElementTag","treeLayersControl","layersControlContainer","getContainer","layersControlToggle","isUpdatingTimeDimensionControl","shouldBeVisible","hasRadar","hasSatellite","isAnyRainViewerLayerActive","timeoutPromise","Promise","_","reject","addControlPromise","race","finally","removeControl","navigator","maxTouchPoints","msMaxTouchPoints","fetchObstacles","rainviewerUpdateTimeout","updateTimeDisplay","timeMatch","innerText","hours","minutes","period","toUpperCase","formattedTime","debouncedUpdateTimeDimensionControl","MutationObserver","mutations","observe","childList","subtree","setInterval","rainviewerRefreshInterval","fetchRainviewerMetadata","metadata","_metadata","_loaded","_setAvailableTimes","mapReadyEvent","Event","dispatchEvent","geoJson","obstacles","coords","polyline","maxAgl","clickedObstacles","obs","TimeDimension","Layer","Rainviewer","endpoint","arguments","_frames","_defaultTime","_availableTimes","_timeCacheBackward","cacheBackward","_timeCacheForward","cacheForward","_updateTimeDimension","updateTimeDimension","_updateTimeDimensionMode","updateTimeDimensionMode","_type","_baseLayer","setLoaded","fire","bind","nowcast","past","frame","infrared","sort_and_deduplicate","Number","_updateCurrentTime","_timeDimension","getAvailableTimes","setAvailableTimes","setCurrentTime","context","prop","hasOwnProperty","_onNewTimeLoading","_getLayerForTime","isReady","currentZoom","getZoom","minZoom","isLoaded","getCurrentTime","_currentLayer","_showLayer","setOpacity","apply","setZIndex","_unvalidateCache","redraw","_evictCachedTimes","keepforward","keepbackward","objectsToRemove","times","_getLoadedTimes","strTime","_currentTime","index","indexOf","_removeLayers","show","toISOString","nearestTime","_getNearestTime","newLayer","_createLayerForTime","isLoading","getPrototypeOf","host","TileLayer","path","l","setMinimumForwardCache","len","geolocation","getCurrentPosition","userLat","latitude","userLng","longitude","setView","locationReadyEvent","CustomEvent","detail","__webpack_module_cache__","moduleId","cachedModule","loaded","__webpack_modules__","m","O","chunkIds","priority","notFulfilled","Infinity","fulfilled","every","r","d","definition","defineProperty","enumerable","get","nmd","paths","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","some","chunkLoadingGlobal","self","__webpack_exports__"],"sourceRoot":""}