{"version":3,"file":"js/main.15ca98333c8b2f1d6b7b.js","mappings":"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","sources":["webpack://XCmaps/webpack/runtime/chunk loaded","webpack://XCmaps/./node_modules/moment/locale/ sync ^\\.\\/.*$","webpack://XCmaps/./src/public/assets/js/L.Control.Layers.Tree.js","webpack://XCmaps/./src/public/assets/js/leaflet.responsive.popup.js","webpack://XCmaps/./src/components/info-control.js","webpack://XCmaps/./src/components/deprecated/airspaces-gliding.js","webpack://XCmaps/./src/components/deprecated/airspaces-notam.js","webpack://XCmaps/./src/components/airspaces-xc.js","webpack://XCmaps/./src/components/windstations.js","webpack://XCmaps/./src/components/spots-helper.js","webpack://XCmaps/./src/components/spots-pg.js","webpack://XCmaps/./src/components/spots-hg.js","webpack://XCmaps/./src/components/spots-lz.js","webpack://XCmaps/./src/components/obstacles.js","webpack://XCmaps/./src/components/rainviewer.js","webpack://XCmaps/./src/components/keycloak-auth.js","webpack://XCmaps/./src/public/assets/js/index.js","webpack://XCmaps/webpack/bootstrap","webpack://XCmaps/webpack/runtime/amd options","webpack://XCmaps/webpack/runtime/define property getters","webpack://XCmaps/webpack/runtime/global","webpack://XCmaps/webpack/runtime/hasOwnProperty shorthand","webpack://XCmaps/webpack/runtime/node module decorator","webpack://XCmaps/webpack/runtime/jsonp chunk loading","webpack://XCmaps/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","var map = {\n\t\"./af\": 5177,\n\t\"./af.js\": 5177,\n\t\"./ar\": 1509,\n\t\"./ar-dz\": 1488,\n\t\"./ar-dz.js\": 1488,\n\t\"./ar-kw\": 8676,\n\t\"./ar-kw.js\": 8676,\n\t\"./ar-ly\": 2353,\n\t\"./ar-ly.js\": 2353,\n\t\"./ar-ma\": 4496,\n\t\"./ar-ma.js\": 4496,\n\t\"./ar-ps\": 6947,\n\t\"./ar-ps.js\": 6947,\n\t\"./ar-sa\": 2682,\n\t\"./ar-sa.js\": 2682,\n\t\"./ar-tn\": 9756,\n\t\"./ar-tn.js\": 9756,\n\t\"./ar.js\": 1509,\n\t\"./az\": 5533,\n\t\"./az.js\": 5533,\n\t\"./be\": 8959,\n\t\"./be.js\": 8959,\n\t\"./bg\": 7777,\n\t\"./bg.js\": 7777,\n\t\"./bm\": 4903,\n\t\"./bm.js\": 4903,\n\t\"./bn\": 1290,\n\t\"./bn-bd\": 7357,\n\t\"./bn-bd.js\": 7357,\n\t\"./bn.js\": 1290,\n\t\"./bo\": 1545,\n\t\"./bo.js\": 1545,\n\t\"./br\": 1470,\n\t\"./br.js\": 1470,\n\t\"./bs\": 4429,\n\t\"./bs.js\": 4429,\n\t\"./ca\": 7306,\n\t\"./ca.js\": 7306,\n\t\"./cs\": 6464,\n\t\"./cs.js\": 6464,\n\t\"./cv\": 3635,\n\t\"./cv.js\": 3635,\n\t\"./cy\": 4226,\n\t\"./cy.js\": 4226,\n\t\"./da\": 3601,\n\t\"./da.js\": 3601,\n\t\"./de\": 7853,\n\t\"./de-at\": 6111,\n\t\"./de-at.js\": 6111,\n\t\"./de-ch\": 4697,\n\t\"./de-ch.js\": 4697,\n\t\"./de.js\": 7853,\n\t\"./dv\": 708,\n\t\"./dv.js\": 708,\n\t\"./el\": 4691,\n\t\"./el.js\": 4691,\n\t\"./en-au\": 3872,\n\t\"./en-au.js\": 3872,\n\t\"./en-ca\": 8298,\n\t\"./en-ca.js\": 8298,\n\t\"./en-gb\": 6195,\n\t\"./en-gb.js\": 6195,\n\t\"./en-ie\": 6584,\n\t\"./en-ie.js\": 6584,\n\t\"./en-il\": 5543,\n\t\"./en-il.js\": 5543,\n\t\"./en-in\": 9033,\n\t\"./en-in.js\": 9033,\n\t\"./en-nz\": 9402,\n\t\"./en-nz.js\": 9402,\n\t\"./en-sg\": 3004,\n\t\"./en-sg.js\": 3004,\n\t\"./eo\": 2934,\n\t\"./eo.js\": 2934,\n\t\"./es\": 7650,\n\t\"./es-do\": 838,\n\t\"./es-do.js\": 838,\n\t\"./es-mx\": 7730,\n\t\"./es-mx.js\": 7730,\n\t\"./es-us\": 6575,\n\t\"./es-us.js\": 6575,\n\t\"./es.js\": 7650,\n\t\"./et\": 3035,\n\t\"./et.js\": 3035,\n\t\"./eu\": 3508,\n\t\"./eu.js\": 3508,\n\t\"./fa\": 119,\n\t\"./fa.js\": 119,\n\t\"./fi\": 527,\n\t\"./fi.js\": 527,\n\t\"./fil\": 5995,\n\t\"./fil.js\": 5995,\n\t\"./fo\": 2477,\n\t\"./fo.js\": 2477,\n\t\"./fr\": 5498,\n\t\"./fr-ca\": 6435,\n\t\"./fr-ca.js\": 6435,\n\t\"./fr-ch\": 7892,\n\t\"./fr-ch.js\": 7892,\n\t\"./fr.js\": 5498,\n\t\"./fy\": 7071,\n\t\"./fy.js\": 7071,\n\t\"./ga\": 1734,\n\t\"./ga.js\": 1734,\n\t\"./gd\": 217,\n\t\"./gd.js\": 217,\n\t\"./gl\": 7329,\n\t\"./gl.js\": 7329,\n\t\"./gom-deva\": 2124,\n\t\"./gom-deva.js\": 2124,\n\t\"./gom-latn\": 3383,\n\t\"./gom-latn.js\": 3383,\n\t\"./gu\": 5050,\n\t\"./gu.js\": 5050,\n\t\"./he\": 1713,\n\t\"./he.js\": 1713,\n\t\"./hi\": 3861,\n\t\"./hi.js\": 3861,\n\t\"./hr\": 6308,\n\t\"./hr.js\": 6308,\n\t\"./hu\": 609,\n\t\"./hu.js\": 609,\n\t\"./hy-am\": 7160,\n\t\"./hy-am.js\": 7160,\n\t\"./id\": 4063,\n\t\"./id.js\": 4063,\n\t\"./is\": 9374,\n\t\"./is.js\": 9374,\n\t\"./it\": 8383,\n\t\"./it-ch\": 1827,\n\t\"./it-ch.js\": 1827,\n\t\"./it.js\": 8383,\n\t\"./ja\": 3827,\n\t\"./ja.js\": 3827,\n\t\"./jv\": 9722,\n\t\"./jv.js\": 9722,\n\t\"./ka\": 1794,\n\t\"./ka.js\": 1794,\n\t\"./kk\": 7088,\n\t\"./kk.js\": 7088,\n\t\"./km\": 6870,\n\t\"./km.js\": 6870,\n\t\"./kn\": 4451,\n\t\"./kn.js\": 4451,\n\t\"./ko\": 3164,\n\t\"./ko.js\": 3164,\n\t\"./ku\": 8174,\n\t\"./ku-kmr\": 6181,\n\t\"./ku-kmr.js\": 6181,\n\t\"./ku.js\": 8174,\n\t\"./ky\": 8474,\n\t\"./ky.js\": 8474,\n\t\"./lb\": 9680,\n\t\"./lb.js\": 9680,\n\t\"./lo\": 5867,\n\t\"./lo.js\": 5867,\n\t\"./lt\": 5766,\n\t\"./lt.js\": 5766,\n\t\"./lv\": 9532,\n\t\"./lv.js\": 9532,\n\t\"./me\": 8076,\n\t\"./me.js\": 8076,\n\t\"./mi\": 1848,\n\t\"./mi.js\": 1848,\n\t\"./mk\": 306,\n\t\"./mk.js\": 306,\n\t\"./ml\": 3739,\n\t\"./ml.js\": 3739,\n\t\"./mn\": 9053,\n\t\"./mn.js\": 9053,\n\t\"./mr\": 6169,\n\t\"./mr.js\": 6169,\n\t\"./ms\": 3386,\n\t\"./ms-my\": 2297,\n\t\"./ms-my.js\": 2297,\n\t\"./ms.js\": 3386,\n\t\"./mt\": 7075,\n\t\"./mt.js\": 7075,\n\t\"./my\": 2264,\n\t\"./my.js\": 2264,\n\t\"./nb\": 2274,\n\t\"./nb.js\": 2274,\n\t\"./ne\": 8235,\n\t\"./ne.js\": 8235,\n\t\"./nl\": 2572,\n\t\"./nl-be\": 3784,\n\t\"./nl-be.js\": 3784,\n\t\"./nl.js\": 2572,\n\t\"./nn\": 4566,\n\t\"./nn.js\": 4566,\n\t\"./oc-lnc\": 9330,\n\t\"./oc-lnc.js\": 9330,\n\t\"./pa-in\": 9849,\n\t\"./pa-in.js\": 9849,\n\t\"./pl\": 4418,\n\t\"./pl.js\": 4418,\n\t\"./pt\": 9834,\n\t\"./pt-br\": 8303,\n\t\"./pt-br.js\": 8303,\n\t\"./pt.js\": 9834,\n\t\"./ro\": 4457,\n\t\"./ro.js\": 4457,\n\t\"./ru\": 2271,\n\t\"./ru.js\": 2271,\n\t\"./sd\": 1221,\n\t\"./sd.js\": 1221,\n\t\"./se\": 3478,\n\t\"./se.js\": 3478,\n\t\"./si\": 7538,\n\t\"./si.js\": 7538,\n\t\"./sk\": 5784,\n\t\"./sk.js\": 5784,\n\t\"./sl\": 6637,\n\t\"./sl.js\": 6637,\n\t\"./sq\": 6794,\n\t\"./sq.js\": 6794,\n\t\"./sr\": 5719,\n\t\"./sr-cyrl\": 3322,\n\t\"./sr-cyrl.js\": 3322,\n\t\"./sr.js\": 5719,\n\t\"./ss\": 6000,\n\t\"./ss.js\": 6000,\n\t\"./sv\": 1011,\n\t\"./sv.js\": 1011,\n\t\"./sw\": 748,\n\t\"./sw.js\": 748,\n\t\"./ta\": 1025,\n\t\"./ta.js\": 1025,\n\t\"./te\": 1885,\n\t\"./te.js\": 1885,\n\t\"./tet\": 8861,\n\t\"./tet.js\": 8861,\n\t\"./tg\": 6571,\n\t\"./tg.js\": 6571,\n\t\"./th\": 5802,\n\t\"./th.js\": 5802,\n\t\"./tk\": 9527,\n\t\"./tk.js\": 9527,\n\t\"./tl-ph\": 9231,\n\t\"./tl-ph.js\": 9231,\n\t\"./tlh\": 1052,\n\t\"./tlh.js\": 1052,\n\t\"./tr\": 5096,\n\t\"./tr.js\": 5096,\n\t\"./tzl\": 9846,\n\t\"./tzl.js\": 9846,\n\t\"./tzm\": 1765,\n\t\"./tzm-latn\": 7711,\n\t\"./tzm-latn.js\": 7711,\n\t\"./tzm.js\": 1765,\n\t\"./ug-cn\": 8414,\n\t\"./ug-cn.js\": 8414,\n\t\"./uk\": 6618,\n\t\"./uk.js\": 6618,\n\t\"./ur\": 158,\n\t\"./ur.js\": 158,\n\t\"./uz\": 7609,\n\t\"./uz-latn\": 2475,\n\t\"./uz-latn.js\": 2475,\n\t\"./uz.js\": 7609,\n\t\"./vi\": 1135,\n\t\"./vi.js\": 1135,\n\t\"./x-pseudo\": 4051,\n\t\"./x-pseudo.js\": 4051,\n\t\"./yo\": 2218,\n\t\"./yo.js\": 2218,\n\t\"./zh-cn\": 2648,\n\t\"./zh-cn.js\": 2648,\n\t\"./zh-hk\": 1632,\n\t\"./zh-hk.js\": 1632,\n\t\"./zh-mo\": 1541,\n\t\"./zh-mo.js\": 1541,\n\t\"./zh-tw\": 304,\n\t\"./zh-tw.js\": 304\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 5358;","/*\r\n * Control like L.Control.Layers, but showing layers in a tree.\r\n * Do not forget to include the css file.\r\n */\r\nconsole.log(\"L.Control.Layers.Tree has been loaded!\");\r\n(function(L) {\r\n    if (typeof L === 'undefined') {\r\n        throw new Error('Leaflet must be included first');\r\n    }\r\n\r\n    /*\r\n     * L.Control.Layers.Tree extends L.Control.Layers because it reuses\r\n     * most of its functionality. Only the HTML creation is different.\r\n     */\r\n    L.Control.Layers.Tree = L.Control.Layers.extend({\r\n        options: {\r\n            closedSymbol: '+',\r\n            openedSymbol: '&minus;',\r\n            spaceSymbol: ' ',\r\n            selectorBack: false,\r\n            namedToggle: false,\r\n            collapseAll: '',\r\n            expandAll: '',\r\n            labelIsSelector: 'both',\r\n        },\r\n\r\n        // Class names are error prone texts, so write them once here\r\n        _initClassesNames: function() {\r\n            this.cls = {\r\n                children: 'leaflet-layerstree-children',\r\n                childrenNopad: 'leaflet-layerstree-children-nopad',\r\n                hide: 'leaflet-layerstree-hide',\r\n                closed: 'leaflet-layerstree-closed',\r\n                opened: 'leaflet-layerstree-opened',\r\n                space: 'leaflet-layerstree-header-space',\r\n                pointer: 'leaflet-layerstree-header-pointer',\r\n                header: 'leaflet-layerstree-header',\r\n                neverShow: 'leaflet-layerstree-nevershow',\r\n                node: 'leaflet-layerstree-node',\r\n                name: 'leaflet-layerstree-header-name',\r\n                label: 'leaflet-layerstree-header-label',\r\n                selAllCheckbox: 'leaflet-layerstree-sel-all-checkbox',\r\n            };\r\n        },\r\n\r\n        initialize: function(baseTree, overlaysTree, options) {\r\n            this._scrollTop = 0;\r\n            this._initClassesNames();\r\n            this._baseTree = null;\r\n            this._overlaysTree = null;\r\n            L.Util.setOptions(this, options);\r\n            L.Control.Layers.prototype.initialize.call(this, null, null, options);\r\n            this._setTrees(baseTree, overlaysTree);\r\n        },\r\n\r\n        setBaseTree: function(tree) {\r\n            return this._setTrees(tree);\r\n        },\r\n\r\n        setOverlayTree: function(tree) {\r\n            return this._setTrees(undefined, tree);\r\n        },\r\n\r\n        addBaseLayer: function(_layer, _name) {\r\n            throw 'addBaseLayer is disabled';\r\n        },\r\n\r\n        addOverlay: function(_layer, _name) {\r\n            throw 'addOverlay is disabled';\r\n        },\r\n\r\n        removeLayer: function(_layer) {\r\n            throw 'removeLayer is disabled';\r\n        },\r\n\r\n        collapse: function() {\r\n            this._scrollTop = this._sect().scrollTop;\r\n            return L.Control.Layers.prototype.collapse.call(this);\r\n        },\r\n\r\n        expand: function() {\r\n            L.Control.Layers.prototype.expand.call(this);\r\n            this._sect().scrollTop = this._scrollTop;\r\n        },\r\n\r\n        onAdd: function(map) {\r\n            function changeName(layer) {\r\n                if (layer._layersTreeName) {\r\n                    toggle.innerHTML = layer._layersTreeName;\r\n                }\r\n            }\r\n\r\n            var ret = L.Control.Layers.prototype.onAdd.call(this, map);\r\n            if (this.options.namedToggle) {\r\n                var toggle = this._container.getElementsByClassName('leaflet-control-layers-toggle')[0];\r\n                L.DomUtil.addClass(toggle, 'leaflet-layerstree-named-toggle');\r\n                // Start with this value...\r\n                map.eachLayer(function(layer) {changeName(layer);});\r\n                // ... and change it whenever the baselayer is changed.\r\n                map.on('baselayerchange', function(e) {changeName(e.layer);}, this);\r\n            }\r\n            return ret;\r\n        },\r\n\r\n        // Expands the whole tree (base other overlays)\r\n        expandTree: function(overlay) {\r\n            var container = overlay ? this._overlaysList : this._baseLayersList;\r\n            if (container) {\r\n                this._applyOnTree(container, false);\r\n            }\r\n            return this._localExpand();\r\n        },\r\n\r\n        // Collapses the whole tree (base other overlays)\r\n        collapseTree: function(overlay) {\r\n            var container = overlay ? this._overlaysList : this._baseLayersList;\r\n            if (container) {\r\n                this._applyOnTree(container, true);\r\n            }\r\n            return this._localExpand();\r\n        },\r\n\r\n        // Expands the tree, only to show the selected inputs\r\n        expandSelected: function(overlay) {\r\n            function iter(el) {\r\n                // Function to iterate the whole DOM upwards\r\n                var p = el.parentElement;\r\n                if (p) {\r\n                    if (L.DomUtil.hasClass(p, that.cls.children) &&\r\n                        !L.DomUtil.hasClass(el, that.cls.childrenNopad)) {\r\n                        L.DomUtil.removeClass(p, hide);\r\n                    }\r\n\r\n                    if (L.DomUtil.hasClass(p, that.cls.node)) {\r\n                        var h = p.getElementsByClassName(that.cls.header)[0];\r\n                        that._applyOnTree(h, false);\r\n                    }\r\n                    iter(p);\r\n                }\r\n            }\r\n\r\n            var that = this;\r\n            var container = overlay ? this._overlaysList : this._baseLayersList;\r\n            if (!container) return this;\r\n            var hide = this.cls.hide;\r\n            var inputs = this._layerControlInputs || container.getElementsByTagName('input');\r\n            for (var i = 0; i < inputs.length; i++) {\r\n                // Loop over every (valid) input.\r\n                var input = inputs[i];\r\n                if (this._getLayer && !!this._getLayer(input.layerId).overlay != !!overlay) continue;\r\n                if (input.checked) {\r\n                    // Get out of the header,\r\n                    // to not open the possible (but rare) children\r\n                    iter(input.parentElement.parentElement.parentElement.parentElement);\r\n                }\r\n            }\r\n            return this._localExpand();\r\n        },\r\n\r\n        // \"private\" methods, not exposed in the API\r\n        _sect: function() {\r\n            // to keep compatibility after 1.3 https://github.com/Leaflet/Leaflet/pull/6380\r\n            return this._section || this._form;\r\n        },\r\n\r\n        _setTrees: function(base, overlays) {\r\n            var id = 0; // to keep unique id\r\n            function iterate(tree, output, overlays) {\r\n                if (tree && tree.layer) {\r\n                    if (!overlays) {\r\n                        tree.layer._layersTreeName = tree.name || tree.label;\r\n                    }\r\n                    output[id++] = tree.layer;\r\n                }\r\n                if (tree && tree.children && tree.children.length) {\r\n                    tree.children.forEach(function(child) {\r\n                        iterate(child, output, overlays);\r\n                    });\r\n                }\r\n                return output;\r\n            }\r\n\r\n            // We accept arrays, but convert into an object with children\r\n            function forArrays(input) {\r\n                if (Array.isArray(input)) {\r\n                    return {noShow: true, children: input};\r\n                } else {\r\n                    return input;\r\n                }\r\n            }\r\n\r\n            // Clean everything, and start again.\r\n            if (this._layerControlInputs) {\r\n                this._layerControlInputs = [];\r\n            }\r\n            for (var i = 0; i < this._layers.length; ++i) {\r\n                this._layers[i].layer.off('add remove', this._onLayerChange, this);\r\n            }\r\n            this._layers = [];\r\n\r\n            if (base !== undefined) this._baseTree = forArrays(base);\r\n            if (overlays !== undefined) this._overlaysTree = forArrays(overlays);\r\n\r\n            var bflat = iterate(this._baseTree, {});\r\n            for (var j in bflat) {\r\n                this._addLayer(bflat[j], j);\r\n            }\r\n\r\n            var oflat = iterate(this._overlaysTree, {}, true);\r\n            for (var k in oflat) {\r\n                this._addLayer(oflat[k], k, true);\r\n            }\r\n            return (this._map) ? this._update() : this;\r\n        },\r\n\r\n        // Used to update the vertical scrollbar\r\n        _localExpand: function() {\r\n            if (this._map && L.DomUtil.hasClass(this._container, 'leaflet-control-layers-expanded')) {\r\n                var top = this._sect().scrollTop;\r\n                this.expand();\r\n                this._sect().scrollTop = top; // to keep the scroll location\r\n                this._scrollTop = top;\r\n            }\r\n            return this;\r\n        },\r\n\r\n        // collapses or expands the tree in the container.\r\n        _applyOnTree: function(container, collapse) {\r\n            var iters = [\r\n                {cls: this.cls.children, hide: collapse},\r\n                {cls: this.cls.opened, hide: collapse},\r\n                {cls: this.cls.closed, hide: !collapse},\r\n            ];\r\n            iters.forEach(function(it) {\r\n                var els = container.getElementsByClassName(it.cls);\r\n                for (var i = 0; i < els.length; i++) {\r\n                    var el = els[i];\r\n                    if (L.DomUtil.hasClass(el, this.cls.childrenNopad)) {\r\n                        // do nothing\r\n                    } else if (it.hide) {\r\n                        L.DomUtil.addClass(el, this.cls.hide);\r\n                    } else {\r\n                        L.DomUtil.removeClass(el, this.cls.hide);\r\n                    }\r\n                }\r\n            }, this);\r\n        },\r\n\r\n        // it is called in the original _update, and shouldn't do anything.\r\n        _addItem: function(_obj) {\r\n        },\r\n\r\n        // overwrite _update function in Control.Layers\r\n        _update: function() {\r\n            if (!this._container) { return this; }\r\n            L.Control.Layers.prototype._update.call(this);\r\n            this._addTreeLayout(this._baseTree, false);\r\n            this._addTreeLayout(this._overlaysTree, true);\r\n            return this._localExpand();\r\n        },\r\n\r\n        // Create the DOM objects for the tree\r\n        _addTreeLayout: function(tree, overlay) {\r\n            if (!tree) return;\r\n            var container = overlay ? this._overlaysList : this._baseLayersList;\r\n            this._expandCollapseAll(overlay, this.options.collapseAll, this.collapseTree);\r\n            this._expandCollapseAll(overlay, this.options.expandAll, this.expandTree);\r\n            this._iterateTreeLayout(tree, container, overlay, [], tree.noShow);\r\n            if (this._checkDisabledLayers) {\r\n                // to keep compatibility\r\n                this._checkDisabledLayers();\r\n            }\r\n        },\r\n\r\n        // Create the \"Collapse all\" or expand, if needed.\r\n        _expandCollapseAll: function(overlay, text, fn, ctx) {\r\n            var container = overlay ? this._overlaysList : this._baseLayersList;\r\n            ctx = ctx ? ctx : this;\r\n            if (text) {\r\n                var o = document.createElement('div');\r\n                o.className = 'leaflet-layerstree-expand-collapse';\r\n                container.appendChild(o);\r\n                o.innerHTML = text;\r\n                o.tabIndex = 0;\r\n                L.DomEvent.on(o, 'click keydown', function(e) {\r\n                    if (e.type !== 'keydown' || e.keyCode === 32) {\r\n                        o.blur();\r\n                        fn.call(ctx, overlay);\r\n                        this._localExpand();\r\n                    }\r\n                }, this);\r\n            }\r\n        },\r\n\r\n        // recursive function to create the DOM children\r\n        _iterateTreeLayout: function(tree, container, overlay, selAllNodes, noShow) {\r\n            if (!tree) return;\r\n            function creator(type, cls, append, innerHTML) {\r\n                var obj = L.DomUtil.create(type, cls, append);\r\n                if (innerHTML) obj.innerHTML = innerHTML;\r\n                return obj;\r\n            }\r\n\r\n            // Add this block to handle HTML elements\r\n            if (tree.html) {\r\n                var htmlContainer = creator('div', 'leaflet-layerstree-html-container', container);\r\n                htmlContainer.innerHTML = tree.html;\r\n                return;  // Skip normal processing for HTML nodes\r\n            }\r\n\r\n            // create the header with it fields\r\n            var header = creator('div', this.cls.header, container);\r\n            var sel = creator('span');\r\n            var entry = creator('span');\r\n            var closed = creator('span', this.cls.closed, sel, this.options.closedSymbol);\r\n            var opened = creator('span', this.cls.opened, sel, this.options.openedSymbol);\r\n            var space = creator('span', this.cls.space, null, this.options.spaceSymbol);\r\n            if (this.options.selectorBack) {\r\n                sel.insertBefore(space, closed);\r\n                header.appendChild(entry);\r\n                header.appendChild(sel);\r\n            } else {\r\n                sel.appendChild(space);\r\n                header.appendChild(sel);\r\n                header.appendChild(entry);\r\n            }\r\n\r\n            function updateSelAllCheckbox(ancestor) {\r\n                var selector = ancestor.querySelector('input[type=checkbox]');\r\n                var selectedAll = true;\r\n                var selectedNone = true;\r\n                var inputs = ancestor.querySelectorAll('input[type=checkbox]');\r\n                [].forEach.call(inputs, function(inp) { // to work in node for tests\r\n                    if (inp === selector) {\r\n                        // ignore\r\n                    } else if (inp.indeterminate) {\r\n                        selectedAll = false;\r\n                        selectedNone = false;\r\n                    } else if (inp.checked) {\r\n                        selectedNone = false;\r\n                    } else if (!inp.checked) {\r\n                        selectedAll = false;\r\n                    }\r\n                });\r\n                if (selectedAll) {\r\n                    selector.indeterminate = false;\r\n                    selector.checked = true;\r\n                } else if (selectedNone) {\r\n                    selector.indeterminate = false;\r\n                    selector.checked = false;\r\n                } else {\r\n                    selector.indeterminate = true;\r\n                    selector.checked = false;\r\n                }\r\n            }\r\n\r\n            function manageSelectorsAll(input, ctx) {\r\n                selAllNodes.forEach(function(ancestor) {\r\n                    L.DomEvent.on(input, 'click', function(_ev) {\r\n                        updateSelAllCheckbox(ancestor);\r\n                    }, ctx);\r\n                }, ctx);\r\n            }\r\n\r\n            var selAll;\r\n            if (tree.selectAllCheckbox) {\r\n                selAll = this._createCheckboxElement(false);\r\n                selAll.className += ' ' + this.cls.selAllCheckbox;\r\n            }\r\n\r\n            var hide = this.cls.hide; // To toggle state\r\n            // create the children group, with the header event click\r\n            if (tree.children) {\r\n                var children = creator('div', this.cls.children, container);\r\n                var sensible = tree.layer ? sel : header;\r\n                L.DomUtil.addClass(sensible, this.cls.pointer);\r\n                sensible.tabIndex = 0;\r\n                L.DomEvent.on(sensible, 'click keydown', function(e) {\r\n                    // leaflet internal flag to prevent click propagation and collapsing tree on mobile browsers\r\n                    if (this._preventClick) {\r\n                        return;\r\n                    }\r\n                    if (e.type === 'keydown' && e.keyCode !== 32) {\r\n                        return;\r\n                    }\r\n                    sensible.blur();\r\n\r\n                    if (L.DomUtil.hasClass(opened, hide)) {\r\n                        // it is not opened, so open it\r\n                        L.DomUtil.addClass(closed, hide);\r\n                        L.DomUtil.removeClass(opened, hide);\r\n                        L.DomUtil.removeClass(children, hide);\r\n                    } else {\r\n                        // close it\r\n                        L.DomUtil.removeClass(closed, hide);\r\n                        L.DomUtil.addClass(opened, hide);\r\n                        L.DomUtil.addClass(children, hide);\r\n                    }\r\n                    this._localExpand();\r\n                }, this);\r\n                if (selAll) {\r\n                    selAllNodes.splice(0, 0, container);\r\n                }\r\n                tree.children.forEach(function(child) {\r\n                    var node = creator('div', this.cls.node, children);\r\n                    this._iterateTreeLayout(child, node, overlay, selAllNodes);\r\n                }, this);\r\n                if (selAll) {\r\n                    selAllNodes.splice(0, 1);\r\n                }\r\n            } else {\r\n                // no children, so the selector makes no sense.\r\n                L.DomUtil.addClass(sel, this.cls.neverShow);\r\n            }\r\n\r\n            // make (or not) the label clickable to toggle the layer\r\n            var labelType;\r\n            if (tree.layer) {\r\n                if ((this.options.labelIsSelector === 'both') || // if option is set to both\r\n                    (overlay && this.options.labelIsSelector === 'overlay') || // if an overlay layer and options is set to overlay\r\n                    (!overlay && this.options.labelIsSelector === 'base')) { // if a base layer and option is set to base\r\n                    labelType = 'label';\r\n                } else { // if option is set to something else\r\n                    labelType = 'span';\r\n                }\r\n            } else {\r\n                labelType = 'span';\r\n            }\r\n            // create the input and label\r\n            var label = creator(labelType, this.cls.label, entry);\r\n            if (tree.layer) {\r\n                // now create the element like in _addItem\r\n                var checked = this._map.hasLayer(tree.layer);\r\n                var input;\r\n                var radioGroup = overlay ? tree.radioGroup : 'leaflet-base-layers_' + L.Util.stamp(this);\r\n                if (radioGroup) {\r\n                    input = this._createRadioElement(radioGroup, checked);\r\n                } else {\r\n                    input = this._createCheckboxElement(checked);\r\n                    manageSelectorsAll(input, this);\r\n                }\r\n                if (this._layerControlInputs) {\r\n                    // to keep compatibility with 1.0.3\r\n                    this._layerControlInputs.push(input);\r\n                }\r\n                input.layerId = L.Util.stamp(tree.layer);\r\n                L.DomEvent.on(input, 'click', this._onInputClick, this);\r\n                label.appendChild(input);\r\n            }\r\n\r\n            function isText(variable) {\r\n                return (typeof variable === 'string' || variable instanceof String);\r\n            }\r\n\r\n            function isFunction(functionToCheck) {\r\n                return functionToCheck && {}.toString.call(functionToCheck) === '[object Function]';\r\n            }\r\n\r\n            function selectAllCheckboxes(select, ctx) {\r\n                var inputs = container.getElementsByTagName('input');\r\n                for (var i = 0; i < inputs.length; i++) {\r\n                    var input = inputs[i];\r\n                    if (input.type !== 'checkbox') continue;\r\n                    input.checked = select;\r\n                    input.indeterminate = false;\r\n                }\r\n                ctx._onInputClick();\r\n            }\r\n            if (tree.selectAllCheckbox) {\r\n                // selAll is already created\r\n                label.appendChild(selAll);\r\n                if (isText(tree.selectAllCheckbox)) {\r\n                    selAll.title = tree.selectAllCheckbox;\r\n                }\r\n                L.DomEvent.on(selAll, 'click', function(ev) {\r\n                    ev.stopPropagation();\r\n                    selectAllCheckboxes(selAll.checked, this);\r\n                }, this);\r\n                updateSelAllCheckbox(container);\r\n                manageSelectorsAll(selAll, this);\r\n            }\r\n\r\n            creator('span', this.cls.name, label, tree.label);\r\n\r\n            // hide the button which doesn't fit the collapsed state, then hide children conditionally\r\n            L.DomUtil.addClass(tree.collapsed ? opened : closed, hide);\r\n            tree.collapsed && children && L.DomUtil.addClass(children, hide);\r\n\r\n            if (noShow) {\r\n                L.DomUtil.addClass(header, this.cls.neverShow);\r\n                L.DomUtil.addClass(children, this.cls.childrenNopad);\r\n            }\r\n\r\n            var eventeds = tree.eventedClasses;\r\n            if (!(eventeds instanceof Array)) {\r\n                eventeds = [eventeds];\r\n            }\r\n\r\n            for (var e = 0; e < eventeds.length; e++) {\r\n                var evented = eventeds[e];\r\n                if (evented && evented.className) {\r\n                    var obj = container.querySelector('.' + evented.className);\r\n                    if (obj) {\r\n                        L.DomEvent.on(obj, evented.event || 'click', (function(selectAll) {\r\n                            return function(ev) {\r\n                                ev.stopPropagation();\r\n                                var select = isFunction(selectAll) ? selectAll(ev, container, tree, this._map) : selectAll;\r\n                                if (select !== undefined && select !== null) {\r\n                                    selectAllCheckboxes(select, this);\r\n                                }\r\n                            };\r\n                        })(evented.selectAll), this);\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        _createCheckboxElement: function(checked) {\r\n            var input = document.createElement('input');\r\n            input.type = 'checkbox';\r\n            input.className = 'leaflet-control-layers-selector';\r\n            input.defaultChecked = checked;\r\n            return input;\r\n        },\r\n\r\n    });\r\n\r\n    L.control.layers.tree = function(base, overlays, options) {\r\n        return new L.Control.Layers.Tree(base, overlays, options);\r\n    };\r\n \r\n})(L);\r\nconsole.log(\"L.Control.Layers.Tree has been loaded!\");\r\n","/*\r\n leaflet.responsive.popup 1.0.0\r\n (c) 20222 https://github.com/yafred\r\n*/\r\n\r\nL.ResponsivePopup = L.Popup.extend({\r\n\t\t\r\n\toptions: {\r\n\t\thasTip: true\r\n\t\t/*\r\n\t\t * Inherited from L.Popup\r\n\t\t * \r\n\t\t * - offset\r\n\t\t * \r\n\t\t * - autoPanPadding\r\n\t\t * - autoPanPaddingTopLeft\r\n\t\t * - autoPanPaddingBottomRight\r\n\t\t */\r\n\t},\r\n\t\r\n\t/**\r\n\t * Overrides https://github.com/Leaflet/Leaflet/blob/399ed2105220f10b79e69b57420597e03502e611/src/layer/Popup.js#L183\r\n\t * This is to add hasTip option\r\n\t */\r\n\t_initLayout: function () {\r\n\r\n\t\tvar prefix = 'leaflet-popup',\r\n\t\t    container = this._container = L.DomUtil.create('div',\r\n\t\t\tprefix + ' ' + (this.options.className || '') +\r\n\t\t\t' leaflet-zoom-animated');\r\n\r\n\t\tvar wrapper = this._wrapper = L.DomUtil.create('div', prefix + '-content-wrapper', container);\r\n\t\tthis._contentNode = L.DomUtil.create('div', prefix + '-content', wrapper);\r\n\r\n\t\tL.DomEvent.disableClickPropagation(container);\r\n\t\tL.DomEvent.disableScrollPropagation(this._contentNode);\r\n\t\tL.DomEvent.on(container, 'contextmenu', L.DomEvent.stopPropagation);\r\n\r\n\t\tthis._tipContainer = L.DomUtil.create('div', prefix + '-tip-container', container);\r\n\t\tif(!this.options.hasTip) {\r\n\t\t\tthis._tipContainer.style.visibility = 'hidden';\r\n\t\t}\r\n\t\tthis._tip = L.DomUtil.create('div', prefix + '-tip', this._tipContainer);\r\n\r\n\t\tif (this.options.closeButton) {\r\n\t\t\tvar closeButton = this._closeButton = L.DomUtil.create('a', prefix + '-close-button', container);\r\n\t\t\tcloseButton.setAttribute('role', 'button'); // overrides the implicit role=link of <a> elements #7399\r\n\t\t\tcloseButton.setAttribute('aria-label', 'Close popup');\r\n\t\t\tcloseButton.href = '#close';\r\n\t\t\tcloseButton.innerHTML = '<span aria-hidden=\"true\">&#215;</span>';\r\n\r\n\t\t\tL.DomEvent.on(closeButton, 'click', function (ev) {\r\n\t\t\t\tL.DomEvent.preventDefault(ev);\r\n\t\t\t\tthis.close();\r\n\t\t\t}, this);\r\n\t\t}\r\n\t},\r\n\t\r\n\t\r\n\t\r\n\t/**\r\n\t * Overrides https://github.com/Leaflet/Leaflet/blob/v1.3.4/src/layer/DivOverlay.js#L178\r\n\t */\r\n\t_updatePosition: function () {\r\n\r\n\t\tif (!this._map) { return; }\r\n\t\t\r\n\t\tvar pos = this._map.latLngToLayerPoint(this._latlng),\r\n\t        basePoint = this._map.layerPointToContainerPoint(pos),\r\n\t        containerWidth = this._container.offsetWidth,\r\n\t        containerHeight = this._container.offsetHeight,\r\n\t\t    padding = L.point(this.options.autoPanPadding),\r\n\t\t    paddingTL = L.point(this.options.autoPanPaddingTopLeft || padding),\r\n\t\t    paddingBR = L.point(this.options.autoPanPaddingBottomRight || padding),\r\n\t        mapSize = this._map.getSize(),\r\n\t        anchor = this._getAnchor(),  // popup anchor\r\n        \toffset = L.point(this.options.offset); // offset relative to anchor (option from L.DivOverlay. We only use absolute values).\r\n  \r\n\t\t// Leaflet default dimensions (should not be hard coded in the future)\r\n  \t\tvar tipHeight = 11; //px\r\n  \t\tvar tipWidth = 22; //px\r\n  \t\tvar containerRadius = 12; //px  \r\n\t\t\r\n  \t\t// Tweak offset to include tip dimensions \r\n  \t\tvar offsetX = Math.abs(offset.x);\r\n   \t\tvar offsetY = Math.abs(offset.y);\r\n   \t\tif(this.options.hasTip) {\r\n  \t\t\toffsetX += tipHeight;\r\n  \t\t\toffsetY += tipHeight;  \r\n  \t\t\t\r\n  \t\t\t// clear CSS\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-north');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-south');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-east');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-west');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-north-east');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-north-west');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-south-east');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-south-west');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-east-north');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-east-south');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-west-north');\t\t\r\n  \t\t\tL.DomUtil.removeClass(this._container, 'leaflet-resp-popup-west-south');\r\n  \t\t\t// this._container.style.display = 'initial'; // this does not work\r\n  \t\t}\r\n\t\t\r\n\t\t// Where can we fit the popup ?\r\n\t\tvar canGoTop = true,\r\n\t\t    canGoBottom = true,\r\n\t\t    canGoLeft = true,\r\n\t\t    canGoRight = true,\r\n\t\t    containerPos = false;\r\n\t\t\r\n\t\tif(basePoint.y + anchor.y - offsetY - containerHeight - Math.abs(paddingTL.y) < 0) {\r\n\t\t\tcanGoTop = false;\r\n\t\t}\r\n\t\tif(basePoint.y + anchor.y + offsetY + containerHeight + Math.abs(paddingBR.y) > mapSize.y) {\r\n\t\t\tcanGoBottom = false;\r\n\t\t}\r\n\t\tif(basePoint.x + anchor.x - offsetX - containerWidth - Math.abs(paddingTL.x) < 0) {\r\n\t\t\tcanGoLeft = false;\r\n\t\t}\r\n\t\tif(basePoint.x + anchor.x + offsetX + containerWidth + Math.abs(paddingBR.x) > mapSize.x) {\r\n\t\t\tcanGoRight = false;\r\n\t\t}\r\n\t\t\r\n\t\t// manage overflows\r\n\t\tvar subtractX = containerWidth / 2 - anchor.x,\r\n\t\t    subtractY = containerHeight / 2 - anchor.y;\r\n\t\t\r\n\t\tif(canGoTop || canGoBottom) {\t\t\r\n\t\t\tvar containerLeft = basePoint.x + anchor.x - (containerWidth / 2);\r\n\t\t\tvar containerRight = basePoint.x + anchor.x + (containerWidth / 2);\r\n\t\t\tif(containerLeft < Math.abs(paddingTL.x)) { // left overflow\r\n\t\t\t\tsubtractX = containerWidth / 2 - anchor.x - Math.abs(paddingTL.x) + containerLeft;\r\n\t\t\t}\t\t\r\n\t\t\tif(containerRight > mapSize.x - Math.abs(paddingBR.x)) { // right overflow\r\n\t\t\t\tsubtractX = containerWidth / 2 - anchor.x + containerRight - mapSize.x + Math.abs(paddingBR.x);\r\n\t\t\t}\t\t\t\t\t\t\r\n\t\t}\t\r\n\t\tif(canGoLeft || canGoRight) {\r\n\t\t\tvar containerTop = basePoint.y + anchor.y - (containerHeight / 2);\r\n\t\t\tvar containerBottom = basePoint.y + anchor.y + (containerHeight / 2);\r\n\t\t\tif(containerTop < Math.abs(paddingTL.y)) { // top overflow\r\n\t\t\t\tsubtractY = containerHeight / 2 - anchor.y - Math.abs(paddingTL.y) + containerTop;\r\n\t\t\t}\t\t\r\n\t\t\tif(containerBottom > mapSize.y - Math.abs(paddingBR.y)) { // bottom overflow\r\n\t\t\t\tsubtractY = containerHeight / 2 - anchor.y + containerBottom - mapSize.y + Math.abs(paddingBR.y);\r\n\t\t\t}\t\t\t\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\t// position the popup (order of preference is: top, left, bottom, right, centerOnMap)\r\n\t\tif(canGoTop) {\r\n\t\t\tcontainerPos = pos.subtract(L.point(subtractX, -anchor.y + containerHeight + offsetY, true));\r\n\t\t\tif(this.options.hasTip) {\r\n\t\t\t\tif(basePoint.x + anchor.x < paddingTL.x + containerRadius + tipWidth/2) {\r\n\t\t\t\t\tcontainerPos.x = pos.x + anchor.x;\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-north-east');\r\n\t\t\t\t\tthis._tipContainer.style.top = containerHeight + 'px';\r\n\t\t\t\t\tthis._tipContainer.style.left = '0px';\r\n\t\t\t\t}\r\n\t\t\t\telse if(basePoint.x + anchor.x > mapSize.x - paddingBR.x - containerRadius - tipWidth/2) {\r\n\t\t\t\t\tcontainerPos.x = pos.x + anchor.x - containerWidth;\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-north-west');\t\r\n\t\t\t\t\tthis._tipContainer.style.top = containerHeight + 'px';\r\n\t\t\t\t\tthis._tipContainer.style.left = containerWidth + 'px';\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-north');\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tthis._tipContainer.style.top = containerHeight + 'px';\r\n\t\t\t\t\tthis._tipContainer.style.left = (pos.x + anchor.x - containerPos.x) + 'px';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(canGoLeft) {\r\n\t\t\tcontainerPos = pos.subtract(L.point(-anchor.x + containerWidth + offsetX, subtractY, true));\r\n\t\t\tif(this.options.hasTip) {\r\n\t\t\t\tif(basePoint.y + anchor.y < paddingTL.y + containerRadius + tipWidth/2) {\r\n\t\t\t\t\tcontainerPos.y = pos.y + anchor.y;\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-west-south');\r\n\t\t\t\t\tthis._tipContainer.style.top = '0px';\r\n\t\t\t\t\tthis._tipContainer.style.left = containerWidth + 'px';\r\n\t\t\t\t}\r\n\t\t\t\telse if(basePoint.y + anchor.y > mapSize.y - paddingBR.y - containerRadius - tipWidth/2) {\r\n\t\t\t\t\tcontainerPos.y = pos.y + anchor.y - containerHeight;\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-west-north');\t\t\t\t\t\r\n\t\t\t\t\tthis._tipContainer.style.top = containerHeight + 'px';\r\n\t\t\t\t\tthis._tipContainer.style.left = containerWidth + 'px';\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-west');\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tthis._tipContainer.style.top = (pos.y + anchor.y - containerPos.y) + 'px';\r\n\t\t\t\t\tthis._tipContainer.style.left = containerWidth + 'px';\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(canGoBottom) {\r\n\t\t\tcontainerPos = pos.subtract(L.point(subtractX, -anchor.y - offsetY, true));\r\n\t\t\tif(this.options.hasTip) {\r\n\t\t\t\tif(basePoint.x + anchor.x < paddingTL.x + containerRadius + tipWidth/2) {\r\n\t\t\t\t\tcontainerPos.x = pos.x + anchor.x;\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-south-east');\r\n\t\t\t\t\tthis._tipContainer.style.top = '0px';\r\n\t\t\t\t\tthis._tipContainer.style.left = '0px';\r\n\t\t\t\t}\r\n\t\t\t\telse if(basePoint.x + anchor.x > mapSize.x - paddingBR.x - containerRadius - tipWidth/2) {\r\n\t\t\t\t\tcontainerPos.x = pos.x + anchor.x - containerWidth;\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-south-west');\t\t\t\t\t\r\n\t\t\t\t\tthis._tipContainer.style.top = '0px';\r\n\t\t\t\t\tthis._tipContainer.style.left = containerWidth + 'px';\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-south');\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tthis._tipContainer.style.top = '0px';\r\n\t\t\t\t\tthis._tipContainer.style.left = (pos.x + anchor.x - containerPos.x) + 'px';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(canGoRight) {\r\n\t\t\tcontainerPos = pos.subtract(L.point(-anchor.x - offsetX, subtractY, true));\r\n\t\t\tif(this.options.hasTip) {\r\n\t\t\t\tif(basePoint.y + anchor.y < paddingTL.y + containerRadius + tipWidth/2) {\r\n\t\t\t\t\tcontainerPos.y = pos.y + anchor.y;\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-east-south');\r\n\t\t\t\t\tthis._tipContainer.style.top = '0px';\r\n\t\t\t\t\tthis._tipContainer.style.left = '0px';\r\n\t\t\t\t}\r\n\t\t\t\telse if(basePoint.y + anchor.y > mapSize.y - paddingBR.y - containerRadius - tipWidth/2) {\r\n\t\t\t\t\tcontainerPos.y = pos.y + anchor.y - containerHeight;\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-east-north');\t\t\t\t\t\r\n\t\t\t\t\tthis._tipContainer.style.top = containerHeight + 'px';\r\n\t\t\t\t\tthis._tipContainer.style.left = '0px';\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tL.DomUtil.addClass(this._container, 'leaflet-resp-popup-east');\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tthis._tipContainer.style.top = (pos.y + anchor.y - containerPos.y) + 'px';\r\n\t\t\t\t\tthis._tipContainer.style.left = '0px';\r\n\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar pos = this._map.latLngToLayerPoint(this._map.getCenter());\r\n\t\t\tcontainerPos = pos.subtract(L.point(containerWidth / 2, containerHeight / 2));\r\n\t\t\tif(this.options.hasTip) {\r\n\t\t\t\t// this._tipContainer.style.display = 'none'; // this does not work\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t\t\r\n\t\t// if point is not visible, just hide the popup\r\n\t\tif(basePoint.x < 0 || basePoint.y < 0 || basePoint.x > mapSize.x || basePoint.y > mapSize.y) {\r\n\t\t\t// this._container.style.display = 'none';  // this does not work\r\n\t\t}\r\n\t\t\r\n\t\t// if container is too big, just hide the popup\r\n\t\tif(containerWidth - Math.abs(paddingTL.x) - Math.abs(paddingBR.x) > mapSize.x || containerHeight - Math.abs(paddingTL.y) - Math.abs(paddingBR.y) > mapSize.y) {\r\n\t\t\t// this._container.style.display = 'none'; // this does not work\r\n\t\t}\r\n\t\t\r\n\t\tL.DomUtil.setPosition(this._container, containerPos);\r\n\t}\r\n\t\r\n});\r\n\r\n\r\n//Instantiates a `ResponsivePopup` object given an optional `options` object that describes its appearance and location and an optional `source` object that is used to tag the popup with a reference to the Layer to which it refers.\r\nL.responsivePopup = function (options, source) {\r\n\treturn new L.ResponsivePopup(options, source);\r\n};\r\n\r\n//Adds Angular support\r\nif( typeof exports === 'object' && typeof module !== 'undefined') {\r\n\texports.responsivePopup = L.responsivePopup;\r\n\texports.ResponsivePopup = L.ResponsivePopup;\r\n}","const InfoControl = L.Control.extend({\r\n    onAdd: function(map) {\r\n        // --- Create the button on the map ---\r\n        var container = L.DomUtil.create('div', 'info-control leaflet-bar leaflet-control');\r\n        var link = L.DomUtil.create('a', 'leaflet-control-button', container);\r\n        link.href = '#';\r\n        var img = L.DomUtil.create('img', 'info-control-icon', link);\r\n        img.src = 'assets/images/info.png';\r\n        img.alt = 'Information';\r\n        img.style.width = '24px'; img.style.height = '24px'; img.style.padding = '4px';\r\n\r\n        L.DomEvent.disableClickPropagation(container);\r\n\r\n        // --- Modal/Popup state variables ---\r\n        let modalOverlay = null;\r\n        let modalContent = null;\r\n        let contentAreaDiv = null;\r\n        let headerDiv = null;\r\n        let footerDiv = null;\r\n        let breadcrumbDiv = null;\r\n        let feedbackDropzone = null;\r\n        let currentFeedbackForm = null;\r\n        let isModalStructureBuilt = false;\r\n\r\n        // --- Content Definitions ---\r\n        const popupSections = {\r\n            home: `\r\n                <h3>About XCmaps</h3>\r\n                <p>XCmaps is a non-commercial project that brings together various data sources for para- and hang-gliders, providing valuable insights for the community.</p>\r\n\r\n                <h3>Contact</h3>\r\n                <p>You can reach out to us via the Feedback form below or by <a href=\"mailto:info@XCmaps.com\" target=\"_blank\">email</a>.</p>\r\n                <p>If youd like to report an issue, such as a bug or a feature request, please visit our <a href=\"https://github.com/XCmaps/XCmaps\" target=\"_blank\">GitHub</a> project page.</p>\r\n                <p>To stay up-to date on latest updates, please follow us on <a href=\"https://facebook.com/xcmaps\" target=\"_blank\">Facebook</a> or <a href=\"https://github.com/XCmaps/XCmaps\" target=\"_blank\">GitHub</a>.</p>\r\n\r\n                <p>If you enjoy our content, consider buying us a landing beer! Your support helps keep this service running, as we cover real costs for servers, storage, AI models, and data sources.<br>Its simple: the more funding we receive, the faster we can roll out new features!</p>\r\n                <p><a href=\"https://buymeacoffee.com/XCmaps\" target=\"_blank\" class=\"donation-button\">  Buy us a Landing Beer</a></p>\r\n\r\n                <h3>Features</h3>\r\n                <ul>\r\n                  <li><strong>Weather Stations:</strong> Wind, Gusts, Direction, Temp and Camera if available</li>\r\n                  <li><strong>Rain Viewer:</strong> Radar and Satellite, past 60 min + 20 min forecast</li>\r\n                  <li><strong>Thermals:</strong> kk7 thermal map</li>\r\n                  <li><strong>Spots:</strong> Para- and Hangliding take-off and Landing Zones ( <a href=\"https://paraglidingspots.com\" target=\"_blank\">paraglidingspots.com</a>)</li>\r\n                  <li><strong>Airspaces:</strong> Xcontest Airspaces & Activations, filter for today and the next 6 days and lowest floor level</li>\r\n                  <li><strong>Obstacles:</strong> OSM based obstacles from Xcontest</li>\r\n                  <li><strong>Locate and Track:</strong> Locate and Track your position using the Locate Control</li>\r\n                </ul>\r\n\r\n                <h3>Credits</h3>\r\n                <ul>\r\n                  <li><strong>Base Maps:</strong> <a href=\"https://www.jawg.io\" target=\"_blank\">Jawg.io</a>, <a href=\"https://openstreetmap.org\" target=\"_blank\">OpenStreetMap</a>, <a href=\"https://xcontest.org\" target=\"_blank\">XContest</a>, <a href=\"https://maptiler.com\" target=\"_blank\">MapTiler</a></li>\r\n                  <li><strong>Weather Stations:</strong> <a href=\"https://github.com/winds-mobi\" target=\"_blank\">winds.mobi</a> by Yann Savary and additional data sources</li>\r\n                  <li><strong>Airspaces & Obstacles:</strong> <a href=\"https://xcontest.org\" target=\"_blank\">XContest</a>, <a href=\"https://openaip.net\" target=\"_blank\">OpenAIP</a></li>\r\n                  <li><strong>Take-off and Landing Spots:</strong>  <a href=\"https://paraglidingspots.com\" target=\"_blank\">paraglidingspots.com</a> by Karsten Ehlers</li>\r\n                  <li><strong>Rain Viewer:</strong> <a href=\"https://www.rainviewer.com\" target=\"_blank\">rainviewer</a></li>\r\n                  <li><strong>Thermals:</strong> <a href=\"https://thermal.kk7.ch\" target=\"_blank\">thermal.kk7</a> by Michi von Knel</li>\r\n                  <li>and many more open source libraries, projects, and artwork</li>\r\n                </ul>\r\n\r\n                <h3>License and Code</h3>\r\n                <p>As some integrations are licensed under CC BY-NC-SA 4.0, XCmaps applied the same level and is licensed under a <a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" target=\"_blank\">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License.</a></p>\r\n            `,\r\n            privacy: `\r\n                <h3>XCmaps Privacy Policy</h3>\r\n                <p>At XCmaps (referred to as \"we\", \"us\" or \"our\" in this policy), we understand the importance of protecting your personal data. This privacy policy explains how we collect, use, share and store information when you access our website at XCmaps.com, which is operated by us, and any other services provided by flyXC (collectively referred to as the \"Services\").</p>\r\n                <p>You acknowledge that this Privacy Policy is part of our Site Terms of Use, and by accessing or using our site, you agree to be bound by all of its terms and conditions. If you do not agree to these terms, please do not access or use this site.</p>\r\n                <p>We reserve the right to change this Privacy Policy at any time. Such changes, modifications, additions or deletions shall be effective immediately upon notice thereof, which may be given by means including, but not limited to issuing an email to the email address listed by registered users and posting the revised Policy on this page. You acknowledge and agree that it is your responsibility to maintain a valid email address as a registered user, review this site and this Policy periodically and to be aware of any modifications. Your continued use of the site after such modifications will constitute your: (a) acknowledgment of the modified Policy; and (b) agreement to abide and be bound by the modified Policy.</p>\r\n                <h4>1. Information We Collect</h4>\r\n                <p>We collect two types of information: Personal Data and Non-Personal Data.</p>\r\n                <p><strong>A) Personal Data:</strong> This includes data that can be used to directly or indirectly identify you, such as your name, location, email address, and other similar information. You are not required to provide the personal data that we have requested, but if you choose not to do so, in many cases we will not be able to provide you with our products or services, and/or respond to any queries or requests you may have.</p>\r\n                <p><strong>B) Non-Personal Data:</strong> This includes information that cannot identify a specific individual, such as browser types, operating systems, and the pages viewed while navigating through the Services. We collect this data using cookies and other similar technologies.</p>\r\n                <h4>2. How We Collect Information</h4>\r\n                <p>We may obtain Personal Data from you when you:</p>\r\n                <ul><li>Register on our website or application;</li><li>Submit an inquiry through the Services;</li><li>Communicate with us via email, phone, or other means</li></ul>\r\n                <p>We do not collect any Personally Identifiable Information about you unless you voluntarily provide it to us. You provide certain Personally Identifiable Information to us when you register your account.</p>\r\n                <p>We collect your registered tracker positions continuously and use that to display your position on the map for up to 48 hours. By signing up for XCmaps and registering your tracker devices, you acknowledge and agree that your tracker devices location will be displayed and viewable via our services.</p>\r\n                <p>For safety purpose, we keep an archive of the last 30 days for the live tracks. The archive is not publicly accessible.</p>\r\n                <p>We reserve the right to use any track uploaded on our services. i.e. to derive heat maps of thermal locations.</p>\r\n                <h4>3. How We Use Information</h4>\r\n                <p>We use your information to:</p>\r\n                <ul><li>Provide and improve our products and services;</li><li>Respond to requests, inquiries, and comments;</li><li>Analyze usage trends and preferences;</li><li>Comply with legal obligations;</li><li>Enforce our terms of service;</li><li>Protect the rights, property, or safety of XCmaps, our users, or others.</li></ul>\r\n                <h4>4. How We Share Information</h4>\r\n                <p>We may share your information:</p>\r\n                <ul><li>With third parties who provide services on our behalf;</li><li>In response to legal process;</li><li>To investigate suspected fraud or potential threats to the security of our Services;</li><li>In connection with an acquisition, merger, or sale of assets;</li><li>When we have your explicit consent.</li></ul>\r\n                <h4>5. How We Store Information</h4>\r\n                <p>We store your information on secure servers that are protected by appropriate physical, technical, and organizational measures designed to prevent unauthorized access, loss, misuse, disclosure, alteration, and destruction. However, no electronic transmission or storage of data is completely secure, so we cannot guarantee the absolute security of this information.</p>\r\n                <h4>6. Your Rights</h4>\r\n                <p>You have certain rights regarding your Personal Data, subject to local law. These include the right to request access, correction, erasure, restriction, portability, and objection to processing of your Personal Data. You can exercise these rights by contacting us using the details provided in this policy.</p>\r\n                <h4>7. Children's Privacy</h4>\r\n                <p>Our Services are not directed at children under 16 years old. If you learn that a child has provided us with their information without consent, please contact us immediately so we can take appropriate action.</p>\r\n                <h4>8. Changes to This Policy</h4>\r\n                <p>We may update our privacy policy from time to time. When we make significant changes, we will notify you by posting a notice on our website or through other communication channels. We encourage you to review this page periodically for the latest information on our privacy practices.</p>\r\n                <h4>9. Contact Information</h4>\r\n                <p>If you have any questions about this Privacy Policy, please contact us at: info@XCmaps.com</p>\r\n            `,\r\n            terms: `\r\n                <h3>XCmaps Terms and Conditions</h3>\r\n                <p>This website, XCmaps.com (the \"Website\"), provides various data sources for para- and hang-gliders, providing valuable insights for the community.</p>\r\n                <p>By using the Website, you agree to these terms and conditions (the \"Terms\") and acknowledge that they constitute a legally binding contract between you and XCmaps. If you do not agree to these Terms, please do not use the Website. We reserve the right to modify or update these Terms at any time without prior notice. Your continued use of the Website after any changes indicates your acceptance of the new terms and conditions. Therefore, we recommend that you review these Terms regularly for any changes.</p>\r\n\r\n                <h4>1. Purpose of the Website</h4>\r\n                <p>The purpose of the Website is to enhance safety and education in free flight sports such as paragliding and hang gliding. The Website provides users with access to various features, including:</p>\r\n                <ul>\r\n                  <li><strong>Weather Stations:</strong> Wind, Gusts, Direction, Temp and Camera if available</li>\r\n                  <li><strong>Rain Viewer:</strong> Radar and Satellite incl. forecast</li>\r\n                  <li><strong>Thermals:</strong> kk7 thermal map</li>\r\n                  <li><strong>Spots:</strong> Para- and Hangliding take-off and Landing Zones ( <a href=\"https://paraglidingspots.com\" target=\"_blank\">paraglidingspots.com</a>)</li>\r\n                  <li><strong>Airspaces:</strong> Xcontest Airspaces & Activations, filter for today and the next 6 days</li>\r\n                  <li><strong>Obstacles:</strong> OSM based obstacles from Xcontest</li>\r\n                </ul>\r\n\r\n                <h4>2. Data Collection and Use</h4>\r\n                <p>XCmaps does not collect data from its users.</p>\r\n                <p>XCmaps does not sell, rent, or otherwise share your personal information with any third parties, except as required by law or as necessary to protect the rights, property, or safety of XCmaps, its employees, users, or others. XCmaps may also disclose your data if it is involved in a merger, acquisition, or sale of all or part of its assets.</p>\r\n\r\n                <h4>3. Ownership and Intellectual Property Rights</h4>\r\n                <p>The Website, including but not limited to its design, layout, content, graphics, images, audio, video, and code, is owned by XCmaps and protected by copyright laws and international intellectual property rights. You may not reproduce, modify, distribute, sell, or otherwise use any part of the Website without the prior written consent of XCmaps.</p>\r\n\r\n                <h4>4. Disclaimer of Warranties and Liability</h4>\r\n                <p>The Website is provided \"as is\" and \"as available\". XCmaps disclaims all warranties, express or implied, including but not limited to warranties of merchantability, fitness for a particular purpose, title, non-infringement, and security. XCmaps does not guarantee that the Website will be error-free, uninterrupted, or accessible at all times. XCmaps is not responsible for any losses, damages, or expenses arising from your use of the Website, including but not limited to direct, indirect, special, incidental, consequential, or punitive damages. XCmaps also disclaims any liability for any actions taken by you or others based on the information provided by the Website, which may be inaccurate, incomplete, or outdated.</p>\r\n\r\n                <h4>5. Indemnification</h4>\r\n                <p>You agree to indemnify and hold harmless XCmaps, its officers, directors, employees, agents, licensors, and suppliers from any claims, actions, demands, liabilities, costs, damages, and expenses (including reasonable attorneys' fees) arising from your use of the Website or your violation of these Terms.</p>\r\n\r\n                <h4>6. Applicable Law and Dispute Resolution</h4>\r\n                <p>These Terms shall be governed by and construed in accordance with the laws of France, without giving effect to any principles of conflicts of law. Any disputes arising out of or in connection with these Terms or your use of the Website shall be subject to the exclusive jurisdiction of the courts of England and Wales.</p>\r\n\r\n                <h4>7. Entire Agreement</h4>\r\n                <p>These Terms constitute the entire agreement between you and XCmaps regarding your use of the Website and supersede any prior agreements, understandings, or representations, whether written or oral. If any provision of these Terms is found to be unenforceable or invalid, that provision shall be limited or eliminated to the minimum extent necessary so that these Terms shall otherwise remain in full force and effect and enforceable.</p>\r\n                <p>By using the Website, you acknowledge that you have read, understood, and agreed to these Terms. If you do not agree to these Terms, please do not use the Website.</p>\r\n            `\r\n        };\r\n\r\n        // --- Function to build the common content structure ---\r\n        function buildContentStructure() {\r\n            const structureContainer = L.DomUtil.create('div', 'info-popup-container');\r\n\r\n            headerDiv = L.DomUtil.create('div', 'info-popup-header', structureContainer); // Main header flex container\r\n\r\n            // Left side: Logo and Breadcrumbs\r\n            const headerLeft = L.DomUtil.create('div', 'info-popup-header-left', headerDiv);\r\n            const logoImg = L.DomUtil.create('img', 'info-popup-logo', headerLeft);\r\n            logoImg.src = 'assets/images/XCmapsLogo.png';\r\n            logoImg.alt = 'XCmaps Logo';\r\n            breadcrumbDiv = L.DomUtil.create('div', 'info-popup-breadcrumbs', headerLeft);\r\n\r\n            // Right side: Social Icons and Close Button\r\n            const headerRight = L.DomUtil.create('div', 'info-popup-header-right', headerDiv);\r\n\r\n            // Facebook Icon\r\n            const fbLink = L.DomUtil.create('a', 'social-icon', headerRight);\r\n            fbLink.href = 'https://facebook.com/xcmaps';\r\n            fbLink.target = '_blank'; // Open in new tab\r\n            const fbImg = L.DomUtil.create('img', '', fbLink);\r\n            fbImg.src = 'assets/images/facebook.png';\r\n            fbImg.alt = 'Facebook';\r\n\r\n            // GitHub Icon (Assuming no specific link for now)\r\n            const ghLink = L.DomUtil.create('a', 'social-icon', headerRight);\r\n            ghLink.href = 'https://github.com/XCmaps/XCmaps'; \r\n            ghLink.target = '_blank'; \r\n            const ghImg = L.DomUtil.create('img', '', ghLink);\r\n            ghImg.src = 'assets/images/github.svg';\r\n            ghImg.alt = 'GitHub';\r\n\r\n            // Close Button\r\n            const headerCloseButton = L.DomUtil.create('span', 'info-popup-close', headerRight);\r\n            headerCloseButton.innerHTML = '&times;';\r\n            // Listener added later depending on context\r\n            contentAreaDiv = L.DomUtil.create('div', 'info-popup-content', structureContainer);\r\n\r\n            // Footer (Fixed at bottom) - Comments Removed\r\n            footerDiv = L.DomUtil.create('div', 'info-popup-footer d-flex justify-content-between align-items-center', structureContainer);\r\n            footerDiv.innerHTML = `\r\n                <div class=\"footer-links\">\r\n                    <a href=\"#\" data-section=\"privacy\">Privacy Policy</a>\r\n                    <a href=\"#\" data-section=\"terms\">Terms and Conditions</a>\r\n                </div>\r\n                <div class=\"d-flex align-items-center\">\r\n                    <div id=\"info-feedback-message\" class=\"text-start\" style=\"margin-right: 10px;\"></div>\r\n                    <button class=\"btn btn-primary btn-sm me-2 info-popup-feedback-btn\">Feedback</button>\r\n                    <button class=\"btn btn-dark btn-sm info-popup-footer-close\">Close</button>\r\n                </div>\r\n            `;\r\n\r\n            updateView('home'); // Set initial content\r\n            L.DomEvent.on(structureContainer, 'click', handleContentClick); // Attach main delegated listener\r\n            return structureContainer;\r\n        }\r\n\r\n        // --- Modal Creation and Management ---\r\n        function ensureModalStructureExists() {\r\n            if (isModalStructureBuilt) return;\r\n            modalOverlay = L.DomUtil.create('div', 'info-modal-overlay', document.body);\r\n            modalOverlay.style.display = 'none';\r\n            modalContent = L.DomUtil.create('div', 'info-modal-content', modalOverlay);\r\n            const structure = buildContentStructure();\r\n            modalContent.appendChild(structure);\r\n            const headerCloseButton = modalContent.querySelector('.info-popup-close');\r\n            if (headerCloseButton) L.DomEvent.on(headerCloseButton, 'click', hideModal);\r\n            L.DomEvent.on(modalOverlay, 'click', (ev) => { if (ev.target === modalOverlay) hideModal(); });\r\n            isModalStructureBuilt = true;\r\n        }\r\n\r\n        function showModal() {\r\n            ensureModalStructureExists();\r\n            updateView('home');\r\n            if(modalOverlay) modalOverlay.style.display = 'flex';\r\n            if (map) {\r\n                map.dragging.disable(); map.touchZoom.disable(); map.doubleClickZoom.disable();\r\n                map.scrollWheelZoom.disable(); map.boxZoom.disable(); map.keyboard.disable();\r\n                if (map.tap) map.tap.disable();\r\n                L.DomUtil.addClass(map.getContainer(), 'modal-open');\r\n            }\r\n        }\r\n\r\n        function hideModal() {\r\n            cancelFeedback(false);\r\n            if (modalOverlay) modalOverlay.style.display = 'none';\r\n            if (map) {\r\n                map.dragging.enable(); map.touchZoom.enable(); map.doubleClickZoom.enable();\r\n                map.scrollWheelZoom.enable(); map.boxZoom.enable(); map.keyboard.enable();\r\n                if (map.tap) map.tap.enable();\r\n                 L.DomUtil.removeClass(map.getContainer(), 'modal-open');\r\n            }\r\n        }\r\n\r\n        // --- Fullscreen Trigger ---\r\n        function triggerFullscreen() {\r\n             const contentElement = buildContentStructure();\r\n             const tempPopup = L.popup({ className: 'info-popup', autoPan: false })\r\n             .setLatLng(map.getCenter())\r\n             .setContent(contentElement)\r\n             .openOn(map);\r\n        }\r\n\r\n        // --- Shared Update/Feedback/Cancel Logic ---\r\n        function updateView(sectionName) {\r\n            if (!contentAreaDiv || !breadcrumbDiv || !footerDiv) return;\r\n            cancelFeedback(false);\r\n            if (!popupSections[sectionName]) { console.error(\"Unknown section:\", sectionName); return; }\r\n            contentAreaDiv.innerHTML = popupSections[sectionName];\r\n             footerDiv.style.display = (sectionName === 'home') ? 'flex' : 'none';\r\n\r\n            breadcrumbDiv.innerHTML = '';\r\n            if (sectionName !== 'home') {\r\n                breadcrumbDiv.innerHTML = `<a href=\"#\" data-section=\"home\" class=\"breadcrumb-link\">Home</a> / `;\r\n                const currentPageSpan = L.DomUtil.create('span', 'breadcrumb-current', breadcrumbDiv);\r\n                if (sectionName === 'privacy') currentPageSpan.innerText = 'Privacy Policy';\r\n                else if (sectionName === 'terms') currentPageSpan.innerText = 'Terms and Conditions';\r\n            }\r\n            contentAreaDiv.scrollTop = 0;\r\n        }\r\n\r\n        function showFeebackForm() {\r\n             if (!contentAreaDiv || !footerDiv) return;\r\n             cancelFeedback(false);\r\n             const messageDiv = footerDiv.querySelector(\"#info-feedback-message\");\r\n             if (messageDiv) { messageDiv.textContent = \"\"; messageDiv.className = 'text-start'; }\r\n             footerDiv.style.display = \"none\";\r\n\r\n             const feedbackFormHtml = `\r\n                <div id=\"infoFeedbackFormHtml\" class=\"feedback-modal\">\r\n                    <h5>Feedback for XCmaps</h5>\r\n                     <form id=\"infoFeedbackForm\">\r\n                        <div class=\"form-group mb-2\">\r\n                            <label for=\"infoFeedbackText\">Feedback / Correction / Comment:</label>\r\n                            <textarea id=\"infoFeedbackText\" class=\"form-control\" required style=\"height: 100px;\"></textarea>\r\n                        </div>\r\n                        <div class=\"form-group mb-2\">\r\n                            <label>Upload Images (optional):</label>\r\n                            <div id=\"infoDropzoneFeedback\" class=\"dropzone mt-1 border-dashed rounded-2 min-h-0 dz-clickable\"></div>\r\n                        </div>\r\n                        <div class=\"form-group d-flex justify-content-between mb-2\">\r\n                            <div style=\"width: 48%;\">\r\n                                <label for=\"infoUserName\">Name:</label>\r\n                                <input type=\"text\" id=\"infoUserName\" class=\"form-control\" required>\r\n                            </div>\r\n                            <div style=\"width: 48%;\">\r\n                                <label for=\"infoUserEmail\">E-Mail:</label>\r\n                                <input type=\"email\" id=\"infoUserEmail\" class=\"form-control\" required>\r\n                                <small class=\"text-danger d-none\" id=\"infoEmailError\">Please enter a valid email address.</small>\r\n                            </div>\r\n                        </div>\r\n                        <button type=\"submit\" class=\"btn btn-sm btn-success me-2\">Submit</button>\r\n                        <button type=\"button\" class=\"btn btn-sm btn-secondary info-feedback-cancel-btn\">Cancel</button>\r\n                    </form>\r\n                </div>\r\n             `;\r\n             contentAreaDiv.insertAdjacentHTML(\"beforeend\", feedbackFormHtml);\r\n             currentFeedbackForm = contentAreaDiv.querySelector(\"#infoFeedbackFormHtml\");\r\n\r\n             try {\r\n                feedbackDropzone = new Dropzone(\"#infoDropzoneFeedback\", {\r\n                    url: \"/api/send-feedback\", autoProcessQueue: false, maxFiles: 5, maxFilesize: 10,\r\n                    acceptedFiles: \"image/*\", addRemoveLinks: true, dictDefaultMessage: \"Drop files or click here\", clickable: true,\r\n                    init: function() { /* Optional event handlers */ }\r\n                });\r\n             } catch (err) { console.error(\"Dropzone init failed.\", err); /* ... error display ... */ }\r\n\r\n             const formElement = currentFeedbackForm?.querySelector(\"#infoFeedbackForm\");\r\n             const cancelButton = currentFeedbackForm?.querySelector(\".info-feedback-cancel-btn\");\r\n             const emailInput = currentFeedbackForm?.querySelector(\"#infoUserEmail\");\r\n\r\n             if (formElement) formElement.addEventListener(\"submit\", handleFeedbackSubmit);\r\n             if (cancelButton) cancelButton.addEventListener(\"click\", () => cancelFeedback(true));\r\n             if (emailInput) {\r\n                 emailInput.addEventListener(\"input\", function() {\r\n                     const isValid = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(this.value);\r\n                     const errorMsg = currentFeedbackForm?.querySelector(\"#infoEmailError\");\r\n                     if (errorMsg) errorMsg.classList.toggle(\"d-none\", isValid);\r\n                 });\r\n             }\r\n\r\n             contentAreaDiv.scrollTop = contentAreaDiv.scrollHeight;\r\n        }\r\n\r\n        async function handleFeedbackSubmit(event) {\r\n             if (!footerDiv) return;\r\n             event.preventDefault();\r\n             if (!currentFeedbackForm) return;\r\n             const formData = new FormData();\r\n             formData.append(\"subject\", \"General XCmaps Info Feedback\");\r\n             formData.append(\"feedbackText\", currentFeedbackForm.querySelector(\"#infoFeedbackText\").value);\r\n             formData.append(\"userName\", currentFeedbackForm.querySelector(\"#infoUserName\").value);\r\n             formData.append(\"userEmail\", currentFeedbackForm.querySelector(\"#infoUserEmail\").value);\r\n             if (feedbackDropzone) {\r\n                 feedbackDropzone.files.forEach(file => {\r\n                     if (file.status === Dropzone.ADDED || file.status === Dropzone.QUEUED) {\r\n                          formData.append(\"images\", file);\r\n                     }\r\n                 });\r\n             }\r\n             try {\r\n                 const response = await fetch(`/api/send-feedback`, { method: \"POST\", body: formData });\r\n                 const result = await response.json();\r\n                 cancelFeedback(false); // Clean form\r\n                 const messageDiv = footerDiv.querySelector(\"#info-feedback-message\");\r\n                 if (messageDiv) {\r\n                      messageDiv.textContent = result.success ? (result.message || \"Feedback submitted!\") : (result.error || \"Submission error.\");\r\n                      messageDiv.className = result.success ? 'text-start text-success' : 'text-start text-danger';\r\n                 }\r\n                 // Only show footer if we are on home view after submit\r\n                 if (!breadcrumbDiv || breadcrumbDiv.innerHTML === '') {\r\n                    footerDiv.style.display = \"flex\";\r\n                 }\r\n             } catch (error) {\r\n                 console.error(\"Submission error:\", error);\r\n                 cancelFeedback(true); // Clean form, show footer (if home)\r\n                 const messageDiv = footerDiv.querySelector(\"#info-feedback-message\");\r\n                  if (messageDiv) {\r\n                      messageDiv.textContent = \"Network error during submission.\";\r\n                      messageDiv.className = 'text-start text-danger';\r\n                  }\r\n             }\r\n        }\r\n\r\n        function cancelFeedback(restoreFooter = true) {\r\n             if (!contentAreaDiv) return;\r\n             const formToRemove = contentAreaDiv.querySelector(\"#infoFeedbackFormHtml\");\r\n             if (formToRemove) formToRemove.remove();\r\n             currentFeedbackForm = null;\r\n\r\n             if (feedbackDropzone) {\r\n                 if (typeof feedbackDropzone.destroy === 'function') feedbackDropzone.destroy();\r\n                 feedbackDropzone = null;\r\n             }\r\n             if (restoreFooter && footerDiv) {\r\n                 const messageDiv = footerDiv.querySelector(\"#info-feedback-message\");\r\n                 if(messageDiv) messageDiv.textContent = \"\";\r\n                 // Only show footer if we are on the home section\r\n                 if (!breadcrumbDiv || breadcrumbDiv.innerHTML === '') {\r\n                    footerDiv.style.display = \"flex\";\r\n                 } else {\r\n                    footerDiv.style.display = \"none\";\r\n                 }\r\n             }\r\n        }\r\n\r\n         // --- Delegated Click Handler ---\r\n         function handleContentClick(ev) {\r\n             let target = ev.target;\r\n             // Footer close\r\n             if (footerDiv && footerDiv.contains(target) && target.classList.contains('info-popup-footer-close')) {\r\n                 L.DomEvent.stopPropagation(ev);\r\n                 if (modalOverlay && modalOverlay.style.display !== 'none') hideModal();\r\n                 else if (typeof window.closeFullscreenInfo === 'function') {\r\n                     const fsInfo = document.getElementById('fullScreenInfo');\r\n                     if (fsInfo && fsInfo.classList.contains('visible')) window.closeFullscreenInfo();\r\n                 }\r\n                 return;\r\n             }\r\n             // Feedback button\r\n             if (footerDiv && footerDiv.contains(target) && target.classList.contains('info-popup-feedback-btn')) {\r\n                  L.DomEvent.stopPropagation(ev); showFeebackForm(); return;\r\n             }\r\n             // Navigation links (includes footer links)\r\n             let depth = 0; let navTarget = target;\r\n             while (navTarget && navTarget !== ev.currentTarget && !navTarget.dataset.section && depth < 3) {\r\n                 navTarget = navTarget.parentNode; depth++;\r\n             }\r\n             if (navTarget && navTarget.dataset.section) {\r\n                 L.DomEvent.preventDefault(ev); L.DomEvent.stopPropagation(ev);\r\n                 updateView(navTarget.dataset.section);\r\n             }\r\n         }\r\n\r\n\r\n        // --- Map Button Click Handler ---\r\n        L.DomEvent.on(link, 'click', function(ev) {\r\n            L.DomEvent.stop(ev);\r\n            const screenWidthThreshold = 768;\r\n            // Close any open instance first\r\n            if (modalOverlay && modalOverlay.style.display !== 'none') { hideModal(); return; }\r\n            const fsInfo = document.getElementById('fullScreenInfo');\r\n            const fsContent = fsInfo?.querySelector('.info-popup-container');\r\n            if (fsInfo && fsInfo.classList.contains('visible') && fsContent) {\r\n                 if (typeof window.closeFullscreenInfo === 'function') window.closeFullscreenInfo();\r\n                 return;\r\n            }\r\n            // Decide how to open\r\n            if (window.innerWidth < screenWidthThreshold) triggerFullscreen();\r\n            else showModal();\r\n        });\r\n\r\n        // --- Cleanup ---\r\n        container.onRemove = function() {\r\n             if (modalOverlay) { modalOverlay.remove(); modalOverlay = null; isModalStructureBuilt = false; }\r\n             if (map) { L.DomUtil.removeClass(map.getContainer(), 'modal-open'); /* ... enable map ... */ }\r\n        };\r\n\r\n        return container;\r\n    },\r\n});\r\nexport default InfoControl;\r\n","// airspaces.js\r\n// Store the airspace click handler as a module-level variable so we can reference it later\r\nlet airspaceClickHandler = null;\r\n\r\nfunction fetchAirspacesGliding() {\r\n  // Make sure map is available\r\n  if (!window.map) {\r\n    console.error(\"Map not initialized yet\");\r\n    return;\r\n  }\r\n  \r\n  const center = window.map.getCenter();\r\n  const lat = center.lat.toFixed(6);\r\n  const lng = center.lng.toFixed(6);\r\n  const types = [21];\r\n\r\n  const apiUrl = `${process.env.APP_DOMAIN}/api/airspaces?lat=${lat}&lng=${lng}&dist=200000&types=${encodeURIComponent(types.join(','))}`;\r\n\r\n  fetch(apiUrl)\r\n    .then(response => response.json())\r\n    .then(data => {\r\n      // Clear existing layers\r\n      window.airspaceGliding.clearLayers();\r\n\r\n      const airspaces = []; // Store polygons and data for later use\r\n\r\n      data.items.forEach(airspace => {\r\n        if (airspace.type === 0 && airspace.icaoClass === 4) {\r\n          return;\r\n        }\r\n\r\n        if (airspace.geometry && airspace.geometry.type === \"Polygon\") {\r\n          const coordinates = airspace.geometry.coordinates[0].map(coord => [coord[1], coord[0]]);\r\n\r\n          const lowerLimit = airspace.lowerLimit.value;\r\n          const color = lowerLimit === 0 ? \"red\" : \"green\";\r\n\r\n          const airspaceTypeText = airspaceTypes[airspace.type] || \"Unknown\";\r\n          const icaoClassText = icaoClasses[airspace.icaoClass] || \"Unknown\";\r\n\r\n          const polygon = L.polygon(coordinates, {\r\n            color: color,\r\n            weight: 2,\r\n            fillOpacity: 0.3\r\n          });\r\n\r\n          // Store airspace data with its polygon\r\n          airspaces.push({ polygon, data: airspace });\r\n\r\n          window.airspaceGliding.addLayer(polygon);\r\n        }\r\n      });\r\n\r\n      console.log(`Added ${airspaces.length} airspaces to the map`);\r\n\r\n      // Remove any existing click listeners to avoid duplicates\r\n      if (airspaceClickHandler) {\r\n        window.map.off(\"click\", airspaceClickHandler);\r\n      }\r\n\r\n      // Create a new click handler that captures the airspaces in its closure\r\n      airspaceClickHandler = function(e) {\r\n        // Check if the airspace layer is actually visible before processing clicks\r\n        if (!window.map.hasLayer(window.airspaceGliding)) {\r\n          return; // Exit if airspace layer is not visible\r\n        }\r\n\r\n        const clickedPoint = e.latlng;\r\n        const overlappingAirspaces = [];\r\n\r\n        airspaces.forEach(({ polygon, data }) => {\r\n          if (polygon.getBounds().contains(clickedPoint)) {\r\n            overlappingAirspaces.push(data);\r\n          }\r\n        });\r\n\r\n        if (overlappingAirspaces.length > 0) {\r\n          const popupContent = overlappingAirspaces.map(a => `\r\n            <b>${a.name}</b><br>\r\n            Type: ${airspaceTypes[a.type] || \"Unknown\"}<br>\r\n            ICAO Class: ${icaoClasses[a.icaoClass] || \"Unknown\"}<br>\r\n            ${a.lowerLimit.value} ${getUnit(a.lowerLimit.unit)}  ${a.upperLimit.value} ${getUnit(a.upperLimit.unit)}<br>\r\n          `).join(\"<hr>\");\r\n\r\n          L.popup()\r\n            .setLatLng(clickedPoint)\r\n            .setContent(popupContent)\r\n            .openOn(window.map);\r\n        }\r\n      };\r\n      \r\n      // Add the new click handler\r\n      window.map.on(\"click\", airspaceClickHandler);\r\n    })\r\n    .catch(error => console.error(\"Error fetching airspaces:\", error));\r\n}\r\n\r\n// Lookup tables for airspace type and ICAO class\r\n\r\nconst airspaceTypes = {\r\n  0: \"Other\",\r\n  1: \"Restricted\",\r\n  2: \"Danger (D)\",\r\n  3: \"Prohibited (Parc reserve)\",\r\n  4: \"Controlled Tower Region (CTR)\",\r\n  5: \"Transponder Mandatory Zone (TMZ)\",\r\n  6: \"Radio Mandatory Zone (RMZ)\",\r\n  7: \"Terminal Maneuvering Area (TMA)\",\r\n  8: \"Temporary Reserved Area (TRA)\",\r\n  9: \"Temporary Segregated Area (TSA)\",\r\n  10: \"Flight Information Region (FIR)\",\r\n  11: \"Upper Flight Information Region (UIR)\",\r\n  12: \"Air Defense Identification Zone (ADIZ)\",\r\n  13: \"Airport Traffic Zone (ATZ)\",\r\n  14: \"Military Airport Traffic Zone (MATZ)\",\r\n  15: \"Airway\",\r\n  16: \"Military Training Route (MTR)\",\r\n  17: \"Alert Area\",\r\n  18: \"Warning Area\",\r\n  19: \"Protected Area\",\r\n  20: \"Helicopter Traffic Zone (HTZ)\",\r\n  21: \"Gliding Sector\",\r\n  22: \"Transponder Setting (TRP)\",\r\n  23: \"Traffic Information Zone (TIZ)\",\r\n  24: \"Traffic Information Area (TIA)\",\r\n  25: \"Military Training Area (MTA)\",\r\n  26: \"Control Area (CTA)\",\r\n  27: \"ACC Sector (ACC)\",\r\n  28: \"Aerial Sporting Or Recreational Activity\",\r\n  29: \"Low Altitude Overflight Restriction\",\r\n  30: \"Military Route (MRT)\",\r\n  31: \"TSA/TRA Feeding Route (TFR)\",\r\n  32: \"VFR Sector\",\r\n  33: \"FIS Sector\",\r\n  34: \"Lower Traffic Area (LTA)\",\r\n  35: \"Upper Traffic Area (UTA)\"\r\n};\r\n\r\nconst icaoClasses = {\r\n  0: \"A\",\r\n  1: \"B\",\r\n  2: \"C\",\r\n  3: \"D\",\r\n  4: \"E\",\r\n  5: \"F\",\r\n  6: \"G\",\r\n  8: \"Special Use Airspace (SUA)\"\r\n};\r\n\r\nfunction getUnit(unitCode) {\r\n  const units = {\r\n    1: \"ft\", // Feet\r\n    6: \"FL\"  // Flight Level\r\n  };\r\n  return units[unitCode] || \"Unknown\";\r\n}\r\n\r\n\r\n// Export the fetchAirspacesGliding function to make it globally available\r\nwindow.fetchAirspacesGliding = fetchAirspacesGliding;\r\n\r\n// Listen for map layer visibility changes\r\ndocument.addEventListener('map_initialized', function() {\r\n  console.log(\"Setting up airspace layer events\");\r\n  \r\n  // Add event listener for when the airspace layer is added to the map\r\n  window.map.on('overlayadd', function(e) {\r\n    if (e.name === 'Airspaces' || e.name === 'Gliding' || e.name === 'Notam') {\r\n      console.log(`Overlay added: ${e.name}, fetching airspaces`);\r\n      fetchAirspacesGliding();\r\n    }\r\n  });\r\n  \r\n  // Also set up the moveend event to refresh airspaces when panning/zooming\r\n  window.map.on('moveend', function() {\r\n    // Only fetch if the layer is currently visible\r\n    if (window.map.hasLayer(window.airspaceGliding)) {\r\n      console.log(\"Map moved, refreshing airspaces\");\r\n      fetchAirspacesGliding();\r\n    }\r\n  });\r\n});\r\n\r\n// Don't auto-fetch on script load - wait for the layer to be enabled\r\n// Remove or comment out: fetchAirspacesGliding();","// airspaces.js\r\n// Store the airspace click handler as a module-level variable so we can reference it later\r\nlet airspaceClickHandler = null;\r\n\r\nfunction fetchAirspacesNotam() {\r\n  // Make sure map is available\r\n  if (!window.map) {\r\n    console.error(\"Map not initialized yet\");\r\n    return;\r\n  }\r\n  \r\n  const center = window.map.getCenter();\r\n  const lat = center.lat.toFixed(6);\r\n  const lng = center.lng.toFixed(6);\r\n  const types = [8, 9];\r\n\r\n  const apiUrl = `${process.env.APP_DOMAIN}/api/airspaces?lat=${lat}&lng=${lng}&dist=200000&types=${encodeURIComponent(types.join(','))}`;\r\n\r\n  fetch(apiUrl)\r\n    .then(response => response.json())\r\n    .then(data => {\r\n      // Clear existing layers\r\n      window.airspaceNotam.clearLayers();\r\n\r\n      const airspaces = []; // Store polygons and data for later use\r\n\r\n      data.items.forEach(airspace => {\r\n        if (airspace.type === 0 && airspace.icaoClass === 4) {\r\n          return;\r\n        }\r\n\r\n        if (airspace.geometry && airspace.geometry.type === \"Polygon\") {\r\n          const coordinates = airspace.geometry.coordinates[0].map(coord => [coord[1], coord[0]]);\r\n\r\n          const lowerLimit = airspace.lowerLimit.value;\r\n          const color = lowerLimit === 0 ? \"red\" : \"blue\";\r\n\r\n          const airspaceTypeText = airspaceTypes[airspace.type] || \"Unknown\";\r\n          const icaoClassText = icaoClasses[airspace.icaoClass] || \"Unknown\";\r\n\r\n          const polygon = L.polygon(coordinates, {\r\n            color: color,\r\n            weight: 2,\r\n            fillOpacity: 0.3\r\n          });\r\n\r\n          // Store airspace data with its polygon\r\n          airspaces.push({ polygon, data: airspace });\r\n\r\n          window.airspaceNotam.addLayer(polygon);\r\n        }\r\n      });\r\n\r\n      console.log(`Added ${airspaces.length} airspaces to the map`);\r\n\r\n      // Remove any existing click listeners to avoid duplicates\r\n      if (airspaceClickHandler) {\r\n        window.map.off(\"click\", airspaceClickHandler);\r\n      }\r\n\r\n      // Create a new click handler that captures the airspaces in its closure\r\n      airspaceClickHandler = function(e) {\r\n        // Check if the airspace layer is actually visible before processing clicks\r\n        if (!window.map.hasLayer(window.airspaceNotam)) {\r\n          return; // Exit if airspace layer is not visible\r\n        }\r\n\r\n        const clickedPoint = e.latlng;\r\n        const overlappingAirspaces = [];\r\n\r\n        airspaces.forEach(({ polygon, data }) => {\r\n          if (polygon.getBounds().contains(clickedPoint)) {\r\n            overlappingAirspaces.push(data);\r\n          }\r\n        });\r\n\r\n        if (overlappingAirspaces.length > 0) {\r\n          const popupContent = overlappingAirspaces.map(a => `\r\n            <b>${a.name}</b><br>\r\n            Type: ${airspaceTypes[a.type] || \"Unknown\"}<br>\r\n            ICAO Class: ${icaoClasses[a.icaoClass] || \"Unknown\"}<br>\r\n            ${a.lowerLimit.value} ${getUnit(a.lowerLimit.unit)}  ${a.upperLimit.value} ${getUnit(a.upperLimit.unit)}<br>\r\n          `).join(\"<hr>\");\r\n\r\n          L.popup()\r\n            .setLatLng(clickedPoint)\r\n            .setContent(popupContent)\r\n            .openOn(window.map);\r\n        }\r\n      };\r\n      \r\n      // Add the new click handler\r\n      window.map.on(\"click\", airspaceClickHandler);\r\n    })\r\n    .catch(error => console.error(\"Error fetching airspaces:\", error));\r\n}\r\n\r\n// Lookup tables for airspace type and ICAO class\r\n\r\nconst airspaceTypes = {\r\n  0: \"Other\",\r\n  1: \"Restricted\",\r\n  2: \"Danger (D)\",\r\n  3: \"Prohibited (Parc reserve)\",\r\n  4: \"Controlled Tower Region (CTR)\",\r\n  5: \"Transponder Mandatory Zone (TMZ)\",\r\n  6: \"Radio Mandatory Zone (RMZ)\",\r\n  7: \"Terminal Maneuvering Area (TMA)\",\r\n  8: \"Temporary Reserved Area (TRA)\",\r\n  9: \"Temporary Segregated Area (TSA)\",\r\n  10: \"Flight Information Region (FIR)\",\r\n  11: \"Upper Flight Information Region (UIR)\",\r\n  12: \"Air Defense Identification Zone (ADIZ)\",\r\n  13: \"Airport Traffic Zone (ATZ)\",\r\n  14: \"Military Airport Traffic Zone (MATZ)\",\r\n  15: \"Airway\",\r\n  16: \"Military Training Route (MTR)\",\r\n  17: \"Alert Area\",\r\n  18: \"Warning Area\",\r\n  19: \"Protected Area\",\r\n  20: \"Helicopter Traffic Zone (HTZ)\",\r\n  21: \"Gliding Sector\",\r\n  22: \"Transponder Setting (TRP)\",\r\n  23: \"Traffic Information Zone (TIZ)\",\r\n  24: \"Traffic Information Area (TIA)\",\r\n  25: \"Military Training Area (MTA)\",\r\n  26: \"Control Area (CTA)\",\r\n  27: \"ACC Sector (ACC)\",\r\n  28: \"Aerial Sporting Or Recreational Activity\",\r\n  29: \"Low Altitude Overflight Restriction\",\r\n  30: \"Military Route (MRT)\",\r\n  31: \"TSA/TRA Feeding Route (TFR)\",\r\n  32: \"VFR Sector\",\r\n  33: \"FIS Sector\",\r\n  34: \"Lower Traffic Area (LTA)\",\r\n  35: \"Upper Traffic Area (UTA)\"\r\n};\r\n\r\nconst icaoClasses = {\r\n  0: \"A\",\r\n  1: \"B\",\r\n  2: \"C\",\r\n  3: \"D\",\r\n  4: \"E\",\r\n  5: \"F\",\r\n  6: \"G\",\r\n  8: \"Special Use Airspace (SUA)\"\r\n};\r\n\r\nfunction getUnit(unitCode) {\r\n  const units = {\r\n    1: \"ft\", // Feet\r\n    6: \"FL\"  // Flight Level\r\n  };\r\n  return units[unitCode] || \"Unknown\";\r\n}\r\n\r\n\r\n// Export the fetchAirspacesNotam function to make it globally available\r\nwindow.fetchAirspacesNotam = fetchAirspacesNotam;\r\n\r\n// Listen for map layer visibility changes\r\ndocument.addEventListener('map_initialized', function() {\r\n  console.log(\"Setting up airspace layer events\");\r\n  \r\n  // Add event listener for when the airspace layer is added to the map\r\n  window.map.on('overlayadd', function(e) {\r\n    if (e.name === 'Airspaces' || e.name === 'Gliding' || e.name === 'Notam') {\r\n      console.log(`Overlay added: ${e.name}, fetching airspaces`);\r\n      fetchAirspacesNotam();\r\n    }\r\n  });\r\n  \r\n  // Also set up the moveend event to refresh airspaces when panning/zooming\r\n  window.map.on('moveend', function() {\r\n    // Only fetch if the layer is currently visible\r\n    if (window.map.hasLayer(window.airspaceNotam)) {\r\n      console.log(\"Map moved, refreshing airspaces\");\r\n      fetchAirspacesNotam();\r\n    }\r\n  });\r\n});\r\n\r\n// Don't auto-fetch on script load - wait for the layer to be enabled\r\n// Remove or comment out: fetchAirspacesNotam();","import moment from 'moment';\r\nimport 'moment-timezone';\r\nimport * as turf from '@turf/turf';\r\n\r\nlet airspacePopupOpenListener = null; // Listener for popupopen\r\nlet currentLowerLimit = 3000; // Default matches dropdown\r\nlet airspaceDebounceTimer;\r\nlet selectedDateStr = getCurrentDateStr(); // Store the selected date\r\n\r\n// Global array to store airspace data accessible by the popupopen listener\r\nlet allLoadedAirspaces = [];\r\n\r\n// Helper function to get current date string in YYYY-MM-DD format\r\nfunction getCurrentDateStr() {\r\n  const today = new Date();\r\n  return `${today.getFullYear()}-${(today.getMonth() + 1).toString().padStart(2, '0')}-${today.getDate().toString().padStart(2, '0')}`;\r\n}\r\n\r\n// Helper function to convert limit to meters\r\nfunction getLimitMeters(limit) {\r\n  if (!limit) return null;\r\n\r\n  switch (limit.type) {\r\n    case 'FL': return limit.height * 0.3048;\r\n    case 'AMSL': case 'AGL': return limit.height * 0.3048;\r\n    default: return null;\r\n  }\r\n}\r\n\r\n// Helper function to generate HTML for a single airspace's popup content\r\nfunction generateAirspacePopupHtml(a) { // 'a' represents the airspace data (feature.properties)\r\n  const tzName = moment.tz.guess();\r\n\r\n  let descriptionsHtml = '';\r\n  if (a.descriptions && Array.isArray(a.descriptions) && a.descriptions.length > 0) {\r\n    const formatDescription = (text) => {\r\n      if (!text) return '';\r\n      return text.replace(/([ABCDEFGQ]\\))/g, '<br>$1');\r\n    };\r\n    descriptionsHtml = `\r\n      <div class=\"airspace-descriptions\" style=\"font-size: 0.8em;\">\r\n          ${a.descriptions.map(desc => {\r\n            const formattedDesc = formatDescription(desc.airdescription || '');\r\n            return `${formattedDesc} ${desc.airlanguage ? `(${desc.airlanguage})` : ''}`;\r\n          }).join('')}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  let activationsHtml = '';\r\n  if (a.activations && Array.isArray(a.activations) && a.activations.length > 0) {\r\n    activationsHtml = `\r\n      <div class=\"airspace-activations\">\r\n        <b>Activations:</b><br>\r\n        ${a.activations.map(activation => {\r\n          const startMoment = moment.utc(activation[0]).tz(tzName);\r\n          const endMoment = moment.utc(activation[1]).tz(tzName);\r\n          return `${startMoment.format('MMM D, HH:mm z')} - ${endMoment.format('MMM D, HH:mm z')}`;\r\n        }).join('<br>')}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  const formatLimit = (limit, original) => {\r\n    if (!limit) return original || 'N/A';\r\n    const type = limit.type;\r\n    const height = limit.height;\r\n    if (type === 'FL') {\r\n      const meters = Math.round(height * 0.3048);\r\n      const flNumber = height / 100;\r\n      return `${meters}m (FL${flNumber})`;\r\n    } else if (type === 'AMSL' || type === 'AGL') {\r\n      const meters = Math.round(height * 0.3048);\r\n      return `${meters}m`;\r\n    } else {\r\n      return original || 'N/A';\r\n    }\r\n  };\r\n\r\n  const lower = formatLimit(a.airlower_j, a.lowerLimit);\r\n  const upper = formatLimit(a.airupper_j, a.upperLimit);\r\n\r\n  // Add timezone info like in the old code example\r\n  const tzAbbreviation = moment.tz(tzName).zoneAbbr();\r\n  const tzOffset = moment.tz(tzName).format('Z');\r\n\r\n  return `\r\n    <div class=\"airspace-detail\">\r\n      <b>${a.name} (${a.airspaceClass})</b><br>\r\n      <b> </b>${lower} - <b> </b>${upper}<br>\r\n      ${descriptionsHtml}\r\n      ${activationsHtml}\r\n    </div>\r\n  `;\r\n}\r\n\r\n\r\nfunction fetchAirspacesXC() {\r\n    if (!window.map) {\r\n      console.error(\"Map not initialized yet\");\r\n      return;\r\n    }\r\n\r\n    // --- Zoom Level Check ---\r\n    const currentZoom = window.map.getZoom();\r\n    const minZoomLevel = 5;\r\n    if (currentZoom < minZoomLevel) {\r\n        console.log(`[AirspaceXC] Zoom level ${currentZoom} is below minimum (${minZoomLevel}), clearing layer and skipping fetch.`);\r\n        if (window.airspaceXC) { // Ensure layer group exists before clearing\r\n            window.airspaceXC.clearLayers(); // Clear existing layers\r\n        }\r\n        allLoadedAirspaces = []; // Reset data\r\n        // No need to manage popup listener here, it's handled elsewhere or irrelevant if no data is loaded\r\n        return; // Exit *before* constructing URL or fetching\r\n    }\r\n    // --- End Zoom Level Check ---\r\n\r\n\r\n    const center = window.map.getCenter();\r\n    const lat = center.lat.toFixed(6);\r\n    const lng = center.lng.toFixed(6);\r\n    const bounds = window.map.getBounds();\r\n    const nw = bounds.getNorthWest();\r\n    const se = bounds.getSouthEast();\r\n    const dateStr = selectedDateStr;\r\n    const apiUrl = `/api/airspacesXCdb?startDate=${dateStr}&nw_lat=${nw.lat.toFixed(6)}&nw_lng=${nw.lng.toFixed(6)}&se_lat=${se.lat.toFixed(6)}&se_lng=${se.lng.toFixed(6)}`;\r\n\r\n    fetch(apiUrl)\r\n    .then(response => response.json())\r\n    .then(data => {\r\n        window.airspaceXC.clearLayers();\r\n        allLoadedAirspaces = []; // Reset global array\r\n\r\n        // Remove any existing popupopen listeners from the MAP\r\n        if (airspacePopupOpenListener) {\r\n          window.map.off(\"popupopen\", airspacePopupOpenListener); // Target MAP now\r\n          airspacePopupOpenListener = null;\r\n        }\r\n\r\n        // Redundant zoom check removed from here\r\n\r\n\r\n        const features = data.features || [];\r\n        const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\r\n        const selectedDateStartLocal = moment.tz(selectedDateStr, \"YYYY-MM-DD\", userTimezone).startOf('day');\r\n        const selectedDateStartUTC = selectedDateStartLocal.utc().toDate();\r\n\r\n        features.forEach(feature => {\r\n          if (feature.geometry && feature.geometry.type === \"Polygon\") {\r\n\r\n            // --- Filtering Logic (Unchanged) ---\r\n            if (feature.properties.name && feature.properties.name.startsWith(\"V00\")) return;\r\n            const lowerLimitMeters = getLimitMeters(feature.properties.airlower_j);\r\n            if (lowerLimitMeters === null || lowerLimitMeters > currentLowerLimit) return;\r\n            let isExpired = false;\r\n            if (feature.properties.descriptions && Array.isArray(feature.properties.descriptions)) {\r\n              for (const desc of feature.properties.descriptions) {\r\n                const description = desc.airdescription || '';\r\n                const cMatch = description.match(/C\\)\\s*(\\d{10})/);\r\n                if (cMatch && cMatch[1]) {\r\n                  try {\r\n                    const year = 2000 + parseInt(cMatch[1].substring(0, 2));\r\n                    const month = parseInt(cMatch[1].substring(2, 4)) - 1;\r\n                    const day = parseInt(cMatch[1].substring(4, 6));\r\n                    const hour = parseInt(cMatch[1].substring(6, 8));\r\n                    const minute = parseInt(cMatch[1].substring(8, 10));\r\n                    const expirationDate = new Date(Date.UTC(year, month, day, hour, minute));\r\n                    if (expirationDate < selectedDateStartUTC) { isExpired = true; break; }\r\n                  } catch (error) { console.error(\"Error parsing expiration date:\", error); }\r\n                }\r\n              }\r\n            }\r\n            if (isExpired) return;\r\n            let hasActiveActivation = false;\r\n            if (feature.properties.activations && Array.isArray(feature.properties.activations) && feature.properties.activations.length > 0) {\r\n              const selectedDateEndLocal = moment.tz(selectedDateStr, \"YYYY-MM-DD\", userTimezone).endOf('day');\r\n              const selectedDateEndUTC = selectedDateEndLocal.utc().toDate();\r\n              for (const activation of feature.properties.activations) {\r\n                const activationStart = new Date(activation[0]);\r\n                const activationEnd = new Date(activation[1]);\r\n                if (activationStart <= selectedDateEndUTC && activationEnd >= selectedDateStartUTC) { hasActiveActivation = true; break; }\r\n              }\r\n              if (!hasActiveActivation) return;\r\n            }\r\n            if (feature.properties.airspaceClass === \"R\") {\r\n              let hasExpirationDate = false;\r\n              if (feature.properties.descriptions && Array.isArray(feature.properties.descriptions)) {\r\n                for (const desc of feature.properties.descriptions) {\r\n                  if ((desc.airdescription || '').match(/C\\)\\s*(\\d{10})/)) { hasExpirationDate = true; break; }\r\n                }\r\n              }\r\n              if (!hasExpirationDate && !hasActiveActivation) return;\r\n            }\r\n            // --- End Filtering Logic ---\r\n\r\n            const coordinates = feature.geometry.coordinates[0].map(coord => [coord[1], coord[0]]);\r\n            const polygon = L.polygon(coordinates, {\r\n              color: feature.properties.strokeColor || \"blue\",\r\n              weight: feature.properties.strokeWeight || 2,\r\n              fillColor: feature.properties.fillColor || \"blue\",\r\n              fillOpacity: feature.properties.fillOpacity || 0.3\r\n            });\r\n\r\n            // *** Bind a SIMPLE initial popup content ***\r\n            polygon.bindPopup(`<b>${feature.properties.name}</b><br><i>Loading details...</i>`, {\r\n                 className: 'airspace-popup' // Keep class\r\n            });\r\n\r\n            // Store polygon, data, and geometry globally\r\n            allLoadedAirspaces.push({\r\n              polygon, // Keep reference to layer\r\n              data: feature.properties,\r\n              geometry: feature.geometry\r\n            });\r\n            window.airspaceXC.addLayer(polygon);\r\n          }\r\n        });\r\n\r\n        // Define the popupopen listener function\r\n        airspacePopupOpenListener = function(e) {\r\n          // console.log('[AirspaceXC popupopen Listener - Attempt 13] Fired for layer:', e.layer); // DEBUG REMOVED\r\n\r\n          const popup = e.popup;\r\n          // Check if this is one of our airspaces popups before proceeding\r\n          if (!popup || !popup.options || !popup.options.className || !popup.options.className.includes('airspace-popup')) {\r\n              // console.log('[AirspaceXC popupopen Listener - Attempt 14] Ignoring popup without airspace-popup class.'); // DEBUG REMOVED\r\n              return;\r\n          }\r\n\r\n          const openedLayer = e.layer; // We know it's an airspace popup now\r\n          const latlng = popup.getLatLng();\r\n\r\n          if (!latlng) {\r\n              // console.log('[AirspaceXC popupopen Listener - Attempt 13] No LatLng found on popup.'); // DEBUG REMOVED\r\n              return;\r\n          }\r\n          // console.log('[AirspaceXC popupopen Listener - Attempt 13] Popup LatLng:', latlng); // DEBUG REMOVED\r\n\r\n          const overlappingAirspacesData = [];\r\n          const pt = turf.point([latlng.lng, latlng.lat]);\r\n\r\n          // console.log('[AirspaceXC popupopen Listener - Attempt 13] Checking overlaps in allLoadedAirspaces (count:', allLoadedAirspaces.length, ')'); // DEBUG REMOVED\r\n\r\n          // Find overlapping airspaces using the globally stored data\r\n          allLoadedAirspaces.forEach(({ data, geometry }, index) => {\r\n            try {\r\n              const poly = turf.polygon(geometry.coordinates);\r\n              if (turf.booleanPointInPolygon(pt, poly)) {\r\n                // console.log(`[AirspaceXC popupopen Listener - Attempt 13] Overlap found with airspace index ${index}:`, data.name); // DEBUG REMOVED\r\n                overlappingAirspacesData.push(data);\r\n              }\r\n            } catch (error) {\r\n              console.error(`[AirspaceXC] Error checking point in polygon for index ${index}:`, error); // Keep error log, remove debug marker\r\n            }\r\n          });\r\n\r\n          // console.log(`[AirspaceXC popupopen Listener - Attempt 13] Found ${overlappingAirspacesData.length} total overlaps.`); // DEBUG REMOVED\r\n          // Log the names for easier debugging\r\n          // console.log('[AirspaceXC popupopen Listener - Attempt 13] Overlapping names:', overlappingAirspacesData.map(d => d.name)); // DEBUG REMOVED\r\n\r\n          if (overlappingAirspacesData.length > 0) {\r\n              // Generate combined HTML content\r\n              const combinedHtml = overlappingAirspacesData\r\n                  .map(data => generateAirspacePopupHtml(data)) // Use helper for each\r\n                  .join(\"<hr style='margin: 5px 0; border-top: 1px solid #ccc;'>\"); // Join with separator\r\n\r\n              // Update the content of the popup that just opened\r\n              // console.log('[AirspaceXC popupopen Listener - Attempt 13] Updating popup content.'); // DEBUG REMOVED\r\n              // console.log('[AirspaceXC popupopen Listener - Attempt 13] Combined HTML:', combinedHtml); // DEBUG (potentially very long)\r\n              popup.setContent(combinedHtml);\r\n\r\n          } else {\r\n              // console.log('[AirspaceXC popupopen Listener - Attempt 13] No overlaps found, setting default content.'); // DEBUG REMOVED\r\n              // Fallback: Set content to just the opened layer's default\r\n              const openedLayerEntry = allLoadedAirspaces.find(entry => entry.polygon === openedLayer);\r\n              if (openedLayerEntry) {\r\n                 popup.setContent(generateAirspacePopupHtml(openedLayerEntry.data));\r\n              } else {\r\n                 console.error('[AirspaceXC popupopen Listener - Attempt 13] Could not find data for the opened layer!'); // DEBUG\r\n                 popup.setContent(\"Error: Could not find airspace details.\");\r\n              }\r\n          }\r\n        };\r\n\r\n        // Add the popupopen listener to the MAP\r\n        window.map.on(\"popupopen\", airspacePopupOpenListener); // Target MAP now\r\n        console.log(\"[AirspaceXC] popupopen listener attached to MAP.\"); // INFO\r\n      })\r\n      .catch(error => console.error(\"Error fetching airspaces:\", error));\r\n}\r\n\r\n\r\ndocument.addEventListener('change', function(e) {\r\n    //close open popups\r\n    if (e.target && (e.target.id === 'airspaceLowerLimit' || e.target.id === 'airspaceTime')) {\r\n      if (window.map && window.map._popup) {\r\n        window.map.closePopup();\r\n      }\r\n    }\r\n    // Handle airspaceLowerLimit changes\r\n    if (e.target && e.target.id === 'airspaceLowerLimit') {\r\n        const newLimit = parseInt(e.target.value, 10);\r\n        if (newLimit !== currentLowerLimit) {\r\n            currentLowerLimit = newLimit;\r\n            clearTimeout(airspaceDebounceTimer);\r\n            airspaceDebounceTimer = setTimeout(() => {\r\n                if (window.map.hasLayer(window.airspaceXC)) {\r\n                    fetchAirspacesXC();\r\n                }\r\n            }, 300);\r\n        }\r\n    }\r\n    // Handle date selection changes\r\n    if (e.target && e.target.id === 'airspaceTime') {\r\n      const newDate = e.target.value;\r\n      if (newDate !== selectedDateStr) {\r\n        selectedDateStr = newDate;\r\n        clearTimeout(airspaceDebounceTimer);\r\n        airspaceDebounceTimer = setTimeout(() => {\r\n          if (window.map.hasLayer(window.airspaceXC)) {\r\n            fetchAirspacesXC();\r\n          }\r\n        }, 300);\r\n      }\r\n    }\r\n});\r\n\r\nfunction initializeAirspaceXCMapListeners(mapInstance) {\r\n    if (mapInstance) {\r\n        mapInstance.on('zoomend', function() {\r\n            // Check if the airspaceXC layer is currently supposed to be visible\r\n            // Ensure window.airspaceXC exists before checking hasLayer\r\n            if (window.airspaceXC && mapInstance.hasLayer(window.airspaceXC)) {\r\n                console.log(\"[AirspaceXC] Map zoom ended, re-fetching airspaces based on new zoom level.\");\r\n                // Use a small debounce to avoid rapid calls if zoom changes quickly\r\n                clearTimeout(airspaceDebounceTimer);\r\n                airspaceDebounceTimer = setTimeout(() => {\r\n                    // Pass mapInstance to fetch function if it needs it,\r\n                    // otherwise ensure fetchAirspacesXC uses the correct map reference\r\n                    // (Assuming fetchAirspacesXC still relies on window.map internally for now)\r\n                    fetchAirspacesXC();\r\n                }, 150); // Shorter delay for zoom\r\n            }\r\n        });\r\n        console.log(\"[AirspaceXC] zoomend listener attached to map.\");\r\n\r\n        // Also attach the popup listener here, ensuring it uses the correct map instance\r\n        // Remove the old listener attachment from fetchAirspacesXC if it's still there\r\n        mapInstance.on(\"popupopen\", airspacePopupOpenListener);\r\n        console.log(\"[AirspaceXC] popupopen listener attached to MAP via initializer.\");\r\n\r\n    } else {\r\n        console.error(\"[AirspaceXC] Invalid map instance provided to initializeAirspaceXCMapListeners.\");\r\n    }\r\n}\r\n\r\n// Export the initializer and the fetch function\r\nexport { fetchAirspacesXC, initializeAirspaceXCMapListeners };\r\n\r\n// Keep global assignment for potential legacy compatibility, though ideally refactor away\r\nwindow.fetchAirspacesXC = fetchAirspacesXC;\r\n","// spotsHelper.js - Common functionality for loading and displaying spots on a map\r\n\r\n// Module-scoped variable to track Dropzone instance\r\nlet feedbackDropzone = null;\r\nlet currentFeedbackForm = null;\r\n\r\n// Swiper related functions\r\nfunction changeSwiper() {\r\n    if (typeof swiperc !== \"undefined\") {\r\n        $(\".swiper2\").removeClass(\"swiper-small swiper-medium swiper-large\"); // Remove all classes first\r\n        if (window.innerWidth < 576) {\r\n            $(\".swiper2\").addClass(\"swiper-small\");\r\n            swiperc.changeDirection('horizontal', true);\r\n        }\r\n        else {\r\n            if (window.innerWidth < 840) {\r\n                $(\".swiper2\").addClass(\"swiper-medium\");\r\n            }\r\n            else {\r\n                $(\".swiper2\").addClass(\"swiper-large\");\r\n            }\r\n            swiperc.changeDirection('vertical', true);\r\n        }\r\n    }\r\n}\r\n\r\nfunction initSwiper(idImg) {\r\n    let swiperv, swiperc;\r\n    // USED 09/24 Beschreibung: Initialisierung der Image-Swiper\r\n    var swiperLoop3 = (idImg < 4) ? false : true;\r\n    var swiperLoop4 = (idImg < 5) ? false : true;\r\n\r\n    swiperv = new Swiper('.swiper1', {\r\n        autoHeight: true,\r\n        direction: 'horizontal',\r\n        allowTouchMove: false,\r\n        mousewheel: false,\r\n        slidesPerView: 1,\r\n        loop: false,\r\n    });\r\n\r\n    swiperc = new Swiper('.swiper2', {\r\n        direction: 'vertical',\r\n        allowTouchMove: true,\r\n        mousewheel: true,\r\n        slidesPerView: 3,\r\n        spaceBetween: 10,\r\n        loop: swiperLoop3,\r\n        breakpoints: {\r\n            840: {\r\n                slidesPerView: 4,\r\n                loop: swiperLoop4\r\n            }\r\n        },\r\n        scrollbar: {\r\n            el: '.swiper-scrollbar',\r\n            hide: false,\r\n            draggable: true,\r\n        },\r\n        on: {\r\n            click: function() {\r\n                let iR = (this.clickedSlide.firstChild.id).substring(3) - 1;\r\n                swiperv.slideTo(iR, 1);\r\n            },\r\n            transitionEnd: function () {\r\n                let iR = this.realIndex;\r\n                swiperv.slideTo(iR, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    changeSwiper();\r\n}\r\n\r\n// Mapping wind directions to angles\r\nfunction getCompassDirection(deg) {\r\n    const directions = [\r\n        \"N\", \"NNE\", \"NE\", \"ENE\", \"E\", \"ESE\", \"SE\", \"SSE\",\r\n        \"S\", \"SSW\", \"SW\", \"WSW\", \"W\", \"WNW\", \"NW\", \"NNW\",\r\n    ];\r\n    return directions[Math.round(deg / 22.5) % 16];\r\n}\r\n\r\nfunction getFillColor(speed) {\r\n    if (speed >= 7 && speed <= 14) return \"LimeGreen\";\r\n    if (speed >= 15 && speed <= 24) return \"yellow\";\r\n    if (speed >= 25 && speed <= 30) return \"orange\";\r\n    if (speed >= 31 && speed <= 36) return \"red\";\r\n    if (speed > 36) return \"black\";\r\n    return \"Aquamarine\";\r\n}\r\n\r\nfunction getStrokeColor(speed) {\r\n    if (speed >= 15 && speed <= 24) return \"LimeGreen\";\r\n    if (speed >= 25 && speed <= 32) return \"yellow\";\r\n    if (speed >= 33 && speed <= 38) return \"orange\";\r\n    if (speed >= 39 && speed <= 44) return \"red\";\r\n    if (speed > 44) return \"black\";\r\n    return \"Aquamarine\";\r\n}\r\n\r\nfunction getTextColor(backgroundColor) {\r\n    return backgroundColor === \"black\" ? \"white\" : \"black\";\r\n}\r\n\r\n// Helper: Process raw historical data into 10minute averages.\r\nfunction processHistoricalData(data) {\r\n    const grouped = {};\r\n    data.forEach((entry) => {\r\n        const dt = new Date(entry._id * 1000);\r\n        // Round down to the nearest 10minute mark.\r\n        dt.setMinutes(Math.floor(dt.getMinutes() / 10) * 10);\r\n        dt.setSeconds(0);\r\n        dt.setMilliseconds(0);\r\n        const key = dt.getTime();\r\n        if (!grouped[key]) {\r\n            grouped[key] = { count: 0, wAvgSum: 0, wMaxSum: 0, wDirSum: 0, tempSum: 0, tempCount: 0 };\r\n        }\r\n        grouped[key].count++;\r\n        grouped[key].wAvgSum += entry[\"w-avg\"];\r\n        grouped[key].wMaxSum += entry[\"w-max\"];\r\n        grouped[key].wDirSum += entry[\"w-dir\"];\r\n        if (entry[\"temp\"] !== undefined) {\r\n            grouped[key].tempSum += entry[\"temp\"];\r\n            grouped[key].tempCount++;\r\n        }\r\n    });\r\n    const result = Object.keys(grouped).map((key) => ({\r\n        _id: parseInt(key) / 1000, // back to seconds\r\n        \"w-avg\": grouped[key].wAvgSum / grouped[key].count,\r\n        \"w-max\": grouped[key].wMaxSum / grouped[key].count,\r\n        \"w-dir\": grouped[key].wDirSum / grouped[key].count,\r\n        \"temp\": grouped[key].tempCount > 0 ? grouped[key].tempSum / grouped[key].tempCount : undefined,\r\n    }));\r\n    // For the table we want descending order (most recent first).\r\n    result.sort((a, b) => b._id - a._id);\r\n    return result;\r\n}\r\n\r\n// Main function to fetch and display/update wind stations.\r\nfunction fetchWindStations() {\r\n    console.log('[fetchWindStations] Function called.'); // Added log\r\n    // Make sure the map and windLayer exist before trying to use them\r\n    if (!window.map || typeof window.map.getBounds !== 'function' || !window.windLayer) {\r\n        console.error('[fetchWindStations] Map or windLayer not properly initialized, exiting.'); // Modified log\r\n        return;\r\n    }\r\n\r\n    // Note: We don't need to track the open popup ID explicitly.\r\n    // Leaflet keeps the popup open if only the icon is updated via setIcon().\r\n\r\n    const bounds = window.map.getBounds();\r\n    const nwLat = bounds.getNorthWest().lat;\r\n    const nwLng = bounds.getNorthWest().lng;\r\n    const seLat = bounds.getSouthEast().lat;\r\n    const seLng = bounds.getSouthEast().lng;\r\n\r\n    fetch(\r\n        `/api/wind-data-getCurrent?nwLat=${nwLat}&nwLng=${nwLng}&seLat=${seLat}&seLng=${seLng}`\r\n    )\r\n    .then((response) => response.json())\r\n    .then((responseData) => { // Main .then for station data\r\n        if (!Array.isArray(responseData)) {\r\n            console.error(\"[fetchWindStations] Invalid data format received from API:\", responseData); // Added log\r\n            throw new Error(\"Invalid data format received from API\");\r\n        }\r\n\r\n        console.log(`[fetchWindStations] Received ${responseData.length} stations from API.`); // Added log\r\n        const newStationsMap = new Map(responseData.map(station => [station._id, station]));\r\n        const existingMarkersMap = new Map();\r\n        window.windLayer.eachLayer(marker => {\r\n            // Ensure we only process markers added by this logic (with stationId)\r\n            if (marker.options && marker.options.stationId) {\r\n                existingMarkersMap.set(marker.options.stationId, marker);\r\n            }\r\n        });\r\n\r\n        let updatedCount = 0;\r\n        let removedCount = 0;\r\n        let addedCount = 0;\r\n        // --- Update existing markers or remove old ones ---\r\n        existingMarkersMap.forEach((marker, stationId) => {\r\n            const newStationData = newStationsMap.get(stationId);\r\n            if (newStationData) {\r\n                // Station exists, update its icon\r\n                const windDirection = newStationData.last[\"w-dir\"];\r\n                const windAvg = newStationData.last[\"w-avg\"];\r\n                const windMax = newStationData.last[\"w-max\"];\r\n                const fillColor = getFillColor(windAvg);\r\n                const strokeColor = getStrokeColor(windMax);\r\n                const peakArrow = newStationData.peak ? \"\" : \"\";\r\n\r\n                const newArrowSvg = `\r\n                  <svg width=\"30\" height=\"30\" viewBox=\"0 0 800 900\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <g transform=\"rotate(${windDirection + 90}, 400, 400)\" stroke=\"${strokeColor}\" stroke-width=\"60\">\r\n                      <path d=\"M203,391 L75,144 L738,391 L75,637 L203,391 Z\" fill=\"${fillColor}\"/>\r\n                    </g>\r\n                    <text x=\"330\" y=\"850\" font-size=\"220\" text-anchor=\"middle\" fill=\"black\" font-weight=\"bold\">\r\n                      ${peakArrow}${Math.round(windAvg)} / ${Math.round(windMax)}\r\n                    </text>\r\n                  </svg>`;\r\n\r\n                const newArrowIcon = L.divIcon({\r\n                    className: \"wind-arrow\",\r\n                    html: newArrowSvg,\r\n                    iconSize: [30, 30],\r\n                    iconAnchor: [12, 15],\r\n                });\r\n\r\n                marker.setIcon(newArrowIcon);\r\n                updatedCount++;\r\n\r\n                // Remove from map so we know it's been processed and won't be added again\r\n                newStationsMap.delete(stationId);\r\n\r\n            } else {\r\n                // Station no longer in data, remove marker\r\n                // console.log(`Removing marker for station: ${stationId}`); // Debugging\r\n                window.windLayer.removeLayer(marker);\r\n                removedCount++;\r\n            }\r\n        }); // End existingMarkersMap.forEach\r\n\r\n        // --- Add new markers ---\r\n        newStationsMap.forEach((station) => { // Iterate only stations NOT already updated\r\n            addedCount++;\r\n            // console.log(`Adding new marker for station: ${station._id}`); // Debugging\r\n            const [lon, lat] = station.loc.coordinates;\r\n            const windDirection = station.last[\"w-dir\"];\r\n            const windAvg = station.last[\"w-avg\"];\r\n            const windMax = station.last[\"w-max\"];\r\n            // const tempC = station.last[\"temp\"]; // Keep for potential future use in popup\r\n            const compassDirection = getCompassDirection(windDirection);\r\n            const lastUpdate = new Date(station.last[\"_id\"] * 1000).toLocaleTimeString(\"de-DE\", {hour: \"2-digit\", minute: \"2-digit\", });\r\n            const fillColor = getFillColor(windAvg);\r\n            const strokeColor = getStrokeColor(windMax);\r\n            const peakArrow = station.peak ? \"\" : \"\";\r\n            const isHolfuy = station._id.includes(\"holfuy\");\r\n            let holfuyStationId = '';\r\n            if (isHolfuy) {\r\n              holfuyStationId = station._id.split(\"-\")[1];\r\n            }\r\n\r\n            // Create the SVG arrow icon.\r\n            const arrowSvg = `\r\n              <svg width=\"30\" height=\"30\" viewBox=\"0 0 800 900\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <g transform=\"rotate(${windDirection + 90}, 400, 400)\" stroke=\"${strokeColor}\" stroke-width=\"60\">\r\n                  <path d=\"M203,391 L75,144 L738,391 L75,637 L203,391 Z\" fill=\"${fillColor}\"/>\r\n                </g>\r\n                <text x=\"330\" y=\"850\" font-size=\"220\" text-anchor=\"middle\" fill=\"black\" font-weight=\"bold\">\r\n                  ${peakArrow}${Math.round(windAvg)} / ${Math.round(windMax)}\r\n                </text>\r\n              </svg>`;\r\n\r\n            const arrowIcon = L.divIcon({\r\n              className: \"wind-arrow\",\r\n              html: arrowSvg,\r\n              iconSize: [30, 30],\r\n              iconAnchor: [12, 15],\r\n            });\r\n\r\n            // Create the marker.\r\n            const marker = L.marker([lat, lon], {\r\n                icon: arrowIcon,\r\n                stationId: station._id // Store station ID in options\r\n            }).addTo(window.windLayer);\r\n\r\n            // --- Fetch historical data and bind popup ONLY for NEW markers ---\r\n            fetch(\r\n              `https://winds.mobi/api/2.3/stations/${station._id}/historic/?duration=21000&keys=w-dir&keys=w-avg&keys=w-max&keys=temp`\r\n            )\r\n              .then((response) => response.json())\r\n              .then((historyData) => { // .then for history data\r\n                // Process historyData into 10minute averages.\r\n                const aggregatedData = processHistoricalData(historyData);\r\n\r\n                // --- TABLE SETUP (10minute averages, limited to last 5 hours) ---\r\n                const fiveHoursAgo = Date.now() - 5 * 60 * 60 * 1000;\r\n                const limitedData = aggregatedData.filter(\r\n                  (entry) => entry._id * 1000 >= fiveHoursAgo\r\n                ).slice(0, 24); // Limit to 24 most recent entries\r\n                let historyTable = `<div class=\"table-responsive\"><table class=\"wind-data-table table\">\r\n                  <thead>\r\n                    <tr>\r\n                      <th>Wind (m/s)</th>\r\n                      <th>Gusts (m/s)</th>\r\n                      <th>Direction</th>\r\n                      <th>Temp C</th>\r\n                      <th>Time</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>`;\r\n                limitedData.forEach((entry) => {\r\n                  const timeFormatted = new Date(entry._id * 1000).toLocaleTimeString(\"de-DE\", {\r\n                    hour: \"2-digit\",\r\n                    minute: \"2-digit\",\r\n                  });\r\n                  const compassDir = getCompassDirection(entry[\"w-dir\"]);\r\n                  historyTable += `<tr>\r\n                    <td class=\"wind-avg-cell\" style=\"color: ${getTextColor(getFillColor(entry[\"w-avg\"]))}; background-color: ${getFillColor(entry[\"w-avg\"])};\">\r\n                      ${entry[\"w-avg\"].toFixed(1)}\r\n                    </td>\r\n                    <td class=\"wind-max-cell\" style=\"color: ${getTextColor(getStrokeColor(entry[\"w-max\"]))}; background-color: ${getStrokeColor(entry[\"w-max\"])};\">\r\n                      ${entry[\"w-max\"].toFixed(1)}\r\n                    </td>\r\n                    <td style=\"white-space: nowrap;\">\r\n                      <span class=\"wind-direction-arrow\" style=\"transform: rotate(${entry[\"w-dir\"] + 180}deg);\">\r\n                          <i class=\"fa fa-long-arrow-up\"></i>\r\n                      </span>\r\n                      &nbsp;&nbsp;${compassDir}\r\n                    </td>\r\n                    <td>${entry[\"temp\"] !== undefined ? entry[\"temp\"].toFixed(1) : \"N/A\"}</td>\r\n                    <td>${timeFormatted}</td>\r\n                  </tr>`;\r\n                });\r\n                historyTable += `</tbody></table></div>`;\r\n\r\n                // --- CHART SETUP (10minute averages with hourly vertical grid lines) ---\r\n                // For the chart we want ascending order (oldest first).\r\n                const chartData = aggregatedData.slice().reverse();\r\n\r\n                // Build the popup HTML with tabs.\r\n                // Use the current data passed into this loop for the top section\r\n                const currentWindAvg = station.last[\"w-avg\"];\r\n                const currentWindMax = station.last[\"w-max\"];\r\n                const currentWindDir = station.last[\"w-dir\"];\r\n                const currentCompassDir = getCompassDirection(currentWindDir);\r\n                const currentLastUpdate = new Date(station.last[\"_id\"] * 1000).toLocaleTimeString(\"de-DE\", {hour: \"2-digit\", minute: \"2-digit\", });\r\n\r\n                const popupHtml = `\r\n                  <div style=\"display: flex; gap: 1px; align-items: flex-end; max-width: 700px\">\r\n                    <div style=\"flex: 1;\" class=\"wind-station-popup-content\">\r\n                      <strong>${station.short}</strong><br><br>\r\n                      <tag-name>Wind Speed:&#9;&#9;${currentWindAvg} km/h<br></tag-name>\r\n                      <tag-name>Max Wind:&#9;&#9;${currentWindMax} km/h<br></tag-name>\r\n                      <tag-name>Wind Direction:&#9;${currentWindDir} (${currentCompassDir})<br></tag-name>\r\n                      <tag-name>Last Update:&#9;&#9;${currentLastUpdate}<br><br></tag-name>\r\n                    </div>\r\n                    ${isHolfuy ? `\r\n                      <div style=\"flex: 0 0 auto; width: 110px; margin-right: 15px; position: relative;\">\r\n                        <iframe src=\"https://widget.holfuy.com/?station=${holfuyStationId}&su=km/h&t=C&lang=en&mode=rose&size=110\"\r\n                          width=\"110\"\r\n                          height=\"110\"\r\n                          frameborder=\"0\"\r\n                          scrolling=\"no\"\r\n                          style=\"pointer-events: none;\">\r\n                        </iframe>\r\n                        <div style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10;\"></div>\r\n                      </div>\r\n                    ` : ''}\r\n                  </div>\r\n                  \r\n                  <div class=\"tab-container\">\r\n                    <div class=\"tab active\" onclick=\"showTab('table-${station._id}', this)\">Table</div>\r\n                    <div class=\"tab\" onclick=\"showTab('chart-${station._id}', this)\">Chart</div>\r\n                    <div class=\"tab\" id=\"camera-tab-${station._id}\" style=\"display: none;\" onclick=\"showTab('camera-${station._id}', this)\">Camera</div>\r\n                  </div>\r\n                  <div id=\"table-${station._id}\" class=\"tab-content\">\r\n                    ${historyTable}\r\n                  </div>\r\n                  <div id=\"chart-${station._id}\" class=\"tab-content\" style=\"display: none;\">\r\n                    <canvas id=\"canvas-${station._id}\" width=\"400\" height=\"200\"></canvas>\r\n                  </div>\r\n                  <div id=\"camera-${station._id}\" class=\"tab-content\" style=\"display: none;\">\r\n                    <img id=\"camera-image-${station._id}\" src=\"\" alt=\"Camera Image\" class=\"camera-image\">\r\n                  </div>\r\n                `;\r\n\r\n                // Bind a responsive popup using the plugin.\r\n                marker.bindPopup(\r\n                  L.responsivePopup({\r\n                    hasTip: true,\r\n                    autoPan: false,\r\n                    offset: [15, 25],\r\n                    maxWidth: 700,\r\n                    minWidth: 400,\r\n                    maxHeight: 800,\r\n                  }).setContent(popupHtml)\r\n                );\r\n\r\n                // When the popup is opened, initialize the chart and camera logic.\r\n                marker.on(\"popupopen\", () => {\r\n                  setTimeout(() => {\r\n                    const canvas = document.getElementById(`canvas-${station._id}`);\r\n                    if (canvas) {\r\n                      canvas.style.height = \"300px\";\r\n                      const ctx = canvas.getContext(\"2d\");\r\n                      if (ctx) {\r\n                        // Transform chartData so that each point has an x (timestamp) and y (value)\r\n                        const chartDataPointsAvg = chartData.map((entry) => ({\r\n                          x: entry._id * 1000, // convert seconds to ms\r\n                          y: entry[\"w-avg\"],\r\n                        }));\r\n                        const chartDataPointsMax = chartData.map((entry) => ({\r\n                          x: entry._id * 1000,\r\n                          y: entry[\"w-max\"],\r\n                        }));\r\n\r\n                        const chartInstance = new Chart(ctx, {\r\n                          type: \"line\",\r\n                          data: {\r\n                            datasets: [\r\n                              {\r\n                                label: \"Wind Avg (km/h)\",\r\n                                data: chartDataPointsAvg,\r\n                                borderColor: \"blue\",\r\n                                fill: false,\r\n                                pointRadius: 3,\r\n                              },\r\n                              {\r\n                                label: \"Wind Max (km/h)\",\r\n                                data: chartDataPointsMax,\r\n                                borderColor: \"red\",\r\n                                fill: false,\r\n                                pointRadius: 3,\r\n                              },\r\n                            ],\r\n                          },\r\n                          options: {\r\n                            responsive: true,\r\n                            maintainAspectRatio: false,\r\n                            layout: {\r\n                              // Add extra bottom padding so there's room for the arrows.\r\n                              padding: { bottom: 5 },\r\n                            },\r\n                            scales: {\r\n                              x: {\r\n                                type: \"time\",\r\n                                time: {\r\n                                  unit: \"hour\",\r\n                                  displayFormats: {\r\n                                    hour: \"HH:mm\",\r\n                                  },\r\n                                  tooltipFormat: \"HH:mm\",\r\n                                },\r\n                                grid: {\r\n                                  drawBorder: true,\r\n                                },\r\n                                ticks: {\r\n                                  autoSkip: true,\r\n                                  maxRotation: 0,\r\n                                  minRotation: 0,\r\n                                  padding: 30,\r\n                                },\r\n                              },\r\n                              y: {\r\n                                beginAtZero: true,\r\n                                ticks: {\r\n                                  stepSize: 10,\r\n                                  maxTicksLimit: 10,\r\n                                  font: { size: 14 },\r\n                                },\r\n                              },\r\n                            },\r\n                            plugins: {\r\n                              legend: { display: false },\r\n                            },\r\n                          },\r\n                          plugins: [\r\n                            {\r\n                              id: \"windDirectionArrows\",\r\n                              afterDraw: (chart) => {\r\n                                const ctx = chart.ctx;\r\n                                const xAxis = chart.scales.x;\r\n                                ctx.save();\r\n                                // Position arrows just below the x-axis line \r\n                                const arrowRowY = xAxis.top + 20;\r\n                                \r\n                                // Set text properties for centered alignment\r\n                                ctx.textAlign = \"center\";\r\n                                ctx.textBaseline = \"middle\";\r\n                                \r\n                                chartData.forEach((entry) => {\r\n                                  const x = xAxis.getPixelForValue(entry._id * 1000);\r\n                                  ctx.save();\r\n                                  ctx.translate(x, arrowRowY);\r\n                                  ctx.rotate(((entry[\"w-dir\"] + 180) * Math.PI) / 180);\r\n                                  ctx.font = \"extra-bold 12px 'Roboto', sans-serif\";\r\n                                  ctx.fillText(\"\", 0, 0);\r\n                                  ctx.restore();\r\n                                });\r\n                                ctx.restore();\r\n                              },\r\n                            },\r\n                          ],\r\n                          \r\n                        });\r\n                        canvas.chartInstance = chartInstance;\r\n                      } else {\r\n                        console.error(\"Failed to get 2D context from canvas.\");\r\n                      }\r\n                    } else {\r\n                      console.error(\"Canvas element not found.\");\r\n                    }\r\n                    // Inside the popupopen event handler where camera handling happens:\r\n                    const cameraTabElement = document.getElementById(`camera-tab-${station._id}`);\r\n                    const cameraImageElement = document.getElementById(`camera-image-${station._id}`);\r\n                    \r\n                    // Special cases for Moselfalken webcams\r\n                    if (station._id === \"holfuy-361\" || station._id === \"holfuy-362\" || station._id === \"holfuy-363\") {\r\n                      console.log(`Handling special case for ${station._id}`);\r\n                      \r\n                      // Create a container div for better layout control\r\n                      const container = document.createElement('div');\r\n                      container.classList.add('holfuy-container');\r\n\r\n                      // No heading needed\r\n                      \r\n                      // Add a loading indicator\r\n                      const loadingText = document.createElement('div');\r\n                      loadingText.textContent = 'Loading webcam image...';\r\n                      loadingText.classList.add('loading-text');\r\n                      container.appendChild(loadingText);\r\n                      \r\n                      // Replace the image element with our container\r\n                      if (cameraImageElement && cameraImageElement.parentNode) { // Check if element exists\r\n                          cameraImageElement.parentNode.replaceChild(container, cameraImageElement);\r\n                          if (cameraTabElement) cameraTabElement.style.display = \"block\"; // Check if tab exists\r\n                          console.log(\"Successfully replaced image with container\");\r\n                      } else {\r\n                          console.error(\"Cannot find parent of image element or image element itself for replacement\");\r\n                          if (cameraTabElement) cameraTabElement.style.display = \"none\"; // Check if tab exists\r\n                          return; // Exit if we can't replace\r\n                      }\r\n                      \r\n                      // First fetch the Moselfalken website to extract the current image URL\r\n                      \r\n                      // Show loading state\r\n                      const extractingText = document.createElement('div');\r\n                      extractingText.textContent = 'Loading webcam image...';\r\n                      extractingText.classList.add('loading-text');\r\n                      container.innerHTML = '';\r\n                      container.appendChild(extractingText);\r\n                      \r\n                      // Determine the website URL based on the station ID\r\n                      let websiteUrl = 'https://www.moselfalken.de/zeltingen-rachtig'; // Default for holfuy-361\r\n                      if (station._id === \"holfuy-362\") {\r\n                          websiteUrl = 'https://www.moselfalken.de/ockfen';\r\n                      } else if (station._id === \"holfuy-363\") {\r\n                          websiteUrl = 'https://www.moselfalken.de/meerfeld';\r\n                      }\r\n                      \r\n                      \r\n                      // Fetch the website via our proxy\r\n                      const websiteProxyUrl = `/api/proxy?imageUrl=${encodeURIComponent(websiteUrl)}`; // Ensure URL is encoded\r\n                      console.log(`[${station._id}] Fetching website HTML from: ${websiteProxyUrl}`); // Added logging\r\n                      fetch(websiteProxyUrl)\r\n                        .then(response => {\r\n                          if (!response.ok) {\r\n                            throw new Error(`HTTP error! Status: ${response.status}`);\r\n                          }\r\n                          return response.text();\r\n                        })\r\n                        .then(html => {\r\n                          // Parse the HTML\r\n                          const parser = new DOMParser();\r\n                          const doc = parser.parseFromString(html, 'text/html');\r\n                          \r\n                          // Find all picture elements\r\n                          const pictureElements = doc.querySelectorAll('picture');\r\n                          \r\n                          if (pictureElements.length === 0) {\r\n                            throw new Error('No picture elements found in HTML');\r\n                          }\r\n                          \r\n                          // Look for a picture element that might contain the webcam image\r\n                          let webcamPicture = null;\r\n                          for (const picture of pictureElements) {\r\n                            const img = picture.querySelector('img');\r\n                            if (img && (img.src.includes('cam') || (img.alt && img.alt.toLowerCase().includes('webcam')))) { // Case-insensitive check\r\n                              webcamPicture = picture;\r\n                              break;\r\n                            }\r\n                          }\r\n                          \r\n                          // If we didn't find a specific webcam picture, use the first one as fallback\r\n                          if (!webcamPicture && pictureElements.length > 0) {\r\n                            console.warn(`[${station._id}] No specific webcam picture found, using first picture element as fallback.`);\r\n                            webcamPicture = pictureElements[0];\r\n                          } else if (!webcamPicture) {\r\n                             throw new Error('No suitable picture element found.');\r\n                          }\r\n                          \r\n                          // Find all source elements and the img element in the picture\r\n                          const sourceElements = webcamPicture.querySelectorAll('source');\r\n                          const imgElement = webcamPicture.querySelector('img');\r\n                          \r\n                          let imageUrl = '';\r\n                          \r\n                          // Try to get URL from the last source element (often highest resolution)\r\n                          if (sourceElements.length > 0) {\r\n                            const lastSource = sourceElements[sourceElements.length - 1];\r\n                            const srcset = lastSource.getAttribute('srcset');\r\n                            if (srcset) {\r\n                              // Extract the URL part before potential \" 1x\", \" 2x\" descriptors\r\n                              imageUrl = srcset.trim().split(' ')[0];\r\n                            }\r\n                          }\r\n                          \r\n                          // Fallback to img src if no source element found or srcset was empty\r\n                          if (!imageUrl && imgElement) {\r\n                            imageUrl = imgElement.getAttribute('src');\r\n                          }\r\n                          \r\n                          if (!imageUrl) {\r\n                            throw new Error('Could not extract image URL from picture element');\r\n                          }\r\n                          \r\n                          // Convert relative URL to absolute URL based on the fetched website's origin\r\n                          try {\r\n                              const base = new URL(websiteUrl); // Use the original website URL as base\r\n                              imageUrl = new URL(imageUrl, base).href;\r\n                          } catch (e) {\r\n                              console.error(`[${station._id}] Error constructing absolute URL for ${imageUrl} with base ${websiteUrl}:`, e);\r\n                              throw new Error('Failed to construct absolute image URL');\r\n                          }\r\n\r\n                          console.log(`[${station._id}] Extracted absolute image URL: ${imageUrl}`); // Added logging\r\n                          \r\n                          // Now fetch the image via the proxy\r\n                          const imageProxyUrl = `/api/proxy?imageUrl=${encodeURIComponent(imageUrl)}`; // Ensure URL is encoded\r\n                          \r\n                          // Create a new image element\r\n                          const img = document.createElement('img');\r\n                          img.alt = \"Moselfalken Webcam\";\r\n                          img.classList.add('webcam-image'); // Use consistent class\r\n                          img.style.maxWidth = '100%'; // Ensure image fits container\r\n                          img.style.height = 'auto';\r\n                          console.log(`[${station._id}] Setting image src to proxy: ${imageProxyUrl}`); // Added logging\r\n                          img.src = imageProxyUrl;\r\n                          \r\n                          // Replace the loading text with just the image\r\n                          container.innerHTML = '';\r\n                          container.appendChild(img);\r\n                        })\r\n                        .catch(error => {\r\n                          console.error(`[${station._id}] Error fetching/parsing website or extracting image URL:`, error); // Added logging\r\n                          container.innerHTML = 'Error loading webcam.'; // Show error in container\r\n                          // Optionally hide the tab if preferred on error\r\n                          // if (cameraTabElement) cameraTabElement.style.display = \"none\";\r\n                        });\r\n                    } else if (isHolfuy && holfuyStationId) { // Handle other Holfuy stations\r\n                      const cameraImageUrl = `https://holfuy.com/en/takeit/cam/s${holfuyStationId}.jpg`;\r\n                      \r\n                      // Create temporary image to test validity\r\n                      const testImage = new Image();\r\n                      testImage.onload = function() {\r\n                        // Only show tab if image loads successfully\r\n                        if (cameraImageElement) cameraImageElement.src = cameraImageUrl; // Check element exists\r\n                        if (cameraTabElement) cameraTabElement.style.display = \"block\"; // Check element exists\r\n                      };\r\n                      testImage.onerror = function() {\r\n                        // Hide tab if image fails to load\r\n                         if (cameraTabElement) cameraTabElement.style.display = \"none\"; // Check element exists\r\n                      };\r\n                      testImage.src = cameraImageUrl;\r\n                      \r\n                      // Set timeout as fallback in case responses are slow\r\n                      setTimeout(() => {\r\n                        if (!testImage.complete || testImage.naturalWidth === 0) {\r\n                           if (cameraTabElement) cameraTabElement.style.display = \"none\"; // Check element exists\r\n                        }\r\n                      }, 3000); // Increased timeout slightly\r\n                    } else {\r\n                       // If not Holfuy or no ID, ensure tab is hidden\r\n                       if (cameraTabElement) cameraTabElement.style.display = \"none\";\r\n                    }\r\n                  }, 500); // End setTimeout for popupopen\r\n                }); // End marker.on(\"popupopen\")\r\n\r\n              }) // End .then for history data\r\n              .catch((error) =>\r\n                console.error(`Error fetching historical wind data for ${station._id}:`, error)\r\n              ); // End .catch for history data\r\n        }); // End newStationsMap.forEach\r\n\r\n        console.log(`[fetchWindStations] Update complete. Updated: ${updatedCount}, Removed: ${removedCount}, Added: ${addedCount}`); // Added summary log\r\n    }) // End .then for station data\r\n    .catch((error) =>\r\n      console.error(\"Error fetching wind station data:\", error)\r\n    ); // End .catch for station data\r\n} // End fetchWindStations function\r\n\r\n\r\n// Enhanced tab switching function.\r\nfunction showTab(tabId, element) {\r\n  console.log(\"Switching to tab:\", tabId);\r\n\r\n  // Find the closest popup content container to ensure we only affect tabs within the current popup\r\n  let popupContent = element ? element.closest('.leaflet-popup-content') : null;\r\n  if (!popupContent) {\r\n      // Fallback if element is null or not inside a popup (shouldn't happen with onclick)\r\n      popupContent = document; // Less ideal, might affect other popups if multiple are open somehow\r\n      console.warn(\"Could not find parent popup content for tab switching, using document as root.\");\r\n  }\r\n\r\n  // Hide all tab content within this specific popup\r\n  popupContent.querySelectorAll(\".tab-content\").forEach((tab) => {\r\n    tab.style.display = \"none\";\r\n  });\r\n\r\n  // Deactivate all tabs within this specific popup\r\n  popupContent.querySelectorAll(\".tab\").forEach((tab) => {\r\n    tab.classList.remove(\"active\");\r\n  });\r\n\r\n  // Show the target tab content within this specific popup\r\n  const targetTab = popupContent.querySelector(`#${tabId}`); // Search within popupContent\r\n  if (targetTab) {\r\n    targetTab.style.display = \"block\";\r\n  } else {\r\n    console.error(\"Tab content not found within this popup:\", tabId);\r\n  }\r\n\r\n  // Activate the clicked tab element\r\n  if (element) {\r\n    element.classList.add(\"active\");\r\n  } else {\r\n    console.error(\"Clicked tab element is null or undefined\");\r\n  }\r\n\r\n  // Resize chart if the chart tab was selected\r\n  if (tabId.startsWith(\"chart-\")) {\r\n    const stationId = tabId.split(\"chart-\")[1];\r\n    // console.log(\"Resizing chart for Station ID:\", stationId); // Debugging\r\n    const canvas = popupContent.querySelector(`#canvas-${stationId}`); // Search within popupContent\r\n    if (canvas && canvas.chartInstance) {\r\n      // Need a slight delay for the tab content to become visible and have dimensions\r\n      setTimeout(() => {\r\n          canvas.chartInstance.resize();\r\n          // console.log(\"Chart resized.\"); // Debugging\r\n      }, 50);\r\n    } else if (canvas && !canvas.chartInstance) {\r\n        console.warn(\"Canvas found, but chart instance not attached.\");\r\n    } else {\r\n        // console.warn(\"Canvas not found for chart resize.\"); // Debugging\r\n    }\r\n  }\r\n};\r\n\r\n// Assign functions to window object for global access\r\nwindow.showTab = showTab;\r\nwindow.fetchWindStations = fetchWindStations;\r\n","// spotsHelper.js - Common functionality for loading and displaying spots on a map\r\n\r\n// Module-scoped variable to track Dropzone instance\r\nlet feedbackDropzone = null;\r\nlet currentFeedbackForm = null;\r\n\r\n// Swiper related functions\r\nfunction changeSwiper() {\r\n    if (typeof swiperc !== \"undefined\") {\r\n        if (window.innerWidth < 576) {\r\n            $(\".swiper2\").css(\"height\", \"\"); $(\".swiper2\").css(\"width\", \"320px\");\r\n            $(\".swiper2\").css(\"padding-left\", \"\"); $(\".swiper2\").css(\"padding-top\", \"30px\");\r\n            $(\".swiper2 > .swiper-wrapper\").css(\"width\", \"\"); $(\".swiper2 > .swiper-wrapper\").css(\"height\", \"100px\");\r\n            swiperc.changeDirection('horizontal', true);\r\n        }\r\n        else {\r\n            if (window.innerWidth < 840) {\r\n                $(\".swiper2\").css(\"width\", \"\"); $(\".swiper2\").css(\"height\", \"320px\");\r\n            }\r\n            else {\r\n                $(\".swiper2\").css(\"width\", \"\"); $(\".swiper2\").css(\"height\", \"460px\");\r\n            }\r\n            $(\".swiper2\").css(\"padding-top\", \"\"); $(\".swiper2\").css(\"padding-left\", \"30px\");\r\n            $(\".swiper2 > .swiper-wrapper\").css(\"height\", \"\"); $(\".swiper2 > .swiper-wrapper\").css(\"width\", \"100px\");\r\n            swiperc.changeDirection('vertical', true);\r\n        }\r\n    }\r\n}\r\n\r\nfunction initSwiper(idImg) {\r\n    let swiperv, swiperc;\r\n    // USED 09/24 Beschreibung: Initialisierung der Image-Swiper\r\n    var swiperLoop3 = (idImg < 4) ? false : true;\r\n    var swiperLoop4 = (idImg < 5) ? false : true;\r\n\r\n    swiperv = new Swiper('.swiper1', {\r\n        autoHeight: true,\r\n        direction: 'horizontal',\r\n        allowTouchMove: false,\r\n        mousewheel: false,\r\n        slidesPerView: 1,\r\n        loop: false,\r\n    });\r\n\r\n    swiperc = new Swiper('.swiper2', {\r\n        direction: 'vertical',\r\n        allowTouchMove: true,\r\n        mousewheel: true,\r\n        slidesPerView: 3,\r\n        spaceBetween: 10,\r\n        loop: swiperLoop3,\r\n        breakpoints: {\r\n            840: {\r\n                slidesPerView: 4,\r\n                loop: swiperLoop4\r\n            }\r\n        },\r\n        scrollbar: {\r\n            el: '.swiper-scrollbar',\r\n            hide: false,\r\n            draggable: true,\r\n        },\r\n        on: {\r\n            click: function() {\r\n                let iR = (this.clickedSlide.firstChild.id).substring(3) - 1;\r\n                swiperv.slideTo(iR, 1);\r\n            },\r\n            transitionEnd: function () {\r\n                let iR = this.realIndex;\r\n                swiperv.slideTo(iR, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    changeSwiper();\r\n}\r\n\r\n// Mapping wind directions to angles\r\nfunction getAngleRange(direction) {\r\n    const dirToAngle = {\r\n        \"N\": 0, \"NNE\": 22.5, \"NE\": 45, \"ENE\": 67.5,\r\n        \"E\": 90, \"ESE\": 112.5, \"SE\": 135, \"SSE\": 157.5,\r\n        \"S\": 180, \"SSW\": 202.5, \"SW\": 225, \"WSW\": 247.5,\r\n        \"W\": 270, \"WNW\": 292.5, \"NW\": 315, \"NNW\": 337.5\r\n    };\r\n\r\n    let angleRanges = [];\r\n    let parts = direction.split(',').map(part => part.trim());\r\n\r\n    parts.forEach(part => {\r\n        let range = part.split('-').map(dir => dir.trim());\r\n        if (range.length === 1) {\r\n            let angle = dirToAngle[range[0]];\r\n            if (angle !== undefined) {\r\n                angleRanges.push([angle - 22.5, angle + 22.5]);\r\n            }\r\n        } else if (range.length === 2) {\r\n            let start = dirToAngle[range[0]];\r\n            let end = dirToAngle[range[1]];\r\n            if (start !== undefined && end !== undefined) {\r\n                if (end < start) {\r\n                    [start, end] = [end, start];\r\n                }\r\n                if (end - start > 180) {\r\n                    [start, end] = [end, start];\r\n                }\r\n                angleRanges.push([start, end]);\r\n            }\r\n        }\r\n    });\r\n\r\n    return angleRanges;\r\n}\r\n\r\n// Fetch full place details when a popup is opened\r\nasync function loadPlaceDetails(layer, placeId) {\r\n    try {\r\n        const response = await fetch(`/api/places/${placeId}`);\r\n        const data = await response.json();\r\n\r\n        if (data.error) {\r\n            console.error(\"Error fetching place details:\", data.error);\r\n            return;\r\n        }\r\n\r\n        let regex1 = /<center><b><a href=\"http:\\/\\/www\\.paraglidingearth\\.com\\/index\\.php\\?site=\\d+\">More information on ParaglidingEarth<\\/a><\\/b><\\/center>\\n?/g;\r\n        let regex2 = /<br>\\n<b>Take off : <\\/b><br>\\n?/g;\r\n        let regexHeight = /H \\d+(-\\d+)? m(?:, |<br>)/g;\r\n        let regexHD = /HD \\d+ m(?:<br>| \\/)/g;\r\n        let regexRating = /\\nrating \\d+\\/\\d+(?:\\n|<br>)*/gi;\r\n\r\n        let description = (data.properties.description || \"\")\r\n            .replace(regex1, \"\")\r\n            .replace(regex2, \"\")\r\n            .replace(regexHeight, \"\")\r\n            .replace(regexHD, \"\")\r\n            .replace(regexRating, \"\")\r\n            .trim();\r\n\r\n        window.currentPlaceName = data.properties.name;\r\n        window.currentPlaceId = data.properties.id;\r\n        window.currentStrPlacemarkId = data.properties.strPlacemarkId;\r\n\r\n        // --- Apply fullSpotsPopoup configuration ---\r\n        if (window.appConfig && window.appConfig.fullSpotsPopoup === true) {\r\n            // --- FULL POPUP LOGIC ---\r\n            console.log(\"Generating full spot popup (config enabled)\");\r\n\r\n            let popupContent = `<span style=\"color: #0087F7;\"><h5>${data.properties.name}</h5></span>\r\n                                <table style=\"border-collapse: collapse; width: 70%;\">\r\n                                <tr>\r\n                                    <th style=\"text-align: left; vertical-align: top;\">Type:</th>\r\n                                    <td style=\"text-align: left; vertical-align: top;\">${data.properties.type}</td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <th style=\"text-align: left; vertical-align: top;\">Direction:</th>\r\n                                    <td style=\"text-align: left; vertical-align: top;\">${data.properties.direction}</td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <th style=\"text-align: left; vertical-align: top;\">Rating:</th>\r\n                                    <td style=\"text-align: left; vertical-align: top;\">${data.properties.rating != null ? data.properties.rating + '/6' : ' -'}</td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <th style=\"text-align: left; vertical-align: top;\">Height:</th>\r\n                                    <td style=\"text-align: left; vertical-align: top;\">${data.properties.height != null ? data.properties.height : ' -'}</td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <th style=\"text-align: left; vertical-align: top;\">Height difference:</th>\r\n                                    <td style=\"text-align: left; vertical-align: top;\">${data.properties.heightdifference != null ? data.properties.heightdifference : ' -'}</td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <th style=\"text-align: left; vertical-align: top;\">Last Update:</th>\r\n                                    <td style=\"text-align: left; vertical-align: top;\">${data.properties.lastupdate}</td>\r\n                                </tr>\r\n                                </table><br>\r\n                                <b>Description:</b> <div class=\"spot-description\">${description}</div><br>\r\n                                <b> <a href=\"https://paraglidingspots.com\" target=\"_blank\">paraglidingspots.com</a></b>\r\n                                <div class=\"modal-footer d-flex justify-content-between\">\r\n                                <div id=\"feedback-message\" class=\"text-start\"></div> <!-- Message on the left -->\r\n                                <div class=\"d-flex ms-auto\">\r\n                                    <button class=\"btn btn-primary btn-sm me-2\" onclick=\"showFeebackForm()\">Feedback/Correction</button>\r\n                                    <button class=\"btn btn-dark btn-sm close-popup\">Close</button>\r\n                                </div>\r\n                                </div>\r\n                                `;\r\n\r\n            // Apply maxWidth CSS directly to popup content if needed\r\n            popupContent += `<style>\r\n            /* Limit the height of the Swiper container */\r\n            .swiper-container {\r\n                max-height: 460px !important;\r\n                height: 460px !important;\r\n                overflow: hidden !important;\r\n            }\r\n\r\n            /* Ensure individual Swipers don't expand beyond this height */\r\n            .swiper, .swiper1, .swiper2 {\r\n                max-height: 460px !important;\r\n                height: 460px !important;\r\n                overflow: hidden !important;\r\n            }\r\n\r\n            /* Limit Swiper wrapper height */\r\n            .swiper-wrapper {\r\n                max-height: 460px !important;\r\n            }\r\n\r\n            /* Ensure Swiper slides don't stretch */\r\n            .swiper-slide {\r\n                max-height: 460px !important;\r\n                display: flex !important;\r\n                align-items: center !important; /* Keep images centered */\r\n                justify-content: center !important;\r\n            }\r\n\r\n            /* Prevent images from exceeding the swiper height */\r\n            .swiper-slide img {\r\n                max-height: 100% !important;\r\n                width: auto !important;\r\n            }\r\n            \r\n            /* Keep the overall popup size unchanged */\r\n            .leaflet-popup-content {\r\n                max-height: 780px !important; /* Keep original popup height */\r\n                overflow-y: auto; /* Allow scrolling inside the popup if needed */\r\n            }\r\n\r\n            .swiper-clear {\r\n                clear: both;\r\n                margin-bottom: 1px;\r\n            }\r\n            </style>`;\r\n\r\n            // Check if fullscreen info is visible and update its content area\r\n            // Note: The actual showing/hiding of fullscreen is handled by index.js popupopen handler\r\n            // This part just ensures the content is ready if fullscreen is triggered.\r\n            const fullScreenInfo = document.getElementById('fullScreenInfo');\r\n            const fullScreenContentArea = document.getElementById('fullscreen-content-area');\r\n            if (fullScreenInfo && fullScreenInfo.classList.contains('visible') && fullScreenContentArea) {\r\n                console.log(\"Updating fullscreen info content area for spot (config enabled)\");\r\n                // Remove default button/footer added by index.js\r\n                const defaultCloseBtn = fullScreenInfo.querySelector('#default-fullscreen-close-btn');\r\n                const defaultFooter = fullScreenInfo.querySelector('#default-fullscreen-footer');\r\n                if (defaultCloseBtn) defaultCloseBtn.remove();\r\n                if (defaultFooter) defaultFooter.remove();\r\n                // Set the spot-specific content\r\n                fullScreenContentArea.innerHTML = popupContent;\r\n            }\r\n\r\n            // Update the original Leaflet popup\r\n            layer.setPopupContent(popupContent);\r\n\r\n            // Wait for the popup to open before initializing Swiper\r\n            setTimeout(() => {\r\n                let firstImg = document.querySelector(\".swiper1 .swiper-slide img\");\r\n                if (firstImg) {\r\n                    let idImg = parseInt(firstImg.id.replace(/\\D/g, \"\"), 10) || 1;\r\n                    initSwiper(idImg); // Call existing Swiper function\r\n                }\r\n            }, 300);\r\n\r\n            // Attach close button listener, considering fullscreen context\r\n            setTimeout(() => {\r\n                const fullScreenInfo = document.getElementById('fullScreenInfo');\r\n                let closeButton = null;\r\n\r\n                if (fullScreenInfo && fullScreenInfo.classList.contains('visible')) {\r\n                    // Target close button within fullscreen view\r\n                    closeButton = fullScreenInfo.querySelector('#fullscreen-content-area .close-popup');\r\n                    if (closeButton) {\r\n                        closeButton.replaceWith(closeButton.cloneNode(true)); // Remove old listeners\r\n                        closeButton = fullScreenInfo.querySelector('#fullscreen-content-area .close-popup'); // Re-select\r\n                        closeButton.addEventListener(\"click\", function () {\r\n                            console.log(\"Fullscreen close button clicked\");\r\n                            window.closeFullscreenInfo();\r\n                        });\r\n                    } else { console.error(\"Close button not found in fullscreen view\"); }\r\n                } else {\r\n                    // Target close button within the standard Leaflet popup\r\n                    const popupElement = layer.getPopup()?.getElement();\r\n                    if (popupElement) {\r\n                        closeButton = popupElement.querySelector(\".close-popup\");\r\n                        if (closeButton) {\r\n                            closeButton.replaceWith(closeButton.cloneNode(true)); // Remove old listeners\r\n                            closeButton = popupElement.querySelector(\".close-popup\"); // Re-select\r\n                            closeButton.addEventListener(\"click\", function () {\r\n                                console.log(\"Standard popup close button clicked\");\r\n                                if (window.map) { window.map.closePopup(); }\r\n                            });\r\n                        } else { console.error(\"Close button not found in standard popup\"); }\r\n                    }\r\n                }\r\n            }, 350);\r\n\r\n        } else {\r\n            // --- SIMPLIFIED POPUP LOGIC ---\r\n            console.log(\"Generating simplified spot popup (config disabled)\");\r\n\r\n            // Add the 'simplified-spot-popup' class here\r\n            const simplifiedPopupContent = `\r\n                <div class=\"simplified-spot-popup\" style=\"padding: 5px;\">\r\n                    <span style=\"color: #0087F7;\"><h5>${data.properties.name}</h5></span>\r\n                    <p style=\"font-size: 0.9em; margin-top: 10px;\">\r\n                        All Spots are provided under the copyright of paraglidingspots.com.\r\n                        If you want to see the full details for this spot, please visit\r\n                        <a href=\"https://paraglidingspots.com/online/\" target=\"_blank\" rel=\"noopener noreferrer\">https://paraglidingspots.com/online/</a>\r\n                    </p>\r\n                    <b> <a href=\"https://paraglidingspots.com\" target=\"_blank\">paraglidingspots.com</a></b>\r\n                </div>\r\n            `;\r\n            // Set the simplified content for the standard Leaflet popup\r\n            layer.setPopupContent(simplifiedPopupContent);\r\n\r\n            // Ensure fullscreen is closed if it was somehow opened\r\n            const fullScreenInfo = document.getElementById('fullScreenInfo');\r\n             if (fullScreenInfo && fullScreenInfo.classList.contains('visible')) {\r\n                 window.closeFullscreenInfo();\r\n             }\r\n        }\r\n        // --- End configuration application ---\r\n\r\n    } catch (error) {\r\n        console.error(\"Error fetching place details:\", error);\r\n    }\r\n}\r\n\r\nfunction showFeebackForm() {\r\n    // Cleanup any existing feedback form\r\n    if (currentFeedbackForm) {\r\n        currentFeedbackForm.remove();\r\n        currentFeedbackForm = null;\r\n    }\r\n    if (feedbackDropzone) {\r\n        feedbackDropzone.destroy();\r\n        feedbackDropzone = null;\r\n    }\r\n    // Clear previous feedback message\r\n    const messageDiv = document.getElementById(\"feedback-message\");\r\n    if (messageDiv) {\r\n        messageDiv.textContent = \"\";\r\n         messageDiv.classList.remove(\"text-success\", \"text-danger\");\r\n    }\r\n\r\n    // Determine the context (fullscreen or standard popup)\r\n    const fullScreenInfo = document.getElementById('fullScreenInfo');\r\n    const isFullScreen = fullScreenInfo && fullScreenInfo.classList.contains('visible');\r\n    const contextElement = isFullScreen ? fullScreenInfo.querySelector('#fullscreen-content-area') : document.querySelector(\".leaflet-popup-content\");\r\n\r\n    if (!contextElement) {\r\n        console.error(\"Could not find context element for feedback form.\");\r\n        return;\r\n    }\r\n\r\n    // Hide the original footer within the correct context\r\n    let modalFooter = contextElement.querySelector(\".modal-footer\");\r\n    if (modalFooter) modalFooter.style.display = \"none\";\r\n\r\n    const feedbackFormHtml = `\r\n        <div id=\"feedbackFormHtml\">\r\n            <div class=\"feedback-modal\">\r\n                <span style=\"color: #0087F7;\"><h5>Feedback for ${window.currentPlaceName}</h5></span>\r\n                <form id=\"feedbackForm\">\r\n                    <div class=\"form-group\">\r\n                        <label for=\"feedbackText\">Feedback / Correction / Comment:</label>\r\n                        <textarea id=\"feedbackText\" class=\"form-control\" required style=\"height: 130px;\"></textarea>\r\n                    </div>\r\n                    <div class=\"form-group\">\r\n                        <label>Upload Images (optional):</label>\r\n                        <div id=\"dropzoneFeedback\" class=\"dropzone mt-4 border-dashed rounded-2 min-h-0\"></div>\r\n                    </div>\r\n                    <div class=\"form-group d-flex justify-content-between\">\r\n                        <div style=\"width: 48%;\">\r\n                            <label for=\"userName\">Name:</label>\r\n                            <input type=\"text\" id=\"userName\" class=\"form-control\" required>\r\n                        </div>\r\n                        <div style=\"width: 48%;\">\r\n                            <label for=\"userEmail\">E-Mail:</label>\r\n                            <input type=\"email\" id=\"userEmail\" class=\"form-control\" required>\r\n                            <small class=\"text-danger d-none\" id=\"emailError\">Please enter a valid email address.</small>\r\n                        </div>\r\n                    </div>\r\n                    <button type=\"submit\" class=\"btn btn-sm btn-success\">Submit</button>\r\n                    <button type=\"button\" class=\"btn btn-sm btn-secondary\" onclick=\"cancelFeedback()\">Cancel</button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    `;\r\n\r\n    // Append the form HTML to the correct context element\r\n    if (contextElement) {\r\n        contextElement.insertAdjacentHTML(\"beforeend\", feedbackFormHtml);\r\n        // Find the newly added form within the specific context\r\n        currentFeedbackForm = contextElement.querySelector(\"#feedbackFormHtml\");\r\n\r\n        // Auto-scroll implementation (scroll the context element)\r\n        setTimeout(() => {\r\n            // Use the contextElement determined earlier\r\n            if (contextElement) {\r\n                // First try the standard scrollTo method\r\n                contextElement.scrollTo({\r\n                    top: contextElement.scrollHeight,\r\n                    behavior: 'smooth'\r\n                });\r\n                \r\n                // As a fallback, also set scrollTop directly\r\n                contextElement.scrollTop = contextElement.scrollHeight;\r\n                \r\n                // If we're in fullscreen mode, also try to scroll the entire fullscreen container\r\n                if (isFullScreen && fullScreenInfo) {\r\n                    fullScreenInfo.scrollTo({\r\n                        top: fullScreenInfo.scrollHeight,\r\n                        behavior: 'smooth'\r\n                    });\r\n                    fullScreenInfo.scrollTop = fullScreenInfo.scrollHeight;\r\n                }\r\n                \r\n                // Focus on the feedback text area to bring it into view\r\n                setTimeout(() => {\r\n                    const feedbackText = document.getElementById(\"feedbackText\");\r\n                    if (feedbackText) {\r\n                        feedbackText.focus();\r\n                    }\r\n                }, 100);\r\n            }\r\n        }, 200); // Increased delay to ensure DOM rendering\r\n    } else {\r\n        console.error(\"Popup content not found!\");\r\n        return;\r\n    }\r\n\r\n    // Initialize Dropzone\r\n    feedbackDropzone = new Dropzone(\"#dropzoneFeedback\", {\r\n        url: \"/upload\",\r\n        autoProcessQueue: false,\r\n        maxFiles: 5,\r\n        maxFilesize: 100,\r\n        acceptedFiles: \"image/*\",\r\n        addRemoveLinks: false,\r\n        dictDefaultMessage: \"Drag & drop files here or click to upload\",\r\n        clickable: true,\r\n        init: function() {\r\n            const dzInstance = this;\r\n            this.on(\"addedfile\", function(file) {\r\n                const previewElement = file.previewElement;\r\n                const deleteIcon = document.createElement(\"img\");\r\n                deleteIcon.src = \"/assets/images/imgdelete.png\";\r\n                deleteIcon.alt = \"Delete\";\r\n                deleteIcon.classList.add(\"delete-icon\");\r\n                previewElement.querySelector(\".dz-image\").appendChild(deleteIcon);\r\n\r\n                deleteIcon.addEventListener(\"click\", function(e) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    dzInstance.removeFile(file);\r\n                });\r\n            });\r\n\r\n            this.on(\"removedfile\", function(file) {\r\n                console.log(\"File removed:\", file.name);\r\n            });\r\n        }\r\n    });\r\n\r\n    // Email validation\r\n    document.getElementById(\"userEmail\").addEventListener(\"input\", function() {\r\n        const isValid = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(this.value);\r\n        document.getElementById(\"emailError\").classList.toggle(\"d-none\", isValid);\r\n    });\r\n\r\n    // Form submission\r\n    document.getElementById(\"feedbackForm\").addEventListener(\"submit\", async function(event) {\r\n        event.preventDefault();\r\n\r\n        const formData = new FormData();\r\n        formData.append(\"name\", window.currentPlaceName);\r\n        formData.append(\"id\", window.currentPlaceId);\r\n        formData.append(\"strPlacemarkId\", window.currentStrPlacemarkId);    \r\n        formData.append(\"feedbackText\", document.getElementById(\"feedbackText\").value);\r\n        formData.append(\"userName\", document.getElementById(\"userName\").value);\r\n        formData.append(\"userEmail\", document.getElementById(\"userEmail\").value);\r\n\r\n        feedbackDropzone.files.forEach(file => {\r\n            formData.append(\"images\", file);\r\n        });\r\n\r\n        try {\r\n            const response = await fetch(`/api/send-feedback`, {\r\n                method: \"POST\",\r\n                body: formData\r\n            });\r\n            const result = await response.json();\r\n\r\n            // Cleanup after submission\r\n            if (currentFeedbackForm) {\r\n                currentFeedbackForm.remove();\r\n                currentFeedbackForm = null;\r\n            }\r\n            if (feedbackDropzone) {\r\n                feedbackDropzone.destroy();\r\n                feedbackDropzone = null;\r\n            }\r\n\r\n            // Find the message div and footer within the correct context\r\n            const messageDiv = contextElement ? contextElement.querySelector(\"#feedback-message\") : document.getElementById(\"feedback-message\");\r\n            const modalFooter = contextElement ? contextElement.querySelector(\".modal-footer\") : document.querySelector(\".modal-footer\");\r\n\r\n            if (messageDiv) {\r\n                if (result.success) {\r\n                    messageDiv.textContent = result.message || \"Feedback submitted successfully!\";\r\n                    messageDiv.classList.remove(\"text-danger\");\r\n                    messageDiv.classList.add(\"text-success\");\r\n                } else {\r\n                    messageDiv.textContent = result.error || \"An error occurred.\";\r\n                    messageDiv.classList.remove(\"text-success\");\r\n                    messageDiv.classList.add(\"text-danger\");\r\n                }\r\n            } else {\r\n                console.error(\"Feedback message div not found in context.\");\r\n            }\r\n            \r\n            if (modalFooter) {\r\n                modalFooter.style.display = \"flex\"; // Restore footer visibility\r\n            } else {\r\n                console.error(\"Modal footer not found in context.\");\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error(\"Submission error:\", error);\r\n            // Attempt to restore footer even on error\r\n            const modalFooter = contextElement ? contextElement.querySelector(\".modal-footer\") : document.querySelector(\".modal-footer\");\r\n            if (modalFooter) modalFooter.style.display = \"flex\";\r\n        }\r\n    });\r\n}\r\n\r\nfunction cancelFeedback() {\r\n    // Cleanup feedback form and Dropzone\r\n    if (currentFeedbackForm) {\r\n        currentFeedbackForm.remove();\r\n        currentFeedbackForm = null;\r\n    }\r\n    if (feedbackDropzone) {\r\n        feedbackDropzone.destroy();\r\n        feedbackDropzone = null;\r\n    }\r\n    // Find the correct context and footer to restore\r\n    const fullScreenInfo = document.getElementById('fullScreenInfo');\r\n    const isFullScreen = fullScreenInfo && fullScreenInfo.classList.contains('visible');\r\n    const contextElement = isFullScreen ? fullScreenInfo.querySelector('#fullscreen-content-area') : document.querySelector(\".leaflet-popup-content\");\r\n    if (contextElement) {\r\n        let modalFooter = contextElement.querySelector(\".modal-footer\");\r\n        if (modalFooter) modalFooter.style.display = \"flex\";\r\n    } else {\r\n        // Fallback for safety, though contextElement should exist if form was shown\r\n        let fallbackFooter = document.querySelector(\".modal-footer\");\r\n        if (fallbackFooter) fallbackFooter.style.display = \"flex\";\r\n    }\r\n}\r\n\r\n// Export functions\r\nexport {\r\n    changeSwiper,\r\n    initSwiper,\r\n    getAngleRange,\r\n    loadPlaceDetails,\r\n    showFeebackForm,\r\n    cancelFeedback\r\n};","import { \r\n    getAngleRange, \r\n    loadPlaceDetails, \r\n    showFeebackForm, \r\n    cancelFeedback \r\n} from './spots-helper.js';\r\n\r\n// Use a module initialization function that waits for map to be ready\r\nexport function initSpotPG() {\r\n    // Check if map and placesLayerPG are available in the window object\r\n    if (!window.map || !window.placesLayerPG) {\r\n        console.error(\"Map or placesLayerPG is not defined. Retrying in 500ms...\");\r\n        setTimeout(initSpotPG, 500);\r\n        return;\r\n    }\r\n\r\n    console.log(\"Initializing PG spots module...\");\r\n\r\n    // Expose needed functions to global scope for event handlers\r\n    window.showFeebackForm = showFeebackForm;\r\n    window.cancelFeedback = cancelFeedback;\r\n\r\n    // Create cluster group and nest it in the existing layer group\r\n    const clusterGroup = L.markerClusterGroup({\r\n        disableClusteringAtZoom: 9,\r\n        spiderfyOnMaxZoom: true,\r\n        showCoverageOnHover: true,\r\n        zoomToBoundsOnClick: true,\r\n        maxClusterRadius: 250,\r\n        iconCreateFunction: function(cluster) {\r\n            return L.divIcon({ \r\n                html: `<div class=\"cluster-marker\">${cluster.getChildCount()}</div>`,\r\n                className: 'pg-cluster-icon',\r\n                iconSize: L.point(30, 30)\r\n            });\r\n        }\r\n    });\r\n\r\n    window.placesLayerPG.addLayer(clusterGroup);\r\n\r\n    // Track current fetch controller to allow cancellation\r\n    let currentFetchController = null;\r\n    // Add debounce timer\r\n    let fetchDebounceTimer = null;\r\n    const DEBOUNCE_DELAY = 300; // ms\r\n\r\n    // Fetch places without descriptions\r\n    function fetchPlaces() {\r\n        // Only proceed if the layer is on the map\r\n        if (!window.map.hasLayer(window.placesLayerPG)) {\r\n            console.log(\"PG layer not visible, skipping fetch\");\r\n            return;\r\n        }\r\n        \r\n        // Clear any pending debounce\r\n        if (fetchDebounceTimer) {\r\n            clearTimeout(fetchDebounceTimer);\r\n        }\r\n        \r\n        // Debounce the fetch call to prevent rapid successive requests\r\n        fetchDebounceTimer = setTimeout(() => {\r\n            // Cancel any ongoing fetch\r\n            if (currentFetchController) {\r\n                currentFetchController.abort();\r\n            }\r\n\r\n            // Create a new controller for this fetch\r\n            currentFetchController = new AbortController();\r\n            const signal = currentFetchController.signal;\r\n\r\n            const bounds = window.map.getBounds();\r\n            const nw_lat = bounds.getNorthWest().lat;\r\n            const nw_lng = bounds.getNorthWest().lng;\r\n            const se_lat = bounds.getSouthEast().lat;\r\n            const se_lng = bounds.getSouthEast().lng;\r\n\r\n            fetch(`/api/places?nw_lat=${nw_lat}&nw_lng=${nw_lng}&se_lat=${se_lat}&se_lng=${se_lng}&type=TO&type=TOW&type=TH`, {\r\n                signal // Attach the abort signal to the fetch call\r\n            })\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    // Only process if this is still the active request\r\n                    if (signal.aborted) return;\r\n                    \r\n                    clusterGroup.clearLayers();\r\n\r\n                    L.geoJSON(data, {\r\n                        pointToLayer: function (feature, latlng) {\r\n                            return L.marker(latlng, {\r\n                                icon: L.canvasIcon({\r\n                                    iconSize: [50, 50],\r\n                                    iconAnchor: [15, 15],\r\n                                    drawIcon: function (icon, type) {\r\n                                        if (type === 'icon') {\r\n                                            var ctx = icon.getContext('2d');\r\n                                            var size = L.point(this.options.iconSize);\r\n                                            var center = L.point(size.x / 2, size.y / 2);\r\n                                            ctx.clearRect(0, 0, size.x, size.y);\r\n\r\n                                            let direction = feature.properties.direction || \"\";\r\n                                            let angleRanges = getAngleRange(direction);\r\n\r\n                                            ctx.beginPath();\r\n                                            angleRanges.forEach(([start, end]) => {\r\n                                                ctx.moveTo(center.x, center.y);\r\n                                                ctx.arc(center.x, center.y, center.x, (start - 90) * Math.PI / 180, (end - 90) * Math.PI / 180, false);\r\n                                                ctx.lineTo(center.x, center.y);\r\n                                            });\r\n                                            ctx.fillStyle = 'orange';\r\n                                            ctx.fill();\r\n                                            ctx.closePath();\r\n\r\n                                            ctx.beginPath();\r\n                                            ctx.arc(center.x, center.y, center.x / 4, 0, Math.PI * 2);\r\n                                            ctx.fillStyle = 'green';\r\n                                            ctx.fill();\r\n                                            ctx.closePath();\r\n                                        }\r\n                                    }\r\n                                })\r\n                            });\r\n                        },\r\n                        onEachFeature: function (feature, layer) {\r\n                            if (feature.properties) {\r\n                                let popupContent = `<b>${feature.properties.name}</b><br>\r\n                                                    Type: ${feature.properties.type}<br>\r\n                                                    Direction: ${feature.properties.direction}<br>\r\n                                                    <i>Loading details...</i>`;\r\n\r\n                                let responsivePopup = L.responsivePopup({\r\n                                    hasTip: true,\r\n                                    autoPan: false,\r\n                                    offset: [15, 25],\r\n                                    maxWidth: 900,\r\n                                    maxHeight: 780\r\n                                }).setContent(popupContent);\r\n\r\n                                layer.bindPopup(responsivePopup);\r\n\r\n                                layer.on(\"popupopen\", async function () {\r\n                                    await loadPlaceDetails(layer, feature.properties.id);\r\n                                });\r\n                            }\r\n                            \r\n                            clusterGroup.addLayer(layer);\r\n                        }\r\n                    });\r\n                    \r\n                    // Clear the controller reference when done\r\n                    currentFetchController = null;\r\n                })\r\n                .catch(error => {\r\n                    // Don't log aborted requests as errors\r\n                    if (error.name !== 'AbortError') {\r\n                        console.error(\"Error fetching PG places:\", error);\r\n                    }\r\n                });\r\n        }, DEBOUNCE_DELAY);\r\n    }\r\n\r\n    // IMPORTANT: Expose fetchPlaces to window so it can be called from index.js\r\n    window.fetchPlacesPG = fetchPlaces;\r\n\r\n    // REMOVED: Don't attach moveend listener here anymore\r\n    // The central handler in index.js will call fetchPlacesPG when needed\r\n\r\n    // Initial load only if layer is visible\r\n    if (window.map.hasLayer(window.placesLayerPG)) {\r\n        fetchPlaces();\r\n    }\r\n    \r\n    console.log(\"PG spots module initialized\");\r\n}\r\n\r\n// Listen for map initialization event\r\ndocument.addEventListener(\"map_initialized\", function() {\r\n    console.log(\"Map initialized event received in PG spots module\");\r\n    setTimeout(initSpotPG, 100);\r\n});\r\n\r\n// Alternative initialization approach\r\nsetTimeout(() => {\r\n    if (window.mapInitialized) {\r\n        console.log(\"Backup initialization for PG spots module\");\r\n        initSpotPG();\r\n    }\r\n}, 1000);","import { \r\n    getAngleRange, \r\n    loadPlaceDetails, \r\n    showFeebackForm, \r\n    cancelFeedback \r\n} from './spots-helper.js';\r\n\r\n// Use a module initialization function that waits for map to be ready\r\nexport function initSpotHG() {\r\n    // Check if map and placesLayerHG are available in the window object\r\n    if (!window.map || !window.placesLayerHG) {\r\n        console.error(\"Map or placesLayerHG is not defined. Retrying in 500ms...\");\r\n        setTimeout(initSpotHG, 500);\r\n        return;\r\n    }\r\n\r\n    console.log(\"Initializing HG spots module...\");\r\n\r\n    // Expose needed functions to global scope for event handlers\r\n    window.showFeebackForm = showFeebackForm;\r\n    window.cancelFeedback = cancelFeedback;\r\n\r\n    // Create cluster group and nest it in the existing layer group\r\n    const clusterGroup = L.markerClusterGroup({\r\n        disableClusteringAtZoom: 9,\r\n        spiderfyOnMaxZoom: true,\r\n        showCoverageOnHover: true,\r\n        zoomToBoundsOnClick: true,\r\n        maxClusterRadius: 250,\r\n        iconCreateFunction: function(cluster) {\r\n            return L.divIcon({ \r\n                html: `<div class=\"cluster-marker\">${cluster.getChildCount()}</div>`,\r\n                className: 'hg-cluster-icon',\r\n                iconSize: L.point(30, 30)\r\n            });\r\n        }\r\n    });\r\n\r\n    window.placesLayerHG.addLayer(clusterGroup);\r\n\r\n    // Track current fetch controller to allow cancellation\r\n    let currentFetchController = null;\r\n    // Add debounce timer\r\n    let fetchDebounceTimer = null;\r\n    const DEBOUNCE_DELAY = 300; // ms\r\n\r\n    // Fetch places without descriptions\r\n    function fetchPlaces() {\r\n        // Clear any pending debounce\r\n        if (fetchDebounceTimer) {\r\n            clearTimeout(fetchDebounceTimer);\r\n        }\r\n        \r\n        // Debounce the fetch call to prevent rapid successive requests\r\n        fetchDebounceTimer = setTimeout(() => {\r\n            // Cancel any ongoing fetch\r\n            if (currentFetchController) {\r\n                currentFetchController.abort();\r\n            }\r\n\r\n            // Create a new controller for this fetch\r\n            currentFetchController = new AbortController();\r\n            const signal = currentFetchController.signal;\r\n\r\n            const bounds = window.map.getBounds();\r\n            const nw_lat = bounds.getNorthWest().lat;\r\n            const nw_lng = bounds.getNorthWest().lng;\r\n            const se_lat = bounds.getSouthEast().lat;\r\n            const se_lng = bounds.getSouthEast().lng;\r\n\r\n            fetch(`/api/places?nw_lat=${nw_lat}&nw_lng=${nw_lng}&se_lat=${se_lat}&se_lng=${se_lng}&type=TO-HG&type=TOW-HG`, {\r\n                signal // Attach the abort signal to the fetch call\r\n            })\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    // Only process if this is still the active request\r\n                    if (signal.aborted) return;\r\n                    \r\n                    clusterGroup.clearLayers();\r\n\r\n                    L.geoJSON(data, {\r\n                        pointToLayer: function (feature, latlng) {\r\n                            return L.marker(latlng, {\r\n                                icon: L.canvasIcon({\r\n                                    iconSize: [50, 50],\r\n                                    iconAnchor: [15, 15],\r\n                                    drawIcon: function (icon, type) {\r\n                                        if (type === 'icon') {\r\n                                            var ctx = icon.getContext('2d');\r\n                                            var size = L.point(this.options.iconSize);\r\n                                            var center = L.point(size.x / 2, size.y / 2);\r\n                                            ctx.clearRect(0, 0, size.x, size.y);\r\n\r\n                                            let direction = feature.properties.direction || \"\";\r\n                                            let angleRanges = getAngleRange(direction);\r\n\r\n                                            ctx.beginPath();\r\n                                            angleRanges.forEach(([start, end]) => {\r\n                                                ctx.moveTo(center.x, center.y);\r\n                                                ctx.arc(center.x, center.y, center.x, (start - 90) * Math.PI / 180, (end - 90) * Math.PI / 180, false);\r\n                                                ctx.lineTo(center.x, center.y);\r\n                                            });\r\n                                            ctx.fillStyle = 'orange';\r\n                                            ctx.fill();\r\n                                            ctx.closePath();\r\n\r\n                                            ctx.beginPath();\r\n                                            ctx.arc(center.x, center.y, center.x / 4, 0, Math.PI * 2);\r\n                                            ctx.fillStyle = 'green';\r\n                                            ctx.fill();\r\n                                            ctx.closePath();\r\n                                        }\r\n                                    }\r\n                                })\r\n                            });\r\n                        },\r\n                        onEachFeature: function (feature, layer) {\r\n                            if (feature.properties) {\r\n                                let popupContent = `<b>${feature.properties.name}</b><br>\r\n                                                    Type: ${feature.properties.type}<br>\r\n                                                    Direction: ${feature.properties.direction}<br>\r\n                                                    <i>Loading details...</i>`;\r\n\r\n                                let responsivePopup = L.responsivePopup({\r\n                                    hasTip: true,\r\n                                    autoPan: false,\r\n                                    offset: [15, 25],\r\n                                    maxWidth: 900,\r\n                                    maxHeight: 780\r\n                                }).setContent(popupContent);\r\n\r\n                                layer.bindPopup(responsivePopup);\r\n\r\n                                layer.on(\"popupopen\", async function () {\r\n                                    await loadPlaceDetails(layer, feature.properties.id);\r\n                                });\r\n                            }\r\n                            \r\n                            clusterGroup.addLayer(layer);\r\n                        }\r\n                    });\r\n                    \r\n                    // Clear the controller reference when done\r\n                    currentFetchController = null;\r\n                })\r\n                .catch(error => {\r\n                    // Don't log aborted requests as errors\r\n                    if (error.name !== 'AbortError') {\r\n                        console.error(\"Error fetching HG places:\", error);\r\n                    }\r\n                });\r\n        }, DEBOUNCE_DELAY);\r\n    }\r\n\r\n    // IMPORTANT: Expose fetchPlaces to window so it can be called from index.js\r\n    window.fetchPlacesHG = fetchPlaces;\r\n\r\n    // REMOVED: Don't attach moveend listener here anymore\r\n    // The central handler in index.js will call fetchPlacesPG when needed\r\n\r\n    // Initial load only if layer is visible\r\n    if (window.map.hasLayer(window.placesLayerHG)) {\r\n        fetchPlaces();\r\n    }\r\n    \r\n    console.log(\"PG spots module initialized\");\r\n}\r\n\r\n// Listen for map initialization event\r\ndocument.addEventListener(\"map_initialized\", function() {\r\n    console.log(\"Map initialized event received in HG spots module\");\r\n    setTimeout(initSpotHG, 100);\r\n});\r\n\r\n// Alternative initialization approach\r\nsetTimeout(() => {\r\n    if (window.mapInitialized) {\r\n        console.log(\"Backup initialization for HG spots module\");\r\n        initSpotHG();\r\n    }\r\n}, 1000);","import { \r\n    getAngleRange, \r\n    loadPlaceDetails, \r\n    showFeebackForm, \r\n    cancelFeedback \r\n} from './spots-helper.js';\r\n\r\n// Use a module initialization function that waits for map to be ready\r\nexport function initSpotLZ() {\r\n    if (!window.map || !window.placesLayerLZ) {\r\n        setTimeout(initSpotLZ, 500);\r\n        return;\r\n    }\r\n\r\n    console.log(\"Initializing LZ spots module...\");\r\n\r\n    // Create cluster group and nest it in the existing layer group\r\n    const clusterGroup = L.markerClusterGroup({\r\n        disableClusteringAtZoom: 9,\r\n        spiderfyOnMaxZoom: true,\r\n        showCoverageOnHover: true,\r\n        zoomToBoundsOnClick: true,\r\n        maxClusterRadius: 250,\r\n        iconCreateFunction: function(cluster) {\r\n            return L.divIcon({ \r\n                html: `<div class=\"cluster-marker\">${cluster.getChildCount()}</div>`,\r\n                className: 'lz-cluster-icon',\r\n                iconSize: L.point(30, 30)\r\n            });\r\n        }\r\n    });\r\n\r\n    window.placesLayerLZ.addLayer(clusterGroup); // Add cluster group to the layer group\r\n\r\n    // Track current fetch controller to allow cancellation\r\n    let currentFetchController = null;\r\n    // Add debounce timer\r\n    let fetchDebounceTimer = null;\r\n    const DEBOUNCE_DELAY = 300; // ms\r\n\r\n    // Update fetchPlaces to use clusterGroup\r\n    function fetchPlaces() {\r\n        // Clear any pending debounce\r\n        if (fetchDebounceTimer) {\r\n            clearTimeout(fetchDebounceTimer);\r\n        }\r\n        \r\n        // Debounce the fetch call to prevent rapid successive requests\r\n        fetchDebounceTimer = setTimeout(() => {\r\n            // Cancel any ongoing fetch\r\n            if (currentFetchController) {\r\n                currentFetchController.abort();\r\n            }\r\n\r\n            // Create a new controller for this fetch\r\n            currentFetchController = new AbortController();\r\n            const signal = currentFetchController.signal;\r\n            \r\n            const bounds = window.map.getBounds();\r\n            const nw_lat = bounds.getNorthWest().lat;\r\n            const nw_lng = bounds.getNorthWest().lng;\r\n            const se_lat = bounds.getSouthEast().lat;\r\n            const se_lng = bounds.getSouthEast().lng;\r\n\r\n            fetch(`/api/places?nw_lat=${nw_lat}&nw_lng=${nw_lng}&se_lat=${se_lat}&se_lng=${se_lng}&type=LZ`, {\r\n                signal // Attach the abort signal to the fetch call\r\n            })\r\n                .then(response => response.json())\r\n                .then(data => {\r\n                    // Only process if this is still the active request\r\n                    if (signal.aborted) return;\r\n                    \r\n                    clusterGroup.clearLayers(); // Clear the cluster group\r\n\r\n                    L.geoJSON(data, {\r\n                        pointToLayer: function (feature, latlng) {\r\n                            return L.marker(latlng, {\r\n                                icon: L.icon({\r\n                                    iconUrl: '../assets/images/windsock.png', // Replace with the actual path to your PNG\r\n                                    iconSize: [20, 20], // Adjust size as needed\r\n                                    iconAnchor: [20, 20] // Adjust anchor to center the image properly\r\n                                })\r\n                            });\r\n                        },\r\n                        onEachFeature: function (feature, layer) {\r\n                            if (feature.properties) {\r\n                                let popupContent = `<b>${feature.properties.name}</b><br>\r\n                                                    Type: ${feature.properties.type}<br>\r\n                                                    Direction: ${feature.properties.direction}<br>\r\n                                                    <i>Loading details...</i>`;\r\n\r\n                                let responsivePopup = L.responsivePopup({\r\n                                    hasTip: true,\r\n                                    autoPan: false,\r\n                                    offset: [15, 25],\r\n                                    maxWidth: 900,\r\n                                    maxHeight: 780\r\n                                }).setContent(popupContent);\r\n\r\n                                layer.bindPopup(responsivePopup);\r\n\r\n                                // Fetch details when popup is opened\r\n                                layer.on(\"popupopen\", async function () {\r\n                                    await loadPlaceDetails(layer, feature.properties.id);\r\n                                });\r\n                               \r\n                            }\r\n                            \r\n                            clusterGroup.addLayer(layer); // Add to clusterGroup\r\n                        }\r\n                    });\r\n                    \r\n                    // Clear the controller reference when done\r\n                    currentFetchController = null;\r\n                })\r\n                .catch(error => {\r\n                    // Don't log aborted requests as errors\r\n                    if (error.name !== 'AbortError') {\r\n                        console.error(\"Error fetching LZ places:\", error);\r\n                    }\r\n                });\r\n        }, DEBOUNCE_DELAY);\r\n    }\r\n    // IMPORTANT: Expose fetchPlaces to window so it can be called from index.js\r\n    window.fetchPlacesLZ = fetchPlaces;\r\n\r\n    // REMOVED: Don't attach moveend listener here anymore\r\n    // The central handler in index.js will call fetchPlacesPG when needed\r\n\r\n    // Initial load only if layer is visible\r\n    if (window.map.hasLayer(window.placesLayerLZ)) {\r\n        fetchPlaces();\r\n    }\r\n    \r\n    console.log(\"PG spots module initialized\");\r\n}\r\n\r\n// Listen for map initialization event\r\ndocument.addEventListener(\"map_initialized\", function() {\r\n    console.log(\"Map initialized event received in LZ spots module\");\r\n    // Give a slight delay to ensure map is fully ready\r\n    setTimeout(initSpotLZ, 100);\r\n});\r\n\r\n// Alternative initialization approach - also try to init if we missed the event\r\nsetTimeout(() => {\r\n    if (window.mapInitialized) {\r\n        console.log(\"Backup initialization for LZ spots module\");\r\n        initSpotLZ();\r\n    }\r\n}, 1000);","// obstacles.js\r\nlet obstacleClickHandler = null;\r\nlet obstacleDebounceTimer;\r\n\r\n// Initialize the obstacle layer\r\nlet obstacleLayer = L.layerGroup({\r\n    attribution: 'XContest&copy; <a href=\"https://xcontest.org\">XContest</a>'\r\n});\r\nwindow.obstacleLayer = obstacleLayer;\r\n\r\nfunction fetchObstacles() {\r\n  if (!window.map) {\r\n    console.error(\"Map not initialized yet\");\r\n    return;\r\n  }\r\n\r\n  // Get current map bounds\r\n  const bounds = window.map.getBounds();\r\n  const nw = bounds.getNorthWest();\r\n  const se = bounds.getSouthEast();\r\n\r\n  const apiUrl = `/api/obstacles?nw_lat=${nw.lat}&nw_lng=${nw.lng}&se_lat=${se.lat}&se_lng=${se.lng}`;\r\n\r\n  // Clear previous layers\r\n  obstacleLayer.clearLayers();\r\n\r\n  fetch(apiUrl)\r\n    .then(response => response.json())\r\n    .then(geoJson => {\r\n      const obstacles = [];\r\n\r\n      geoJson.features.forEach(feature => {\r\n        if (feature.geometry.type === \"LineString\") {\r\n          // Convert coordinates to LatLng format [lat, lng]\r\n          const coords = feature.geometry.coordinates.map(coord => [\r\n            coord[1],\r\n            coord[0]\r\n          ]);\r\n\r\n          // Create polyline with styling from properties\r\n          const polyline = L.polyline(coords, {\r\n            color: feature.properties.strokeColor || \"#ff0000\",\r\n            weight: feature.properties.strokeWeight || 2\r\n          });\r\n\r\n          // Store obstacle data with its polyline\r\n          obstacles.push({ polyline, data: feature.properties });\r\n\r\n          // Add to layer group\r\n          polyline.addTo(obstacleLayer);\r\n\r\n          // Add popup content (using standard popup)\r\n          polyline.bindPopup(() => {\r\n            const content = [];\r\n            if (feature.properties.name) content.push(`<b>${feature.properties.name}</b>`);\r\n            if (feature.properties.type) content.push(`Type: ${feature.properties.type}`);\r\n            if (feature.properties.description) content.push(`Description: ${feature.properties.description}`);\r\n            if (feature.properties.maxAgl) content.push(`Max AG: ${feature.properties.maxAgl}m`);\r\n            \r\n            return content.join(\"<br>\");\r\n          }, { className: 'obstacle-popup' }); // Add custom class to identify obstacle popups\r\n        }\r\n      });\r\n\r\n      console.log(`Added ${obstacles.length} obstacles to the map`);\r\n\r\n      // Remove existing click handler if any\r\n      if (obstacleClickHandler) {\r\n        window.map.off(\"click\", obstacleClickHandler);\r\n      }\r\n\r\n      // Add new click handler for obstacles\r\n      obstacleClickHandler = function(e) {\r\n        if (!window.map.hasLayer(obstacleLayer)) return;\r\n\r\n        const clickedPoint = e.latlng;\r\n        const clickedObstacles = [];\r\n\r\n        obstacles.forEach(({ polyline, data }) => {\r\n          if (polyline.getBounds().contains(clickedPoint)) {\r\n            clickedObstacles.push(data);\r\n          }\r\n        });\r\n\r\n        if (clickedObstacles.length > 0) {\r\n          const popupContent = clickedObstacles.map(obs => `\r\n            ${obs.name ? `<b>${obs.name}</b><br>` : ''}\r\n            ${obs.type ? `Type: ${obs.type}<br>` : ''}\r\n            ${obs.description ? `Description: ${obs.description}<br>` : ''}\r\n            ${obs.maxAgl ? `Max AG: ${obs.maxAgl}m<br>` : ''}\r\n          `).join(\"<hr>\");\r\n\r\n          L.popup({ className: 'obstacle-popup' }) // Add custom class to identify obstacle popups\r\n            .setLatLng(clickedPoint)\r\n            .setContent(popupContent)\r\n            .openOn(window.map);\r\n        }\r\n      };\r\n\r\n      window.map.on(\"click\", obstacleClickHandler);\r\n    })\r\n    .catch(error => console.error(\"Error fetching obstacles:\", error));\r\n}\r\n\r\n// Export the fetch function\r\nwindow.fetchObstacles = fetchObstacles;\r\n\r\n\r\n","\r\n\r\nL.TimeDimension.Layer.Rainviewer = L.TimeDimension.Layer.extend({\r\n\r\n    initialize: function(endpoint, options={}) {\r\n      \r\n      options['attribution'] = options['attribution'] || \"<a href='https://www.rainviewer.com/api.html' rel='noopener noreferrer' target='_blank'>RainViewer</a>\";\r\n  \r\n      L.TimeDimension.Layer.prototype.initialize.call(this, L.tileLayer(''), options);\r\n          this._endpoint = endpoint; // Store endpoint for refresh\r\n          this._refreshInterval = this.options.refreshInterval || 0; // Refresh interval in ms (0 = disabled)\r\n          this._refreshTimer = null; // Timer ID\r\n          this._metadata = {};\r\n          this._frames = {};\r\n          this._layers = {};\r\n          this._defaultTime = 12;\r\n          this._availableTimes = [];\r\n          this._timeCacheBackward = this.options.cacheBackward || this.options.cache || 0;\r\n          this._timeCacheForward = this.options.cacheForward || this.options.cache || 0;\r\n          this._updateTimeDimension = this.options.updateTimeDimension  || true ;\r\n          this._updateTimeDimensionMode = this.options.updateTimeDimensionMode || 'union'; // 'union', 'replace' or extremes\r\n          this._type = this.options.type || 'radar';\r\n          this._loaded = false;\r\n  \r\n          fetchRainviewerMetadata(this._endpoint).then((metadata) => {\r\n            this._metadata = metadata;\r\n            this._loaded = true;\r\n            if(this._map && this._map.hasLayer(this)){\r\n              this._setAvailableTimes();\r\n            }\r\n          });\r\n  \r\n          this._baseLayer.on('load', (function() {\r\n              this._baseLayer.setLoaded(true);\r\n              this.fire('timeload', {\r\n                  time: this._defaultTime\r\n              });\r\n          }).bind(this));\r\n      },\r\n      onAdd: function(map) {\r\n          L.TimeDimension.Layer.prototype.onAdd.call(this, map);\r\n          if (this._loaded) {\r\n              this._setAvailableTimes();\r\n          }\r\n          // Start refresh timer if interval is set\r\n          if (this._refreshInterval > 0 && !this._refreshTimer) {\r\n              this._refreshTimer = setInterval(this._refreshData.bind(this), this._refreshInterval);\r\n          }\r\n      },\r\n      onRemove: function(map) {\r\n          L.TimeDimension.Layer.prototype.onRemove.call(this, map);\r\n          // Clear refresh timer\r\n          if (this._refreshTimer) {\r\n              clearInterval(this._refreshTimer);\r\n              this._refreshTimer = null;\r\n          }\r\n      },\r\n      _setAvailableTimes() {\r\n        if(this._type == 'radar'){\r\n          let times = [...this._metadata['radar'].nowcast, ...this._metadata['radar'].past];\r\n          times.forEach(frame => this._frames[frame.time * 1000] = frame);\r\n        }else if(this._type == 'satellite'){\r\n          let times = this._metadata['satellite'].infrared;\r\n          times.forEach(frame => this._frames[frame.time * 1000] = frame);\r\n        }\r\n  \r\n        this._availableTimes = L.TimeDimension.Util.sort_and_deduplicate(Object.keys(this._frames).map(time => Number(time)));\r\n        this._updateCurrentTime = this._updateCurrentTime || (this._timeDimension && this._timeDimension.getAvailableTimes().length == 0);\r\n        if (this._timeDimension && (this._updateTimeDimension || this._timeDimension.getAvailableTimes().length == 0)) {\r\n            this._timeDimension.setAvailableTimes(this._availableTimes, this._updateTimeDimensionMode);\r\n        }\r\n        if (this._updateCurrentTime && this._timeDimension && this._availableTimes.length) {\r\n            this._timeDimension.setCurrentTime(this._availableTimes[this._defaultTime]);\r\n        }\r\n      },\r\n      _refreshData: async function() {\r\n        console.log('Refreshing Rainviewer data (' + this._type + ')...');\r\n        try {\r\n          const metadata = await fetchRainviewerMetadata(this._endpoint);\r\n          this._metadata = metadata;\r\n          // Clear old frames before setting new ones\r\n          this._frames = {};\r\n          this._setAvailableTimes(); // This updates _availableTimes and the timeDimension control\r\n          this._update(); // This updates the currently displayed layer\r\n          console.log('Rainviewer data refreshed (' + this._type + ').');\r\n        } catch (error) {\r\n          console.error('Error refreshing Rainviewer data:', error);\r\n        }\r\n      },\r\n      eachLayer: function(method, context) {\r\n          for (var prop in this._layers) {\r\n              if (this._layers.hasOwnProperty(prop)) {\r\n                  method.call(context, this._layers[prop]);\r\n              }\r\n          }\r\n          return L.TimeDimension.Layer.prototype.eachLayer.call(this, method, context);\r\n      },\r\n  \r\n      _onNewTimeLoading: function(ev) {\r\n          var layer = this._getLayerForTime(ev.time);\r\n          if (!this._map.hasLayer(layer)) {\r\n              this._map.addLayer(layer);\r\n          }\r\n      },\r\n  \r\n      isReady: function(time) {\r\n          var layer = this._getLayerForTime(time);\r\n          var currentZoom = this._map.getZoom();\r\n          if (layer.options.minZoom && currentZoom < layer.options.minZoom){\r\n              return true;\r\n          }\r\n          if (layer.options.maxZoom && currentZoom > layer.options.maxZoom){\r\n              return true;\r\n          }\r\n          return layer.isLoaded();\r\n      },\r\n  \r\n      _update: function() {\r\n          if (!this._map)\r\n              return;\r\n          var time = this._timeDimension.getCurrentTime();\r\n          // It will get the layer for this time (create or get)\r\n          // Then, the layer will be loaded if necessary, adding it to the map (and show it after loading).\r\n          // If it already on the map (but probably hidden), it will be shown\r\n          var layer = this._getLayerForTime(time);\r\n          if (this._currentLayer == null) {\r\n              this._currentLayer = layer;\r\n          }\r\n          if (!this._map.hasLayer(layer)) {\r\n              this._map.addLayer(layer);\r\n          } else {\r\n              this._showLayer(layer, time);\r\n          }\r\n      },\r\n  \r\n      setOpacity: function(opacity) {\r\n          L.TimeDimension.Layer.prototype.setOpacity.apply(this, arguments);\r\n          // apply to all preloaded caches\r\n          for (var prop in this._layers) {\r\n              if (this._layers.hasOwnProperty(prop) && this._layers[prop].setOpacity) {\r\n                  this._layers[prop].setOpacity(opacity);\r\n              }\r\n          }\r\n      },\r\n      \r\n      setZIndex: function(zIndex){\r\n          L.TimeDimension.Layer.prototype.setZIndex.apply(this, arguments);\r\n          // apply to all preloaded caches\r\n          for (var prop in this._layers) {\r\n              if (this._layers.hasOwnProperty(prop) && this._layers[prop].setZIndex) {\r\n                  this._layers[prop].setZIndex(zIndex);\r\n              }\r\n          }\r\n      },\r\n  \r\n      _unvalidateCache: function() {\r\n          var time = this._timeDimension.getCurrentTime();\r\n          for (var prop in this._layers) {\r\n              if (time != prop && this._layers.hasOwnProperty(prop)) {\r\n                  this._layers[prop].setLoaded(false); // mark it as unloaded\r\n                  this._layers[prop].redraw();\r\n              }\r\n          }\r\n      },\r\n  \r\n      _evictCachedTimes: function(keepforward, keepbackward) {\r\n          // Cache management\r\n          var times = this._getLoadedTimes();\r\n          var strTime = String(this._currentTime);\r\n          var index = times.indexOf(strTime);\r\n          var remove = [];\r\n          // remove times before current time\r\n          if (keepbackward > -1) {\r\n              var objectsToRemove = index - keepbackward;\r\n              if (objectsToRemove > 0) {\r\n                  remove = times.splice(0, objectsToRemove);\r\n                  this._removeLayers(remove);\r\n              }\r\n          }\r\n          if (keepforward > -1) {\r\n              index = times.indexOf(strTime);\r\n              var objectsToRemove = times.length - index - keepforward - 1;\r\n              if (objectsToRemove > 0) {\r\n                  remove = times.splice(index + keepforward + 1, objectsToRemove);\r\n                  this._removeLayers(remove);\r\n              }\r\n          }\r\n      },\r\n  \r\n      _showLayer: function(layer, time) {\r\n          if (this._currentLayer && this._currentLayer !== layer) {\r\n              this._currentLayer.hide();\r\n          }\r\n          layer.show();\r\n          if (this._currentLayer && this._currentLayer === layer) {\r\n              return;\r\n          }\r\n          this._currentLayer = layer;\r\n          this._currentTime = time;\r\n  \r\n          this._evictCachedTimes(this._timeCacheForward, this._timeCacheBackward);\r\n      },\r\n  \r\n      _getLayerForTime: function(time) {\r\n          if (time == 0 || time == this._defaultTime || time == null || !this._loaded) {\r\n              return this._baseLayer;\r\n          }\r\n          if (this._layers.hasOwnProperty(time)) {\r\n              return this._layers[time];\r\n          }\r\n          var nearestTime = this._getNearestTime(time);\r\n          if (this._layers.hasOwnProperty(nearestTime)) {\r\n              return this._layers[nearestTime];\r\n          }\r\n          if (!this._frames.hasOwnProperty(nearestTime)){\r\n              return this._baseLayer;\r\n          }\r\n  \r\n          var newLayer = this._createLayerForTime(nearestTime);\r\n         \r\n          this._layers[time] = newLayer;\r\n  \r\n          newLayer.on('load', (function(layer, time) {\r\n              layer.setLoaded(true);\r\n              // this time entry should exists inside _layers\r\n              // but it might be deleted by cache management\r\n              if (!this._layers[time]) {\r\n                  this._layers[time] = layer;\r\n              }\r\n              if (this._timeDimension && time == this._timeDimension.getCurrentTime() && !this._timeDimension.isLoading()) {\r\n                  this._showLayer(layer, time);\r\n              }\r\n              // console.log('Loaded layer ' + layer.wmsParams.layers + ' with time: ' + new Date(time).toISOString());\r\n              this.fire('timeload', {\r\n                  time: time\r\n              });\r\n          }).bind(this, newLayer, time));\r\n  \r\n          // Hack to hide the layer when added to the map.\r\n          // It will be shown when timeload event is fired from the map (after all layers are loaded)\r\n          newLayer.onAdd = (function(map) {\r\n              Object.getPrototypeOf(this).onAdd.call(this, map);\r\n              this.hide();\r\n          }).bind(newLayer);\r\n          return newLayer;\r\n      },\r\n      \r\n      _createLayerForTime:function(time){\r\n        var options = this.options;\r\n        var url = this._metadata.host;\r\n        let color = 2;\r\n        if(this._type == 'satellite'){\r\n          color = 0;\r\n        }\r\n  \r\n        return new L.TileLayer(url + this._frames[time].path + \"/256/{z}/{x}/{y}/\" + color + \"/1_1.png\", options);\r\n      },\r\n  \r\n      _getLoadedTimes: function() {\r\n          var result = [];\r\n          for (var prop in this._layers) {\r\n              if (this._layers.hasOwnProperty(prop)) {\r\n                  result.push(prop);\r\n              }\r\n          }\r\n          return result.sort(function(a, b) {\r\n              return a - b;\r\n          });\r\n      },\r\n  \r\n      _removeLayers: function(times) {\r\n          for (var i = 0, l = times.length; i < l; i++) {\r\n              if (this._map)\r\n                  this._map.removeLayer(this._layers[times[i]]);\r\n              delete this._layers[times[i]];\r\n          }\r\n      },\r\n  \r\n      setMinimumForwardCache: function(value) {\r\n          if (value > this._timeCacheForward) {\r\n              this._timeCacheForward = value;\r\n          }\r\n      },\r\n  \r\n      _getNearestTime: function(time) {\r\n          if (this._layers.hasOwnProperty(time)) {\r\n              return time;\r\n          }\r\n          if (this._availableTimes.length == 0) {\r\n              return time;\r\n          }\r\n          var index = 0;\r\n          var len = this._availableTimes.length;\r\n          for (; index < len; index++) {\r\n              if (time < this._availableTimes[index]) {\r\n                  break;\r\n              }\r\n          }\r\n          // We've found the first index greater than the time. Get the previous\r\n          if (index > 0) {\r\n              index--;\r\n          }\r\n          if (time != this._availableTimes[index]) {\r\n              console.log('Search layer time: ' + new Date(time).toISOString());\r\n              console.log('Return layer time: ' + new Date(this._availableTimes[index]).toISOString());\r\n          }\r\n          return this._availableTimes[index];\r\n      },\r\n  });\r\n  \r\n  L.timeDimension.layer.rainviewer = function(endpoint, options) {\r\n      return new L.TimeDimension.Layer.Rainviewer(endpoint, options);\r\n  };\r\n  \r\n  async function fetchRainviewerMetadata(endpoint){\r\n    let response = await fetch(endpoint);\r\n    let metadata = await response.json();\r\n    return metadata;\r\n  \r\n  }","// Keycloak integration for user authentication\r\n\r\n// Import Keycloak\r\nimport Keycloak from 'keycloak-js';\r\n\r\n// Initialize Keycloak instance\r\nconst keycloak = new Keycloak({\r\n  url: `${window.location.origin}/auth`,\r\n  realm: 'master',\r\n  clientId: 'xcmaps-client'\r\n});\r\n\r\n// Store the authentication state\r\nlet isAuthenticated = false;\r\nlet userProfile = null;\r\n\r\n// Initialize Keycloak\r\nconst initKeycloak = () => {\r\n  console.log('Initializing Keycloak...');\r\n  return new Promise((resolve, reject) => {\r\n    try {\r\n      keycloak.init({\r\n        onLoad: 'check-sso',\r\n        // Disable silent check SSO to avoid 404 errors\r\n        silentCheckSsoRedirectUri: null,\r\n        checkLoginIframe: false\r\n      })\r\n        .then(authenticated => {\r\n          console.log('Keycloak initialized, authenticated:', authenticated);\r\n          isAuthenticated = authenticated;\r\n          \r\n          if (authenticated) {\r\n            return keycloak.loadUserProfile();\r\n          }\r\n          \r\n          resolve(authenticated);\r\n        })\r\n        .then(profile => {\r\n          if (profile) {\r\n            userProfile = profile;\r\n            updateUserIcon(true);\r\n          }\r\n          resolve(isAuthenticated);\r\n        })\r\n        .catch(error => {\r\n          console.error('Failed to initialize Keycloak:', error);\r\n          resolve(false);\r\n        });\r\n    } catch (error) {\r\n      console.error('Error in initKeycloak:', error);\r\n      resolve(false);\r\n    }\r\n  });\r\n};\r\n\r\n// Login function - redirect to Keycloak login page\r\nconst login = () => {\r\n  console.log('Login clicked - redirecting to Keycloak login');\r\n  try {\r\n    // Set up a callback for when login completes\r\n    keycloak.onAuthSuccess = function() {\r\n      console.log('Authentication successful');\r\n      isAuthenticated = true;\r\n      keycloak.loadUserProfile().then(profile => {\r\n        userProfile = profile;\r\n        updateUserIcon(true);\r\n      });\r\n    };\r\n    \r\n    keycloak.login();\r\n  } catch (error) {\r\n    console.error('Error during login:', error);\r\n    // Show error message to user\r\n    alert('Error during login. Please try again later.');\r\n  }\r\n};\r\n\r\n// Helper function to get the current state of base and overlay layers\r\nfunction getCurrentMapState(control) {\r\n    if (!control || !control.getContainer) {\r\n        console.warn(\"Layer control not available for getting map state.\");\r\n        return { selectedBaseLayer: null, selectedOverlays: [] };\r\n    }\r\n\r\n    const controlContainer = control.getContainer();\r\n    let selectedBaseLayerLabel = null;\r\n    const selectedOverlayLabels = [];\r\n\r\n    // Find selected base layer (radio button)\r\n    const baseLayerRadios = controlContainer.querySelectorAll('.leaflet-control-layers-base input[type=\"radio\"]');\r\n    baseLayerRadios.forEach(radio => {\r\n        if (radio.checked) {\r\n            let labelElement = radio.closest('label') || radio.parentElement.querySelector('span'); // Adjust selector if needed\r\n            if (labelElement && labelElement.textContent.trim()) {\r\n                selectedBaseLayerLabel = labelElement.textContent.trim();\r\n                console.log(\"Found selected base layer label:\", selectedBaseLayerLabel);\r\n            }\r\n        }\r\n    });\r\n\r\n    // Find selected overlay layers (checkboxes)\r\n    const overlayCheckboxes = controlContainer.querySelectorAll('.leaflet-control-layers-overlays input[type=\"checkbox\"]');\r\n    overlayCheckboxes.forEach(checkbox => {\r\n        if (checkbox.checked) {\r\n            let labelElement = checkbox.closest('label') || checkbox.parentElement.querySelector('span'); // Adjust selector if needed\r\n            if (labelElement && labelElement.textContent.trim()) {\r\n                const labelText = labelElement.textContent.trim();\r\n                // Basic filtering attempt - might need refinement if labels are ambiguous\r\n                const knownParentLabels = ['Rain Viewer', 'Thermals', 'Spots']; // Labels of nodes that contain other layers\r\n                if (!knownParentLabels.includes(labelText)) {\r\n                    console.log(\"Found checked overlay layer label:\", labelText);\r\n                    selectedOverlayLabels.push(labelText);\r\n                } else {\r\n                    console.log(\"Skipping potential parent label:\", labelText);\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    console.log(\"Current map state:\", { selectedBaseLayer: selectedBaseLayerLabel, selectedOverlays: selectedOverlayLabels });\r\n    return { selectedBaseLayer: selectedBaseLayerLabel, selectedOverlays: selectedOverlayLabels };\r\n}\r\n\r\n\r\n// Logout function - saves preferences before redirecting to Keycloak logout\r\nconst logout = async () => { // Make async\r\n  console.log('Logout clicked - attempting to save preferences...');\r\n\r\n  // --- Save Preferences before logout ---\r\n  if (isAuthenticated && keycloak.hasRealmRole('user')) {\r\n    console.log(\"User is authenticated and has 'user' role. Saving preferences.\");\r\n    try {\r\n      const currentMapState = getCurrentMapState(window.treeLayersControl); // Get base and overlays state\r\n      // Always prepare and send the current state\r\n      const preferences = {\r\n          selectedBaseLayer: currentMapState.selectedBaseLayer, // Will be null if none selected\r\n          selectedOverlays: currentMapState.selectedOverlays   // Will be [] if none selected\r\n      };\r\n      console.log(\"Sending preferences to save:\", preferences);\r\n\r\n      const response = await fetch('/api/user/preferences', {\r\n          method: 'PUT',\r\n          headers: {\r\n              'Content-Type': 'application/json',\r\n              'Authorization': `Bearer ${keycloak.token}`\r\n          },\r\n          body: JSON.stringify(preferences)\r\n      });\r\n\r\n      if (!response.ok) {\r\n          console.error(`Failed to save preferences: ${response.status} ${response.statusText}`);\r\n          // Optionally inform user, but proceed with logout\r\n      } else {\r\n          console.log(\"Preferences saved successfully (including empty state if applicable).\");\r\n      }\r\n    } catch (error) {\r\n      console.error('Error saving user preferences:', error);\r\n      // Proceed with logout even if saving fails\r\n    }\r\n  } else {\r\n      console.log(\"User not logged in or does not have 'user' role. Skipping preference saving.\");\r\n  }\r\n  // --- End Save Preferences ---\r\n\r\n\r\n  console.log('Proceeding with Keycloak logout...');\r\n  try {\r\n    // Clear local state immediately before redirect\r\n    const redirectUri = window.location.origin;\r\n    isAuthenticated = false;\r\n    userProfile = null;\r\n    // updateUserIcon(false); // This might not run fully before redirect, handle UI update on page load\r\n\r\n    keycloak.logout({ redirectUri: redirectUri });\r\n  } catch (error) {\r\n    console.error('Error during logout:', error);\r\n    // Fallback to manual logout\r\n    isAuthenticated = false;\r\n    userProfile = null;\r\n    updateUserIcon(false);\r\n    \r\n    // Remove profile badge if exists\r\n    const badge = document.getElementById('profile-badge');\r\n    if (badge) {\r\n      badge.remove();\r\n    }\r\n  }\r\n};\r\n\r\n// Check if user is authenticated\r\nconst isUserAuthenticated = () => {\r\n  return isAuthenticated;\r\n};\r\n\r\n// Get user profile\r\nconst getUserProfile = () => {\r\n  return userProfile;\r\n};\r\n\r\n// Update user icon based on authentication state\r\nconst updateUserIcon = (authenticated) => {\r\n  console.log('Updating user icon, authenticated:', authenticated);\r\n  \r\n  // Try to find the icon container with a small delay to ensure DOM is ready\r\n  setTimeout(() => {\r\n    const iconContainer = document.querySelector('.user-icon-container');\r\n    if (iconContainer) {\r\n      console.log('Found user icon container, updating image');\r\n      if (authenticated) {\r\n        // Use the active user icon\r\n        iconContainer.innerHTML = `\r\n          <img id=\"user-control-icon\" src=\"/assets/images/user-active.svg\" width=\"30\" height=\"30\" alt=\"User (logged in)\" />\r\n        `;\r\n        console.log('Set active user icon');\r\n      } else {\r\n        // Use the default user icon\r\n        iconContainer.innerHTML = `\r\n          <svg id=\"user-control-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"30\" height=\"30\" viewBox=\"0 0 256 256\" xml:space=\"preserve\">\r\n            <g style=\"stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;\" transform=\"translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)\">\r\n              <path d=\"M 45 0 C 20.147 0 0 20.147 0 45 c 0 24.853 20.147 45 45 45 s 45 -20.147 45 -45 C 90 20.147 69.853 0 45 0 z M 45 22.007 c 8.899 0 16.14 7.241 16.14 16.14 c 0 8.9 -7.241 16.14 -16.14 16.14 c -8.9 0 -16.14 -7.24 -16.14 -16.14 C 28.86 29.248 36.1 22.007 45 22.007 z M 45 83.843 c -11.135 0 -21.123 -4.885 -27.957 -12.623 c 3.177 -5.75 8.144 -10.476 14.05 -13.341 c 2.009 -0.974 4.354 -0.958 6.435 0.041 c 2.343 1.126 4.857 1.696 7.473 1.696 c 2.615 0 5.13 -0.571 7.473 -1.696 c 2.083 -1 4.428 -1.015 6.435 -0.041 c 5.906 2.864 10.872 7.591 14.049 13.341 C 66.123 78.957 56.135 83.843 45 83.843 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\"/>\r\n            </g>\r\n          </svg>\r\n        `;\r\n        console.log('Set default user icon');\r\n      }\r\n    } else {\r\n      console.error('User icon container not found');\r\n    }\r\n  }, 500);\r\n};\r\n\r\n// Create user control\r\nconst createUserControl = () => {\r\n  try {\r\n    console.log('Creating user control...');\r\n    \r\n    // Check if window.map exists\r\n    if (!window.map) {\r\n      console.error('Map not initialized yet, cannot add user control');\r\n      // Try again after a short delay\r\n      setTimeout(createUserControl, 1000);\r\n      return;\r\n    }\r\n    \r\n    // Check if control already exists\r\n    if (document.getElementById('user-control')) {\r\n      console.log('User control already exists, not creating again');\r\n      return;\r\n    }\r\n    \r\n    // Create a Leaflet control for the user icon\r\n    L.Control.UserControl = L.Control.extend({\r\n      onAdd: function(map) {\r\n        console.log('Adding user control to map');\r\n        const container = L.DomUtil.create('div', 'leaflet-control-user');\r\n        container.id = 'user-control';\r\n        \r\n        // Create container for the icon\r\n        container.innerHTML = `<div class=\"user-icon-container\"></div>`;\r\n        \r\n        // Set initial icon based on authentication state\r\n        updateUserIcon(isAuthenticated);\r\n        \r\n        // Add click event listener\r\n        L.DomEvent.on(container, 'click', function(e) {\r\n          L.DomEvent.stopPropagation(e);\r\n          \r\n          if (isAuthenticated) {\r\n            // Show profile badge with logout option\r\n            showProfileBadge(container);\r\n          } else {\r\n            // Login\r\n            login();\r\n          }\r\n        });\r\n        \r\n        return container;\r\n      }\r\n    });\r\n    \r\n    L.control.userControl = function(opts) {\r\n      return new L.Control.UserControl(opts);\r\n    };\r\n    \r\n    // Add the user control to the map\r\n    const userControl = L.control.userControl({ position: 'topright' });\r\n    userControl.addTo(window.map);\r\n    console.log('User control added to map');\r\n    \r\n    return userControl;\r\n  } catch (error) {\r\n    console.error('Error creating user control:', error);\r\n  }\r\n};\r\n\r\n// Show profile badge with logout option\r\nconst showProfileBadge = (container) => {\r\n  // Remove existing profile badge if any\r\n  const existingBadge = document.getElementById('profile-badge');\r\n  if (existingBadge) {\r\n    existingBadge.remove();\r\n    return;\r\n  }\r\n  \r\n  // Create profile badge\r\n  const badge = document.createElement('div');\r\n  badge.id = 'profile-badge';\r\n  badge.className = 'profile-badge';\r\n  \r\n  // Add user info and logout button\r\n  badge.innerHTML = `\r\n    <div class=\"profile-info\">\r\n      <div class=\"profile-name\">${userProfile ? userProfile.username : 'User'}</div>\r\n      ${userProfile && userProfile.email ? `<div class=\"profile-email\">${userProfile.email}</div>` : ''}\r\n    </div>\r\n    <div class=\"profile-actions\">\r\n      <button id=\"logout-button\" class=\"logout-button\">Logout</button>\r\n    </div>\r\n  `;\r\n  \r\n  // Append badge to container\r\n  container.appendChild(badge);\r\n  \r\n  // Add click event listener to logout button\r\n  const logoutButton = document.getElementById('logout-button');\r\n  if (logoutButton) {\r\n    L.DomEvent.on(logoutButton, 'click', function(e) {\r\n      L.DomEvent.stopPropagation(e);\r\n      logout();\r\n    });\r\n  }\r\n  \r\n  // Close profile badge when clicking outside\r\n  const closeProfileBadge = (e) => {\r\n    const badge = document.getElementById('profile-badge');\r\n    const container = document.getElementById('user-control');\r\n    \r\n    if (badge && container && !container.contains(e.target)) {\r\n      badge.remove();\r\n      document.removeEventListener('click', closeProfileBadge);\r\n    }\r\n  };\r\n  \r\n  // Add event listener with a slight delay to prevent immediate closing\r\n  setTimeout(() => {\r\n    document.addEventListener('click', closeProfileBadge);\r\n  }, 100);\r\n};\r\n\r\n// Function to load and apply user preferences (called from index.js after init)\r\nconst loadUserPreferences = async () => {\r\n    if (!isAuthenticated || !keycloak.hasRealmRole('user')) {\r\n        console.log(\"User not logged in or not 'user' role. Skipping preference loading.\");\r\n        return;\r\n    }\r\n\r\n    console.log(\"User is authenticated 'user'. Loading preferences...\");\r\n    try {\r\n        const response = await fetch('/api/user/preferences', {\r\n            method: 'GET',\r\n            headers: {\r\n                'Authorization': `Bearer ${keycloak.token}`\r\n            }\r\n        });\r\n\r\n        if (!response.ok) {\r\n            if (response.status === 404) {\r\n                 console.log(\"No preferences found for user.\");\r\n                 return; // No preferences saved yet, do nothing.\r\n            }\r\n            console.error(`Failed to load preferences: ${response.status} ${response.statusText}`);\r\n            return;\r\n        }\r\n\r\n        const preferences = await response.json();\r\n        console.log(\"Received preferences:\", preferences);\r\n\r\n        // Check if preferences exist and layer control is ready\r\n        let baseLayerApplied = false;\r\n        if (preferences && window.treeLayersControl) {\r\n             console.log(\"Applying preferences to layer control:\", preferences);\r\n             baseLayerApplied = applyMapPreferences(preferences, window.treeLayersControl);\r\n        } else {\r\n             console.log(\"No preferences found or layer control not ready.\");\r\n        }\r\n        return baseLayerApplied; // Return whether the preferred base layer was found and applied\r\n\r\n    } catch (error) {\r\n        console.error('Error loading user preferences:', error);\r\n    }\r\n};\r\n\r\n// Helper function to apply saved preferences (base layer and overlays)\r\nfunction applyMapPreferences(preferences, control) {\r\n    if (!control || !control.getContainer) {\r\n        console.warn(\"Layer control not available for applying preferences.\");\r\n        return false; // Indicate base layer not set\r\n    }\r\n\r\n    const controlContainer = control.getContainer();\r\n    // Use defaults if properties are missing/null in preferences\r\n    const { selectedBaseLayer = null, selectedOverlays = [] } = preferences;\r\n    const overlayLabelsToApply = new Set(selectedOverlays);\r\n    let baseLayerApplied = false;\r\n\r\n    console.log(\"Applying Base Layer:\", selectedBaseLayer);\r\n    console.log(\"Applying Overlays:\", selectedOverlays);\r\n\r\n    // Apply base layer selection\r\n    const baseLayerRadios = controlContainer.querySelectorAll('.leaflet-control-layers-base input[type=\"radio\"]');\r\n    baseLayerRadios.forEach(radio => {\r\n        let labelElement = radio.closest('label') || radio.parentElement.querySelector('span');\r\n        if (labelElement) {\r\n             const labelText = labelElement.textContent.trim();\r\n             // Check if this radio corresponds to the saved preference\r\n             if (labelText === selectedBaseLayer) {\r\n                 if (!radio.checked) {\r\n                     console.log(`Clicking base layer radio: ${selectedBaseLayer}`);\r\n                     radio.click(); // Click to select the base layer\r\n                 } else {\r\n                      console.log(`Base layer already selected: ${selectedBaseLayer}`);\r\n                 }\r\n                 baseLayerApplied = true;\r\n             }\r\n        }\r\n    });\r\n\r\n     if (selectedBaseLayer && !baseLayerApplied) {\r\n         console.warn(`Could not find base layer radio button for label: ${selectedBaseLayer}`);\r\n     }\r\n\r\n    // Apply overlay selections\r\n    const overlayCheckboxes = controlContainer.querySelectorAll('.leaflet-control-layers-overlays input[type=\"checkbox\"]');\r\n    overlayCheckboxes.forEach(checkbox => {\r\n        let labelElement = checkbox.closest('label') || checkbox.parentElement.querySelector('span');\r\n        if (labelElement) {\r\n            const labelText = labelElement.textContent.trim();\r\n            const shouldBeChecked = overlayLabelsToApply.has(labelText);\r\n\r\n            // Only click if the state needs changing\r\n            if (checkbox.checked !== shouldBeChecked) {\r\n                console.log(`Clicking overlay checkbox for: ${labelText} (Should be checked: ${shouldBeChecked})`);\r\n                checkbox.click(); // Click to toggle state\r\n            } else {\r\n                 console.log(`Overlay checkbox already in correct state for: ${labelText} (Checked: ${checkbox.checked})`);\r\n            }\r\n        }\r\n    });\r\n\r\n    console.log(\"Finished applying preferences.\");\r\n    // control.expandSelected(true); // Optional: Re-expand nodes if needed\r\n    return baseLayerApplied; // Return whether the preferred base layer was found and applied\r\n}\r\n\r\n\r\n// Export functions\r\nexport {\r\n  initKeycloak,\r\n  login,\r\n  logout,\r\n  isUserAuthenticated,\r\n  getUserProfile,\r\n  createUserControl,\r\n  loadUserPreferences // Name remains the same, functionality updated\r\n};","import './L.Control.Layers.Tree.js';\r\nimport '../css/L.Control.Layers.Tree.css';\r\n\r\nimport './leaflet.responsive.popup.js';\r\nimport './leaflet.responsive.popup.css';\r\n\r\nimport '../css/styles.css';\r\nimport '../css/user-control.css';\r\nimport InfoControl from '../../../components/info-control.js';\r\nimport moment from 'moment';\r\nimport 'moment-timezone';\r\n \r\n// import './../../../components/airspaces.js'; // Removed EFG airspaces\r\nimport '../../../components/deprecated/airspaces-gliding.js';\r\nimport '../../../components/deprecated/airspaces-notam.js';\r\nimport './../../../components/airspaces-xc.js';\r\nimport './../../../components/windstations.js';\r\nimport '../../../components/spots-pg.js';\r\nimport '../../../components/spots-hg.js';\r\nimport '../../../components/spots-lz.js';\r\nimport '../../../components/obstacles.js';\r\nimport '../../../components/rainviewer.js';\r\nimport { initializeAirspaceXCMapListeners } from './../../../components/airspaces-xc.js';\r\nimport { initKeycloak, createUserControl, loadUserPreferences } from '../../../components/keycloak-auth.js'; // Import loadUserPreferences\r\n\r\n// --- Global App Configuration ---\r\nwindow.appConfig = {\r\n  fullSpotsPopoup: false // Default value, will be overwritten by fetched config\r\n};\r\n\r\nasync function fetchAppConfig() {\r\n  try {\r\n    const response = await fetch('/api/config');\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP error! status: ${response.status}`);\r\n    }\r\n    const config = await response.json();\r\n    window.appConfig = { ...window.appConfig, ...config }; // Merge fetched config with defaults\r\n    console.log('App configuration loaded:', window.appConfig);\r\n  } catch (error) {\r\n    console.error('Failed to fetch app configuration:', error);\r\n    // Keep using default config in case of error\r\n  }\r\n}\r\n// --- End Global App Configuration ---\r\n\r\n\r\n// Initialize map and make necessary objects globally available\r\nfunction initMap() {\r\n  // Create the map object and make it globally accessible\r\n  window.map = L.map('map', {\r\n      center: [50, 6],\r\n      zoom: 9,\r\n      zoomControl: false,\r\n      layers: [],\r\n      timeDimension: true\r\n  });\r\n\r\n  L.control.zoom({\r\n      position: 'bottomright',\r\n  }).addTo(window.map);\r\n\r\n  // Base Layers\r\n  var awgTerrain = L.tileLayer('https://tile.jawg.io/jawg-terrain/{z}/{x}/{y}{r}.png?access-token=qBDXRu1KSlZGhx4ROlceBD9hcxmrumL34oj29tUkzDVkafqx08tFWPeRNb0KSoKa', {\r\n      attribution: 'Jawg.io'\r\n  }); // Don't add to map by default\r\n\r\n  var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n      attribution: ' OpenStreetMap'\r\n  });\r\n\r\n  var xcontest = L.tileLayer('https://topo.xcontest.app/elev/{z}/{x}/{y}.jpg', {\r\n      attribution: 'XContest&copy; <a href=\"https://www.xcontest.org\">XContest</a>',\r\n      className: 'xcontest-layer'\r\n  });\r\n\r\n  /* JS */\r\n    // Modified popupopen handler\r\n  window.map.on('popupopen', function(ev){\r\n    const el = document.getElementById('fullScreenInfo');\r\n    const screenWidthThreshold = 768; // Match CSS media query\r\n    const popupEl = ev.popup.getElement(); // Get popup DOM element\r\n\r\n    // Helper function to show content in fullscreen modal\r\n    function showInFullscreen(content) {\r\n        console.log(\"Attempting to show content in fullscreen modal.\");\r\n        window.map.closePopup(); // Close small popup first\r\n        try {\r\n            // Add default close button and footer\r\n            const closeButtonHTML = '<div id=\"default-fullscreen-close-btn\" style=\"position: absolute; top: 10px; right: 10px;\">' +\r\n                                  '<button onclick=\"closeFullscreenInfo()\" style=\"background: none; border: none; font-size: 20px; cursor: pointer;\"></button>' +\r\n                                  '</div>';\r\n            const footerHTML = '<div id=\"default-fullscreen-footer\" style=\"text-align: right; padding: 10px;\">' +\r\n                             '<button class=\"btn btn-dark btn-sm\" onclick=\"closeFullscreenInfo()\">Close</button>' +\r\n                             '</div>';\r\n\r\n            // Check if content is a node or string\r\n            let contentHTML = '';\r\n            if (typeof content === 'string') {\r\n                contentHTML = content;\r\n            } else if (content instanceof Node && typeof content.outerHTML === 'string') {\r\n                contentHTML = content.outerHTML; // Use outerHTML if it's a DOM node\r\n            } else {\r\n                 console.warn(\"Popup content is neither string nor DOM node, cannot display in fullscreen.\");\r\n                 contentHTML = 'Error: Invalid popup content.';\r\n            }\r\n            el.innerHTML = closeButtonHTML + `<div id=\"fullscreen-content-area\">${contentHTML}</div>` + footerHTML;\r\n\r\n            // Show panel\r\n            el.classList.add('visible');\r\n            el.style.display = 'block';\r\n            el.style.zIndex = '10000';\r\n            document.getElementById('map').classList.add('map-covered');\r\n\r\n        } catch (error) {\r\n            console.error('Error processing content for fullscreen:', error);\r\n            // Optionally show an error message in the fullscreen panel\r\n            el.innerHTML = '<div style=\"padding: 20px;\">Error displaying popup content.</div>' +\r\n                           '<div style=\"text-align: right; padding: 10px;\"><button class=\"btn btn-dark btn-sm\" onclick=\"closeFullscreenInfo()\">Close</button></div>';\r\n            // Still show the panel even if there's an error\r\n            el.classList.add('visible');\r\n            el.style.display = 'block';\r\n            el.style.zIndex = '10000';\r\n            document.getElementById('map').classList.add('map-covered');\r\n        }\r\n    }\r\n\r\n    // --- Small Screen Logic ---\r\n    if (window.innerWidth < screenWidthThreshold) {\r\n\r\n      // --- Handle Info Popup Specifically (Uses its own fullscreen logic) ---\r\n      if (popupEl && popupEl.classList.contains('info-popup')) {\r\n        console.log(\"Opening Info Popup in fullscreen mode.\");\r\n        window.map.closePopup(); // Close the small popup first\r\n        try {\r\n          const infoContentElement = ev.popup.getContent();\r\n          if (typeof infoContentElement !== 'object' || !infoContentElement.querySelector) {\r\n               console.error(\"Info popup content is not a valid DOM element.\"); return;\r\n          }\r\n          el.innerHTML = ''; // Clear previous content\r\n          el.appendChild(infoContentElement); // Append the entire structure\r\n\r\n          // Attach close handlers (assuming infoContentElement contains buttons with correct classes/onclick)\r\n          const headerCloseBtn = infoContentElement.querySelector('.info-popup-close');\r\n          const footerCloseBtn = infoContentElement.querySelector('.info-popup-footer-close');\r\n          if (headerCloseBtn) L.DomEvent.on(headerCloseBtn, 'click', window.closeFullscreenInfo);\r\n          if (footerCloseBtn) L.DomEvent.on(footerCloseBtn, 'click', window.closeFullscreenInfo);\r\n\r\n          // Show the fullscreen panel\r\n          el.classList.add('visible');\r\n          el.style.display = 'block';\r\n          el.style.zIndex = '10000';\r\n          document.getElementById('map').classList.add('map-covered');\r\n        } catch (error) {\r\n          console.error('Error processing info popup for fullscreen:', error);\r\n        }\r\n        return; // Stop further processing\r\n      }\r\n\r\n      // --- Skip specific other popups ---\r\n      if (popupEl && (\r\n          popupEl.classList.contains('obstacle-popup') ||\r\n          popupEl.classList.contains('airspace-popup')\r\n          // Add other classes to skip here if needed\r\n      )) {\r\n        console.log(\"Skipping fullscreen for obstacle/airspace popup.\");\r\n        return; // Don't show these in fullscreen\r\n      }\r\n\r\n      // --- Handle Wind Station Popups (Always Fullscreen) ---\r\n      if (popupEl && popupEl.querySelector('.wind-station-popup-content')) {\r\n          console.log(\"Opening Wind Station popup in fullscreen mode.\");\r\n          showInFullscreen(ev.popup.getContent());\r\n          return; // Stop further processing\r\n      }\r\n\r\n      // --- Handle Other Generic Popups (Conditional on Config) ---\r\n      // Includes full spot popups if config is true, simplified spot popups are handled by Leaflet if config is false\r\n      if (window.appConfig && window.appConfig.fullSpotsPopoup === true) {\r\n          console.log(\"Opening generic popup in fullscreen mode (config enabled).\");\r\n          showInFullscreen(ev.popup.getContent());\r\n          // Note: Simplified spot popups won't reach here if config is false\r\n      } else {\r\n          // If config is false, do nothing extra for other generic popups (like simplified spots).\r\n          // Leaflet will handle the standard popup display.\r\n          console.log(\"Skipping fullscreen for generic popup (config disabled).\");\r\n      }\r\n    }\r\n    // --- End Small Screen Logic ---\r\n  });\r\n\r\n  // closeFullscreenInfo function (no changes needed here)\r\n  window.closeFullscreenInfo = function() {\r\n    var el = document.getElementById('fullScreenInfo');\r\n    el.classList.remove('visible');\r\n    el.innerHTML = ''; // Clear the content\r\n    document.getElementById('map').classList.remove('map-covered');\r\n    window.map.closePopup(); // Close the Leaflet popup\r\n  };\r\n\r\n  // MapLibre GL layer\r\n  var mapTilerTerrain = L.mapboxGL({\r\n      style: '/assets/maps/maptiler_terrain_wob_testxc.json',\r\n      apiKey: \"c49iG8J3xvAkgCSZ8M8v\",\r\n      className: 'xcmap-layer',\r\n      attribution: 'MapTiler Terrain'\r\n  });\r\n\r\n  var sat = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}',{\r\n      attribution: 'Map data: Google',\r\n      maxZoom: 20,\r\n      subdomains:['mt0','mt1','mt2','mt3']\r\n  });\r\n\r\n  var mbsat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',{\r\n    attribution: ' Esri',\r\n    id: 'MapID',\r\n  });\r\n\r\n  var mapTilerTerrainOverlay = L.mapboxGL({\r\n    style: '/assets/maps/maptiler_terrain_wob_testxc.json',\r\n    apiKey: \"c49iG8J3xvAkgCSZ8M8v\",\r\n    className: 'xcmap-layer satellite-overlay',\r\n    attribution: 'MapTiler Terrain'\r\n  });\r\n\r\n  // Use the local proxy for kk7 thermals to avoid CORS issues\r\n  var kk7thermals = L.tileLayer('/api/kk7thermals/{z}/{x}/{y}.png', {\r\n    attribution: '<a href=\"https://thermal.kk7.ch\">thermal.kk7.ch</a>',\r\n    maxNativeZoom: 12,\r\n    tms: true // Keep TMS if the original source uses it\r\n    // Removed headers option as it's handled by the proxy\r\n  });\r\n\r\n// Create a simplified contour overlay specifically for use with satellite\r\nvar contourOverlay = L.tileLayer('https://api.maptiler.com/tiles/contours/{z}/{x}/{y}.pbf?key=c49iG8J3xvAkgCSZ8M8v', {\r\n  attribution: 'MapTiler',\r\n  opacity: 0.8,\r\n  className: 'contour-overlay',\r\n  style: {\r\n      color: '#ffffff',\r\n      weight: 1,\r\n      opacity: 0.8\r\n  }\r\n});\r\n  // Layer groups - make them globally accessible\r\n  window.windLayer = L.layerGroup().addTo(window.map);\r\n\r\n  window.oaipMap = L.tileLayer(`https://a.api.tiles.openaip.net/api/data/openaip/{z}/{x}/{y}.png?apiKey=${process.env.OAIP_KEY}`, {\r\n      attribution: 'OpenAIP&copy; <a href=\"https://www.openaip.net\">OpenAIP</a>',\r\n      className: 'oaip-layer'\r\n  });\r\n  \r\n  // Initialize RainViewer layers with error handling\r\n  try {\r\n    // Use different endpoints for radar and satellite to prevent conflicts\r\n    window.rainviewerRadarLayer = L.timeDimension.layer.rainviewer(\"https://api.rainviewer.com/public/weather-maps.json\", {\r\n      opacity: 0.7,\r\n      cache: 5, // Limit cache size to improve performance\r\n      refreshInterval: 300000 // Refresh every 5 minutes\r\n    }).addTo(window.map); // Add radar layer to map by default\r\n    \r\n    window.rainviewerSatelliteLayer = L.timeDimension.layer.rainviewer(\"https://api.rainviewer.com/public/weather-maps.json\", {\r\n      type: 'satellite',\r\n      opacity: 0.7,\r\n      cache: 5, // Limit cache size to improve performance\r\n      refreshInterval: 300000 // Refresh every 5 minutes\r\n    });\r\n    \r\n    console.log('RainViewer layers initialized successfully');\r\n    \r\n    // Ensure TimeDimension control is added to the map\r\n    setTimeout(() => {\r\n      updateTimeDimensionControlVisibility();\r\n    }, 500); // Short delay to ensure the layer is fully added\r\n  } catch (error) {\r\n    console.error('Error initializing RainViewer layers:', error);\r\n    // Create empty layers as fallbacks\r\n    window.rainviewerRadarLayer = L.layerGroup();\r\n    window.rainviewerSatelliteLayer = L.layerGroup();\r\n  }\r\n  \r\n  // Create TimeDimension control with error handling\r\n  try {\r\n    window.timeDimensionControl = L.control.timeDimension({\r\n      position: 'bottomleft',\r\n      playerOptions: {\r\n        transitionTime: 1000,\r\n        loop: true,\r\n        buffer: 2 // Reduce buffer size to improve performance\r\n      },\r\n      timeZones: ['Local'],\r\n      autoPlay: true,\r\n      speedSlider: false // Disable speed slider to simplify UI\r\n    });\r\n    console.log('TimeDimension control initialized successfully');\r\n  } catch (error) {\r\n    console.error('Error initializing TimeDimension control:', error);\r\n    // Create a dummy control as fallback\r\n    window.timeDimensionControl = {\r\n      addTo: function() { console.log('Using dummy TimeDimension control'); }\r\n    };\r\n  }\r\n  \r\n  // Track if the TimeDimension control is added to the map\r\n  window.isTimeDimensionControlAdded = false;\r\n  // window.airspaceEFG = L.layerGroup([], { // Removed EFG airspaces\r\n  //   attribution: 'OpenAIP&copy; <a href=\"https://www.openaip.net\">OpenAIP</a>',\r\n  // });\r\n  window.airspaceGliding = L.layerGroup([], {\r\n    attribution: 'OpenAIP&copy; <a href=\"https://www.openaip.net\">OpenAIP</a>',\r\n  });\r\n  window.airspaceNotam = L.layerGroup([], {\r\n    attribution: 'OpenAIP&copy; <a href=\"https://www.openaip.net\">OpenAIP</a>',\r\n  });\r\n  window.airspaceXC = L.layerGroup([], {\r\n    attribution: 'XContest&copy; <a href=\"https://xcontest.org\">XContest</a>',\r\n  });\r\n\r\n  window.placesLayerPG = L.layerGroup( [], {\r\n    attribution: '&copy; <a href=\"https://paraglidingspots.com\">paraglidingspots.com</a>',\r\n  });\r\n  window.placesLayerHG = L.layerGroup([], {\r\n    attribution: '&copy; <a href=\"https://paraglidingspots.com\">paraglidingspots.com</a>',\r\n  });\r\n  window.placesLayerLZ = L.layerGroup([], {\r\n    attribution: '&copy; <a href=\"https://paraglidingspots.com\">paraglidingspots.com</a>',\r\n  });\r\n\r\n  function debugMapLayers() {\r\n    console.log(\"Current map layers:\");\r\n    window.map.eachLayer(function(layer) {\r\n        console.log(layer);\r\n    });\r\n  }\r\n\r\n  // Generate dynamic airspace time options\r\n  const airspaceTimeOptions = (() => {\r\n    let options = '';\r\n    for (let i = 0; i <= 6; i++) {\r\n      const date = moment().add(i, 'days');\r\n      const dayName = date.format('ddd');\r\n      const dateValue = date.format('YYYY-MM-DD');\r\n      options += `<option value=\"${dateValue}\" ${i === 0 ? 'selected' : ''}>${\r\n        i === 0 ? `Today` : dayName\r\n      }</option>`;\r\n    }\r\n    return options;  // Removed the '+ '<option value=\"All\">All</option>''\r\n  })();\r\n\r\n\r\n  // Tree structure\r\n  var baseTree = {\r\n    label: 'Base Maps',\r\n    collapsed: true, // Add this line to collapse by default\r\n    children: [\r\n        { label: 'Terrain', layer: awgTerrain },\r\n        { label: 'XContest', layer: L.layerGroup([xcontest, mapTilerTerrain])},\r\n        { label: 'OpenStreetMap', layer: osm },\r\n        { label: 'Satellite',  layer: sat },\r\n    ]\r\n};\r\n\r\n  var overlayTree = {\r\n      label: 'Overlays',\r\n      children: [\r\n          { label: 'Weather Stations',\r\n            children: [\r\n              { label: 'Weather Stations', layer: window.windLayer, checked: true  },\r\n            ]\r\n          },\r\n          { html: '<hr class=\"leaflet-control-layers-separator\">' }, // Separator\r\n          { label: 'Rain Viewer',\r\n            children: [\r\n              { label: 'Radar', layer: window.rainviewerRadarLayer, checked: true  },\r\n              { label: 'Satellite', layer: window.rainviewerSatelliteLayer },\r\n            ]\r\n          },\r\n          { html: '<hr class=\"leaflet-control-layers-separator\">' }, // Separator\r\n          { label: 'Thermals',\r\n            children: [\r\n              { label: 'kk7 Thermals', layer: kk7thermals  },\r\n            ]\r\n          },\r\n          { html: '<hr class=\"leaflet-control-layers-separator\">' }, // Separator\r\n          { label: 'Spots',\r\n              children: [\r\n                  { label: 'Take-off PG', layer: window.placesLayerPG },\r\n                  { label: 'Take-off HG', layer: window.placesLayerHG },\r\n                  { label: 'Landing Zones', layer: window.placesLayerLZ },\r\n              ]\r\n          },\r\n          { html: '<hr class=\"leaflet-control-layers-separator\">' }, // Separator\r\n          { label: 'Airspaces',\r\n              children: [\r\n                      {\r\n                        html: `\r\n                            <div class=\"airspace-time-control\">\r\n                                Active:\r\n                                <select class=\"airspace-time-select\" id=\"airspaceTime\">\r\n                                    ${airspaceTimeOptions}\r\n                                </select>\r\n                            </div>\r\n                        `\r\n                      },\r\n                      {\r\n                        html: `\r\n                            <div class=\"airspace-limit-control\">\r\n                                 below:\r\n                                <select class=\"lower-limit-select\" id=\"airspaceLowerLimit\">\r\n                                    <option value=\"2000\">2000m</option>\r\n                                    <option value=\"2500\">2500m</option>\r\n                                    <option value=\"3000\" selected>3000m</option>\r\n                                    <option value=\"3500\">3500m</option>\r\n                                    <option value=\"4000\">4000m</option>\r\n                                    <option value=\"4500\">4500m</option>\r\n                                </select>\r\n                            </div>\r\n                        `\r\n                      },\r\n                  // { label: 'Airspaces', layer: window.airspaceEFG }, // Removed EFG airspaces layer from tree\r\n                  { label: 'Airspaces', layer: window.airspaceXC },\r\n                  { label: 'Obstacles', layer: window.obstacleLayer },\r\n                  { label: 'OpenAIP Map', layer: window.oaipMap},\r\n              ]\r\n          },\r\n      ]\r\n  };\r\n\r\n\r\n  new InfoControl({ position: 'bottomright' }).addTo(window.map);\r\n\r\n  // Add logo control to the top left corner\r\n  L.Control.Logo = L.Control.extend({\r\n    onAdd: function(map) {\r\n      const container = L.DomUtil.create('div', 'leaflet-control-logo');\r\n      const img = L.DomUtil.create('img', 'logo-image', container);\r\n      img.src = '/assets/images/XCmapsLogo.png';\r\n      img.alt = 'XCmaps Logo';\r\n      img.style.width = '120px'; // Adjust size as needed\r\n      img.style.height = 'auto';\r\n\r\n      // Prevent clicks on the logo from propagating to the map\r\n      L.DomEvent.disableClickPropagation(container);\r\n\r\n      return container;\r\n    }\r\n  });\r\n\r\n  L.control.logo = function(opts) {\r\n    return new L.Control.Logo(opts);\r\n  };\r\n\r\n  // Add the logo control to the map\r\n  L.control.logo({ position: 'topleft' }).addTo(window.map);\r\n\r\n  // Add locate control\r\n  var lc = L.control\r\n      .locate({\r\n          drawCircle: false,\r\n          keepCurrentZoomLevel: true,\r\n          position: 'bottomright',\r\n          icon: 'locate',\r\n          iconLoading: 'loading',\r\n          iconElementTag: 'div',\r\n          setView: 'always', // Keep map centered on user's location\r\n          flyTo: true // Use flyTo animation for smoother panning\r\n      }).addTo(window.map);\r\n\r\n  // Add layer control tree\r\n\r\n  // Add layer control tree and make it global\r\n  window.treeLayersControl = L.control.layers.tree(baseTree, overlayTree, {\r\n    namedToggle: false,\r\n    collapsed: true\r\n  }).addTo(window.map);\r\n\r\n  // Initialize with base tree collapsed and selected overlays expanded\r\n  treeLayersControl.collapseTree(false).expandSelected(true);\r\n\r\n  // Initialize AirspaceXC map listeners AFTER map and layer control are ready\r\n  initializeAirspaceXCMapListeners(window.map);\r\n\r\n  // --- Wind Layer Auto-Refresh ---\r\n  let windRefreshIntervalId = null;\r\n  const refreshWindStations = () => {\r\n    // Ensure the layer is still on the map before fetching\r\n    if (window.map.hasLayer(window.windLayer)) {\r\n      console.log('[Wind Refresh Interval] Calling fetchWindStations...'); // Added log\r\n      fetchWindStations(); // Assumes fetchWindStations is globally available\r\n    } else {\r\n      console.log('[Wind Refresh Interval] Layer not active, skipping refresh and clearing interval.'); // Modified log\r\n      if (windRefreshIntervalId) {\r\n        clearInterval(windRefreshIntervalId);\r\n        windRefreshIntervalId = null;\r\n        console.log('Cleared wind refresh interval due to layer removal.');\r\n      }\r\n    }\r\n  };\r\n\r\n  window.map.on('layeradd', function(e) {\r\n      if (e.layer === window.windLayer) {\r\n          console.log('[Wind Layer] Layer added. Initial fetch and starting refresh interval.'); // Modified log\r\n          // Clear any existing interval just in case\r\n          if (windRefreshIntervalId) {\r\n              console.log('[Wind Layer] Clearing pre-existing interval ID:', windRefreshIntervalId); // Added log\r\n              clearInterval(windRefreshIntervalId);\r\n          }\r\n          // Fetch immediately on add\r\n          refreshWindStations();\r\n          // Start interval\r\n          windRefreshIntervalId = setInterval(refreshWindStations, 60000); // 60000 ms = 1 minute\r\n          console.log('[Wind Layer] Refresh interval started with ID:', windRefreshIntervalId); // Added log\r\n      }\r\n  });\r\n\r\n  window.map.on('layerremove', function(e) {\r\n      if (e.layer === window.windLayer) {\r\n          console.log('[Wind Layer] Layer removed, clearing refresh interval ID:', windRefreshIntervalId); // Modified log\r\n          if (windRefreshIntervalId) {\r\n              clearInterval(windRefreshIntervalId);\r\n              windRefreshIntervalId = null;\r\n          }\r\n      }\r\n  });\r\n  // --- End Wind Layer Auto-Refresh ---\r\n\r\n\r\n  // Add touch support for mobile devices\r\n  const layersControlContainer = treeLayersControl.getContainer();\r\n  const layersControlToggle = layersControlContainer.querySelector('.leaflet-control-layers-toggle');\r\n\r\n  // Function to detect if device is touch-only (no hover capability)\r\n  const isTouchDevice = () => {\r\n    return (('ontouchstart' in window) ||\r\n            (navigator.maxTouchPoints > 0) ||\r\n            (navigator.msMaxTouchPoints > 0));\r\n  };\r\n\r\n  // Add click handler for touch devices\r\n  if (isTouchDevice()) {\r\n    L.DomEvent.on(layersControlToggle, 'click', function(e) {\r\n      L.DomEvent.stopPropagation(e);\r\n      if (L.DomUtil.hasClass(layersControlContainer, 'leaflet-control-layers-expanded')) {\r\n        L.DomUtil.removeClass(layersControlContainer, 'leaflet-control-layers-expanded');\r\n      } else {\r\n        L.DomUtil.addClass(layersControlContainer, 'leaflet-control-layers-expanded');\r\n      }\r\n    });\r\n\r\n    // Close the control when clicking outside of it\r\n    L.DomEvent.on(document, 'click', function() {\r\n      if (L.DomUtil.hasClass(layersControlContainer, 'leaflet-control-layers-expanded')) {\r\n        L.DomUtil.removeClass(layersControlContainer, 'leaflet-control-layers-expanded');\r\n      }\r\n    });\r\n\r\n    // Prevent clicks inside the control from closing it\r\n    L.DomEvent.on(layersControlContainer, 'click', function(e) {\r\n      L.DomEvent.stopPropagation(e);\r\n    });\r\n  }\r\n\r\n\r\n\r\n  // Central event handler for map movements\r\n  // This will be the ONLY moveend handler for fetching data\r\n  window.map.on('moveend', function() {\r\n    console.log('Map moveend event triggered');\r\n\r\n    // Check if windLayer is on the map and fetchWindStations exists\r\n    if (window.map.hasLayer(window.windLayer) && typeof window.fetchWindStations === 'function') {\r\n      console.log('Fetching wind stations after map move...');\r\n      window.fetchWindStations();\r\n    }\r\n\r\n    // Only trigger fetch for visible spot layers\r\n    if (window.map.hasLayer(window.placesLayerPG) && window.fetchPlacesPG) {\r\n      console.log('Fetching PG spots after map move...');\r\n      window.fetchPlacesPG();\r\n    }\r\n\r\n    if (window.map.hasLayer(window.placesLayerHG) && window.fetchPlacesHG) {\r\n      console.log('Fetching HG spots after map move...');\r\n      window.fetchPlacesHG();\r\n    }\r\n\r\n    if (window.map.hasLayer(window.placesLayerLZ) && window.fetchPlacesLZ) {\r\n      console.log('Fetching LZ spots after map move...');\r\n      window.fetchPlacesLZ();\r\n    }\r\n\r\n    // Airspaces EFG removed\r\n    // if (window.map.hasLayer(window.airspaceEFG) && typeof window.fetchAirspaces === 'function') {\r\n    //   console.log('Fetching airspaces after map move...');\r\n    //   window.fetchAirspaces();\r\n    // }\r\n    // Airspaces Gliding\r\n    if (window.map.hasLayer(window.airspaceGliding) && typeof window.fetchAirspacesGliding === 'function') {\r\n      console.log('Fetching airspaces after map move...');\r\n      window.fetchAirspacesGliding();\r\n    }\r\n    // Airspaces Notam\r\n    if (window.map.hasLayer(window.airspaceNotam) && typeof window.fetchAirspacesNotam === 'function') {\r\n      console.log('Fetching airspaces after map move...');\r\n      window.fetchAirspacesNotam();\r\n    }\r\n    // Airspaces XContest\r\n    if (window.map.hasLayer(window.airspaceXC) && typeof window.fetchAirspacesXC === 'function') {\r\n      // Only fetch if no popup is currently open\r\n      if (!window.map._popup) {\r\n        console.log('Fetching XC airspaces after map move (no popup open)...');\r\n        window.fetchAirspacesXC();\r\n      } else {\r\n        console.log('Skipping XC airspace fetch on moveend because popup is open.');\r\n      }\r\n    }\r\n    // Obstacles XContest\r\n    if (window.map.hasLayer(window.obstacleLayer) && typeof window.fetchObstacles === 'function') {\r\n      console.log('Fetching airspaces after map move...');\r\n      window.fetchObstacles();\r\n    }\r\n  });\r\n\r\n  document.addEventListener('change', function(e) {\r\n    if (e.target && e.target.id === 'airspaceLowerLimit') {\r\n        console.log('Selected limit:', e.target.value);\r\n    }\r\n    // Add this new handler for the time selector\r\n    if (e.target && e.target.id === 'airspaceTime') {\r\n        console.log('Selected airspace date:', e.target.value);\r\n    }\r\n  });\r\n\r\n  // Add layer change event listeners to fetch data when layers are added\r\n  window.map.on('layeradd', function(e) {\r\n    const layer = e.layer;\r\n\r\n    // When a layer is added, fetch its data if needed\r\n    if (layer === window.windLayer && typeof window.fetchWindStations === 'function') {\r\n      window.fetchWindStations();\r\n    } else if (layer === window.placesLayerPG && window.fetchPlacesPG) {\r\n      window.fetchPlacesPG();\r\n    } else if (layer === window.placesLayerHG && window.fetchPlacesHG) {\r\n      window.fetchPlacesHG();\r\n    } else if (layer === window.placesLayerLZ && window.fetchPlacesLZ) {\r\n      window.fetchPlacesLZ();\r\n    // } else if (layer === window.airspaceEFG && typeof window.fetchAirspaces === 'function') { // Removed EFG airspaces\r\n    //   window.fetchAirspaces();\r\n    } else if (layer === window.airspaceGliding && typeof window.fetchAirspacesGliding === 'function') {\r\n      window.fetchAirspacesGliding();\r\n    } else if (layer === window.airspaceNotam && typeof window.fetchAirspacesNotam === 'function') {\r\n      window.fetchAirspacesNotam();\r\n    } else if (layer === window.airspaceXC && typeof window.fetchAirspacesXC === 'function') {\r\n      window.fetchAirspacesXC();\r\n    } else if (layer === window.obstacleLayer && typeof window.fetchObstacles === 'function') {\r\n      window.fetchObstacles();\r\n    } else if (layer === window.rainviewerRadarLayer) {\r\n      console.log('RainViewer Radar layer added via layeradd');\r\n      updateTimeDimensionControlVisibility();\r\n    } else if (layer === window.rainviewerSatelliteLayer) {\r\n      console.log('RainViewer Satellite layer added via layeradd');\r\n      updateTimeDimensionControlVisibility();\r\n    }\r\n  });\r\n  \r\n  // Function to check if any RainViewer layer is active\r\n  function isAnyRainViewerLayerActive() {\r\n    const hasRadar = window.map.hasLayer(window.rainviewerRadarLayer);\r\n    const hasSatellite = window.map.hasLayer(window.rainviewerSatelliteLayer);\r\n    console.log('RainViewer layer check - Radar:', hasRadar, 'Satellite:', hasSatellite);\r\n    return hasRadar || hasSatellite;\r\n  }\r\n  \r\n  // Function to update TimeDimension control visibility\r\n  function updateTimeDimensionControlVisibility() {\r\n    console.log('Updating TimeDimension control visibility');\r\n    \r\n    // Prevent multiple simultaneous calls\r\n    if (window.isUpdatingTimeDimensionControl) {\r\n      console.log('Already updating TimeDimension control, skipping');\r\n      return;\r\n    }\r\n    \r\n    window.isUpdatingTimeDimensionControl = true;\r\n    \r\n    try {\r\n      const shouldBeVisible = isAnyRainViewerLayerActive();\r\n      console.log('Should TimeDimension control be visible?', shouldBeVisible);\r\n      console.log('Is TimeDimension control currently added?', window.isTimeDimensionControlAdded);\r\n      \r\n      if (shouldBeVisible) {\r\n        if (!window.isTimeDimensionControlAdded) {\r\n          try {\r\n            console.log('Adding TimeDimension control to map');\r\n            \r\n            // Set a timeout to prevent hanging\r\n            const timeoutPromise = new Promise((_, reject) => {\r\n              setTimeout(() => reject(new Error('Adding TimeDimension control timed out')), 5000);\r\n            });\r\n            \r\n            const addControlPromise = new Promise((resolve) => {\r\n              window.timeDimensionControl.addTo(window.map);\r\n              resolve();\r\n            });\r\n            \r\n            // Use Promise.race to implement the timeout\r\n            Promise.race([addControlPromise, timeoutPromise])\r\n              .then(() => {\r\n                window.isTimeDimensionControlAdded = true;\r\n                console.log('TimeDimension control added to map successfully');\r\n              })\r\n              .catch(error => {\r\n                console.error('Error adding TimeDimension control:', error);\r\n              })\r\n              .finally(() => {\r\n                window.isUpdatingTimeDimensionControl = false;\r\n              });\r\n            \r\n            return; // Exit early since we're handling the completion in the promise\r\n          } catch (error) {\r\n            console.error('Error adding TimeDimension control:', error);\r\n          }\r\n        } else {\r\n          console.log('TimeDimension control already added, no action needed');\r\n        }\r\n      } else {\r\n        if (window.isTimeDimensionControlAdded) {\r\n          try {\r\n            console.log('Removing TimeDimension control from map');\r\n            window.map.removeControl(window.timeDimensionControl);\r\n            window.isTimeDimensionControlAdded = false;\r\n            console.log('TimeDimension control removed from map successfully');\r\n          } catch (error) {\r\n            console.error('Error removing TimeDimension control:', error);\r\n          }\r\n        } else {\r\n          console.log('TimeDimension control already removed, no action needed');\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error in updateTimeDimensionControlVisibility:', error);\r\n    }\r\n    \r\n    window.isUpdatingTimeDimensionControl = false;\r\n  }\r\n  \r\n  // Handle RainViewer layer visibility with error handling and debouncing\r\n  let rainviewerUpdateTimeout = null;\r\n  \r\n  // Function to format time display in 24-hour format (HH:MM)\r\n  function updateTimeDisplay() {\r\n    try {\r\n      const timeControls = document.querySelectorAll('.leaflet-control-timecontrol.timecontrol-date');\r\n      timeControls.forEach(control => {\r\n        // Get the original text content\r\n        const originalText = control.textContent || control.innerText;\r\n        \r\n        // Extract the time part including AM/PM using regex\r\n        const timeMatch = originalText.match(/(\\d{1,2}):(\\d{2}):\\d{2}\\s*(AM|PM)?/i);\r\n        if (timeMatch) {\r\n          let hours = parseInt(timeMatch[1]);\r\n          const minutes = timeMatch[2];\r\n          const period = timeMatch[3] ? timeMatch[3].toUpperCase() : null;\r\n          \r\n          // Convert to 24-hour format if period is specified\r\n          if (period === 'PM' && hours < 12) {\r\n            hours += 12;\r\n          } else if (period === 'AM' && hours === 12) {\r\n            hours = 0;\r\n          }\r\n          \r\n          // Format as HH:MM with leading zero\r\n          const formattedTime = `${hours.toString().padStart(2, '0')}:${minutes}`;\r\n          \r\n          // Update the text content\r\n          control.textContent = formattedTime;\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.error('Error updating time display:', error);\r\n    }\r\n  }\r\n  \r\n  // Set up a MutationObserver to watch for changes to the time control\r\n  function setupTimeControlObserver() {\r\n    try {\r\n      const observer = new MutationObserver(function(mutations) {\r\n        updateTimeDisplay();\r\n      });\r\n      \r\n      // Start observing the document with the configured parameters\r\n      observer.observe(document.body, {\r\n        childList: true,\r\n        subtree: true\r\n      });\r\n      \r\n      // Also update on initial load and periodically\r\n      updateTimeDisplay();\r\n      setInterval(updateTimeDisplay, 1000);\r\n    } catch (error) {\r\n      console.error('Error setting up time control observer:', error);\r\n    }\r\n  }\r\n  \r\n  // Call the setup function when the map is initialized\r\n  document.addEventListener('map_initialized', setupTimeControlObserver);\r\n\r\n  // Set up periodic refresh for RainViewer layers\r\n  function setupRainViewerRefresh() {\r\n    // Only set up the interval if not already set up\r\n    if (!window.rainviewerRefreshInterval) {\r\n      window.rainviewerRefreshInterval = setInterval(() => {\r\n        try {\r\n          // Check if either RainViewer layer is active\r\n          const hasRadar = window.map.hasLayer(window.rainviewerRadarLayer);\r\n          const hasSatellite = window.map.hasLayer(window.rainviewerSatelliteLayer);\r\n          \r\n          if (hasRadar || hasSatellite) {\r\n            console.log('Refreshing RainViewer data...');\r\n            \r\n            // Refresh radar layer if active\r\n            if (hasRadar) {\r\n              fetchRainviewerMetadata(\"https://api.rainviewer.com/public/weather-maps.json\")\r\n                .then(metadata => {\r\n                  window.rainviewerRadarLayer._metadata = metadata;\r\n                  window.rainviewerRadarLayer._loaded = true;\r\n                  if (window.map.hasLayer(window.rainviewerRadarLayer)) {\r\n                    window.rainviewerRadarLayer._setAvailableTimes();\r\n                  }\r\n                })\r\n                .catch(error => console.error('Error refreshing radar data:', error));\r\n            }\r\n            \r\n            // Refresh satellite layer if active\r\n            if (hasSatellite) {\r\n              fetchRainviewerMetadata(\"https://api.rainviewer.com/public/weather-maps.json\")\r\n                .then(metadata => {\r\n                  window.rainviewerSatelliteLayer._metadata = metadata;\r\n                  window.rainviewerSatelliteLayer._loaded = true;\r\n                  if (window.map.hasLayer(window.rainviewerSatelliteLayer)) {\r\n                    window.rainviewerSatelliteLayer._setAvailableTimes();\r\n                  }\r\n                })\r\n                .catch(error => console.error('Error refreshing satellite data:', error));\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('Error in RainViewer refresh:', error);\r\n        }\r\n      }, 60000); // 1 minute interval\r\n    }\r\n  }\r\n\r\n  // Start the refresh when map is initialized\r\n  document.addEventListener('map_initialized', setupRainViewerRefresh);\r\n  \r\n  function debouncedUpdateTimeDimensionControl() {\r\n    // Clear any existing timeout\r\n    if (rainviewerUpdateTimeout) {\r\n      clearTimeout(rainviewerUpdateTimeout);\r\n    }\r\n    \r\n    // Set a new timeout to update the control after a short delay\r\n    rainviewerUpdateTimeout = setTimeout(() => {\r\n      try {\r\n        updateTimeDimensionControlVisibility();\r\n        // Update time display after visibility is updated\r\n        setTimeout(updateTimeDisplay, 500);\r\n      } catch (error) {\r\n        console.error('Error in debouncedUpdateTimeDimensionControl:', error);\r\n      }\r\n    }, 100); // 100ms debounce time\r\n  }\r\n  \r\n  // Removed focusMapContainerDeferred function definition\r\n\r\n  window.map.on('overlayadd', function(e) {\r\n    try {\r\n      console.log('overlayadd event triggered for layer:', e.name);\r\n      if (e.layer === window.rainviewerRadarLayer) {\r\n        console.log('RainViewer Radar layer added');\r\n        debouncedUpdateTimeDimensionControl();\r\n      } else if (e.layer === window.rainviewerSatelliteLayer) {\r\n        console.log('RainViewer Satellite layer added');\r\n        debouncedUpdateTimeDimensionControl();\r\n      }\r\n      // Removed call to focusMapContainerDeferred(); \r\n    } catch (error) {\r\n      console.error('Error in overlayadd event handler:', error);\r\n    }\r\n  });\r\n  \r\n  window.map.on('overlayremove', function(e) {\r\n    try {\r\n      console.log('overlayremove event triggered for layer:', e.name);\r\n      if (e.layer === window.rainviewerRadarLayer) {\r\n        console.log('RainViewer Radar layer removed');\r\n        debouncedUpdateTimeDimensionControl();\r\n      } else if (e.layer === window.rainviewerSatelliteLayer) {\r\n        console.log('RainViewer Satellite layer removed');\r\n        debouncedUpdateTimeDimensionControl();\r\n      }\r\n      // Removed call to focusMapContainerDeferred(); \r\n    } catch (error) {\r\n      console.error('Error in overlayremove event handler:', error);\r\n    }\r\n  });\r\n\r\n  // Add listener for base layer changes\r\n  window.map.on('baselayerchange', function(e) {\r\n      console.log('baselayerchange event triggered for layer:', e.name);\r\n      // Removed call to focusMapContainerDeferred(); \r\n  });\r\n\r\n  // Signal that the map is fully initialized\r\n  window.mapInitialized = true;\r\n  console.log(\"Map initialization complete\");\r\n\r\n  // Trigger an event that component scripts can listen for\r\n  const mapReadyEvent = new Event('map_initialized');\r\n  document.dispatchEvent(mapReadyEvent);\r\n  console.log(\"Map initialized event dispatched\");\r\n\r\n  // Initialize Keycloak and create user control\r\n  initKeycloak()\r\n    .then(async (authenticated) => { // Make the callback async\r\n      console.log('Keycloak initialized, authenticated:', authenticated);\r\n      createUserControl();\r\n      // Load preferences and check if a base layer was applied\r\n      const baseLayerApplied = await loadUserPreferences();\r\n      // If no base layer preference was loaded/applied, add the default\r\n      if (!baseLayerApplied && window.map && !window.map.hasLayer(awgTerrain)) {\r\n          console.log(\"No base layer preference found or applied, adding default Terrain layer.\");\r\n          awgTerrain.addTo(window.map);\r\n          // Ensure the corresponding radio button is checked in the layer control\r\n          const controlContainer = window.treeLayersControl?.getContainer();\r\n          if (controlContainer) {\r\n              const terrainRadio = controlContainer.querySelector('.leaflet-control-layers-base input[type=\"radio\"]'); // Assuming Terrain is the first\r\n              if (terrainRadio && !terrainRadio.checked) {\r\n                  terrainRadio.checked = true; // Directly check it (less ideal than click, but avoids potential event issues)\r\n              }\r\n          }\r\n      }\r\n      // loadUserPreferences(); // Load preferences after auth and control are ready - Redundant call? Already called above.\r\n    })\r\n    .catch(error => {\r\n      console.error('Failed to initialize Keycloak:', error);\r\n      // Still create the user control even if Keycloak fails\r\n      createUserControl();\r\n      // If Keycloak fails, we might still want to load a default base layer\r\n      if (window.map && !window.map.hasLayer(awgTerrain)) {\r\n          console.log(\"Keycloak failed, adding default Terrain layer.\");\r\n          awgTerrain.addTo(window.map);\r\n           // Ensure the corresponding radio button is checked in the layer control\r\n           const controlContainer = window.treeLayersControl?.getContainer();\r\n           if (controlContainer) {\r\n               const terrainRadio = controlContainer.querySelector('.leaflet-control-layers-base input[type=\"radio\"]'); // Assuming Terrain is the first\r\n               if (terrainRadio && !terrainRadio.checked) {\r\n                   terrainRadio.checked = true;\r\n               }\r\n           }\r\n      }\r\n    });\r\n\r\n  return window.map;\r\n}\r\n\r\n// Wait for DOM to be fully loaded\r\ndocument.addEventListener('DOMContentLoaded', async function() { // Make listener async\r\n    console.log(\"DOM content loaded, fetching config...\");\r\n    await fetchAppConfig(); // Fetch configuration first\r\n    console.log(\"Config fetched, initializing map...\");\r\n    // Initialize the map\r\n    const map = initMap();\r\n\r\n// Setup geolocation after map is initialized\r\nnavigator.geolocation.getCurrentPosition(position => {\r\n    console.log(\"Geolocation received\");\r\n    const userLat = position.coords.latitude;\r\n    const userLng = position.coords.longitude;\r\n    map.setView([userLat, userLng], 10);\r\n\r\n    // Create a user location ready event\r\n    const locationReadyEvent = new CustomEvent('user_location_ready', {\r\n        detail: { lat: userLat, lng: userLng }\r\n    });\r\n    document.dispatchEvent(locationReadyEvent);\r\n    console.log(\"User location event dispatched\");\r\n});\r\n\r\n// Load component scripts after map is initialized\r\n\r\n});\r\n\r\n// Special patch for initial data loading\r\ndocument.addEventListener('user_location_ready', function(e) {\r\nconsole.log(\"Handling user location ready event\");\r\nsetTimeout(() => {\r\n    // Only call these functions if they exist, the map is fully initialized,\r\n    // AND their respective layers are visible\r\n    if (typeof window.fetchWindStations === 'function' &&\r\n        window.mapInitialized &&\r\n        window.map.hasLayer(window.windLayer)) {\r\n        try {\r\n            console.log(\"Fetching wind stations\");\r\n            window.fetchWindStations(e.detail.lat, e.detail.lng);\r\n        } catch (error) {\r\n            console.error('Error fetching wind stations:', error);\r\n        }\r\n    }\r\n\r\n    // EFG Removed\r\n    // if (typeof window.fetchAirspaces === 'function' &&\r\n    //     window.mapInitialized &&\r\n    //     window.map.hasLayer(window.airspaceEFG)) {\r\n    //     try {\r\n    //         console.log(\"Fetching airspaces\");\r\n    //         window.fetchAirspaces();\r\n    //     } catch (error) {\r\n    //         console.error('Error fetching airspaces:', error);\r\n    //     }\r\n    // }\r\n\r\n    if (typeof window.fetchAirspacesGliding === 'function' &&\r\n      window.mapInitialized &&\r\n      window.map.hasLayer(window.airspaceGliding)) {\r\n      try {\r\n          console.log(\"Fetching airspaces\");\r\n          window.fetchAirspacesGliding();\r\n      } catch (error) {\r\n          console.error('Error fetching airspaces:', error);\r\n      }\r\n    }\r\n\r\n    if (typeof window.fetchAirspacesNotam === 'function' &&\r\n      window.mapInitialized &&\r\n      window.map.hasLayer(window.airspaceNotam)) {\r\n      try {\r\n          console.log(\"Fetching airspaces\");\r\n          window.fetchAirspacesNotam();\r\n      } catch (error) {\r\n          console.error('Error fetching airspaces:', error);\r\n      }\r\n    }\r\n\r\n    if (typeof window.fetchAirspacesXC === 'function' &&\r\n      window.mapInitialized &&\r\n      window.map.hasLayer(window.airspaceXC)) {\r\n      try {\r\n          console.log(\"Fetching airspaces\");\r\n          window.fetchAirspacesXC();\r\n      } catch (error) {\r\n          console.error('Error fetching airspaces:', error);\r\n      }\r\n    }\r\n\r\n    if (typeof window.fetchObstacles === 'function' &&\r\n      window.mapInitialized &&\r\n      window.map.hasLayer(window.obstacleLayer)) {\r\n      try {\r\n          console.log(\"Fetching obstacles\");\r\n          window.fetchObstacles();\r\n      } catch (error) {\r\n          console.error('Error fetching obstacles:', error);\r\n      }\r\n    }\r\n}, 500); // Give a short delay to ensure all scripts are loaded\r\n});\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","__webpack_require__.amdO = {};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","__webpack_require__.nmd = (module) => {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t792: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkXCmaps\"] = self[\"webpackChunkXCmaps\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [96], () => (__webpack_require__(8109)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","console","log","L","Control","Layers","Tree","extend","options","closedSymbol","openedSymbol","spaceSymbol","selectorBack","namedToggle","collapseAll","expandAll","labelIsSelector","_initClassesNames","this","cls","children","childrenNopad","hide","closed","opened","space","pointer","header","neverShow","node","name","label","selAllCheckbox","initialize","baseTree","overlaysTree","_scrollTop","_baseTree","_overlaysTree","Util","setOptions","prototype","call","_setTrees","setBaseTree","tree","setOverlayTree","undefined","addBaseLayer","_layer","_name","addOverlay","removeLayer","collapse","_sect","scrollTop","expand","onAdd","changeName","layer","_layersTreeName","toggle","innerHTML","ret","_container","getElementsByClassName","DomUtil","addClass","eachLayer","on","expandTree","overlay","container","_overlaysList","_baseLayersList","_applyOnTree","_localExpand","collapseTree","expandSelected","iter","el","p","parentElement","hasClass","that","removeClass","h","inputs","_layerControlInputs","getElementsByTagName","i","length","input","_getLayer","layerId","checked","_section","_form","base","overlays","iterate","output","forEach","child","forArrays","Array","isArray","noShow","_layers","off","_onLayerChange","bflat","j","_addLayer","oflat","k","_map","_update","top","it","els","_addItem","_obj","_addTreeLayout","_expandCollapseAll","_iterateTreeLayout","_checkDisabledLayers","text","fn","ctx","document","createElement","className","appendChild","tabIndex","DomEvent","type","keyCode","blur","selAllNodes","html","creator","selAll","sel","entry","insertBefore","selectAllCheckbox","_createCheckboxElement","sensible","_preventClick","splice","variable","hasLayer","radioGroup","stamp","_createRadioElement","manageSelectorsAll","push","_onInputClick","String","title","ev","stopPropagation","selectAllCheckboxes","updateSelAllCheckbox","collapsed","eventeds","eventedClasses","evented","obj","querySelector","event","selectAll","functionToCheck","select","toString","append","create","ancestor","selector","selectedAll","selectedNone","querySelectorAll","inp","indeterminate","_ev","defaultChecked","control","layers","ResponsivePopup","Popup","hasTip","_initLayout","prefix","wrapper","_wrapper","_contentNode","disableClickPropagation","disableScrollPropagation","_tipContainer","style","visibility","_tip","closeButton","_closeButton","setAttribute","href","preventDefault","close","_updatePosition","pos","latLngToLayerPoint","_latlng","basePoint","layerPointToContainerPoint","containerWidth","offsetWidth","containerHeight","offsetHeight","padding","point","autoPanPadding","paddingTL","autoPanPaddingTopLeft","paddingBR","autoPanPaddingBottomRight","mapSize","getSize","anchor","_getAnchor","offset","containerRadius","offsetX","Math","abs","x","offsetY","y","canGoTop","canGoBottom","canGoLeft","canGoRight","containerPos","subtractX","subtractY","containerLeft","containerRight","containerTop","containerBottom","subtract","tipWidth","left","getCenter","setPosition","responsivePopup","source","InfoControl","link","img","src","alt","width","height","modalOverlay","modalContent","contentAreaDiv","headerDiv","footerDiv","breadcrumbDiv","feedbackDropzone","currentFeedbackForm","isModalStructureBuilt","popupSections","home","privacy","terms","buildContentStructure","structureContainer","headerLeft","logoImg","headerRight","fbLink","target","fbImg","ghLink","ghImg","updateView","handleContentClick","showModal","body","display","structure","headerCloseButton","hideModal","ensureModalStructureExists","dragging","disable","touchZoom","doubleClickZoom","scrollWheelZoom","boxZoom","keyboard","tap","getContainer","cancelFeedback","enable","sectionName","currentPageSpan","innerText","error","async","handleFeedbackSubmit","formData","FormData","value","files","file","status","Dropzone","ADDED","QUEUED","response","fetch","method","result","json","messageDiv","textContent","success","message","restoreFooter","arguments","formToRemove","remove","destroy","contains","classList","window","closeFullscreenInfo","fsInfo","getElementById","insertAdjacentHTML","url","autoProcessQueue","maxFiles","maxFilesize","acceptedFiles","addRemoveLinks","dictDefaultMessage","clickable","init","err","formElement","cancelButton","emailInput","addEventListener","isValid","test","errorMsg","scrollHeight","showFeebackForm","depth","navTarget","currentTarget","dataset","section","parentNode","stop","fsContent","innerWidth","contentElement","popup","autoPan","setLatLng","setContent","openOn","triggerFullscreen","onRemove","airspaceClickHandler","fetchAirspacesGliding","center","apiUrl","lat","toFixed","lng","encodeURIComponent","join","then","data","airspaceGliding","clearLayers","airspaces","items","airspace","icaoClass","geometry","coordinates","coord","color","lowerLimit","polygon","airspaceTypes","icaoClasses","weight","fillOpacity","addLayer","clickedPoint","latlng","overlappingAirspaces","_ref","getBounds","popupContent","a","getUnit","unit","upperLimit","catch","unitCode","fetchAirspacesNotam","airspaceNotam","airspaceDebounceTimer","airspacePopupOpenListener","currentLowerLimit","selectedDateStr","today","Date","getFullYear","getMonth","padStart","getDate","getCurrentDateStr","allLoadedAirspaces","generateAirspacePopupHtml","tzName","moment","tz","guess","descriptionsHtml","descriptions","formatDescription","replace","desc","airdescription","airlanguage","activationsHtml","activations","activation","startMoment","utc","endMoment","format","formatLimit","limit","original","round","lower","airlower_j","upper","airupper_j","zoneAbbr","airspaceClass","fetchAirspacesXC","currentZoom","getZoom","airspaceXC","bounds","nw","getNorthWest","se","getSouthEast","features","userTimezone","Intl","DateTimeFormat","resolvedOptions","timeZone","selectedDateStartUTC","startOf","toDate","feature","properties","startsWith","lowerLimitMeters","getLimitMeters","isExpired","cMatch","match","year","parseInt","substring","month","day","hour","minute","UTC","hasActiveActivation","selectedDateEndUTC","endOf","activationStart","activationEnd","hasExpirationDate","strokeColor","strokeWeight","fillColor","bindPopup","includes","openedLayer","getLatLng","overlappingAirspacesData","pt","turf","index","poly","combinedHtml","openedLayerEntry","find","_popup","closePopup","newLimit","clearTimeout","setTimeout","newDate","getCompassDirection","deg","getFillColor","speed","getStrokeColor","getTextColor","backgroundColor","showTab","tabId","element","closest","warn","tab","targetTab","add","stationId","split","canvas","chartInstance","resize","fetchWindStations","windLayer","nwLat","nwLng","seLat","seLng","responseData","newStationsMap","Map","station","_id","existingMarkersMap","marker","set","updatedCount","removedCount","addedCount","newStationData","get","windDirection","last","windAvg","windMax","newArrowSvg","peak","newArrowIcon","divIcon","iconSize","iconAnchor","setIcon","delete","lon","loc","toLocaleTimeString","peakArrow","isHolfuy","holfuyStationId","arrowSvg","arrowIcon","icon","addTo","historyData","aggregatedData","grouped","dt","setMinutes","floor","getMinutes","setSeconds","setMilliseconds","key","getTime","count","wAvgSum","wMaxSum","wDirSum","tempSum","tempCount","sort","b","processHistoricalData","fiveHoursAgo","now","limitedData","filter","slice","historyTable","timeFormatted","compassDir","chartData","reverse","currentWindAvg","currentWindMax","currentWindDir","currentCompassDir","currentLastUpdate","popupHtml","short","maxWidth","minWidth","maxHeight","getContext","chartDataPointsAvg","chartDataPointsMax","Chart","datasets","borderColor","fill","pointRadius","responsive","maintainAspectRatio","layout","bottom","scales","time","displayFormats","tooltipFormat","grid","drawBorder","ticks","autoSkip","maxRotation","minRotation","beginAtZero","stepSize","maxTicksLimit","font","size","plugins","legend","afterDraw","chart","xAxis","save","arrowRowY","textAlign","textBaseline","getPixelForValue","translate","rotate","PI","fillText","restore","cameraTabElement","cameraImageElement","loadingText","replaceChild","extractingText","websiteUrl","websiteProxyUrl","ok","pictureElements","DOMParser","parseFromString","webcamPicture","picture","toLowerCase","sourceElements","imgElement","imageUrl","srcset","getAttribute","trim","URL","imageProxyUrl","cameraImageUrl","testImage","Image","onload","onerror","complete","naturalWidth","changeSwiper","swiperc","$","css","changeDirection","getAngleRange","direction","dirToAngle","angleRanges","part","range","dir","angle","start","end","loadPlaceDetails","placeId","regex1","regex2","regexHeight","regexHD","regexRating","description","currentPlaceName","currentPlaceId","currentStrPlacemarkId","strPlacemarkId","appConfig","fullSpotsPopoup","rating","heightdifference","lastupdate","fullScreenInfo","fullScreenContentArea","defaultCloseBtn","defaultFooter","setPopupContent","firstImg","idImg","swiperv","swiperLoop3","swiperLoop4","Swiper","autoHeight","allowTouchMove","mousewheel","slidesPerView","loop","spaceBetween","breakpoints","scrollbar","draggable","click","iR","clickedSlide","firstChild","slideTo","transitionEnd","realIndex","initSwiper","replaceWith","cloneNode","popupElement","getPopup","getElement","simplifiedPopupContent","isFullScreen","contextElement","modalFooter","feedbackFormHtml","scrollTo","behavior","feedbackText","focus","dzInstance","previewElement","deleteIcon","removeFile","fallbackFooter","initSpotPG","placesLayerPG","clusterGroup","markerClusterGroup","disableClusteringAtZoom","spiderfyOnMaxZoom","showCoverageOnHover","zoomToBoundsOnClick","maxClusterRadius","iconCreateFunction","cluster","getChildCount","currentFetchController","fetchDebounceTimer","fetchPlaces","abort","AbortController","signal","nw_lat","nw_lng","se_lat","se_lng","aborted","geoJSON","pointToLayer","canvasIcon","drawIcon","clearRect","beginPath","moveTo","arc","lineTo","fillStyle","closePath","onEachFeature","fetchPlacesPG","initSpotHG","placesLayerHG","fetchPlacesHG","initSpotLZ","placesLayerLZ","iconUrl","fetchPlacesLZ","mapInitialized","obstacleClickHandler","obstacleLayer","layerGroup","attribution","fetchRainviewerMetadata","endpoint","fetchObstacles","geoJson","obstacles","coords","polyline","content","maxAgl","clickedObstacles","obs","TimeDimension","Layer","Rainviewer","tileLayer","_endpoint","_refreshInterval","refreshInterval","_refreshTimer","_metadata","_frames","_defaultTime","_availableTimes","_timeCacheBackward","cacheBackward","cache","_timeCacheForward","cacheForward","_updateTimeDimension","updateTimeDimension","_updateTimeDimensionMode","updateTimeDimensionMode","_type","_loaded","metadata","_setAvailableTimes","_baseLayer","setLoaded","fire","bind","setInterval","_refreshData","clearInterval","nowcast","past","frame","infrared","sort_and_deduplicate","Number","_updateCurrentTime","_timeDimension","getAvailableTimes","setAvailableTimes","setCurrentTime","context","prop","hasOwnProperty","_onNewTimeLoading","_getLayerForTime","isReady","minZoom","maxZoom","isLoaded","getCurrentTime","_currentLayer","_showLayer","setOpacity","opacity","apply","setZIndex","zIndex","_unvalidateCache","redraw","_evictCachedTimes","keepforward","keepbackward","objectsToRemove","times","_getLoadedTimes","strTime","_currentTime","indexOf","_removeLayers","show","nearestTime","_getNearestTime","newLayer","_createLayerForTime","isLoading","getPrototypeOf","host","TileLayer","path","l","setMinimumForwardCache","len","toISOString","timeDimension","rainviewer","keycloak","Keycloak","location","origin","realm","clientId","isAuthenticated","userProfile","logout","hasRealmRole","currentMapState","selectedBaseLayer","selectedOverlays","controlContainer","selectedBaseLayerLabel","selectedOverlayLabels","radio","labelElement","checkbox","labelText","getCurrentMapState","treeLayersControl","preferences","headers","token","JSON","stringify","statusText","redirectUri","updateUserIcon","badge","authenticated","iconContainer","createUserControl","UserControl","showProfileBadge","login","onAuthSuccess","loadUserProfile","profile","alert","userControl","opts","position","existingBadge","username","email","logoutButton","closeProfileBadge","removeEventListener","loadUserPreferences","baseLayerApplied","overlayLabelsToApply","Set","shouldBeChecked","has","applyMapPreferences","initMap","zoom","zoomControl","awgTerrain","osm","xcontest","popupEl","showInFullscreen","closeButtonHTML","footerHTML","contentHTML","Node","outerHTML","infoContentElement","getContent","headerCloseBtn","footerCloseBtn","mapTilerTerrain","mapboxGL","apiKey","sat","subdomains","kk7thermals","maxNativeZoom","tms","oaipMap","rainviewerRadarLayer","rainviewerSatelliteLayer","updateTimeDimensionControlVisibility","timeDimensionControl","playerOptions","transitionTime","buffer","timeZones","autoPlay","speedSlider","isTimeDimensionControlAdded","airspaceTimeOptions","date","dayName","overlayTree","Logo","logo","mapInstance","locate","drawCircle","keepCurrentZoomLevel","iconLoading","iconElementTag","setView","flyTo","windRefreshIntervalId","refreshWindStations","layersControlContainer","layersControlToggle","isUpdatingTimeDimensionControl","shouldBeVisible","hasRadar","hasSatellite","isAnyRainViewerLayerActive","timeoutPromise","Promise","_","reject","addControlPromise","race","finally","removeControl","navigator","maxTouchPoints","msMaxTouchPoints","rainviewerUpdateTimeout","updateTimeDisplay","timeMatch","hours","minutes","period","toUpperCase","formattedTime","debouncedUpdateTimeDimensionControl","MutationObserver","mutations","observe","childList","subtree","rainviewerRefreshInterval","mapReadyEvent","Event","dispatchEvent","onLoad","silentCheckSsoRedirectUri","checkLoginIframe","terrainRadio","config","fetchAppConfig","geolocation","getCurrentPosition","userLat","latitude","userLng","longitude","locationReadyEvent","CustomEvent","detail","__webpack_module_cache__","moduleId","cachedModule","loaded","__webpack_modules__","m","amdO","O","chunkIds","priority","notFulfilled","Infinity","fulfilled","every","r","d","definition","defineProperty","enumerable","g","globalThis","Function","nmd","paths","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","some","chunkLoadingGlobal","self","__webpack_exports__"],"sourceRoot":""}