/*! For license information please see main.9aae1729286bb44ea4ba.js.LICENSE.txt */
(()=>{"use strict";console.log("L.Control.Layers.Tree has been loaded!"),function(t){if(void 0===t)throw new Error("Leaflet must be included first");t.Control.Layers.Tree=t.Control.Layers.extend({options:{closedSymbol:"+",openedSymbol:"&minus;",spaceSymbol:" ",selectorBack:!1,namedToggle:!1,collapseAll:"",expandAll:"",labelIsSelector:"both"},_initClassesNames:function(){this.cls={children:"leaflet-layerstree-children",childrenNopad:"leaflet-layerstree-children-nopad",hide:"leaflet-layerstree-hide",closed:"leaflet-layerstree-closed",opened:"leaflet-layerstree-opened",space:"leaflet-layerstree-header-space",pointer:"leaflet-layerstree-header-pointer",header:"leaflet-layerstree-header",neverShow:"leaflet-layerstree-nevershow",node:"leaflet-layerstree-node",name:"leaflet-layerstree-header-name",label:"leaflet-layerstree-header-label",selAllCheckbox:"leaflet-layerstree-sel-all-checkbox"}},initialize:function(e,n,r){this._scrollTop=0,this._initClassesNames(),this._baseTree=null,this._overlaysTree=null,t.Util.setOptions(this,r),t.Control.Layers.prototype.initialize.call(this,null,null,r),this._setTrees(e,n)},setBaseTree:function(t){return this._setTrees(t)},setOverlayTree:function(t){return this._setTrees(void 0,t)},addBaseLayer:function(t,e){throw"addBaseLayer is disabled"},addOverlay:function(t,e){throw"addOverlay is disabled"},removeLayer:function(t){throw"removeLayer is disabled"},collapse:function(){return this._scrollTop=this._sect().scrollTop,t.Control.Layers.prototype.collapse.call(this)},expand:function(){t.Control.Layers.prototype.expand.call(this),this._sect().scrollTop=this._scrollTop},onAdd:function(e){function n(t){t._layersTreeName&&(o.innerHTML=t._layersTreeName)}var r=t.Control.Layers.prototype.onAdd.call(this,e);if(this.options.namedToggle){var o=this._container.getElementsByClassName("leaflet-control-layers-toggle")[0];t.DomUtil.addClass(o,"leaflet-layerstree-named-toggle"),e.eachLayer((function(t){n(t)})),e.on("baselayerchange",(function(t){n(t.layer)}),this)}return r},expandTree:function(t){var e=t?this._overlaysList:this._baseLayersList;return e&&this._applyOnTree(e,!1),this._localExpand()},collapseTree:function(t){var e=t?this._overlaysList:this._baseLayersList;return e&&this._applyOnTree(e,!0),this._localExpand()},expandSelected:function(e){function n(e){var o=e.parentElement;if(o){if(t.DomUtil.hasClass(o,r.cls.children)&&!t.DomUtil.hasClass(e,r.cls.childrenNopad)&&t.DomUtil.removeClass(o,i),t.DomUtil.hasClass(o,r.cls.node)){var a=o.getElementsByClassName(r.cls.header)[0];r._applyOnTree(a,!1)}n(o)}}var r=this,o=e?this._overlaysList:this._baseLayersList;if(!o)return this;for(var i=this.cls.hide,a=this._layerControlInputs||o.getElementsByTagName("input"),c=0;c<a.length;c++){var l=a[c];this._getLayer&&!!this._getLayer(l.layerId).overlay!=!!e||l.checked&&n(l.parentElement.parentElement.parentElement.parentElement)}return this._localExpand()},_sect:function(){return this._section||this._form},_setTrees:function(t,e){var n=0;function r(t,e,o){return t&&t.layer&&(o||(t.layer._layersTreeName=t.name||t.label),e[n++]=t.layer),t&&t.children&&t.children.length&&t.children.forEach((function(t){r(t,e,o)})),e}function o(t){return Array.isArray(t)?{noShow:!0,children:t}:t}this._layerControlInputs&&(this._layerControlInputs=[]);for(var i=0;i<this._layers.length;++i)this._layers[i].layer.off("add remove",this._onLayerChange,this);this._layers=[],void 0!==t&&(this._baseTree=o(t)),void 0!==e&&(this._overlaysTree=o(e));var a=r(this._baseTree,{});for(var c in a)this._addLayer(a[c],c);var l=r(this._overlaysTree,{},!0);for(var s in l)this._addLayer(l[s],s,!0);return this._map?this._update():this},_localExpand:function(){if(this._map&&t.DomUtil.hasClass(this._container,"leaflet-control-layers-expanded")){var e=this._sect().scrollTop;this.expand(),this._sect().scrollTop=e,this._scrollTop=e}return this},_applyOnTree:function(e,n){[{cls:this.cls.children,hide:n},{cls:this.cls.opened,hide:n},{cls:this.cls.closed,hide:!n}].forEach((function(n){for(var r=e.getElementsByClassName(n.cls),o=0;o<r.length;o++){var i=r[o];t.DomUtil.hasClass(i,this.cls.childrenNopad)||(n.hide?t.DomUtil.addClass(i,this.cls.hide):t.DomUtil.removeClass(i,this.cls.hide))}}),this)},_addItem:function(t){},_update:function(){return this._container?(t.Control.Layers.prototype._update.call(this),this._addTreeLayout(this._baseTree,!1),this._addTreeLayout(this._overlaysTree,!0),this._localExpand()):this},_addTreeLayout:function(t,e){if(t){var n=e?this._overlaysList:this._baseLayersList;this._expandCollapseAll(e,this.options.collapseAll,this.collapseTree),this._expandCollapseAll(e,this.options.expandAll,this.expandTree),this._iterateTreeLayout(t,n,e,[],t.noShow),this._checkDisabledLayers&&this._checkDisabledLayers()}},_expandCollapseAll:function(e,n,r,o){var i=e?this._overlaysList:this._baseLayersList;if(o=o||this,n){var a=document.createElement("div");a.className="leaflet-layerstree-expand-collapse",i.appendChild(a),a.innerHTML=n,a.tabIndex=0,t.DomEvent.on(a,"click keydown",(function(t){"keydown"===t.type&&32!==t.keyCode||(a.blur(),r.call(o,e),this._localExpand())}),this)}},_iterateTreeLayout:function(e,n,r,o,i){if(e){var a,c=k("div",this.cls.header,n),l=k("span"),s=k("span"),u=k("span",this.cls.closed,l,this.options.closedSymbol),p=k("span",this.cls.opened,l,this.options.openedSymbol),d=k("span",this.cls.space,null,this.options.spaceSymbol);this.options.selectorBack?(l.insertBefore(d,u),c.appendChild(s),c.appendChild(l)):(l.appendChild(d),c.appendChild(l),c.appendChild(s)),e.selectAllCheckbox&&((a=this._createCheckboxElement(!1)).className+=" "+this.cls.selAllCheckbox);var h=this.cls.hide;if(e.children){var f=k("div",this.cls.children,n),y=e.layer?l:c;t.DomUtil.addClass(y,this.cls.pointer),y.tabIndex=0,t.DomEvent.on(y,"click keydown",(function(e){this._preventClick||"keydown"===e.type&&32!==e.keyCode||(y.blur(),t.DomUtil.hasClass(p,h)?(t.DomUtil.addClass(u,h),t.DomUtil.removeClass(p,h),t.DomUtil.removeClass(f,h)):(t.DomUtil.removeClass(u,h),t.DomUtil.addClass(p,h),t.DomUtil.addClass(f,h)),this._localExpand())}),this),a&&o.splice(0,0,n),e.children.forEach((function(t){var e=k("div",this.cls.node,f);this._iterateTreeLayout(t,e,r,o)}),this),a&&o.splice(0,1)}else t.DomUtil.addClass(l,this.cls.neverShow);var m,v=k(e.layer&&("both"===this.options.labelIsSelector||r&&"overlay"===this.options.labelIsSelector||!r&&"base"===this.options.labelIsSelector)?"label":"span",this.cls.label,s);if(e.layer){var g,w=this._map.hasLayer(e.layer),b=r?e.radioGroup:"leaflet-base-layers_"+t.Util.stamp(this);b?g=this._createRadioElement(b,w):T(g=this._createCheckboxElement(w),this),this._layerControlInputs&&this._layerControlInputs.push(g),g.layerId=t.Util.stamp(e.layer),t.DomEvent.on(g,"click",this._onInputClick,this),v.appendChild(g)}e.selectAllCheckbox&&(v.appendChild(a),("string"==typeof(m=e.selectAllCheckbox)||m instanceof String)&&(a.title=e.selectAllCheckbox),t.DomEvent.on(a,"click",(function(t){t.stopPropagation(),C(a.checked,this)}),this),S(n),T(a,this)),k("span",this.cls.name,v,e.label),t.DomUtil.addClass(e.collapsed?p:u,h),e.collapsed&&f&&t.DomUtil.addClass(f,h),i&&(t.DomUtil.addClass(c,this.cls.neverShow),t.DomUtil.addClass(f,this.cls.childrenNopad));var L=e.eventedClasses;L instanceof Array||(L=[L]);for(var x=0;x<L.length;x++){var E=L[x];if(E&&E.className){var _=n.querySelector("."+E.className);_&&t.DomEvent.on(_,E.event||"click",function(t){return function(r){r.stopPropagation();var o,i=(o=t)&&"[object Function]"==={}.toString.call(o)?t(r,n,e,this._map):t;null!=i&&C(i,this)}}(E.selectAll),this)}}}function k(e,n,r,o){var i=t.DomUtil.create(e,n,r);return o&&(i.innerHTML=o),i}function S(t){var e=t.querySelector("input[type=checkbox]"),n=!0,r=!0,o=t.querySelectorAll("input[type=checkbox]");[].forEach.call(o,(function(t){t===e||(t.indeterminate?(n=!1,r=!1):t.checked?r=!1:t.checked||(n=!1))})),n?(e.indeterminate=!1,e.checked=!0):r?(e.indeterminate=!1,e.checked=!1):(e.indeterminate=!0,e.checked=!1)}function T(e,n){o.forEach((function(r){t.DomEvent.on(e,"click",(function(t){S(r)}),n)}),n)}function C(t,e){for(var r=n.getElementsByTagName("input"),o=0;o<r.length;o++){var i=r[o];"checkbox"===i.type&&(i.checked=t,i.indeterminate=!1)}e._onInputClick()}},_createCheckboxElement:function(t){var e=document.createElement("input");return e.type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=t,e}}),t.control.layers.tree=function(e,n,r){return new t.Control.Layers.Tree(e,n,r)}}(L),console.log("L.Control.Layers.Tree has been loaded!");var t=window.L;const e=t.Control.extend({onAdd:function(e){var n=t.DomUtil.create("div","info-control leaflet-bar leaflet-control"),r=t.DomUtil.create("a","leaflet-control-button",n);r.href="#";var o=t.DomUtil.create("img","info-control-icon",r);return o.src="assets/images/info.png",o.alt="Information",o.style.width="24px",o.style.height="24px",o.style.padding="4px",t.DomEvent.disableClickPropagation(n),t.DomEvent.on(r,"click",(function(n){t.DomEvent.stop(n);t.popup({className:"info-popup",autoPan:!0}).setLatLng(e.getCenter()).setContent('<div style="padding: 10px; max-width: 800px;"><h3><img src="/assets/images/XCmapsLogo.png" alt="XCmaps"></h3><p>You can contact us by email, or report any issue on github.</p><p><strong>Credits:</strong></p><ul><li>Terrain tiles by <a href="https://www.jawg.io" target="_blank">Jawg</a></li><li>OpenStreetMap</li><li>XContest terrain data</li><li>MapTiler for GL layer</li><li>Airspaces: Airspaces are imported from openaip:"OpenAIP data is not certified and must not be used for primary navigation or flight planning. Never rely on openAIP data! OpenAIP data contains errors. Using openAIP data may result in serious injury or death."</li><li>Wind Stations: based on <a href="https://github.com/winds-mobi/" target="_blank">winds.mobi</a> by Yann Savary and additional data sources</li><li>Spots: © <a href="https://paraglidingspots.com" target="_blank">paraglidingspots.com</a> by Karsten Ehlers</li><li>and many more open source libraries, projects, and artwork</li></ul><p>This map combines various data sources for aerial sports navigation.</p></div>').openOn(e)})),n}});function n(){if(window.map){var t=window.map.getCenter(),e=t.lat.toFixed(6),n=t.lng.toFixed(6),a="".concat("http://localhost:3000","/api/airspaces?lat=").concat(e,"&lng=").concat(n,"&dist=200000");fetch(a).then((function(t){return t.json()})).then((function(t){window.airspaceEFG.clearLayers();var e=[];t.items.forEach((function(t){if((0!==t.type||4!==t.icaoClass)&&t.geometry&&"Polygon"===t.geometry.type){var n=t.geometry.coordinates[0].map((function(t){return[t[1],t[0]]})),i=0===t.lowerLimit.value?"red":"blue",a=(r[t.type],o[t.icaoClass],L.polygon(n,{color:i,weight:2,fillOpacity:.3}));e.push({polygon:a,data:t}),window.airspaceEFG.addLayer(a)}})),console.log("Added ".concat(e.length," airspaces to the map")),window.map.off("click.airspaces"),window.map.on("click.airspaces",(function(t){var n=t.latlng,a=[];if(e.forEach((function(t){var e=t.polygon,r=t.data;e.getBounds().contains(n)&&a.push(r)})),a.length>0){var c=a.map((function(t){return"\n            <b>".concat(t.name,"</b><br>\n            Type: ").concat(r[t.type]||"Unknown","<br>\n            ICAO Class: ").concat(o[t.icaoClass]||"Unknown","<br>\n            ↧").concat(t.lowerLimit.value," ").concat(i(t.lowerLimit.unit),"  ↥").concat(t.upperLimit.value," ").concat(i(t.upperLimit.unit),"<br>\n          ")})).join("<hr>");L.popup().setLatLng(n).setContent(c).openOn(window.map)}}))})).catch((function(t){return console.error("Error fetching airspaces:",t)}))}else console.error("Map not initialized yet")}var r={0:"Other"},o={0:"A"};function i(t){return{1:"ft",6:"FL"}[t]||"Unknown"}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,c=[],l=!0,s=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(c.push(r.value),c.length!==e);l=!0);}catch(t){s=!0,o=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return c(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function l(t){return["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"][Math.round(t/22.5)%16]}function s(t){return t>=7&&t<=14?"LimeGreen":t>=15&&t<=24?"yellow":t>=25&&t<=30?"orange":t>=31&&t<=36?"red":t>36?"black":"Aquamarine"}function u(t){return t>=15&&t<=24?"LimeGreen":t>=25&&t<=32?"yellow":t>=33&&t<=38?"orange":t>=39&&t<=44?"red":t>44?"black":"Aquamarine"}function p(t){return"black"===t?"white":"black"}function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function h(){h=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var i=e&&e.prototype instanceof w?e:w,a=Object.create(i.prototype),c=new I(r||[]);return o(a,"_invoke",{value:C(t,n,c)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",y="suspendedYield",m="executing",v="completed",g={};function w(){}function b(){}function L(){}var x={};s(x,a,(function(){return this}));var E=Object.getPrototypeOf,_=E&&E(E(A([])));_&&_!==n&&r.call(_,a)&&(x=_);var k=L.prototype=w.prototype=Object.create(x);function S(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function n(o,i,a,c){var l=p(t[o],t,i);if("throw"!==l.type){var s=l.arg,u=s.value;return u&&"object"==d(u)&&r.call(u,"__await")?e.resolve(u.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(u).then((function(t){s.value=t,a(s)}),(function(t){return n("throw",t,a,c)}))}c(l.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function C(e,n,r){var o=f;return function(i,a){if(o===m)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var c=r.delegate;if(c){var l=P(c,r);if(l){if(l===g)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=m;var s=p(e,n,r);if("normal"===s.type){if(o=r.done?v:y,s.arg===g)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(o=v,r.method="throw",r.arg=s.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function G(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function A(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(d(e)+" is not iterable")}return b.prototype=L,o(k,"constructor",{value:L,configurable:!0}),o(L,"constructor",{value:b,configurable:!0}),b.displayName=s(L,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,L):(t.__proto__=L,s(t,l,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},S(T.prototype),s(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new T(u(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(k),s(k,l,"Generator"),s(k,a,(function(){return this})),s(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=A,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(G),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return c.type="throw",c.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),s=r.call(a,"finallyLoc");if(l&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),G(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;G(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:A(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function f(t,e,n,r,o,i,a){try{var c=t[i](a),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(r,o)}function y(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){f(i,r,o,a,c,"next",t)}function c(t){f(i,r,o,a,c,"throw",t)}a(void 0)}))}}window.fetchAirspaces=n,document.addEventListener("map_initialized",(function(){console.log("Setting up airspace layer events"),window.map.on("overlayadd",(function(t){"Airspaces"!==t.name&&"Gliding"!==t.name&&"Notam"!==t.name||(console.log("Overlay added: ".concat(t.name,", fetching airspaces")),n())})),window.map.on("moveend",(function(){window.map.hasLayer(window.airspaceEFG)&&(console.log("Map moved, refreshing airspaces"),n())}))})),window.showTab=function(t,e){console.log("Switching to tab:",t),document.querySelectorAll(".tab-content").forEach((function(t){t.style.display="none"})),document.querySelectorAll(".tab").forEach((function(t){t.classList.remove("active")}));var n=document.getElementById(t);if(n?n.style.display="block":console.error("Tab not found:",t),e?e.classList.add("active"):console.error("Element is null or undefined"),t.startsWith("chart-")){var r=t.split("chart-")[1];console.log("Station ID:",r);var o=document.getElementById("canvas-".concat(r));o?(console.log("Canvas found:",o),o.chartInstance?(console.log("Updating chart..."),o.chartInstance.resize(),o.chartInstance.update()):console.warn("Chart instance not found on canvas:",o)):console.error("Canvas not found for station ID:",r)}},window.fetchWindStations=function(){if(window.map&&"function"==typeof window.map.getBounds){var t=window.map.getBounds(),e=t.getNorthWest().lat,n=t.getNorthWest().lng,r=t.getSouthEast().lat,o=t.getSouthEast().lng;fetch("".concat("http://localhost:3000","/api/wind-data-getCurrent?nwLat=").concat(e,"&nwLng=").concat(n,"&seLat=").concat(r,"&seLng=").concat(o)).then((function(t){return t.json()})).then((function(t){if(!Array.isArray(t))throw new Error("Invalid data format received from API");windLayer.clearLayers(),console.log("Wind layers cleared"),t.forEach((function(t){var e=a(t.loc.coordinates,2),n=e[0],r=e[1],o=t.last["w-dir"],i=t.last["w-avg"],c=t.last["w-max"],d=(t.last.temp,l(o)),h=new Date(1e3*t.last._id).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"}),f=s(i),y=u(c),m=t.peak?"▲":"▼",v=t._id.includes("holfuy"),g="";v&&(g=t._id.split("-")[1]);var w='\n          <svg width="30" height="30" viewBox="0 0 800 900" xmlns="http://www.w3.org/2000/svg">\n            <g transform="rotate('.concat(o+90,', 400, 400)" stroke="').concat(y,'" stroke-width="60">\n              <path d="M203,391 L75,144 L738,391 L75,637 L203,391 Z" fill="').concat(f,'"/>\n            </g>\n            <text x="330" y="850" font-size="220" text-anchor="middle" fill="black" font-weight="bold">\n              ').concat(m).concat(Math.round(i)," / ").concat(Math.round(c),"\n            </text>\n          </svg>"),b=L.divIcon({className:"wind-arrow",html:w,iconSize:[30,30],iconAnchor:[12,15]}),x=L.marker([r,n],{icon:b}).addTo(windLayer);fetch("https://winds.mobi/api/2.3/stations/".concat(t._id,"/historic/?duration=21000&keys=w-dir&keys=w-avg&keys=w-max&keys=temp")).then((function(t){return t.json()})).then((function(e){var n=function(t){var e={};t.forEach((function(t){var n=new Date(1e3*t._id);n.setMinutes(10*Math.floor(n.getMinutes()/10)),n.setSeconds(0),n.setMilliseconds(0);var r=n.getTime();e[r]||(e[r]={count:0,wAvgSum:0,wMaxSum:0,wDirSum:0,tempSum:0,tempCount:0}),e[r].count++,e[r].wAvgSum+=t["w-avg"],e[r].wMaxSum+=t["w-max"],e[r].wDirSum+=t["w-dir"],void 0!==t.temp&&(e[r].tempSum+=t.temp,e[r].tempCount++)}));var n=Object.keys(e).map((function(t){return{_id:parseInt(t)/1e3,"w-avg":e[t].wAvgSum/e[t].count,"w-max":e[t].wMaxSum/e[t].count,"w-dir":e[t].wDirSum/e[t].count,temp:e[t].tempCount>0?e[t].tempSum/e[t].tempCount:void 0}}));return n.sort((function(t,e){return e._id-t._id})),n}(e),r=Date.now()-18e6,a=n.filter((function(t){return 1e3*t._id>=r})),f='<table border="1" style="border-collapse: collapse; width: 100%; text-align: center;">\n              <thead>\n                <tr>\n                  <th>Wind (m/s)</th>\n                  <th>Gusts (m/s)</th>\n                  <th>Direction</th>\n                  <th>Temp C°</th>\n                  <th>Time</th>\n                </tr>\n              </thead>\n              <tbody>';a.forEach((function(t){var e=new Date(1e3*t._id).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"}),n=l(t["w-dir"]);f+='<tr>\n                <td style="color: '.concat(p(s(t["w-avg"])),"; background-color: ").concat(s(t["w-avg"]),';">\n                  ').concat(t["w-avg"].toFixed(1),'\n                </td>\n                <td style="color: ').concat(p(u(t["w-max"])),"; background-color: ").concat(u(t["w-max"]),';">\n                  ').concat(t["w-max"].toFixed(1),'\n                </td>\n                <td>\n                  <span style="display: inline-block; transform: rotate(').concat(t["w-dir"]+180,'deg);"><strong>⬆ </strong></span>\n                  ').concat(n,"\n                </td>\n                <td>").concat(void 0!==t.temp?t.temp.toFixed(1):"N/A","</td>\n                <td>").concat(e,"</td>\n              </tr>")})),f+="</tbody></table>";var y=n.slice().reverse(),m='\n              <div style="display: flex; gap: 1px; align-items: flex-start;">\n                <div style="flex: 1;">\n                  <strong>'.concat(t.short,'</strong><br><br>\n                  <tag-name style="white-space:pre">Wind Speed:&#9;&#9;').concat(i,' km/h<br></tag-name>\n                  <tag-name style="white-space:pre">Max Wind:&#9;&#9;').concat(c,' km/h<br></tag-name>\n                  <tag-name style="white-space:pre">Wind Direction:&#9;').concat(o,"° (").concat(d,')<br></tag-name>\n                  <tag-name style="white-space:pre">Last Update:&#9;&#9;').concat(h,"<br><br></tag-name>\n                </div>\n                ").concat(v?'\n                  <div style="flex: 0 0 auto; width: 110px;">\n                    <iframe src="https://widget.holfuy.com/?station='.concat(g,'&su=km/h&t=C&lang=en&mode=rose&size=110"\n                      width="160"\n                      height="110"\n                      frameborder="0"\n                      scrolling="no">\n                    </iframe>\n                  </div>\n                '):"",'\n              </div>\n              \n              <div class="tab-container">\n                <div class="tab active" onclick="showTab(\'table-').concat(t._id,'\', this)">Table</div>\n                <div class="tab" onclick="showTab(\'chart-').concat(t._id,'\', this)">Chart</div>\n                <div class="tab" id="camera-tab-').concat(t._id,'" style="display: none;" onclick="showTab(\'camera-').concat(t._id,'\', this)">Camera</div>\n              </div>\n              <div id="table-').concat(t._id,'" class="tab-content">\n                ').concat(f,'\n              </div>\n              <div id="chart-').concat(t._id,'" class="tab-content" style="display: none;">\n                <canvas id="canvas-').concat(t._id,'" width="400" height="200"></canvas>\n              </div>\n              <div id="camera-').concat(t._id,'" class="tab-content" style="display: none;">\n                <img id="camera-image-').concat(t._id,'" src="" alt="Camera Image" style="width: 100%; height: auto;">\n              </div>\n            ');x.bindPopup(L.responsivePopup({hasTip:!0,autoPan:!1,offset:[15,25],maxWidth:560,maxHeight:800}).setContent(m)),x.on("popupopen",(function(){setTimeout((function(){var e=document.getElementById("canvas-".concat(t._id));if(e){e.style.height="300px";var n=e.getContext("2d");if(n){var r=y.map((function(t){return{x:1e3*t._id,y:t["w-avg"]}})),o=y.map((function(t){return{x:1e3*t._id,y:t["w-max"]}})),i=new Chart(n,{type:"line",data:{datasets:[{label:"Wind Avg (km/h)",data:r,borderColor:"blue",fill:!1,pointRadius:3},{label:"Wind Max (km/h)",data:o,borderColor:"red",fill:!1,pointRadius:3}]},options:{responsive:!0,maintainAspectRatio:!1,layout:{padding:{bottom:5}},scales:{x:{type:"time",time:{unit:"hour",displayFormats:{hour:"HH:mm"},tooltipFormat:"HH:mm"},grid:{drawBorder:!0},ticks:{autoSkip:!0,maxRotation:0,minRotation:0,padding:30}},y:{beginAtZero:!0,ticks:{stepSize:10,maxTicksLimit:10,font:{size:14}}}},plugins:{legend:{display:!1}}},plugins:[{id:"windDirectionArrows",afterDraw:function(t){var e=t.ctx,n=t.scales.x;e.save();var r=n.top+20;e.textAlign="center",e.textBaseline="middle",y.forEach((function(t){var o=n.getPixelForValue(1e3*t._id);e.save(),e.translate(o,r),e.rotate((t["w-dir"]+180)*Math.PI/180),e.font="18px Arial",e.fillText("⬆",0,0),e.restore()})),e.restore()}}]});e.chartInstance=i}else console.error("Failed to get 2D context from canvas.")}else console.error("Canvas element not found.");if(t._id.includes("holfuy")){var a=t._id.split("-")[1],c="https://holfuy.com/en/takeit/cam/s".concat(a,".jpg"),l=document.getElementById("camera-image-".concat(t._id)),s=document.getElementById("camera-tab-".concat(t._id)),u=new Image;u.onload=function(){l.src=c,s.style.display="block"},u.onerror=function(){s.style.display="none"},u.src=c,setTimeout((function(){u.complete&&0!==u.naturalWidth||(s.style.display="none")}),2e3)}}),500)}))})).catch((function(t){return console.error("Error fetching historical wind data:",t)}))}))})).catch((function(t){return console.error("Error fetching wind station data:",t)}))}else console.error("Map not properly initialized")};var m=null,v=null;function g(){"undefined"!=typeof swiperc&&(window.innerWidth<576?($(".swiper2").css("height",""),$(".swiper2").css("width","320px"),$(".swiper2").css("padding-left",""),$(".swiper2").css("padding-top","30px"),$(".swiper2 > .swiper-wrapper").css("width",""),$(".swiper2 > .swiper-wrapper").css("height","100px"),swiperc.changeDirection("horizontal",!0)):(window.innerWidth<840?($(".swiper2").css("width",""),$(".swiper2").css("height","320px")):($(".swiper2").css("width",""),$(".swiper2").css("height","460px")),$(".swiper2").css("padding-top",""),$(".swiper2").css("padding-left","30px"),$(".swiper2 > .swiper-wrapper").css("height",""),$(".swiper2 > .swiper-wrapper").css("width","100px"),swiperc.changeDirection("vertical",!0)))}function w(t){var e,n=!(t<4),r=!(t<5);e=new Swiper(".swiper1",{autoHeight:!0,direction:"horizontal",allowTouchMove:!1,mousewheel:!1,slidesPerView:1,loop:!1}),new Swiper(".swiper2",{direction:"vertical",allowTouchMove:!0,mousewheel:!0,slidesPerView:3,spaceBetween:10,loop:n,breakpoints:{840:{slidesPerView:4,loop:r}},scrollbar:{el:".swiper-scrollbar",hide:!1,draggable:!0},on:{click:function(){var t=this.clickedSlide.firstChild.id.substring(3)-1;e.slideTo(t,1)},transitionEnd:function(){var t=this.realIndex;e.slideTo(t,1)}}}),g()}function b(t){var e={N:0,NNE:22.5,NE:45,ENE:67.5,E:90,ESE:112.5,SE:135,SSE:157.5,S:180,SSW:202.5,SW:225,WSW:247.5,W:270,WNW:292.5,NW:315,NNW:337.5},n=[];return t.split(",").map((function(t){return t.trim()})).forEach((function(t){var r=t.split("-").map((function(t){return t.trim()}));if(1===r.length){var o=e[r[0]];void 0!==o&&n.push([o-22.5,o+22.5])}else if(2===r.length){var i=e[r[0]],a=e[r[1]];if(void 0!==i&&void 0!==a){if(a<i){var c=[a,i];i=c[0],a=c[1]}if(a-i>180){var l=[a,i];i=l[0],a=l[1]}n.push([i,a])}}})),n}function x(t,e){return E.apply(this,arguments)}function E(){return(E=y(h().mark((function t(e,n){var r,o,i,a,c,l,s,u,p;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("".concat("http://localhost:3000","/api/places/").concat(n));case 3:return r=t.sent,t.next=6,r.json();case 6:if(!(o=t.sent).error){t.next=10;break}return console.error("Error fetching place details:",o.error),t.abrupt("return");case 10:i=/<center><b><a href="http:\/\/www\.paraglidingearth\.com\/index\.php\?site=\d+">More information on ParaglidingEarth<\/a><\/b><\/center>\n?/g,a=/<br>\n<b>Take off : <\/b><br>\n?/g,c=/H \d+(-\d+)? m(?:, |<br>)/g,l=/HD \d+ m(?:<br>| \/)/g,s=/\nrating \d+\/\d+(?:\n|<br>)*/gi,u=(o.properties.description||"").replace(i,"").replace(a,"").replace(c,"").replace(l,"").replace(s,"").trim(),window.currentPlaceName=o.properties.name,window.currentPlaceId=o.properties.id,window.currentStrPlacemarkId=o.properties.strPlacemarkId,p='<span style="color: #0087F7;"><h5>'.concat(o.properties.name,'</h5></span>\n                            <table style="border-collapse: collapse; width: 40%;">\n                            <tr>\n                                <th style="text-align: left; vertical-align: top;">Type:</th>\n                                <td style="text-align: left; vertical-align: top;">').concat(o.properties.type,'</td>\n                            </tr>\n                            <tr>\n                                <th style="text-align: left; vertical-align: top;">Direction:</th>\n                                <td style="text-align: left; vertical-align: top;">').concat(o.properties.direction,'</td>\n                            </tr>\n                            <tr>\n                                <th style="text-align: left; vertical-align: top;">Rating:</th>\n                                <td style="text-align: left; vertical-align: top;">').concat(null!=o.properties.rating?o.properties.rating+"/6":" -",'</td>\n                            </tr>\n                            <tr>\n                                <th style="text-align: left; vertical-align: top;">Height:</th>\n                                <td style="text-align: left; vertical-align: top;">').concat(null!=o.properties.height?o.properties.height:" -",'</td>\n                            </tr>\n                            <tr>\n                                <th style="text-align: left; vertical-align: top;">Height difference:</th>\n                                <td style="text-align: left; vertical-align: top;">').concat(null!=o.properties.heightdifference?o.properties.heightdifference:" -",'</td>\n                            </tr>\n                            <tr>\n                                <th style="text-align: left; vertical-align: top;">Last Update:</th>\n                                <td style="text-align: left; vertical-align: top;">').concat(o.properties.lastupdate,"</td>\n                            </tr>\n                            </table><br>\n                            <b>Description:</b> ").concat(u,'<br>\n                            <b>© <a href="https://paraglidingspots.com" target="_blank">paraglidingspots.com</a></b>\n                            <div class="modal-footer d-flex justify-content-between">\n                            <div id="feedback-message" class="text-start"></div> \x3c!-- Message on the left --\x3e\n                            <div class="d-flex ms-auto">\n                                <button class="btn btn-primary me-2" onclick="showFeebackForm()">Feedback/Correction</button>\n                                <button class="btn btn-dark close-popup">Close</button>\n                            </div>\n                            </div>\n                            '),p+="<style>\n        /* Limit the height of the Swiper container */\n        .swiper-container {\n            max-height: 460px !important;\n            height: 460px !important;\n            overflow: hidden !important;\n        }\n\n        /* Ensure individual Swipers don't expand beyond this height */\n        .swiper, .swiper1, .swiper2 {\n            max-height: 460px !important;\n            height: 460px !important;\n            overflow: hidden !important;\n        }\n\n        /* Limit Swiper wrapper height */\n        .swiper-wrapper {\n            max-height: 460px !important;\n        }\n\n        /* Ensure Swiper slides don't stretch */\n        .swiper-slide {\n            max-height: 460px !important;\n            display: flex !important;\n            align-items: center !important; /* Keep images centered */\n            justify-content: center !important;\n        }\n\n        /* Prevent images from exceeding the swiper height */\n        .swiper-slide img {\n            max-height: 100% !important;\n            width: auto !important;\n        }\n        \n        /* Keep the overall popup size unchanged */\n        .leaflet-popup-content {\n            max-height: 780px !important; /* Keep original popup height */\n            overflow-y: auto; /* Allow scrolling inside the popup if needed */\n        }\n\n        .swiper-clear {\n            clear: both;\n            margin-bottom: 1px;\n        }\n        </style>",e.setPopupContent(p),setTimeout((function(){var t=document.querySelector(".swiper1 .swiper-slide img");t&&w(parseInt(t.id.replace(/\D/g,""),10)||1)}),300),setTimeout((function(){document.querySelector(".close-popup").addEventListener("click",(function(){map.closePopup()}))}),300),t.next=29;break;case 26:t.prev=26,t.t0=t.catch(0),console.error("Error fetching place details:",t.t0);case 29:case"end":return t.stop()}}),t,null,[[0,26]])})))).apply(this,arguments)}function _(){v&&(v.remove(),v=null),m&&(m.destroy(),m=null);var t=document.getElementById("feedback-message");t&&(t.textContent="",t.classList.remove("text-success","text-danger"));var e=document.querySelector(".modal-footer");e&&(e.style.display="none");var n='\n        <div id="feedbackFormHtml">\n            <div class="feedback-modal">\n                <span style="color: #0087F7;"><h5>Feedback for '.concat(window.currentPlaceName,'</h5></span>\n                <form id="feedbackForm">\n                    <div class="form-group">\n                        <label for="feedbackText">Feedback / Correction / Comment:</label>\n                        <textarea id="feedbackText" class="form-control" required style="height: 130px;"></textarea>\n                    </div>\n                    <div class="form-group">\n                        <label>Upload Images (optional):</label>\n                        <div id="dropzoneFeedback" class="dropzone mt-4 border-dashed rounded-2 min-h-0"></div>\n                    </div>\n                    <div class="form-group d-flex justify-content-between">\n                        <div style="width: 48%;">\n                            <label for="userName">Name:</label>\n                            <input type="text" id="userName" class="form-control" required>\n                        </div>\n                        <div style="width: 48%;">\n                            <label for="userEmail">E-Mail:</label>\n                            <input type="email" id="userEmail" class="form-control" required>\n                            <small class="text-danger d-none" id="emailError">Please enter a valid email address.</small>\n                        </div>\n                    </div>\n                    <button type="submit" class="btn btn-success">Submit</button>\n                    <button type="button" class="btn btn-secondary" onclick="cancelFeedback()">Cancel</button>\n                </form>\n            </div>\n        </div>\n    '),r=document.querySelector(".leaflet-popup-content");r?(r.insertAdjacentHTML("beforeend",n),v=document.getElementById("feedbackFormHtml"),setTimeout((function(){var t=document.querySelector(".leaflet-popup-content");t&&t.scrollTo({top:t.scrollHeight,behavior:"smooth"})}),50),m=new Dropzone("#dropzoneFeedback",{url:"/upload",autoProcessQueue:!1,maxFiles:5,maxFilesize:100,acceptedFiles:"image/*",addRemoveLinks:!1,dictDefaultMessage:"Drag & drop files here or click to upload",clickable:!0,init:function(){var t=this;this.on("addedfile",(function(e){var n=e.previewElement,r=document.createElement("img");r.src="/assets/images/imgdelete.png",r.alt="Delete",r.classList.add("delete-icon"),n.querySelector(".dz-image").appendChild(r),r.addEventListener("click",(function(n){n.preventDefault(),n.stopPropagation(),t.removeFile(e)}))})),this.on("removedfile",(function(t){console.log("File removed:",t.name)}))}}),document.getElementById("userEmail").addEventListener("input",(function(){var t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.value);document.getElementById("emailError").classList.toggle("d-none",t)})),document.getElementById("feedbackForm").addEventListener("submit",function(){var t=y(h().mark((function t(e){var n,r,o,i;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),(n=new FormData).append("name",window.currentPlaceName),n.append("id",window.currentPlaceId),n.append("strPlacemarkId",window.currentStrPlacemarkId),n.append("feedbackText",document.getElementById("feedbackText").value),n.append("userName",document.getElementById("userName").value),n.append("userEmail",document.getElementById("userEmail").value),m.files.forEach((function(t){n.append("images",t)})),t.prev=9,t.next=12,fetch("".concat("http://localhost:3000","/api/send-feedback"),{method:"POST",body:n});case 12:return r=t.sent,t.next=15,r.json();case 15:o=t.sent,v&&(v.remove(),v=null),m&&(m.destroy(),m=null),i=document.getElementById("feedback-message"),o.success?(i.textContent=o.message||"Feedback submitted successfully!",i.classList.remove("text-danger"),i.classList.add("text-success")):(i.textContent=o.error||"An error occurred.",i.classList.remove("text-success"),i.classList.add("text-danger")),document.querySelector(".modal-footer").style.display="flex",t.next=26;break;case 23:t.prev=23,t.t0=t.catch(9),console.error("Submission error:",t.t0);case 26:case"end":return t.stop()}}),t,null,[[9,23]])})));return function(e){return t.apply(this,arguments)}}())):console.error("Popup content not found!")}function k(){v&&(v.remove(),v=null),m&&(m.destroy(),m=null),document.querySelector(".modal-footer").style.display="flex"}function S(t){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S(t)}function T(){T=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),c=new I(r||[]);return o(a,"_invoke",{value:C(t,n,c)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var d="suspendedStart",h="suspendedYield",f="executing",y="completed",m={};function v(){}function g(){}function w(){}var b={};s(b,a,(function(){return this}));var L=Object.getPrototypeOf,x=L&&L(L(A([])));x&&x!==n&&r.call(x,a)&&(b=x);var E=w.prototype=v.prototype=Object.create(b);function _(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(o,i,a,c){var l=p(t[o],t,i);if("throw"!==l.type){var s=l.arg,u=s.value;return u&&"object"==S(u)&&r.call(u,"__await")?e.resolve(u.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(u).then((function(t){s.value=t,a(s)}),(function(t){return n("throw",t,a,c)}))}c(l.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function C(e,n,r){var o=d;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var c=r.delegate;if(c){var l=P(c,r);if(l){if(l===m)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=f;var s=p(e,n,r);if("normal"===s.type){if(o=r.done?y:h,s.arg===m)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(o=y,r.method="throw",r.arg=s.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function G(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function A(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(S(e)+" is not iterable")}return g.prototype=w,o(E,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=s(w,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,s(t,l,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},_(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new k(u(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(E),s(E,l,"Generator"),s(E,a,(function(){return this})),s(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=A,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(G),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return c.type="throw",c.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),s=r.call(a,"finallyLoc");if(l&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),G(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;G(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:A(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}function C(t,e,n,r,o,i,a){try{var c=t[i](a),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(r,o)}function P(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){C(i,r,o,a,c,"next",t)}function c(t){C(i,r,o,a,c,"throw",t)}a(void 0)}))}}function O(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,c=[],l=!0,s=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(c.push(r.value),c.length!==e);l=!0);}catch(t){s=!0,o=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return G(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?G(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function G(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function I(){if(!window.map||!window.placesLayerPG)return console.error("Map or placesLayerPG is not defined. Retrying in 500ms..."),void setTimeout(I,500);console.log("Initializing PG spots module..."),window.showFeebackForm=_,window.cancelFeedback=k;var t=L.markerClusterGroup({disableClusteringAtZoom:9,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,maxClusterRadius:250,iconCreateFunction:function(t){return L.divIcon({html:'<div class="cluster-marker">'.concat(t.getChildCount(),"</div>"),className:"pg-cluster-icon",iconSize:L.point(30,30)})}});window.placesLayerPG.addLayer(t);var e=null,n=null;function r(){window.map.hasLayer(window.placesLayerPG)?(n&&clearTimeout(n),n=setTimeout((function(){e&&e.abort();var n=(e=new AbortController).signal,r=window.map.getBounds(),o=r.getNorthWest().lat,i=r.getNorthWest().lng,a=r.getSouthEast().lat,c=r.getSouthEast().lng;fetch("".concat("http://localhost:3000","/api/places?nw_lat=").concat(o,"&nw_lng=").concat(i,"&se_lat=").concat(a,"&se_lng=").concat(c,"&type=TO&type=TOW&type=TH"),{signal:n}).then((function(t){return t.json()})).then((function(r){n.aborted||(t.clearLayers(),L.geoJSON(r,{pointToLayer:function(t,e){return L.marker(e,{icon:L.canvasIcon({iconSize:[50,50],iconAnchor:[15,15],drawIcon:function(e,n){if("icon"===n){var r=e.getContext("2d"),o=L.point(this.options.iconSize),i=L.point(o.x/2,o.y/2);r.clearRect(0,0,o.x,o.y);var a=b(t.properties.direction||"");r.beginPath(),a.forEach((function(t){var e=O(t,2),n=e[0],o=e[1];r.moveTo(i.x,i.y),r.arc(i.x,i.y,i.x,(n-90)*Math.PI/180,(o-90)*Math.PI/180,!1),r.lineTo(i.x,i.y)})),r.fillStyle="orange",r.fill(),r.closePath(),r.beginPath(),r.arc(i.x,i.y,i.x/4,0,2*Math.PI),r.fillStyle="green",r.fill(),r.closePath()}}})})},onEachFeature:function(e,n){if(e.properties){var r="<b>".concat(e.properties.name,"</b><br>\n                                                    Type: ").concat(e.properties.type,"<br>\n                                                    Direction: ").concat(e.properties.direction,"<br>\n                                                    <i>Loading details...</i>"),o=L.responsivePopup({hasTip:!0,autoPan:!1,offset:[15,25],maxWidth:900,maxHeight:780}).setContent(r);n.bindPopup(o),n.on("popupopen",P(T().mark((function t(){return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x(n,e.properties.id);case 2:case"end":return t.stop()}}),t)}))))}t.addLayer(n)}}),e=null)})).catch((function(t){"AbortError"!==t.name&&console.error("Error fetching PG places:",t)}))}),300)):console.log("PG layer not visible, skipping fetch")}window.fetchPlacesPG=r,window.map.hasLayer(window.placesLayerPG)&&r(),console.log("PG spots module initialized")}function A(t){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A(t)}function N(){N=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),c=new O(r||[]);return o(a,"_invoke",{value:S(t,n,c)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var d="suspendedStart",h="suspendedYield",f="executing",y="completed",m={};function v(){}function g(){}function w(){}var b={};s(b,a,(function(){return this}));var L=Object.getPrototypeOf,x=L&&L(L(G([])));x&&x!==n&&r.call(x,a)&&(b=x);var E=w.prototype=v.prototype=Object.create(b);function _(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(o,i,a,c){var l=p(t[o],t,i);if("throw"!==l.type){var s=l.arg,u=s.value;return u&&"object"==A(u)&&r.call(u,"__await")?e.resolve(u.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(u).then((function(t){s.value=t,a(s)}),(function(t){return n("throw",t,a,c)}))}c(l.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,n,r){var o=d;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var c=r.delegate;if(c){var l=T(c,r);if(l){if(l===m)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=f;var s=p(e,n,r);if("normal"===s.type){if(o=r.done?y:h,s.arg===m)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(o=y,r.method="throw",r.arg=s.arg)}}}function T(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,T(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function G(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(A(e)+" is not iterable")}return g.prototype=w,o(E,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=s(w,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,s(t,l,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},_(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new k(u(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(E),s(E,l,"Generator"),s(E,a,(function(){return this})),s(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=G,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return c.type="throw",c.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),s=r.call(a,"finallyLoc");if(l&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:G(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}function j(t,e,n,r,o,i,a){try{var c=t[i](a),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(r,o)}function F(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){j(i,r,o,a,c,"next",t)}function c(t){j(i,r,o,a,c,"throw",t)}a(void 0)}))}}function D(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,c=[],l=!0,s=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(c.push(r.value),c.length!==e);l=!0);}catch(t){s=!0,o=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return z(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function M(){if(!window.map||!window.placesLayerHG)return console.error("Map or placesLayerHG is not defined. Retrying in 500ms..."),void setTimeout(M,500);console.log("Initializing HG spots module..."),window.showFeebackForm=_,window.cancelFeedback=k;var t=L.markerClusterGroup({disableClusteringAtZoom:9,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,maxClusterRadius:250,iconCreateFunction:function(t){return L.divIcon({html:'<div class="cluster-marker">'.concat(t.getChildCount(),"</div>"),className:"hg-cluster-icon",iconSize:L.point(30,30)})}});window.placesLayerHG.addLayer(t);var e=null,n=null;function r(){n&&clearTimeout(n),n=setTimeout((function(){e&&e.abort();var n=(e=new AbortController).signal,r=window.map.getBounds(),o=r.getNorthWest().lat,i=r.getNorthWest().lng,a=r.getSouthEast().lat,c=r.getSouthEast().lng;fetch("".concat("http://localhost:3000","/api/places?nw_lat=").concat(o,"&nw_lng=").concat(i,"&se_lat=").concat(a,"&se_lng=").concat(c,"&type=TO-HG&type=TOW-HG"),{signal:n}).then((function(t){return t.json()})).then((function(r){n.aborted||(t.clearLayers(),L.geoJSON(r,{pointToLayer:function(t,e){return L.marker(e,{icon:L.canvasIcon({iconSize:[50,50],iconAnchor:[15,15],drawIcon:function(e,n){if("icon"===n){var r=e.getContext("2d"),o=L.point(this.options.iconSize),i=L.point(o.x/2,o.y/2);r.clearRect(0,0,o.x,o.y);var a=b(t.properties.direction||"");r.beginPath(),a.forEach((function(t){var e=D(t,2),n=e[0],o=e[1];r.moveTo(i.x,i.y),r.arc(i.x,i.y,i.x,(n-90)*Math.PI/180,(o-90)*Math.PI/180,!1),r.lineTo(i.x,i.y)})),r.fillStyle="orange",r.fill(),r.closePath(),r.beginPath(),r.arc(i.x,i.y,i.x/4,0,2*Math.PI),r.fillStyle="green",r.fill(),r.closePath()}}})})},onEachFeature:function(e,n){if(e.properties){var r="<b>".concat(e.properties.name,"</b><br>\n                                                    Type: ").concat(e.properties.type,"<br>\n                                                    Direction: ").concat(e.properties.direction,"<br>\n                                                    <i>Loading details...</i>"),o=L.responsivePopup({hasTip:!0,autoPan:!1,offset:[15,25],maxWidth:900,maxHeight:780}).setContent(r);n.bindPopup(o),n.on("popupopen",F(N().mark((function t(){return N().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x(n,e.properties.id);case 2:case"end":return t.stop()}}),t)}))))}t.addLayer(n)}}),e=null)})).catch((function(t){"AbortError"!==t.name&&console.error("Error fetching HG places:",t)}))}),300)}window.fetchPlacesHG=r,window.map.hasLayer(window.placesLayerHG)&&r(),console.log("PG spots module initialized")}function W(t){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W(t)}function H(){H=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),c=new O(r||[]);return o(a,"_invoke",{value:S(t,n,c)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var d="suspendedStart",h="suspendedYield",f="executing",y="completed",m={};function v(){}function g(){}function w(){}var b={};s(b,a,(function(){return this}));var L=Object.getPrototypeOf,x=L&&L(L(G([])));x&&x!==n&&r.call(x,a)&&(b=x);var E=w.prototype=v.prototype=Object.create(b);function _(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(o,i,a,c){var l=p(t[o],t,i);if("throw"!==l.type){var s=l.arg,u=s.value;return u&&"object"==W(u)&&r.call(u,"__await")?e.resolve(u.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(u).then((function(t){s.value=t,a(s)}),(function(t){return n("throw",t,a,c)}))}c(l.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,n,r){var o=d;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var c=r.delegate;if(c){var l=T(c,r);if(l){if(l===m)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=f;var s=p(e,n,r);if("normal"===s.type){if(o=r.done?y:h,s.arg===m)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(o=y,r.method="throw",r.arg=s.arg)}}}function T(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,T(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function G(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(W(e)+" is not iterable")}return g.prototype=w,o(E,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=s(w,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,s(t,l,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},_(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new k(u(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(E),s(E,l,"Generator"),s(E,a,(function(){return this})),s(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=G,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return c.type="throw",c.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),s=r.call(a,"finallyLoc");if(l&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:G(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}function B(t,e,n,r,o,i,a){try{var c=t[i](a),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(r,o)}function U(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){B(i,r,o,a,c,"next",t)}function c(t){B(i,r,o,a,c,"throw",t)}a(void 0)}))}}function Z(){if(window.map&&window.placesLayerLZ){console.log("Initializing LZ spots module...");var t=L.markerClusterGroup({disableClusteringAtZoom:9,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,maxClusterRadius:250,iconCreateFunction:function(t){return L.divIcon({html:'<div class="cluster-marker">'.concat(t.getChildCount(),"</div>"),className:"lz-cluster-icon",iconSize:L.point(30,30)})}});window.placesLayerLZ.addLayer(t);var e=null,n=null;window.fetchPlacesLZ=r,window.map.hasLayer(window.placesLayerLZ)&&r(),console.log("PG spots module initialized")}else setTimeout(Z,500);function r(){n&&clearTimeout(n),n=setTimeout((function(){e&&e.abort();var n=(e=new AbortController).signal,r=window.map.getBounds(),o=r.getNorthWest().lat,i=r.getNorthWest().lng,a=r.getSouthEast().lat,c=r.getSouthEast().lng;fetch("".concat("http://localhost:3000","/api/places?nw_lat=").concat(o,"&nw_lng=").concat(i,"&se_lat=").concat(a,"&se_lng=").concat(c,"&type=LZ"),{signal:n}).then((function(t){return t.json()})).then((function(r){n.aborted||(t.clearLayers(),L.geoJSON(r,{pointToLayer:function(t,e){return L.marker(e,{icon:L.icon({iconUrl:"../assets/images/windsock.png",iconSize:[20,20],iconAnchor:[20,20]})})},onEachFeature:function(e,n){if(e.properties){var r="<b>".concat(e.properties.name,"</b><br>\n                                                    Type: ").concat(e.properties.type,"<br>\n                                                    Direction: ").concat(e.properties.direction,"<br>\n                                                    <i>Loading details...</i>"),o=L.responsivePopup({hasTip:!0,autoPan:!1,offset:[15,25],maxWidth:900,maxHeight:780}).setContent(r);n.bindPopup(o),n.on("popupopen",U(H().mark((function t(){return H().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x(n,e.properties.id);case 2:case"end":return t.stop()}}),t)}))))}t.addLayer(n)}}),e=null)})).catch((function(t){"AbortError"!==t.name&&console.error("Error fetching LZ places:",t)}))}),300)}}document.addEventListener("map_initialized",(function(){console.log("Map initialized event received in PG spots module"),setTimeout(I,100)})),setTimeout((function(){window.mapInitialized&&(console.log("Backup initialization for PG spots module"),I())}),1e3),document.addEventListener("map_initialized",(function(){console.log("Map initialized event received in HG spots module"),setTimeout(M,100)})),setTimeout((function(){window.mapInitialized&&(console.log("Backup initialization for HG spots module"),M())}),1e3),document.addEventListener("map_initialized",(function(){console.log("Map initialized event received in LZ spots module"),setTimeout(Z,100)})),setTimeout((function(){window.mapInitialized&&(console.log("Backup initialization for LZ spots module"),Z())}),1e3),document.addEventListener("DOMContentLoaded",(function(){console.log("DOM content loaded, initializing map");var t=function(){window.map=L.map("map",{center:[50,6],zoom:11,zoomControl:!1,layers:[]}),L.control.zoom({position:"bottomright"}).addTo(window.map);var t=L.tileLayer("https://tile.jawg.io/jawg-terrain/{z}/{x}/{y}{r}.png?access-token=qBDXRu1KSlZGhx4ROlceBD9hcxmrumL34oj29tUkzDVkafqx08tFWPeRNb0KSoKa",{attribution:"Jawg.io terrain"}).addTo(window.map),n=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap"}),r=L.tileLayer("https://topo.xcontest.app/elev/{z}/{x}/{y}.jpg",{attribution:'XContest&copy; <a href="https://www.xcontest.org">XContest</a>',className:"xcontest-layer"}),o=L.mapboxGL({style:"/assets/maps/maptiler_terrain_wob_testxc.json",apiKey:"c49iG8J3xvAkgCSZ8M8v",className:"xcmap-layer",attribution:"MapTiler Terrain"}),i=L.tileLayer("http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}",{attribution:"Map data: Google",maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"]});window.windLayer=L.layerGroup().addTo(window.map),window.oaipMap=L.tileLayer("https://a.api.tiles.openaip.net/api/data/openaip/{z}/{x}/{y}.png?apiKey=".concat("171189a4d43c6578ce63758f28363cb3"),{attribution:'OpenAIP&copy; <a href="https://www.openaip.net">OpenAIP</a>',className:"oaip-layer"}),window.airspaceEFG=L.layerGroup([],{attribution:'OpenAIP&copy; <a href="https://www.openaip.net">OpenAIP</a>'}),window.placesLayerPG=L.layerGroup([],{attribution:'&copy; <a href="https://paraglidingspots.com">paraglidingspots.com</a>'}),window.placesLayerHG=L.layerGroup([],{attribution:'&copy; <a href="https://paraglidingspots.com">paraglidingspots.com</a>'}),window.placesLayerLZ=L.layerGroup([],{attribution:'&copy; <a href="https://paraglidingspots.com">paraglidingspots.com</a>'});var a={label:"Base Maps",children:[{label:"Terrain",layer:t},{label:"XContest",layer:L.layerGroup([r,o])},{label:"OpenStreetMap",layer:n},{label:"Satellite",layer:L.layerGroup([o,i])}]},c={label:"Overlays",children:[{label:"Wind Stations",layer:window.windLayer,checked:!0},{label:"Spots",children:[{label:"Take-off PG",layer:window.placesLayerPG},{label:"Take-off HG",layer:window.placesLayerHG},{label:"Landing Zones",layer:window.placesLayerLZ}]},{label:"Airspaces",children:[{label:"Airspaces",layer:window.airspaceEFG},{label:"Gliding",layer:window.airspaceEFG},{label:"Notam",layer:window.airspaceEFG},{label:"OpenAIP Map",layer:window.oaipMap}]}]};new e({position:"bottomright"}).addTo(window.map),L.control.locate({drawCircle:!1,keepCurrentZoomLevel:!0,position:"bottomright",icon:"locate",iconLoading:"loading",iconElementTag:"div"}).addTo(window.map),L.control.layers.tree(a,c,{namedToggle:!0,collapsed:!1}).addTo(window.map).collapseTree().expandSelected(),window.map.on("moveend",(function(){console.log("Map moveend event triggered"),window.map.hasLayer(window.windLayer)&&"function"==typeof window.fetchWindStations&&(console.log("Fetching wind stations after map move..."),window.fetchWindStations()),window.map.hasLayer(window.placesLayerPG)&&window.fetchPlacesPG&&(console.log("Fetching PG spots after map move..."),window.fetchPlacesPG()),window.map.hasLayer(window.placesLayerHG)&&window.fetchPlacesHG&&(console.log("Fetching HG spots after map move..."),window.fetchPlacesHG()),window.map.hasLayer(window.placesLayerLZ)&&window.fetchPlacesLZ&&(console.log("Fetching LZ spots after map move..."),window.fetchPlacesLZ()),window.map.hasLayer(window.airspaceEFG)&&"function"==typeof window.fetchAirspaces&&(console.log("Fetching airspaces after map move..."),window.fetchAirspaces())})),window.map.on("layeradd",(function(t){var e=t.layer;e===window.windLayer&&"function"==typeof window.fetchWindStations?window.fetchWindStations():e===window.placesLayerPG&&window.fetchPlacesPG?window.fetchPlacesPG():e===window.placesLayerHG&&window.fetchPlacesHG?window.fetchPlacesHG():e===window.placesLayerLZ&&window.fetchPlacesLZ?window.fetchPlacesLZ():e===window.airspaceEFG&&"function"==typeof window.fetchAirspaces&&window.fetchAirspaces()})),window.mapInitialized=!0,console.log("Map initialization complete");var l=new Event("map_initialized");return document.dispatchEvent(l),console.log("Map initialized event dispatched"),window.map}();navigator.geolocation.getCurrentPosition((function(e){console.log("Geolocation received");var n=e.coords.latitude,r=e.coords.longitude;t.setView([n,r],10);var o=new CustomEvent("user_location_ready",{detail:{lat:n,lng:r}});document.dispatchEvent(o),console.log("User location event dispatched")}))})),document.addEventListener("user_location_ready",(function(t){console.log("Handling user location ready event"),setTimeout((function(){if("function"==typeof window.fetchWindStations&&window.mapInitialized&&window.map.hasLayer(window.windLayer))try{console.log("Fetching wind stations"),window.fetchWindStations(t.detail.lat,t.detail.lng)}catch(t){console.error("Error fetching wind stations:",t)}if("function"==typeof window.fetchAirspaces&&window.mapInitialized&&window.map.hasLayer(window.airspaceEFG))try{console.log("Fetching airspaces"),window.fetchAirspaces()}catch(t){console.error("Error fetching airspaces:",t)}}),500)}))})();
//# sourceMappingURL=main.9aae1729286bb44ea4ba.js.map