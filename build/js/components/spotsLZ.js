import{getAngleRange,loadPlaceDetails,showFeebackForm,cancelFeedback}from"./spotsHelper.js";export function initSpotLZ(){if(!window.map||!window.placesLayerLZ)return void setTimeout(initSpotLZ,500);console.log("Initializing LZ spots module...");const e=L.markerClusterGroup({disableClusteringAtZoom:9,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,maxClusterRadius:250,iconCreateFunction:function(e){return L.divIcon({html:`<div class="cluster-marker">${e.getChildCount()}</div>`,className:"lz-cluster-icon",iconSize:L.point(30,30)})}});function o(){const o=window.map.getBounds(),t=o.getNorthWest().lat,i=o.getNorthWest().lng,n=o.getSouthEast().lat,a=o.getSouthEast().lng;fetch(`http://localhost:3000/api/places?nw_lat=${t}&nw_lng=${i}&se_lat=${n}&se_lng=${a}&type=LZ`).then((e=>e.json())).then((o=>{e.clearLayers(),L.geoJSON(o,{pointToLayer:function(e,o){return L.marker(o,{icon:L.icon({iconUrl:"../assets/images/windsock.png",iconSize:[20,20],iconAnchor:[20,20]})})},onEachFeature:function(o,t){if(o.properties){let e=`<b>${o.properties.name}</b><br>\n                                                Type: ${o.properties.type}<br>\n                                                Direction: ${o.properties.direction}<br>\n                                                <i>Loading details...</i>`,i=L.responsivePopup({hasTip:!0,autoPan:!1,offset:[15,25],maxWidth:900,maxHeight:780}).setContent(e);t.bindPopup(i),t.on("popupopen",(async function(){await loadPlaceDetails(t,o.properties.id)}))}e.addLayer(t)}})})).catch((e=>console.error("Error:",e)))}window.placesLayerLZ.addLayer(e),window.map.on("moveend",o),o()}document.addEventListener("map_initialized",(function(){console.log("Map initialized event received in LZ spots module"),setTimeout(initSpotLZ,100)})),setTimeout((()=>{window.mapInitialized&&(console.log("Backup initialization for LZ spots module"),initSpotLZ())}),1e3);