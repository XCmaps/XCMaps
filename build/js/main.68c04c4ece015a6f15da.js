(()=>{var e,t={5358:(e,t,i)=>{var o={"./af":5177,"./af.js":5177,"./ar":1509,"./ar-dz":1488,"./ar-dz.js":1488,"./ar-kw":8676,"./ar-kw.js":8676,"./ar-ly":2353,"./ar-ly.js":2353,"./ar-ma":4496,"./ar-ma.js":4496,"./ar-ps":6947,"./ar-ps.js":6947,"./ar-sa":2682,"./ar-sa.js":2682,"./ar-tn":9756,"./ar-tn.js":9756,"./ar.js":1509,"./az":5533,"./az.js":5533,"./be":8959,"./be.js":8959,"./bg":7777,"./bg.js":7777,"./bm":4903,"./bm.js":4903,"./bn":1290,"./bn-bd":7357,"./bn-bd.js":7357,"./bn.js":1290,"./bo":1545,"./bo.js":1545,"./br":1470,"./br.js":1470,"./bs":4429,"./bs.js":4429,"./ca":7306,"./ca.js":7306,"./cs":6464,"./cs.js":6464,"./cv":3635,"./cv.js":3635,"./cy":4226,"./cy.js":4226,"./da":3601,"./da.js":3601,"./de":7853,"./de-at":6111,"./de-at.js":6111,"./de-ch":4697,"./de-ch.js":4697,"./de.js":7853,"./dv":708,"./dv.js":708,"./el":4691,"./el.js":4691,"./en-au":3872,"./en-au.js":3872,"./en-ca":8298,"./en-ca.js":8298,"./en-gb":6195,"./en-gb.js":6195,"./en-ie":6584,"./en-ie.js":6584,"./en-il":5543,"./en-il.js":5543,"./en-in":9033,"./en-in.js":9033,"./en-nz":9402,"./en-nz.js":9402,"./en-sg":3004,"./en-sg.js":3004,"./eo":2934,"./eo.js":2934,"./es":7650,"./es-do":838,"./es-do.js":838,"./es-mx":7730,"./es-mx.js":7730,"./es-us":6575,"./es-us.js":6575,"./es.js":7650,"./et":3035,"./et.js":3035,"./eu":3508,"./eu.js":3508,"./fa":119,"./fa.js":119,"./fi":527,"./fi.js":527,"./fil":5995,"./fil.js":5995,"./fo":2477,"./fo.js":2477,"./fr":5498,"./fr-ca":6435,"./fr-ca.js":6435,"./fr-ch":7892,"./fr-ch.js":7892,"./fr.js":5498,"./fy":7071,"./fy.js":7071,"./ga":1734,"./ga.js":1734,"./gd":217,"./gd.js":217,"./gl":7329,"./gl.js":7329,"./gom-deva":2124,"./gom-deva.js":2124,"./gom-latn":3383,"./gom-latn.js":3383,"./gu":5050,"./gu.js":5050,"./he":1713,"./he.js":1713,"./hi":3861,"./hi.js":3861,"./hr":6308,"./hr.js":6308,"./hu":609,"./hu.js":609,"./hy-am":7160,"./hy-am.js":7160,"./id":4063,"./id.js":4063,"./is":9374,"./is.js":9374,"./it":8383,"./it-ch":1827,"./it-ch.js":1827,"./it.js":8383,"./ja":3827,"./ja.js":3827,"./jv":9722,"./jv.js":9722,"./ka":1794,"./ka.js":1794,"./kk":7088,"./kk.js":7088,"./km":6870,"./km.js":6870,"./kn":4451,"./kn.js":4451,"./ko":3164,"./ko.js":3164,"./ku":8174,"./ku-kmr":6181,"./ku-kmr.js":6181,"./ku.js":8174,"./ky":8474,"./ky.js":8474,"./lb":9680,"./lb.js":9680,"./lo":5867,"./lo.js":5867,"./lt":5766,"./lt.js":5766,"./lv":9532,"./lv.js":9532,"./me":8076,"./me.js":8076,"./mi":1848,"./mi.js":1848,"./mk":306,"./mk.js":306,"./ml":3739,"./ml.js":3739,"./mn":9053,"./mn.js":9053,"./mr":6169,"./mr.js":6169,"./ms":3386,"./ms-my":2297,"./ms-my.js":2297,"./ms.js":3386,"./mt":7075,"./mt.js":7075,"./my":2264,"./my.js":2264,"./nb":2274,"./nb.js":2274,"./ne":8235,"./ne.js":8235,"./nl":2572,"./nl-be":3784,"./nl-be.js":3784,"./nl.js":2572,"./nn":4566,"./nn.js":4566,"./oc-lnc":9330,"./oc-lnc.js":9330,"./pa-in":9849,"./pa-in.js":9849,"./pl":4418,"./pl.js":4418,"./pt":9834,"./pt-br":8303,"./pt-br.js":8303,"./pt.js":9834,"./ro":4457,"./ro.js":4457,"./ru":2271,"./ru.js":2271,"./sd":1221,"./sd.js":1221,"./se":3478,"./se.js":3478,"./si":7538,"./si.js":7538,"./sk":5784,"./sk.js":5784,"./sl":6637,"./sl.js":6637,"./sq":6794,"./sq.js":6794,"./sr":5719,"./sr-cyrl":3322,"./sr-cyrl.js":3322,"./sr.js":5719,"./ss":6e3,"./ss.js":6e3,"./sv":1011,"./sv.js":1011,"./sw":748,"./sw.js":748,"./ta":1025,"./ta.js":1025,"./te":1885,"./te.js":1885,"./tet":8861,"./tet.js":8861,"./tg":6571,"./tg.js":6571,"./th":5802,"./th.js":5802,"./tk":9527,"./tk.js":9527,"./tl-ph":9231,"./tl-ph.js":9231,"./tlh":1052,"./tlh.js":1052,"./tr":5096,"./tr.js":5096,"./tzl":9846,"./tzl.js":9846,"./tzm":1765,"./tzm-latn":7711,"./tzm-latn.js":7711,"./tzm.js":1765,"./ug-cn":8414,"./ug-cn.js":8414,"./uk":6618,"./uk.js":6618,"./ur":158,"./ur.js":158,"./uz":7609,"./uz-latn":2475,"./uz-latn.js":2475,"./uz.js":7609,"./vi":1135,"./vi.js":1135,"./x-pseudo":4051,"./x-pseudo.js":4051,"./yo":2218,"./yo.js":2218,"./zh-cn":2648,"./zh-cn.js":2648,"./zh-hk":1632,"./zh-hk.js":1632,"./zh-mo":1541,"./zh-mo.js":1541,"./zh-tw":304,"./zh-tw.js":304};function n(e){var t=a(e);return i(t)}function a(e){if(!i.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}n.keys=function(){return Object.keys(o)},n.resolve=a,e.exports=n,n.id=5358},9896:(e,t,i)=>{"use strict";console.log("L.Control.Layers.Tree has been loaded!"),function(e){if(void 0===e)throw new Error("Leaflet must be included first");e.Control.Layers.Tree=e.Control.Layers.extend({options:{closedSymbol:"+",openedSymbol:"&minus;",spaceSymbol:" ",selectorBack:!1,namedToggle:!1,collapseAll:"",expandAll:"",labelIsSelector:"both"},_initClassesNames:function(){this.cls={children:"leaflet-layerstree-children",childrenNopad:"leaflet-layerstree-children-nopad",hide:"leaflet-layerstree-hide",closed:"leaflet-layerstree-closed",opened:"leaflet-layerstree-opened",space:"leaflet-layerstree-header-space",pointer:"leaflet-layerstree-header-pointer",header:"leaflet-layerstree-header",neverShow:"leaflet-layerstree-nevershow",node:"leaflet-layerstree-node",name:"leaflet-layerstree-header-name",label:"leaflet-layerstree-header-label",selAllCheckbox:"leaflet-layerstree-sel-all-checkbox"}},initialize:function(t,i,o){this._scrollTop=0,this._initClassesNames(),this._baseTree=null,this._overlaysTree=null,e.Util.setOptions(this,o),e.Control.Layers.prototype.initialize.call(this,null,null,o),this._setTrees(t,i)},setBaseTree:function(e){return this._setTrees(e)},setOverlayTree:function(e){return this._setTrees(void 0,e)},addBaseLayer:function(e,t){throw"addBaseLayer is disabled"},addOverlay:function(e,t){throw"addOverlay is disabled"},removeLayer:function(e){throw"removeLayer is disabled"},collapse:function(){return this._scrollTop=this._sect().scrollTop,e.Control.Layers.prototype.collapse.call(this)},expand:function(){e.Control.Layers.prototype.expand.call(this),this._sect().scrollTop=this._scrollTop},onAdd:function(t){function i(e){e._layersTreeName&&(n.innerHTML=e._layersTreeName)}var o=e.Control.Layers.prototype.onAdd.call(this,t);if(this.options.namedToggle){var n=this._container.getElementsByClassName("leaflet-control-layers-toggle")[0];e.DomUtil.addClass(n,"leaflet-layerstree-named-toggle"),t.eachLayer((function(e){i(e)})),t.on("baselayerchange",(function(e){i(e.layer)}),this)}return o},expandTree:function(e){var t=e?this._overlaysList:this._baseLayersList;return t&&this._applyOnTree(t,!1),this._localExpand()},collapseTree:function(e){var t=e?this._overlaysList:this._baseLayersList;return t&&this._applyOnTree(t,!0),this._localExpand()},expandSelected:function(t){function i(t){var n=t.parentElement;if(n){if(e.DomUtil.hasClass(n,o.cls.children)&&!e.DomUtil.hasClass(t,o.cls.childrenNopad)&&e.DomUtil.removeClass(n,a),e.DomUtil.hasClass(n,o.cls.node)){var r=n.getElementsByClassName(o.cls.header)[0];o._applyOnTree(r,!1)}i(n)}}var o=this,n=t?this._overlaysList:this._baseLayersList;if(!n)return this;for(var a=this.cls.hide,r=this._layerControlInputs||n.getElementsByTagName("input"),s=0;s<r.length;s++){var l=r[s];this._getLayer&&!!this._getLayer(l.layerId).overlay!=!!t||l.checked&&i(l.parentElement.parentElement.parentElement.parentElement)}return this._localExpand()},_sect:function(){return this._section||this._form},_setTrees:function(e,t){var i=0;function o(e,t,n){return e&&e.layer&&(n||(e.layer._layersTreeName=e.name||e.label),t[i++]=e.layer),e&&e.children&&e.children.length&&e.children.forEach((function(e){o(e,t,n)})),t}function n(e){return Array.isArray(e)?{noShow:!0,children:e}:e}this._layerControlInputs&&(this._layerControlInputs=[]);for(var a=0;a<this._layers.length;++a)this._layers[a].layer.off("add remove",this._onLayerChange,this);this._layers=[],void 0!==e&&(this._baseTree=n(e)),void 0!==t&&(this._overlaysTree=n(t));var r=o(this._baseTree,{});for(var s in r)this._addLayer(r[s],s);var l=o(this._overlaysTree,{},!0);for(var c in l)this._addLayer(l[c],c,!0);return this._map?this._update():this},_localExpand:function(){if(this._map&&e.DomUtil.hasClass(this._container,"leaflet-control-layers-expanded")){var t=this._sect().scrollTop;this.expand(),this._sect().scrollTop=t,this._scrollTop=t}return this},_applyOnTree:function(t,i){[{cls:this.cls.children,hide:i},{cls:this.cls.opened,hide:i},{cls:this.cls.closed,hide:!i}].forEach((function(i){for(var o=t.getElementsByClassName(i.cls),n=0;n<o.length;n++){var a=o[n];e.DomUtil.hasClass(a,this.cls.childrenNopad)||(i.hide?e.DomUtil.addClass(a,this.cls.hide):e.DomUtil.removeClass(a,this.cls.hide))}}),this)},_addItem:function(e){},_update:function(){return this._container?(e.Control.Layers.prototype._update.call(this),this._addTreeLayout(this._baseTree,!1),this._addTreeLayout(this._overlaysTree,!0),this._localExpand()):this},_addTreeLayout:function(e,t){if(e){var i=t?this._overlaysList:this._baseLayersList;this._expandCollapseAll(t,this.options.collapseAll,this.collapseTree),this._expandCollapseAll(t,this.options.expandAll,this.expandTree),this._iterateTreeLayout(e,i,t,[],e.noShow),this._checkDisabledLayers&&this._checkDisabledLayers()}},_expandCollapseAll:function(t,i,o,n){var a=t?this._overlaysList:this._baseLayersList;if(n=n||this,i){var r=document.createElement("div");r.className="leaflet-layerstree-expand-collapse",a.appendChild(r),r.innerHTML=i,r.tabIndex=0,e.DomEvent.on(r,"click keydown",(function(e){"keydown"===e.type&&32!==e.keyCode||(r.blur(),o.call(n,t),this._localExpand())}),this)}},_iterateTreeLayout:function(t,i,o,n,a){if(t)if(t.html){C("div","leaflet-layerstree-html-container",i).innerHTML=t.html}else{var r,s=C("div",this.cls.header,i),l=C("span"),c=C("span"),d=C("span",this.cls.closed,l,this.options.closedSymbol),p=C("span",this.cls.opened,l,this.options.openedSymbol),m=C("span",this.cls.space,null,this.options.spaceSymbol);this.options.selectorBack?(l.insertBefore(m,d),s.appendChild(c),s.appendChild(l)):(l.appendChild(m),s.appendChild(l),s.appendChild(c)),t.selectAllCheckbox&&((r=this._createCheckboxElement(!1)).className+=" "+this.cls.selAllCheckbox);var h=this.cls.hide;if(t.children){var u=C("div",this.cls.children,i),y=t.layer?l:s;e.DomUtil.addClass(y,this.cls.pointer),y.tabIndex=0,e.DomEvent.on(y,"click keydown",(function(t){this._preventClick||"keydown"===t.type&&32!==t.keyCode||(y.blur(),e.DomUtil.hasClass(p,h)?(e.DomUtil.addClass(d,h),e.DomUtil.removeClass(p,h),e.DomUtil.removeClass(u,h)):(e.DomUtil.removeClass(d,h),e.DomUtil.addClass(p,h),e.DomUtil.addClass(u,h)),this._localExpand())}),this),r&&n.splice(0,0,i),t.children.forEach((function(e){var t=C("div",this.cls.node,u);this._iterateTreeLayout(e,t,o,n)}),this),r&&n.splice(0,1)}else e.DomUtil.addClass(l,this.cls.neverShow);var f,w=C(t.layer&&("both"===this.options.labelIsSelector||o&&"overlay"===this.options.labelIsSelector||!o&&"base"===this.options.labelIsSelector)?"label":"span",this.cls.label,c);if(t.layer){var g,v=this._map.hasLayer(t.layer),b=o?t.radioGroup:"leaflet-base-layers_"+e.Util.stamp(this);b?g=this._createRadioElement(b,v):A(g=this._createCheckboxElement(v),this),this._layerControlInputs&&this._layerControlInputs.push(g),g.layerId=e.Util.stamp(t.layer),e.DomEvent.on(g,"click",this._onInputClick,this),w.appendChild(g)}t.selectAllCheckbox&&(w.appendChild(r),("string"==typeof(f=t.selectAllCheckbox)||f instanceof String)&&(r.title=t.selectAllCheckbox),e.DomEvent.on(r,"click",(function(e){e.stopPropagation(),S(r.checked,this)}),this),k(i),A(r,this)),C("span",this.cls.name,w,t.label),e.DomUtil.addClass(t.collapsed?p:d,h),t.collapsed&&u&&e.DomUtil.addClass(u,h),a&&(e.DomUtil.addClass(s,this.cls.neverShow),e.DomUtil.addClass(u,this.cls.childrenNopad));var L=t.eventedClasses;L instanceof Array||(L=[L]);for(var _=0;_<L.length;_++){var x=L[_];if(x&&x.className){var T=i.querySelector("."+x.className);T&&e.DomEvent.on(T,x.event||"click",function(e){return function(o){o.stopPropagation();var n,a=(n=e)&&"[object Function]"==={}.toString.call(n)?e(o,i,t,this._map):e;null!=a&&S(a,this)}}(x.selectAll),this)}}}function C(t,i,o,n){var a=e.DomUtil.create(t,i,o);return n&&(a.innerHTML=n),a}function k(e){var t=e.querySelector("input[type=checkbox]"),i=!0,o=!0,n=e.querySelectorAll("input[type=checkbox]");[].forEach.call(n,(function(e){e===t||(e.indeterminate?(i=!1,o=!1):e.checked?o=!1:e.checked||(i=!1))})),i?(t.indeterminate=!1,t.checked=!0):o?(t.indeterminate=!1,t.checked=!1):(t.indeterminate=!0,t.checked=!1)}function A(t,i){n.forEach((function(o){e.DomEvent.on(t,"click",(function(e){k(o)}),i)}),i)}function S(e,t){for(var o=i.getElementsByTagName("input"),n=0;n<o.length;n++){var a=o[n];"checkbox"===a.type&&(a.checked=e,a.indeterminate=!1)}t._onInputClick()}},_createCheckboxElement:function(e){var t=document.createElement("input");return t.type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=e,t}}),e.control.layers.tree=function(t,i,o){return new e.Control.Layers.Tree(t,i,o)}}(L),console.log("L.Control.Layers.Tree has been loaded!"),L.ResponsivePopup=L.Popup.extend({options:{hasTip:!0},_initLayout:function(){var e="leaflet-popup",t=this._container=L.DomUtil.create("div",e+" "+(this.options.className||"")+" leaflet-zoom-animated"),i=this._wrapper=L.DomUtil.create("div",e+"-content-wrapper",t);if(this._contentNode=L.DomUtil.create("div",e+"-content",i),L.DomEvent.disableClickPropagation(t),L.DomEvent.disableScrollPropagation(this._contentNode),L.DomEvent.on(t,"contextmenu",L.DomEvent.stopPropagation),this._tipContainer=L.DomUtil.create("div",e+"-tip-container",t),this.options.hasTip||(this._tipContainer.style.visibility="hidden"),this._tip=L.DomUtil.create("div",e+"-tip",this._tipContainer),this.options.closeButton){var o=this._closeButton=L.DomUtil.create("a",e+"-close-button",t);o.setAttribute("role","button"),o.setAttribute("aria-label","Close popup"),o.href="#close",o.innerHTML='<span aria-hidden="true">&#215;</span>',L.DomEvent.on(o,"click",(function(e){L.DomEvent.preventDefault(e),this.close()}),this)}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),t=this._map.layerPointToContainerPoint(e),i=this._container.offsetWidth,o=this._container.offsetHeight,n=L.point(this.options.autoPanPadding),a=L.point(this.options.autoPanPaddingTopLeft||n),r=L.point(this.options.autoPanPaddingBottomRight||n),s=this._map.getSize(),l=this._getAnchor(),c=L.point(this.options.offset),d=12,p=Math.abs(c.x),m=Math.abs(c.y);this.options.hasTip&&(p+=11,m+=11,L.DomUtil.removeClass(this._container,"leaflet-resp-popup-north"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-south"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-east"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-west"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-north-east"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-north-west"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-south-east"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-south-west"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-east-north"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-east-south"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-west-north"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-west-south"));var h=!0,u=!0,y=!0,f=!0,w=!1;t.y+l.y-m-o-Math.abs(a.y)<0&&(h=!1),t.y+l.y+m+o+Math.abs(r.y)>s.y&&(u=!1),t.x+l.x-p-i-Math.abs(a.x)<0&&(y=!1),t.x+l.x+p+i+Math.abs(r.x)>s.x&&(f=!1);var g=i/2-l.x,v=o/2-l.y;if(h||u){var b=t.x+l.x-i/2,_=t.x+l.x+i/2;b<Math.abs(a.x)&&(g=i/2-l.x-Math.abs(a.x)+b),_>s.x-Math.abs(r.x)&&(g=i/2-l.x+_-s.x+Math.abs(r.x))}if(y||f){var x=t.y+l.y-o/2,T=t.y+l.y+o/2;x<Math.abs(a.y)&&(v=o/2-l.y-Math.abs(a.y)+x),T>s.y-Math.abs(r.y)&&(v=o/2-l.y+T-s.y+Math.abs(r.y))}if(h)w=e.subtract(L.point(g,-l.y+o+m,!0)),this.options.hasTip&&(t.x+l.x<a.x+d+11?(w.x=e.x+l.x,L.DomUtil.addClass(this._container,"leaflet-resp-popup-north-east"),this._tipContainer.style.top=o+"px",this._tipContainer.style.left="0px"):t.x+l.x>s.x-r.x-d-11?(w.x=e.x+l.x-i,L.DomUtil.addClass(this._container,"leaflet-resp-popup-north-west"),this._tipContainer.style.top=o+"px",this._tipContainer.style.left=i+"px"):(L.DomUtil.addClass(this._container,"leaflet-resp-popup-north"),this._tipContainer.style.top=o+"px",this._tipContainer.style.left=e.x+l.x-w.x+"px"));else if(y)w=e.subtract(L.point(-l.x+i+p,v,!0)),this.options.hasTip&&(t.y+l.y<a.y+d+11?(w.y=e.y+l.y,L.DomUtil.addClass(this._container,"leaflet-resp-popup-west-south"),this._tipContainer.style.top="0px",this._tipContainer.style.left=i+"px"):t.y+l.y>s.y-r.y-d-11?(w.y=e.y+l.y-o,L.DomUtil.addClass(this._container,"leaflet-resp-popup-west-north"),this._tipContainer.style.top=o+"px",this._tipContainer.style.left=i+"px"):(L.DomUtil.addClass(this._container,"leaflet-resp-popup-west"),this._tipContainer.style.top=e.y+l.y-w.y+"px",this._tipContainer.style.left=i+"px"));else if(u)w=e.subtract(L.point(g,-l.y-m,!0)),this.options.hasTip&&(t.x+l.x<a.x+d+11?(w.x=e.x+l.x,L.DomUtil.addClass(this._container,"leaflet-resp-popup-south-east"),this._tipContainer.style.top="0px",this._tipContainer.style.left="0px"):t.x+l.x>s.x-r.x-d-11?(w.x=e.x+l.x-i,L.DomUtil.addClass(this._container,"leaflet-resp-popup-south-west"),this._tipContainer.style.top="0px",this._tipContainer.style.left=i+"px"):(L.DomUtil.addClass(this._container,"leaflet-resp-popup-south"),this._tipContainer.style.top="0px",this._tipContainer.style.left=e.x+l.x-w.x+"px"));else if(f)w=e.subtract(L.point(-l.x-p,v,!0)),this.options.hasTip&&(t.y+l.y<a.y+d+11?(w.y=e.y+l.y,L.DomUtil.addClass(this._container,"leaflet-resp-popup-east-south"),this._tipContainer.style.top="0px",this._tipContainer.style.left="0px"):t.y+l.y>s.y-r.y-d-11?(w.y=e.y+l.y-o,L.DomUtil.addClass(this._container,"leaflet-resp-popup-east-north"),this._tipContainer.style.top=o+"px",this._tipContainer.style.left="0px"):(L.DomUtil.addClass(this._container,"leaflet-resp-popup-east"),this._tipContainer.style.top=e.y+l.y-w.y+"px",this._tipContainer.style.left="0px"));else{w=(e=this._map.latLngToLayerPoint(this._map.getCenter())).subtract(L.point(i/2,o/2)),this.options.hasTip}t.x<0||t.y<0||t.x>s.x||(t.y,s.y),i-Math.abs(a.x)-Math.abs(r.x)>s.x||(Math.abs(a.y),Math.abs(r.y),s.y),L.DomUtil.setPosition(this._container,w)}}}),L.responsivePopup=function(e,t){return new L.ResponsivePopup(e,t)},"object"==typeof exports&&"undefined"!=typeof module&&(exports.responsivePopup=L.responsivePopup,exports.ResponsivePopup=L.ResponsivePopup);const o=L.Control.extend({onAdd:function(e){var t=L.DomUtil.create("div","info-control leaflet-bar leaflet-control"),i=L.DomUtil.create("a","leaflet-control-button",t);i.href="#";var o=L.DomUtil.create("img","info-control-icon",i);return o.src="assets/images/info.png",o.alt="Information",o.style.width="24px",o.style.height="24px",o.style.padding="4px",L.DomEvent.disableClickPropagation(t),L.DomEvent.on(i,"click",(function(t){L.DomEvent.stop(t);L.popup({className:"info-popup",autoPan:!0,maxWidth:700,offset:[0,300]}).setLatLng(e.getCenter()).setContent('<div class="info-popup-content" style="padding: 10px;"><h3>About XCmaps</h3><p>XCmaps combines various data sources for aerial sports navigation.</p><p>You can contact us by <a href="mailto:info@XCmaps.com" target="_blank">email</a>, or report any issue on github.</p><p><strong>Credits:</strong></p><ul><li>Terrain tiles by <a href="https://www.jawg.io" target="_blank"></a></li><li>OpenStreetMap</li><li>XContest terrain data</li><li>MapTiler for GL layer</li><li>Airspaces: Airspaces are imported from openaip:"OpenAIP data is not certified and must not be used for primary navigation or flight planning. Never rely on openAIP data! OpenAIP data contains errors. Using openAIP data may result in serious injury or death."</li><li>Wind Stations: based on <a href="https://github.com/winds-mobi/" target="_blank">winds.mobi</a> by Yann Savary and additional data sources</li><li>Spots: © <a href="https://paraglidingspots.com" target="_blank">paraglidingspots.com</a> by Karsten Ehlers</li><li>and many more open source libraries, projects, and artwork</li></ul><p>This map combines various data sources for aerial sports navigation.</p><p><a href="https://buymeacoffee.com/XCmaps" target="_blank" class="donation-button"> 🍺 Buy us a Landing Beer</a></p></div>').openOn(e)})),t}});var n=i(5093);i(4837);let a=null;function r(){if(!window.map)return void console.error("Map not initialized yet");const e=window.map.getCenter(),t=`http://localhost:3000/api/airspaces?lat=${e.lat.toFixed(6)}&lng=${e.lng.toFixed(6)}&dist=200000&types=${encodeURIComponent([21].join(","))}`;fetch(t).then((e=>e.json())).then((e=>{window.airspaceGliding.clearLayers();const t=[];e.items.forEach((e=>{if((0!==e.type||4!==e.icaoClass)&&e.geometry&&"Polygon"===e.geometry.type){const i=e.geometry.coordinates[0].map((e=>[e[1],e[0]])),o=0===e.lowerLimit.value?"red":"green",n=(s[e.type],l[e.icaoClass],L.polygon(i,{color:o,weight:2,fillOpacity:.3}));t.push({polygon:n,data:e}),window.airspaceGliding.addLayer(n)}})),console.log(`Added ${t.length} airspaces to the map`),a&&window.map.off("click",a),a=function(e){if(!window.map.hasLayer(window.airspaceGliding))return;const i=e.latlng,o=[];if(t.forEach((e=>{let{polygon:t,data:n}=e;t.getBounds().contains(i)&&o.push(n)})),o.length>0){const e=o.map((e=>`\n            <b>${e.name}</b><br>\n            Type: ${s[e.type]||"Unknown"}<br>\n            ICAO Class: ${l[e.icaoClass]||"Unknown"}<br>\n            ↧${e.lowerLimit.value} ${c(e.lowerLimit.unit)}  ↥${e.upperLimit.value} ${c(e.upperLimit.unit)}<br>\n          `)).join("<hr>");L.popup().setLatLng(i).setContent(e).openOn(window.map)}},window.map.on("click",a)})).catch((e=>console.error("Error fetching airspaces:",e)))}const s={0:"Other",1:"Restricted",2:"Danger (D)",3:"Prohibited (Parc reserve)",4:"Controlled Tower Region (CTR)",5:"Transponder Mandatory Zone (TMZ)",6:"Radio Mandatory Zone (RMZ)",7:"Terminal Maneuvering Area (TMA)",8:"Temporary Reserved Area (TRA)",9:"Temporary Segregated Area (TSA)",10:"Flight Information Region (FIR)",11:"Upper Flight Information Region (UIR)",12:"Air Defense Identification Zone (ADIZ)",13:"Airport Traffic Zone (ATZ)",14:"Military Airport Traffic Zone (MATZ)",15:"Airway",16:"Military Training Route (MTR)",17:"Alert Area",18:"Warning Area",19:"Protected Area",20:"Helicopter Traffic Zone (HTZ)",21:"Gliding Sector",22:"Transponder Setting (TRP)",23:"Traffic Information Zone (TIZ)",24:"Traffic Information Area (TIA)",25:"Military Training Area (MTA)",26:"Control Area (CTA)",27:"ACC Sector (ACC)",28:"Aerial Sporting Or Recreational Activity",29:"Low Altitude Overflight Restriction",30:"Military Route (MRT)",31:"TSA/TRA Feeding Route (TFR)",32:"VFR Sector",33:"FIS Sector",34:"Lower Traffic Area (LTA)",35:"Upper Traffic Area (UTA)"},l={0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",8:"Special Use Airspace (SUA)"};function c(e){return{1:"ft",6:"FL"}[e]||"Unknown"}window.fetchAirspacesGliding=r,document.addEventListener("map_initialized",(function(){console.log("Setting up airspace layer events"),window.map.on("overlayadd",(function(e){"Airspaces"!==e.name&&"Gliding"!==e.name&&"Notam"!==e.name||(console.log(`Overlay added: ${e.name}, fetching airspaces`),r())})),window.map.on("moveend",(function(){window.map.hasLayer(window.airspaceGliding)&&(console.log("Map moved, refreshing airspaces"),r())}))}));let d=null;function p(){if(!window.map)return void console.error("Map not initialized yet");const e=window.map.getCenter(),t=`http://localhost:3000/api/airspaces?lat=${e.lat.toFixed(6)}&lng=${e.lng.toFixed(6)}&dist=200000&types=${encodeURIComponent([8,9].join(","))}`;fetch(t).then((e=>e.json())).then((e=>{window.airspaceNotam.clearLayers();const t=[];e.items.forEach((e=>{if((0!==e.type||4!==e.icaoClass)&&e.geometry&&"Polygon"===e.geometry.type){const i=e.geometry.coordinates[0].map((e=>[e[1],e[0]])),o=0===e.lowerLimit.value?"red":"blue",n=(m[e.type],h[e.icaoClass],L.polygon(i,{color:o,weight:2,fillOpacity:.3}));t.push({polygon:n,data:e}),window.airspaceNotam.addLayer(n)}})),console.log(`Added ${t.length} airspaces to the map`),d&&window.map.off("click",d),d=function(e){if(!window.map.hasLayer(window.airspaceNotam))return;const i=e.latlng,o=[];if(t.forEach((e=>{let{polygon:t,data:n}=e;t.getBounds().contains(i)&&o.push(n)})),o.length>0){const e=o.map((e=>`\n            <b>${e.name}</b><br>\n            Type: ${m[e.type]||"Unknown"}<br>\n            ICAO Class: ${h[e.icaoClass]||"Unknown"}<br>\n            ↧${e.lowerLimit.value} ${u(e.lowerLimit.unit)}  ↥${e.upperLimit.value} ${u(e.upperLimit.unit)}<br>\n          `)).join("<hr>");L.popup().setLatLng(i).setContent(e).openOn(window.map)}},window.map.on("click",d)})).catch((e=>console.error("Error fetching airspaces:",e)))}const m={0:"Other",1:"Restricted",2:"Danger (D)",3:"Prohibited (Parc reserve)",4:"Controlled Tower Region (CTR)",5:"Transponder Mandatory Zone (TMZ)",6:"Radio Mandatory Zone (RMZ)",7:"Terminal Maneuvering Area (TMA)",8:"Temporary Reserved Area (TRA)",9:"Temporary Segregated Area (TSA)",10:"Flight Information Region (FIR)",11:"Upper Flight Information Region (UIR)",12:"Air Defense Identification Zone (ADIZ)",13:"Airport Traffic Zone (ATZ)",14:"Military Airport Traffic Zone (MATZ)",15:"Airway",16:"Military Training Route (MTR)",17:"Alert Area",18:"Warning Area",19:"Protected Area",20:"Helicopter Traffic Zone (HTZ)",21:"Gliding Sector",22:"Transponder Setting (TRP)",23:"Traffic Information Zone (TIZ)",24:"Traffic Information Area (TIA)",25:"Military Training Area (MTA)",26:"Control Area (CTA)",27:"ACC Sector (ACC)",28:"Aerial Sporting Or Recreational Activity",29:"Low Altitude Overflight Restriction",30:"Military Route (MRT)",31:"TSA/TRA Feeding Route (TFR)",32:"VFR Sector",33:"FIS Sector",34:"Lower Traffic Area (LTA)",35:"Upper Traffic Area (UTA)"},h={0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",8:"Special Use Airspace (SUA)"};function u(e){return{1:"ft",6:"FL"}[e]||"Unknown"}window.fetchAirspacesNotam=p,document.addEventListener("map_initialized",(function(){console.log("Setting up airspace layer events"),window.map.on("overlayadd",(function(e){"Airspaces"!==e.name&&"Gliding"!==e.name&&"Notam"!==e.name||(console.log(`Overlay added: ${e.name}, fetching airspaces`),p())})),window.map.on("moveend",(function(){window.map.hasLayer(window.airspaceNotam)&&(console.log("Map moved, refreshing airspaces"),p())}))}));var y=i(278),f=i(3807);let w,g=null,v=3e3,b=function(){const e=new Date;return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`}(),_=[];function x(e){const t=n.tz.guess();let i="";if(e.descriptions&&Array.isArray(e.descriptions)&&e.descriptions.length>0){const t=e=>e?e.replace(/([ABCDEFGQ]\))/g,"<br>$1"):"";i=`\n      <div class="airspace-descriptions" style="font-size: 0.8em;">\n          ${e.descriptions.map((e=>`${t(e.airdescription||"")} ${e.airlanguage?`(${e.airlanguage})`:""}`)).join("")}\n      </div>\n    `}let o="";e.activations&&Array.isArray(e.activations)&&e.activations.length>0&&(o=`\n      <div class="airspace-activations">\n        <b>Activations:</b><br>\n        ${e.activations.map((e=>{const i=n.utc(e[0]).tz(t),o=n.utc(e[1]).tz(t);return`${i.format("MMM D, HH:mm z")} - ${o.format("MMM D, HH:mm z")}`})).join("<br>")}\n      </div>\n    `);const a=(e,t)=>{if(!e)return t||"N/A";const i=e.type,o=e.height;if("FL"===i){return`${Math.round(.3048*o)}m (FL${o/100})`}if("AMSL"===i||"AGL"===i){return`${Math.round(.3048*o)}m`}return t||"N/A"},r=a(e.airlower_j,e.lowerLimit),s=a(e.airupper_j,e.upperLimit);n.tz(t).zoneAbbr(),n.tz(t).format("Z");return`\n    <div class="airspace-detail">\n      <b>${e.name} (${e.airspaceClass})</b><br>\n      <b>↧ </b>${r} - <b>↥ </b>${s}<br>\n      ${i}\n      ${o}\n    </div>\n  `}function T(){if(!window.map)return void console.error("Map not initialized yet");const e=window.map.getCenter(),t=(e.lat.toFixed(6),e.lng.toFixed(6),window.map.getBounds()),i=t.getNorthWest(),o=t.getSouthEast(),a=`/api/airspacesXCdb?startDate=${b}&nw_lat=${i.lat.toFixed(6)}&nw_lng=${i.lng.toFixed(6)}&se_lat=${o.lat.toFixed(6)}&se_lng=${o.lng.toFixed(6)}`;fetch(a).then((e=>e.json())).then((e=>{window.airspaceXC.clearLayers(),_=[],g&&(window.map.off("popupopen",g),g=null);const t=e.features||[],i=Intl.DateTimeFormat().resolvedOptions().timeZone,o=n.tz(b,"YYYY-MM-DD",i).startOf("day").utc().toDate();t.forEach((e=>{if(e.geometry&&"Polygon"===e.geometry.type){if(e.properties.name&&e.properties.name.startsWith("V00"))return;const t=function(e){if(!e)return null;switch(e.type){case"FL":case"AMSL":case"AGL":return.3048*e.height;default:return null}}(e.properties.airlower_j);if(null===t||t>v)return;let a=!1;if(e.properties.descriptions&&Array.isArray(e.properties.descriptions))for(const t of e.properties.descriptions){const e=(t.airdescription||"").match(/C\)\s*(\d{10})/);if(e&&e[1])try{const t=2e3+parseInt(e[1].substring(0,2)),i=parseInt(e[1].substring(2,4))-1,n=parseInt(e[1].substring(4,6)),r=parseInt(e[1].substring(6,8)),s=parseInt(e[1].substring(8,10));if(new Date(Date.UTC(t,i,n,r,s))<o){a=!0;break}}catch(e){console.error("Error parsing expiration date:",e)}}if(a)return;let r=!1;if(e.properties.activations&&Array.isArray(e.properties.activations)&&e.properties.activations.length>0){const t=n.tz(b,"YYYY-MM-DD",i).endOf("day").utc().toDate();for(const i of e.properties.activations){const e=new Date(i[0]),n=new Date(i[1]);if(e<=t&&n>=o){r=!0;break}}if(!r)return}if("R"===e.properties.airspaceClass){let t=!1;if(e.properties.descriptions&&Array.isArray(e.properties.descriptions))for(const i of e.properties.descriptions)if((i.airdescription||"").match(/C\)\s*(\d{10})/)){t=!0;break}if(!t&&!r)return}const s=e.geometry.coordinates[0].map((e=>[e[1],e[0]])),l=L.polygon(s,{color:e.properties.strokeColor||"blue",weight:e.properties.strokeWeight||2,fillColor:e.properties.fillColor||"blue",fillOpacity:e.properties.fillOpacity||.3});l.bindPopup(`<b>${e.properties.name}</b><br><i>Loading details...</i>`,{className:"airspace-popup"}),_.push({polygon:l,data:e.properties,geometry:e.geometry}),window.airspaceXC.addLayer(l)}})),g=function(e){const t=e.popup;if(!(t&&t.options&&t.options.className&&t.options.className.includes("airspace-popup")))return;const i=e.layer,o=t.getLatLng();if(!o)return;const n=[],a=y.zx([o.lng,o.lat]);if(_.forEach(((e,t)=>{let{data:i,geometry:o}=e;try{const e=y.n1(o.coordinates);f.m(a,e)&&n.push(i)}catch(e){console.error(`[AirspaceXC] Error checking point in polygon for index ${t}:`,e)}})),n.length>0){const e=n.map((e=>x(e))).join("<hr style='margin: 5px 0; border-top: 1px solid #ccc;'>");t.setContent(e)}else{const e=_.find((e=>e.polygon===i));e?t.setContent(x(e.data)):(console.error("[AirspaceXC popupopen Listener - Attempt 13] Could not find data for the opened layer!"),t.setContent("Error: Could not find airspace details."))}},window.map.on("popupopen",g),console.log("[AirspaceXC] popupopen listener attached to MAP.")})).catch((e=>console.error("Error fetching airspaces:",e)))}document.addEventListener("change",(function(e){if(!e.target||"airspaceLowerLimit"!==e.target.id&&"airspaceTime"!==e.target.id||window.map&&window.map._popup&&window.map.closePopup(),e.target&&"airspaceLowerLimit"===e.target.id){const t=parseInt(e.target.value,10);t!==v&&(v=t,clearTimeout(w),w=setTimeout((()=>{window.map.hasLayer(window.airspaceXC)&&T()}),300))}if(e.target&&"airspaceTime"===e.target.id){const t=e.target.value;t!==b&&(b=t,clearTimeout(w),w=setTimeout((()=>{window.map.hasLayer(window.airspaceXC)&&T()}),300))}})),window.fetchAirspacesXC=T;function C(e){return["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"][Math.round(e/22.5)%16]}function k(e){return e>=7&&e<=14?"LimeGreen":e>=15&&e<=24?"yellow":e>=25&&e<=30?"orange":e>=31&&e<=36?"red":e>36?"black":"Aquamarine"}function A(e){return e>=15&&e<=24?"LimeGreen":e>=25&&e<=32?"yellow":e>=33&&e<=38?"orange":e>=39&&e<=44?"red":e>44?"black":"Aquamarine"}function S(e){return"black"===e?"white":"black"}window.showTab=function(e,t){console.log("Switching to tab:",e),document.querySelectorAll(".tab-content").forEach((e=>{e.style.display="none"})),document.querySelectorAll(".tab").forEach((e=>{e.classList.remove("active")}));const i=document.getElementById(e);if(i?i.style.display="block":console.error("Tab not found:",e),t?t.classList.add("active"):console.error("Element is null or undefined"),e.startsWith("chart-")){const t=e.split("chart-")[1];console.log("Station ID:",t);const i=document.getElementById(`canvas-${t}`);i&&i.chartInstance&&i.chartInstance.resize()}},window.fetchWindStations=function(){if(!window.map||"function"!=typeof window.map.getBounds)return void console.error("Map not properly initialized");const e=window.map.getBounds(),t=e.getNorthWest().lat,i=e.getNorthWest().lng,o=e.getSouthEast().lat,n=e.getSouthEast().lng;fetch(`/api/wind-data-getCurrent?nwLat=${t}&nwLng=${i}&seLat=${o}&seLng=${n}`).then((e=>e.json())).then((e=>{if(!Array.isArray(e))throw new Error("Invalid data format received from API");windLayer.clearLayers(),console.log("Wind layers cleared"),e.forEach((e=>{const[t,i]=e.loc.coordinates,o=e.last["w-dir"],n=e.last["w-avg"],a=e.last["w-max"],r=(e.last.temp,C(o)),s=new Date(1e3*e.last._id).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"}),l=k(n),c=A(a),d=e.peak?"▲":"▼",p=e._id.includes("holfuy");let m="";p&&(m=e._id.split("-")[1]);const h=`\n          <svg width="30" height="30" viewBox="0 0 800 900" xmlns="http://www.w3.org/2000/svg">\n            <g transform="rotate(${o+90}, 400, 400)" stroke="${c}" stroke-width="60">\n              <path d="M203,391 L75,144 L738,391 L75,637 L203,391 Z" fill="${l}"/>\n            </g>\n            <text x="330" y="850" font-size="220" text-anchor="middle" fill="black" font-weight="bold">\n              ${d}${Math.round(n)} / ${Math.round(a)}\n            </text>\n          </svg>`,u=L.divIcon({className:"wind-arrow",html:h,iconSize:[30,30],iconAnchor:[12,15]}),y=L.marker([i,t],{icon:u}).addTo(windLayer);fetch(`https://winds.mobi/api/2.3/stations/${e._id}/historic/?duration=21000&keys=w-dir&keys=w-avg&keys=w-max&keys=temp`).then((e=>e.json())).then((t=>{const i=function(e){const t={};e.forEach((e=>{const i=new Date(1e3*e._id);i.setMinutes(10*Math.floor(i.getMinutes()/10)),i.setSeconds(0),i.setMilliseconds(0);const o=i.getTime();t[o]||(t[o]={count:0,wAvgSum:0,wMaxSum:0,wDirSum:0,tempSum:0,tempCount:0}),t[o].count++,t[o].wAvgSum+=e["w-avg"],t[o].wMaxSum+=e["w-max"],t[o].wDirSum+=e["w-dir"],void 0!==e.temp&&(t[o].tempSum+=e.temp,t[o].tempCount++)}));const i=Object.keys(t).map((e=>({_id:parseInt(e)/1e3,"w-avg":t[e].wAvgSum/t[e].count,"w-max":t[e].wMaxSum/t[e].count,"w-dir":t[e].wDirSum/t[e].count,temp:t[e].tempCount>0?t[e].tempSum/t[e].tempCount:void 0})));return i.sort(((e,t)=>t._id-e._id)),i}(t),l=Date.now()-18e6,c=i.filter((e=>1e3*e._id>=l)).slice(0,24);let d='<div class="table-responsive"><table class="wind-data-table table">\n              <thead>\n                <tr>\n                  <th>Wind (m/s)</th>\n                  <th>Gusts (m/s)</th>\n                  <th>Direction</th>\n                  <th>Temp C°</th>\n                  <th>Time</th>\n                </tr>\n              </thead>\n              <tbody>';c.forEach((e=>{const t=new Date(1e3*e._id).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"}),i=C(e["w-dir"]);d+=`<tr>\n                <td class="wind-avg-cell" style="color: ${S(k(e["w-avg"]))}; background-color: ${k(e["w-avg"])};">\n                  ${e["w-avg"].toFixed(1)}\n                </td>\n                <td class="wind-max-cell" style="color: ${S(A(e["w-max"]))}; background-color: ${A(e["w-max"])};">\n                  ${e["w-max"].toFixed(1)}\n                </td>\n                <td style="white-space: nowrap;">\n                  <span class="wind-direction-arrow" style="transform: rotate(${e["w-dir"]+180}deg);">\n                      <i class="fa fa-long-arrow-up"></i>\n                  </span>\n                  &nbsp;&nbsp;${i}\n                </td>\n                <td>${void 0!==e.temp?e.temp.toFixed(1):"N/A"}</td>\n                <td>${t}</td>\n              </tr>`})),d+="</tbody></table></div>";const h=i.slice().reverse(),u=`\n              <div style="display: flex; gap: 1px; align-items: flex-end; max-width: 700px">\n                <div style="flex: 1;" class="wind-station-popup-content">\n                  <strong>${e.short}</strong><br><br>\n                  <tag-name>Wind Speed:&#9;&#9;${n} km/h<br></tag-name>\n                  <tag-name>Max Wind:&#9;&#9;${a} km/h<br></tag-name>\n                  <tag-name>Wind Direction:&#9;${o}° (${r})<br></tag-name>\n                  <tag-name>Last Update:&#9;&#9;${s}<br><br></tag-name>\n                </div>\n                ${p?`\n                  <div style="flex: 0 0 auto; width: 110px; margin-right: 15px; position: relative;">\n                    <iframe src="https://widget.holfuy.com/?station=${m}&su=km/h&t=C&lang=en&mode=rose&size=110"\n                      width="110"\n                      height="110"\n                      frameborder="0"\n                      scrolling="no"\n                      style="pointer-events: none;">\n                    </iframe>\n                    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10;"></div>\n                  </div>\n                `:""}\n              </div>\n              \n              <div class="tab-container">\n                <div class="tab active" onclick="showTab('table-${e._id}', this)">Table</div>\n                <div class="tab" onclick="showTab('chart-${e._id}', this)">Chart</div>\n                <div class="tab" id="camera-tab-${e._id}" style="display: none;" onclick="showTab('camera-${e._id}', this)">Camera</div>\n              </div>\n              <div id="table-${e._id}" class="tab-content">\n                ${d}\n              </div>\n              <div id="chart-${e._id}" class="tab-content" style="display: none;">\n                <canvas id="canvas-${e._id}" width="400" height="200"></canvas>\n              </div>\n              <div id="camera-${e._id}" class="tab-content" style="display: none;">\n                <img id="camera-image-${e._id}" src="" alt="Camera Image" class="camera-image">\n              </div>\n            `;y.bindPopup(L.responsivePopup({hasTip:!0,autoPan:!1,offset:[15,25],maxWidth:700,minWidth:400,maxHeight:800}).setContent(u)),y.on("popupopen",(()=>{setTimeout((()=>{const t=document.getElementById(`canvas-${e._id}`);if(t){t.style.height="300px";const e=t.getContext("2d");if(e){const i=h.map((e=>({x:1e3*e._id,y:e["w-avg"]}))),o=h.map((e=>({x:1e3*e._id,y:e["w-max"]}))),n=new Chart(e,{type:"line",data:{datasets:[{label:"Wind Avg (km/h)",data:i,borderColor:"blue",fill:!1,pointRadius:3},{label:"Wind Max (km/h)",data:o,borderColor:"red",fill:!1,pointRadius:3}]},options:{responsive:!0,maintainAspectRatio:!1,layout:{padding:{bottom:5}},scales:{x:{type:"time",time:{unit:"hour",displayFormats:{hour:"HH:mm"},tooltipFormat:"HH:mm"},grid:{drawBorder:!0},ticks:{autoSkip:!0,maxRotation:0,minRotation:0,padding:30}},y:{beginAtZero:!0,ticks:{stepSize:10,maxTicksLimit:10,font:{size:14}}}},plugins:{legend:{display:!1}}},plugins:[{id:"windDirectionArrows",afterDraw:e=>{const t=e.ctx,i=e.scales.x;t.save();const o=i.top+20;t.textAlign="center",t.textBaseline="middle",h.forEach((e=>{const n=i.getPixelForValue(1e3*e._id);t.save(),t.translate(n,o),t.rotate((e["w-dir"]+180)*Math.PI/180),t.font="extra-bold 12px 'Roboto', sans-serif",t.fillText("↑",0,0),t.restore()})),t.restore()}}]});t.chartInstance=n}else console.error("Failed to get 2D context from canvas.")}else console.error("Canvas element not found.");const i=document.getElementById(`camera-tab-${e._id}`),o=document.getElementById(`camera-image-${e._id}`);if("holfuy-361"===e._id||"holfuy-362"===e._id||"holfuy-363"===e._id){console.log(`Handling special case for ${e._id}`);const t=document.createElement("div");t.classList.add("holfuy-container");const n=document.createElement("div");if(n.textContent="Loading webcam image...",n.classList.add("loading-text"),t.appendChild(n),!o.parentNode)return console.error("Cannot find parent of image element for replacement"),void(i.style.display="none");o.parentNode.replaceChild(t,o),i.style.display="block",console.log("Successfully replaced image with container");const a=document.createElement("div");a.textContent="Loading webcam image...",a.classList.add("loading-text"),t.innerHTML="",t.appendChild(a);let r="https://www.moselfalken.de/zeltingen-rachtig";"holfuy-362"===e._id?r="https://www.moselfalken.de/ockfen":"holfuy-363"===e._id&&(r="https://www.moselfalken.de/meerfeld");const s=`/api/proxy?imageUrl=${r}`;console.log(`[${e._id}] Fetching website HTML from: ${s}`),fetch(s).then((e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.text()})).then((i=>{const o=(new DOMParser).parseFromString(i,"text/html").querySelectorAll("picture");if(0===o.length)throw new Error("No picture elements found in HTML");let n=null;for(const e of o){const t=e.querySelector("img");if(t&&(t.src.includes("cam")||t.alt&&t.alt.includes("Webcam"))){n=e;break}}n||(n=o[0]);const a=n.querySelectorAll("source"),r=n.querySelector("img");let s="";if(a.length>0){const e=a[a.length-1].getAttribute("srcset");e&&(s=e.split(" ")[0])}if(!s&&r&&(s=r.getAttribute("src")),!s)throw new Error("Could not extract image URL from HTML");s.startsWith("/")?s="https://www.moselfalken.de"+s:s.startsWith("http")||(s="https://www.moselfalken.de/"+s),console.log(`[${e._id}] Extracted image URL: ${s}`);const l=`/api/proxy?imageUrl=${s}`,c=document.createElement("img");c.alt="Moselfalken Webcam",c.classList.add("webcam-image"),console.log(`[${e._id}] Setting image src to proxy: ${l}`),c.src=l,t.innerHTML="",t.appendChild(c)})).catch((t=>{console.error(`[${e._id}] Error fetching/parsing website or extracting image URL:`,t),i.style.display="none"}))}else{const e=`https://holfuy.com/en/takeit/cam/s${m}.jpg`,t=new Image;t.onload=function(){o.src=e,i.style.display="block"},t.onerror=function(){i.style.display="none"},t.src=e,setTimeout((()=>{t.complete&&0!==t.naturalWidth||(i.style.display="none")}),2e3)}}),500)}))})).catch((e=>console.error("Error fetching historical wind data:",e)))}))})).catch((e=>console.error("Error fetching wind station data:",e)))};let D=null,E=null;function j(){"undefined"!=typeof swiperc&&(window.innerWidth<576?($(".swiper2").css("height",""),$(".swiper2").css("width","320px"),$(".swiper2").css("padding-left",""),$(".swiper2").css("padding-top","30px"),$(".swiper2 > .swiper-wrapper").css("width",""),$(".swiper2 > .swiper-wrapper").css("height","100px"),swiperc.changeDirection("horizontal",!0)):(window.innerWidth<840?($(".swiper2").css("width",""),$(".swiper2").css("height","320px")):($(".swiper2").css("width",""),$(".swiper2").css("height","460px")),$(".swiper2").css("padding-top",""),$(".swiper2").css("padding-left","30px"),$(".swiper2 > .swiper-wrapper").css("height",""),$(".swiper2 > .swiper-wrapper").css("width","100px"),swiperc.changeDirection("vertical",!0)))}function P(e){const t={N:0,NNE:22.5,NE:45,ENE:67.5,E:90,ESE:112.5,SE:135,SSE:157.5,S:180,SSW:202.5,SW:225,WSW:247.5,W:270,WNW:292.5,NW:315,NNW:337.5};let i=[];return e.split(",").map((e=>e.trim())).forEach((e=>{let o=e.split("-").map((e=>e.trim()));if(1===o.length){let e=t[o[0]];void 0!==e&&i.push([e-22.5,e+22.5])}else if(2===o.length){let e=t[o[0]],n=t[o[1]];void 0!==e&&void 0!==n&&(n<e&&([e,n]=[n,e]),n-e>180&&([e,n]=[n,e]),i.push([e,n]))}})),i}async function M(e,t){try{const i=await fetch(`/api/places/${t}`),o=await i.json();if(o.error)return void console.error("Error fetching place details:",o.error);let n=/<center><b><a href="http:\/\/www\.paraglidingearth\.com\/index\.php\?site=\d+">More information on ParaglidingEarth<\/a><\/b><\/center>\n?/g,a=/<br>\n<b>Take off : <\/b><br>\n?/g,r=/H \d+(-\d+)? m(?:, |<br>)/g,s=/HD \d+ m(?:<br>| \/)/g,l=/\nrating \d+\/\d+(?:\n|<br>)*/gi,c=(o.properties.description||"").replace(n,"").replace(a,"").replace(r,"").replace(s,"").replace(l,"").trim();window.currentPlaceName=o.properties.name,window.currentPlaceId=o.properties.id,window.currentStrPlacemarkId=o.properties.strPlacemarkId;let d=`<span style="color: #0087F7;"><h5>${o.properties.name}</h5></span>\n                            <table style="border-collapse: collapse; width: 70%;">\n                            <tr>\n                                <th style="text-align: left; vertical-align: top;">Type:</th>\n                                <td style="text-align: left; vertical-align: top;">${o.properties.type}</td>\n                            </tr>\n                            <tr>\n                                <th style="text-align: left; vertical-align: top;">Direction:</th>\n                                <td style="text-align: left; vertical-align: top;">${o.properties.direction}</td>\n                            </tr>\n                            <tr>\n                                <th style="text-align: left; vertical-align: top;">Rating:</th>\n                                <td style="text-align: left; vertical-align: top;">${null!=o.properties.rating?o.properties.rating+"/6":" -"}</td>\n                            </tr>\n                            <tr>\n                                <th style="text-align: left; vertical-align: top;">Height:</th>\n                                <td style="text-align: left; vertical-align: top;">${null!=o.properties.height?o.properties.height:" -"}</td>\n                            </tr>\n                            <tr>\n                                <th style="text-align: left; vertical-align: top;">Height difference:</th>\n                                <td style="text-align: left; vertical-align: top;">${null!=o.properties.heightdifference?o.properties.heightdifference:" -"}</td>\n                            </tr>\n                            <tr>\n                                <th style="text-align: left; vertical-align: top;">Last Update:</th>\n                                <td style="text-align: left; vertical-align: top;">${o.properties.lastupdate}</td>\n                            </tr>\n                            </table><br>\n                            <b>Description:</b> <div class="spot-description">${c}</div><br>\n                            <b>© <a href="https://paraglidingspots.com" target="_blank">paraglidingspots.com</a></b>\n                            <div class="modal-footer d-flex justify-content-between">\n                            <div id="feedback-message" class="text-start"></div> \x3c!-- Message on the left --\x3e\n                            <div class="d-flex ms-auto">\n                                <button class="btn btn-primary btn-sm me-2" onclick="showFeebackForm()">Feedback/Correction</button>\n                                <button class="btn btn-dark btn-sm close-popup">Close</button>\n                            </div>\n                            </div>\n                            `;d+="<style>\n        /* Limit the height of the Swiper container */\n        .swiper-container {\n            max-height: 460px !important;\n            height: 460px !important;\n            overflow: hidden !important;\n        }\n\n        /* Ensure individual Swipers don't expand beyond this height */\n        .swiper, .swiper1, .swiper2 {\n            max-height: 460px !important;\n            height: 460px !important;\n            overflow: hidden !important;\n        }\n\n        /* Limit Swiper wrapper height */\n        .swiper-wrapper {\n            max-height: 460px !important;\n        }\n\n        /* Ensure Swiper slides don't stretch */\n        .swiper-slide {\n            max-height: 460px !important;\n            display: flex !important;\n            align-items: center !important; /* Keep images centered */\n            justify-content: center !important;\n        }\n\n        /* Prevent images from exceeding the swiper height */\n        .swiper-slide img {\n            max-height: 100% !important;\n            width: auto !important;\n        }\n        \n        /* Keep the overall popup size unchanged */\n        .leaflet-popup-content {\n            max-height: 780px !important; /* Keep original popup height */\n            overflow-y: auto; /* Allow scrolling inside the popup if needed */\n        }\n\n        .swiper-clear {\n            clear: both;\n            margin-bottom: 1px;\n        }\n        </style>";const p=document.getElementById("fullScreenInfo"),m=document.getElementById("fullscreen-content-area");if(p&&p.classList.contains("visible")&&m){console.log("Updating fullscreen info content area for spot");const e=p.querySelector("#default-fullscreen-close-btn"),t=p.querySelector("#default-fullscreen-footer");e&&e.remove(),t&&t.remove(),m.innerHTML=d}e.setPopupContent(d),setTimeout((()=>{let e=document.querySelector(".swiper1 .swiper-slide img");if(e){!function(e){let t,i;var o=!(e<4),n=!(e<5);t=new Swiper(".swiper1",{autoHeight:!0,direction:"horizontal",allowTouchMove:!1,mousewheel:!1,slidesPerView:1,loop:!1}),i=new Swiper(".swiper2",{direction:"vertical",allowTouchMove:!0,mousewheel:!0,slidesPerView:3,spaceBetween:10,loop:o,breakpoints:{840:{slidesPerView:4,loop:n}},scrollbar:{el:".swiper-scrollbar",hide:!1,draggable:!0},on:{click:function(){let e=this.clickedSlide.firstChild.id.substring(3)-1;t.slideTo(e,1)},transitionEnd:function(){let e=this.realIndex;t.slideTo(e,1)}}}),j()}(parseInt(e.id.replace(/\D/g,""),10)||1)}}),300),setTimeout((()=>{const t=document.getElementById("fullScreenInfo");let i=null;if(t&&t.classList.contains("visible"))i=t.querySelector("#fullscreen-content-area .close-popup"),i?(i.replaceWith(i.cloneNode(!0)),i=t.querySelector("#fullscreen-content-area .close-popup"),i.addEventListener("click",(function(){console.log("Fullscreen close button clicked"),window.closeFullscreenInfo()}))):console.error("Close button not found in fullscreen view");else{const t=e.getPopup().getElement();t&&(i=t.querySelector(".close-popup"),i?(i.replaceWith(i.cloneNode(!0)),i=t.querySelector(".close-popup"),i.addEventListener("click",(function(){console.log("Standard popup close button clicked"),window.map&&window.map.closePopup()}))):console.error("Close button not found in standard popup"))}}),350)}catch(e){console.error("Error fetching place details:",e)}}function I(){E&&(E.remove(),E=null),D&&(D.destroy(),D=null);const e=document.getElementById("feedback-message");e&&(e.textContent="",e.classList.remove("text-success","text-danger"));const t=document.getElementById("fullScreenInfo"),i=t&&t.classList.contains("visible"),o=i?t.querySelector("#fullscreen-content-area"):document.querySelector(".leaflet-popup-content");if(!o)return void console.error("Could not find context element for feedback form.");let n=o.querySelector(".modal-footer");n&&(n.style.display="none");const a=`\n        <div id="feedbackFormHtml">\n            <div class="feedback-modal">\n                <span style="color: #0087F7;"><h5>Feedback for ${window.currentPlaceName}</h5></span>\n                <form id="feedbackForm">\n                    <div class="form-group">\n                        <label for="feedbackText">Feedback / Correction / Comment:</label>\n                        <textarea id="feedbackText" class="form-control" required style="height: 130px;"></textarea>\n                    </div>\n                    <div class="form-group">\n                        <label>Upload Images (optional):</label>\n                        <div id="dropzoneFeedback" class="dropzone mt-4 border-dashed rounded-2 min-h-0"></div>\n                    </div>\n                    <div class="form-group d-flex justify-content-between">\n                        <div style="width: 48%;">\n                            <label for="userName">Name:</label>\n                            <input type="text" id="userName" class="form-control" required>\n                        </div>\n                        <div style="width: 48%;">\n                            <label for="userEmail">E-Mail:</label>\n                            <input type="email" id="userEmail" class="form-control" required>\n                            <small class="text-danger d-none" id="emailError">Please enter a valid email address.</small>\n                        </div>\n                    </div>\n                    <button type="submit" class="btn btn-sm btn-success">Submit</button>\n                    <button type="button" class="btn btn-sm btn-secondary" onclick="cancelFeedback()">Cancel</button>\n                </form>\n            </div>\n        </div>\n    `;o?(o.insertAdjacentHTML("beforeend",a),E=o.querySelector("#feedbackFormHtml"),setTimeout((()=>{o&&(o.scrollTo({top:o.scrollHeight,behavior:"smooth"}),o.scrollTop=o.scrollHeight,i&&t&&(t.scrollTo({top:t.scrollHeight,behavior:"smooth"}),t.scrollTop=t.scrollHeight),setTimeout((()=>{const e=document.getElementById("feedbackText");e&&e.focus()}),100))}),200),D=new Dropzone("#dropzoneFeedback",{url:"/upload",autoProcessQueue:!1,maxFiles:5,maxFilesize:100,acceptedFiles:"image/*",addRemoveLinks:!1,dictDefaultMessage:"Drag & drop files here or click to upload",clickable:!0,init:function(){const e=this;this.on("addedfile",(function(t){const i=t.previewElement,o=document.createElement("img");o.src="/assets/images/imgdelete.png",o.alt="Delete",o.classList.add("delete-icon"),i.querySelector(".dz-image").appendChild(o),o.addEventListener("click",(function(i){i.preventDefault(),i.stopPropagation(),e.removeFile(t)}))})),this.on("removedfile",(function(e){console.log("File removed:",e.name)}))}}),document.getElementById("userEmail").addEventListener("input",(function(){const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.value);document.getElementById("emailError").classList.toggle("d-none",e)})),document.getElementById("feedbackForm").addEventListener("submit",(async function(e){e.preventDefault();const t=new FormData;t.append("name",window.currentPlaceName),t.append("id",window.currentPlaceId),t.append("strPlacemarkId",window.currentStrPlacemarkId),t.append("feedbackText",document.getElementById("feedbackText").value),t.append("userName",document.getElementById("userName").value),t.append("userEmail",document.getElementById("userEmail").value),D.files.forEach((e=>{t.append("images",e)}));try{const e=await fetch("/api/send-feedback",{method:"POST",body:t}),i=await e.json();E&&(E.remove(),E=null),D&&(D.destroy(),D=null);const n=o?o.querySelector("#feedback-message"):document.getElementById("feedback-message"),a=o?o.querySelector(".modal-footer"):document.querySelector(".modal-footer");n?i.success?(n.textContent=i.message||"Feedback submitted successfully!",n.classList.remove("text-danger"),n.classList.add("text-success")):(n.textContent=i.error||"An error occurred.",n.classList.remove("text-success"),n.classList.add("text-danger")):console.error("Feedback message div not found in context."),a?a.style.display="flex":console.error("Modal footer not found in context.")}catch(e){console.error("Submission error:",e);const t=o?o.querySelector(".modal-footer"):document.querySelector(".modal-footer");t&&(t.style.display="flex")}}))):console.error("Popup content not found!")}function z(){E&&(E.remove(),E=null),D&&(D.destroy(),D=null);const e=document.getElementById("fullScreenInfo"),t=e&&e.classList.contains("visible")?e.querySelector("#fullscreen-content-area"):document.querySelector(".leaflet-popup-content");if(t){let e=t.querySelector(".modal-footer");e&&(e.style.display="flex")}else{let e=document.querySelector(".modal-footer");e&&(e.style.display="flex")}}function R(){if(!window.map||!window.placesLayerPG)return console.error("Map or placesLayerPG is not defined. Retrying in 500ms..."),void setTimeout(R,500);console.log("Initializing PG spots module..."),window.showFeebackForm=I,window.cancelFeedback=z;const e=L.markerClusterGroup({disableClusteringAtZoom:9,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,maxClusterRadius:250,iconCreateFunction:function(e){return L.divIcon({html:`<div class="cluster-marker">${e.getChildCount()}</div>`,className:"pg-cluster-icon",iconSize:L.point(30,30)})}});window.placesLayerPG.addLayer(e);let t=null,i=null;function o(){window.map.hasLayer(window.placesLayerPG)?(i&&clearTimeout(i),i=setTimeout((()=>{t&&t.abort(),t=new AbortController;const i=t.signal,o=window.map.getBounds(),n=o.getNorthWest().lat,a=o.getNorthWest().lng,r=o.getSouthEast().lat,s=o.getSouthEast().lng;fetch(`/api/places?nw_lat=${n}&nw_lng=${a}&se_lat=${r}&se_lng=${s}&type=TO&type=TOW&type=TH`,{signal:i}).then((e=>e.json())).then((o=>{i.aborted||(e.clearLayers(),L.geoJSON(o,{pointToLayer:function(e,t){return L.marker(t,{icon:L.canvasIcon({iconSize:[50,50],iconAnchor:[15,15],drawIcon:function(t,i){if("icon"===i){var o=t.getContext("2d"),n=L.point(this.options.iconSize),a=L.point(n.x/2,n.y/2);o.clearRect(0,0,n.x,n.y);let i=P(e.properties.direction||"");o.beginPath(),i.forEach((e=>{let[t,i]=e;o.moveTo(a.x,a.y),o.arc(a.x,a.y,a.x,(t-90)*Math.PI/180,(i-90)*Math.PI/180,!1),o.lineTo(a.x,a.y)})),o.fillStyle="orange",o.fill(),o.closePath(),o.beginPath(),o.arc(a.x,a.y,a.x/4,0,2*Math.PI),o.fillStyle="green",o.fill(),o.closePath()}}})})},onEachFeature:function(t,i){if(t.properties){let e=`<b>${t.properties.name}</b><br>\n                                                    Type: ${t.properties.type}<br>\n                                                    Direction: ${t.properties.direction}<br>\n                                                    <i>Loading details...</i>`,o=L.responsivePopup({hasTip:!0,autoPan:!1,offset:[15,25],maxWidth:900,maxHeight:780}).setContent(e);i.bindPopup(o),i.on("popupopen",(async function(){await M(i,t.properties.id)}))}e.addLayer(i)}}),t=null)})).catch((e=>{"AbortError"!==e.name&&console.error("Error fetching PG places:",e)}))}),300)):console.log("PG layer not visible, skipping fetch")}window.fetchPlacesPG=o,window.map.hasLayer(window.placesLayerPG)&&o(),console.log("PG spots module initialized")}function F(){if(!window.map||!window.placesLayerHG)return console.error("Map or placesLayerHG is not defined. Retrying in 500ms..."),void setTimeout(F,500);console.log("Initializing HG spots module..."),window.showFeebackForm=I,window.cancelFeedback=z;const e=L.markerClusterGroup({disableClusteringAtZoom:9,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,maxClusterRadius:250,iconCreateFunction:function(e){return L.divIcon({html:`<div class="cluster-marker">${e.getChildCount()}</div>`,className:"hg-cluster-icon",iconSize:L.point(30,30)})}});window.placesLayerHG.addLayer(e);let t=null,i=null;function o(){i&&clearTimeout(i),i=setTimeout((()=>{t&&t.abort(),t=new AbortController;const i=t.signal,o=window.map.getBounds(),n=o.getNorthWest().lat,a=o.getNorthWest().lng,r=o.getSouthEast().lat,s=o.getSouthEast().lng;fetch(`/api/places?nw_lat=${n}&nw_lng=${a}&se_lat=${r}&se_lng=${s}&type=TO-HG&type=TOW-HG`,{signal:i}).then((e=>e.json())).then((o=>{i.aborted||(e.clearLayers(),L.geoJSON(o,{pointToLayer:function(e,t){return L.marker(t,{icon:L.canvasIcon({iconSize:[50,50],iconAnchor:[15,15],drawIcon:function(t,i){if("icon"===i){var o=t.getContext("2d"),n=L.point(this.options.iconSize),a=L.point(n.x/2,n.y/2);o.clearRect(0,0,n.x,n.y);let i=P(e.properties.direction||"");o.beginPath(),i.forEach((e=>{let[t,i]=e;o.moveTo(a.x,a.y),o.arc(a.x,a.y,a.x,(t-90)*Math.PI/180,(i-90)*Math.PI/180,!1),o.lineTo(a.x,a.y)})),o.fillStyle="orange",o.fill(),o.closePath(),o.beginPath(),o.arc(a.x,a.y,a.x/4,0,2*Math.PI),o.fillStyle="green",o.fill(),o.closePath()}}})})},onEachFeature:function(t,i){if(t.properties){let e=`<b>${t.properties.name}</b><br>\n                                                    Type: ${t.properties.type}<br>\n                                                    Direction: ${t.properties.direction}<br>\n                                                    <i>Loading details...</i>`,o=L.responsivePopup({hasTip:!0,autoPan:!1,offset:[15,25],maxWidth:900,maxHeight:780}).setContent(e);i.bindPopup(o),i.on("popupopen",(async function(){await M(i,t.properties.id)}))}e.addLayer(i)}}),t=null)})).catch((e=>{"AbortError"!==e.name&&console.error("Error fetching HG places:",e)}))}),300)}window.fetchPlacesHG=o,window.map.hasLayer(window.placesLayerHG)&&o(),console.log("PG spots module initialized")}function U(){if(!window.map||!window.placesLayerLZ)return void setTimeout(U,500);console.log("Initializing LZ spots module...");const e=L.markerClusterGroup({disableClusteringAtZoom:9,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,maxClusterRadius:250,iconCreateFunction:function(e){return L.divIcon({html:`<div class="cluster-marker">${e.getChildCount()}</div>`,className:"lz-cluster-icon",iconSize:L.point(30,30)})}});window.placesLayerLZ.addLayer(e);let t=null,i=null;function o(){i&&clearTimeout(i),i=setTimeout((()=>{t&&t.abort(),t=new AbortController;const i=t.signal,o=window.map.getBounds(),n=o.getNorthWest().lat,a=o.getNorthWest().lng,r=o.getSouthEast().lat,s=o.getSouthEast().lng;fetch(`/api/places?nw_lat=${n}&nw_lng=${a}&se_lat=${r}&se_lng=${s}&type=LZ`,{signal:i}).then((e=>e.json())).then((o=>{i.aborted||(e.clearLayers(),L.geoJSON(o,{pointToLayer:function(e,t){return L.marker(t,{icon:L.icon({iconUrl:"../assets/images/windsock.png",iconSize:[20,20],iconAnchor:[20,20]})})},onEachFeature:function(t,i){if(t.properties){let e=`<b>${t.properties.name}</b><br>\n                                                    Type: ${t.properties.type}<br>\n                                                    Direction: ${t.properties.direction}<br>\n                                                    <i>Loading details...</i>`,o=L.responsivePopup({hasTip:!0,autoPan:!1,offset:[15,25],maxWidth:900,maxHeight:780}).setContent(e);i.bindPopup(o),i.on("popupopen",(async function(){await M(i,t.properties.id)}))}e.addLayer(i)}}),t=null)})).catch((e=>{"AbortError"!==e.name&&console.error("Error fetching LZ places:",e)}))}),300)}window.fetchPlacesLZ=o,window.map.hasLayer(window.placesLayerLZ)&&o(),console.log("PG spots module initialized")}document.addEventListener("map_initialized",(function(){console.log("Map initialized event received in PG spots module"),setTimeout(R,100)})),setTimeout((()=>{window.mapInitialized&&(console.log("Backup initialization for PG spots module"),R())}),1e3),document.addEventListener("map_initialized",(function(){console.log("Map initialized event received in HG spots module"),setTimeout(F,100)})),setTimeout((()=>{window.mapInitialized&&(console.log("Backup initialization for HG spots module"),F())}),1e3),document.addEventListener("map_initialized",(function(){console.log("Map initialized event received in LZ spots module"),setTimeout(U,100)})),setTimeout((()=>{window.mapInitialized&&(console.log("Backup initialization for LZ spots module"),U())}),1e3);let N=null,O=L.layerGroup({attribution:'XContest&copy; <a href="https://xcontest.org">XContest</a>'});function G(){window.map=L.map("map",{center:[50,6],zoom:9,zoomControl:!1,layers:[],timeDimension:!0}),L.control.zoom({position:"bottomright"}).addTo(window.map);var e=L.tileLayer("https://tile.jawg.io/jawg-terrain/{z}/{x}/{y}{r}.png?access-token=qBDXRu1KSlZGhx4ROlceBD9hcxmrumL34oj29tUkzDVkafqx08tFWPeRNb0KSoKa",{attribution:"Jawg.io"}).addTo(window.map),t=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap"}),i=L.tileLayer("https://topo.xcontest.app/elev/{z}/{x}/{y}.jpg",{attribution:'XContest&copy; <a href="https://www.xcontest.org">XContest</a>',className:"xcontest-layer"});window.map.on("popupopen",(function(e){var t=document.getElementById("fullScreenInfo");if(window.innerWidth<768){const o=e.popup.getElement();if(o&&(o.classList.contains("obstacle-popup")||o.classList.contains("airspace-popup")))return;window.map.closePopup();try{var i=e.popup.getContent();t.innerHTML=`<div id="default-fullscreen-close-btn" style="position: absolute; top: 10px; right: 10px;"><button onclick="closeFullscreenInfo()" style="background: none; border: none; font-size: 20px; cursor: pointer;">✕</button></div><div id="fullscreen-content-area">${i}</div><div id="default-fullscreen-footer" style="text-align: right; padding: 10px;"><button class="btn btn-dark btn-sm" onclick="closeFullscreenInfo()">Close</button></div>`,t.classList.add("visible"),t.style.display="block",t.style.zIndex="10000",document.getElementById("map").classList.add("map-covered")}catch(e){console.error("Error in popupopen handler:",e)}}})),window.closeFullscreenInfo=function(){var e=document.getElementById("fullScreenInfo");e.classList.remove("visible"),e.innerHTML="",document.getElementById("map").classList.remove("map-covered"),window.map.closePopup()};var a=L.mapboxGL({style:"/assets/maps/maptiler_terrain_wob_testxc.json",apiKey:"c49iG8J3xvAkgCSZ8M8v",className:"xcmap-layer",attribution:"MapTiler Terrain"}),r=L.tileLayer("http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}",{attribution:"Map data: Google",maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"]}),s=(L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"© Esri",id:"MapID"}),L.mapboxGL({style:"/assets/maps/maptiler_terrain_wob_testxc.json",apiKey:"c49iG8J3xvAkgCSZ8M8v",className:"xcmap-layer satellite-overlay",attribution:"MapTiler Terrain"}),L.tileLayer("/api/kk7thermals/{z}/{x}/{y}.png",{attribution:'<a href="https://thermal.kk7.ch">thermal.kk7.ch</a>',maxNativeZoom:12,tms:!0}));L.tileLayer("https://api.maptiler.com/tiles/contours/{z}/{x}/{y}.pbf?key=c49iG8J3xvAkgCSZ8M8v",{attribution:"MapTiler",opacity:.8,className:"contour-overlay",style:{color:"#ffffff",weight:1,opacity:.8}});window.windLayer=L.layerGroup().addTo(window.map),window.oaipMap=L.tileLayer("https://a.api.tiles.openaip.net/api/data/openaip/{z}/{x}/{y}.png?apiKey=171189a4d43c6578ce63758f28363cb3",{attribution:'OpenAIP&copy; <a href="https://www.openaip.net">OpenAIP</a>',className:"oaip-layer"});try{window.rainviewerRadarLayer=L.timeDimension.layer.rainviewer("https://api.rainviewer.com/public/weather-maps.json",{opacity:.7,cache:5}).addTo(window.map),window.rainviewerSatelliteLayer=L.timeDimension.layer.rainviewer("https://api.rainviewer.com/public/weather-maps.json",{type:"satellite",opacity:.7,cache:5}),console.log("RainViewer layers initialized successfully"),setTimeout((()=>{u()}),500)}catch(e){console.error("Error initializing RainViewer layers:",e),window.rainviewerRadarLayer=L.layerGroup(),window.rainviewerSatelliteLayer=L.layerGroup()}try{window.timeDimensionControl=L.control.timeDimension({position:"bottomleft",playerOptions:{transitionTime:1e3,loop:!0,buffer:2},timeZones:["Local"],autoPlay:!0,speedSlider:!1}),console.log("TimeDimension control initialized successfully")}catch(e){console.error("Error initializing TimeDimension control:",e),window.timeDimensionControl={addTo:function(){console.log("Using dummy TimeDimension control")}}}window.isTimeDimensionControlAdded=!1,window.airspaceGliding=L.layerGroup([],{attribution:'OpenAIP&copy; <a href="https://www.openaip.net">OpenAIP</a>'}),window.airspaceNotam=L.layerGroup([],{attribution:'OpenAIP&copy; <a href="https://www.openaip.net">OpenAIP</a>'}),window.airspaceXC=L.layerGroup([],{attribution:'XContest&copy; <a href="https://xcontest.org">XContest</a>'}),window.placesLayerPG=L.layerGroup([],{attribution:'&copy; <a href="https://paraglidingspots.com">paraglidingspots.com</a>'}),window.placesLayerHG=L.layerGroup([],{attribution:'&copy; <a href="https://paraglidingspots.com">paraglidingspots.com</a>'}),window.placesLayerLZ=L.layerGroup([],{attribution:'&copy; <a href="https://paraglidingspots.com">paraglidingspots.com</a>'});const l=(()=>{let e="";for(let t=0;t<=6;t++){const i=n().add(t,"days"),o=i.format("ddd");e+=`<option value="${i.format("YYYY-MM-DD")}" ${0===t?"selected":""}>${0===t?"Today":o}</option>`}return e})();var c={label:"Base Maps",collapsed:!0,children:[{label:"Terrain",layer:e},{label:"XContest",layer:L.layerGroup([i,a])},{label:"OpenStreetMap",layer:t},{label:"Satellite",layer:r}]},d={label:"Overlays",children:[{label:"Weather Stations",children:[{label:"Weather Stations",layer:window.windLayer,checked:!0}]},{html:'<hr class="leaflet-control-layers-separator">'},{label:"Rain Viewer",children:[{label:"Radar",layer:window.rainviewerRadarLayer,checked:!0},{label:"Satellite",layer:window.rainviewerSatelliteLayer}]},{html:'<hr class="leaflet-control-layers-separator">'},{label:"Thermals",children:[{label:"kk7 Thermals",layer:s}]},{html:'<hr class="leaflet-control-layers-separator">'},{label:"Spots",children:[{label:"Take-off PG",layer:window.placesLayerPG},{label:"Take-off HG",layer:window.placesLayerHG},{label:"Landing Zones",layer:window.placesLayerLZ}]},{html:'<hr class="leaflet-control-layers-separator">'},{label:"Airspaces",children:[{html:`\n                            <div class="airspace-time-control">\n                                Active:\n                                <select class="airspace-time-select" id="airspaceTime">\n                                    ${l}\n                                </select>\n                            </div>\n                        `},{html:'\n                            <div class="airspace-limit-control">\n                                ↧ below:\n                                <select class="lower-limit-select" id="airspaceLowerLimit">\n                                    <option value="2000">2000m</option>\n                                    <option value="2500">2500m</option>\n                                    <option value="3000" selected>3000m</option>\n                                    <option value="3500">3500m</option>\n                                    <option value="4000">4000m</option>\n                                    <option value="4500">4500m</option>\n                                </select>\n                            </div>\n                        '},{label:"Airspaces",layer:window.airspaceXC},{label:"Obstacles",layer:window.obstacleLayer},{label:"OpenAIP Map",layer:window.oaipMap}]}]};new o({position:"bottomright"}).addTo(window.map),L.Control.Logo=L.Control.extend({onAdd:function(e){const t=L.DomUtil.create("div","leaflet-control-logo"),i=L.DomUtil.create("img","logo-image",t);return i.src="/assets/images/XCmapsLogo.png",i.alt="XCmaps Logo",i.style.width="120px",i.style.height="auto",L.DomEvent.disableClickPropagation(t),t}}),L.control.logo=function(e){return new L.Control.Logo(e)},L.control.logo({position:"topleft"}).addTo(window.map);L.control.locate({drawCircle:!1,keepCurrentZoomLevel:!0,position:"bottomright",icon:"locate",iconLoading:"loading",iconElementTag:"div"}).addTo(window.map);var p=L.control.layers.tree(c,d,{namedToggle:!1,collapsed:!0}).addTo(window.map);p.collapseTree(!1).expandSelected(!0);const m=p.getContainer(),h=m.querySelector(".leaflet-control-layers-toggle");function u(){if(console.log("Updating TimeDimension control visibility"),window.isUpdatingTimeDimensionControl)console.log("Already updating TimeDimension control, skipping");else{window.isUpdatingTimeDimensionControl=!0;try{const e=function(){const e=window.map.hasLayer(window.rainviewerRadarLayer),t=window.map.hasLayer(window.rainviewerSatelliteLayer);return console.log("RainViewer layer check - Radar:",e,"Satellite:",t),e||t}();if(console.log("Should TimeDimension control be visible?",e),console.log("Is TimeDimension control currently added?",window.isTimeDimensionControlAdded),e)if(window.isTimeDimensionControlAdded)console.log("TimeDimension control already added, no action needed");else try{console.log("Adding TimeDimension control to map");const e=new Promise(((e,t)=>{setTimeout((()=>t(new Error("Adding TimeDimension control timed out"))),5e3)})),t=new Promise((e=>{window.timeDimensionControl.addTo(window.map),e()}));return void Promise.race([t,e]).then((()=>{window.isTimeDimensionControlAdded=!0,console.log("TimeDimension control added to map successfully")})).catch((e=>{console.error("Error adding TimeDimension control:",e)})).finally((()=>{window.isUpdatingTimeDimensionControl=!1}))}catch(e){console.error("Error adding TimeDimension control:",e)}else if(window.isTimeDimensionControlAdded)try{console.log("Removing TimeDimension control from map"),window.map.removeControl(window.timeDimensionControl),window.isTimeDimensionControlAdded=!1,console.log("TimeDimension control removed from map successfully")}catch(e){console.error("Error removing TimeDimension control:",e)}else console.log("TimeDimension control already removed, no action needed")}catch(e){console.error("Error in updateTimeDimensionControlVisibility:",e)}window.isUpdatingTimeDimensionControl=!1}}("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)&&(L.DomEvent.on(h,"click",(function(e){L.DomEvent.stopPropagation(e),L.DomUtil.hasClass(m,"leaflet-control-layers-expanded")?L.DomUtil.removeClass(m,"leaflet-control-layers-expanded"):L.DomUtil.addClass(m,"leaflet-control-layers-expanded")})),L.DomEvent.on(document,"click",(function(){L.DomUtil.hasClass(m,"leaflet-control-layers-expanded")&&L.DomUtil.removeClass(m,"leaflet-control-layers-expanded")})),L.DomEvent.on(m,"click",(function(e){L.DomEvent.stopPropagation(e)}))),window.map.on("moveend",(function(){console.log("Map moveend event triggered"),window.map.hasLayer(window.windLayer)&&"function"==typeof window.fetchWindStations&&(console.log("Fetching wind stations after map move..."),window.fetchWindStations()),window.map.hasLayer(window.placesLayerPG)&&window.fetchPlacesPG&&(console.log("Fetching PG spots after map move..."),window.fetchPlacesPG()),window.map.hasLayer(window.placesLayerHG)&&window.fetchPlacesHG&&(console.log("Fetching HG spots after map move..."),window.fetchPlacesHG()),window.map.hasLayer(window.placesLayerLZ)&&window.fetchPlacesLZ&&(console.log("Fetching LZ spots after map move..."),window.fetchPlacesLZ()),window.map.hasLayer(window.airspaceGliding)&&"function"==typeof window.fetchAirspacesGliding&&(console.log("Fetching airspaces after map move..."),window.fetchAirspacesGliding()),window.map.hasLayer(window.airspaceNotam)&&"function"==typeof window.fetchAirspacesNotam&&(console.log("Fetching airspaces after map move..."),window.fetchAirspacesNotam()),window.map.hasLayer(window.airspaceXC)&&"function"==typeof window.fetchAirspacesXC&&(window.map._popup?console.log("Skipping XC airspace fetch on moveend because popup is open."):(console.log("Fetching XC airspaces after map move (no popup open)..."),window.fetchAirspacesXC())),window.map.hasLayer(window.obstacleLayer)&&"function"==typeof window.fetchObstacles&&(console.log("Fetching airspaces after map move..."),window.fetchObstacles())})),document.addEventListener("change",(function(e){e.target&&"airspaceLowerLimit"===e.target.id&&console.log("Selected limit:",e.target.value),e.target&&"airspaceTime"===e.target.id&&console.log("Selected airspace date:",e.target.value)})),window.map.on("layeradd",(function(e){const t=e.layer;t===window.windLayer&&"function"==typeof window.fetchWindStations?window.fetchWindStations():t===window.placesLayerPG&&window.fetchPlacesPG?window.fetchPlacesPG():t===window.placesLayerHG&&window.fetchPlacesHG?window.fetchPlacesHG():t===window.placesLayerLZ&&window.fetchPlacesLZ?window.fetchPlacesLZ():t===window.airspaceGliding&&"function"==typeof window.fetchAirspacesGliding?window.fetchAirspacesGliding():t===window.airspaceNotam&&"function"==typeof window.fetchAirspacesNotam?window.fetchAirspacesNotam():t===window.airspaceXC&&"function"==typeof window.fetchAirspacesXC?window.fetchAirspacesXC():t===window.obstacleLayer&&"function"==typeof window.fetchObstacles?window.fetchObstacles():t===window.rainviewerRadarLayer?(console.log("RainViewer Radar layer added via layeradd"),u()):t===window.rainviewerSatelliteLayer&&(console.log("RainViewer Satellite layer added via layeradd"),u())}));let y=null;function f(){try{document.querySelectorAll(".leaflet-control-timecontrol.timecontrol-date").forEach((e=>{const t=(e.textContent||e.innerText).match(/(\d{1,2}):(\d{2}):\d{2}\s*(AM|PM)?/i);if(t){let i=parseInt(t[1]);const o=t[2],n=t[3]?t[3].toUpperCase():null;"PM"===n&&i<12?i+=12:"AM"===n&&12===i&&(i=0);const a=`${i.toString().padStart(2,"0")}:${o}`;e.textContent=a}}))}catch(e){console.error("Error updating time display:",e)}}function w(){y&&clearTimeout(y),y=setTimeout((()=>{try{u(),setTimeout(f,500)}catch(e){console.error("Error in debouncedUpdateTimeDimensionControl:",e)}}),100)}document.addEventListener("map_initialized",(function(){try{new MutationObserver((function(e){f()})).observe(document.body,{childList:!0,subtree:!0}),f(),setInterval(f,1e3)}catch(e){console.error("Error setting up time control observer:",e)}})),document.addEventListener("map_initialized",(function(){window.rainviewerRefreshInterval||(window.rainviewerRefreshInterval=setInterval((()=>{try{const e=window.map.hasLayer(window.rainviewerRadarLayer),t=window.map.hasLayer(window.rainviewerSatelliteLayer);(e||t)&&(console.log("Refreshing RainViewer data..."),e&&fetchRainviewerMetadata("https://api.rainviewer.com/public/weather-maps.json").then((e=>{window.rainviewerRadarLayer._metadata=e,window.rainviewerRadarLayer._loaded=!0,window.map.hasLayer(window.rainviewerRadarLayer)&&window.rainviewerRadarLayer._setAvailableTimes()})).catch((e=>console.error("Error refreshing radar data:",e))),t&&fetchRainviewerMetadata("https://api.rainviewer.com/public/weather-maps.json").then((e=>{window.rainviewerSatelliteLayer._metadata=e,window.rainviewerSatelliteLayer._loaded=!0,window.map.hasLayer(window.rainviewerSatelliteLayer)&&window.rainviewerSatelliteLayer._setAvailableTimes()})).catch((e=>console.error("Error refreshing satellite data:",e))))}catch(e){console.error("Error in RainViewer refresh:",e)}}),6e4))})),window.map.on("overlayadd",(function(e){try{console.log("overlayadd event triggered for layer:",e.name),e.layer===window.rainviewerRadarLayer?(console.log("RainViewer Radar layer added"),w()):e.layer===window.rainviewerSatelliteLayer&&(console.log("RainViewer Satellite layer added"),w())}catch(e){console.error("Error in overlayadd event handler:",e)}})),window.map.on("overlayremove",(function(e){try{console.log("overlayremove event triggered for layer:",e.name),e.layer===window.rainviewerRadarLayer?(console.log("RainViewer Radar layer removed"),w()):e.layer===window.rainviewerSatelliteLayer&&(console.log("RainViewer Satellite layer removed"),w())}catch(e){console.error("Error in overlayremove event handler:",e)}})),window.mapInitialized=!0,console.log("Map initialization complete");const g=new Event("map_initialized");return document.dispatchEvent(g),console.log("Map initialized event dispatched"),window.map}window.obstacleLayer=O,window.fetchObstacles=function(){if(!window.map)return void console.error("Map not initialized yet");const e=window.map.getBounds(),t=e.getNorthWest(),i=e.getSouthEast(),o=`/api/obstacles?nw_lat=${t.lat}&nw_lng=${t.lng}&se_lat=${i.lat}&se_lng=${i.lng}`;O.clearLayers(),fetch(o).then((e=>e.json())).then((e=>{const t=[];e.features.forEach((e=>{if("LineString"===e.geometry.type){const i=e.geometry.coordinates.map((e=>[e[1],e[0]])),o=L.polyline(i,{color:e.properties.strokeColor||"#ff0000",weight:e.properties.strokeWeight||2});t.push({polyline:o,data:e.properties}),o.addTo(O),o.bindPopup((()=>{const t=[];return e.properties.name&&t.push(`<b>${e.properties.name}</b>`),e.properties.type&&t.push(`Type: ${e.properties.type}`),e.properties.description&&t.push(`Description: ${e.properties.description}`),e.properties.maxAgl&&t.push(`Max AG: ${e.properties.maxAgl}m`),t.join("<br>")}),{className:"obstacle-popup"})}})),console.log(`Added ${t.length} obstacles to the map`),N&&window.map.off("click",N),N=function(e){if(!window.map.hasLayer(O))return;const i=e.latlng,o=[];if(t.forEach((e=>{let{polyline:t,data:n}=e;t.getBounds().contains(i)&&o.push(n)})),o.length>0){const e=o.map((e=>`\n            ${e.name?`<b>${e.name}</b><br>`:""}\n            ${e.type?`Type: ${e.type}<br>`:""}\n            ${e.description?`Description: ${e.description}<br>`:""}\n            ${e.maxAgl?`Max AG: ${e.maxAgl}m<br>`:""}\n          `)).join("<hr>");L.popup({className:"obstacle-popup"}).setLatLng(i).setContent(e).openOn(window.map)}},window.map.on("click",N)})).catch((e=>console.error("Error fetching obstacles:",e)))},L.TimeDimension.Layer.Rainviewer=L.TimeDimension.Layer.extend({initialize:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.attribution=t.attribution||"<a href='https://www.rainviewer.com/api.html' rel='noopener noreferrer' target='_blank'>RainViewer</a>",L.TimeDimension.Layer.prototype.initialize.call(this,L.tileLayer(""),t),this._metadata={},this._frames={},this._layers={},this._defaultTime=12,this._availableTimes=[],this._timeCacheBackward=this.options.cacheBackward||this.options.cache||0,this._timeCacheForward=this.options.cacheForward||this.options.cache||0,this._updateTimeDimension=this.options.updateTimeDimension||!0,this._updateTimeDimensionMode=this.options.updateTimeDimensionMode||"union",this._type=this.options.type||"radar",this._loaded=!1,async function(e){let t=await fetch(e);return await t.json()}(e).then((e=>{this._metadata=e,this._loaded=!0,this._map&&this._map.hasLayer(this)&&this._setAvailableTimes()})),this._baseLayer.on("load",function(){this._baseLayer.setLoaded(!0),this.fire("timeload",{time:this._defaultTime})}.bind(this))},onAdd:function(e){L.TimeDimension.Layer.prototype.onAdd.call(this,e),this._loaded&&this._setAvailableTimes()},_setAvailableTimes(){if("radar"==this._type){[...this._metadata.radar.nowcast,...this._metadata.radar.past].forEach((e=>this._frames[1e3*e.time]=e))}else if("satellite"==this._type){this._metadata.satellite.infrared.forEach((e=>this._frames[1e3*e.time]=e))}this._availableTimes=L.TimeDimension.Util.sort_and_deduplicate(Object.keys(this._frames).map((e=>Number(e)))),this._updateCurrentTime=this._updateCurrentTime||this._timeDimension&&0==this._timeDimension.getAvailableTimes().length,this._timeDimension&&(this._updateTimeDimension||0==this._timeDimension.getAvailableTimes().length)&&this._timeDimension.setAvailableTimes(this._availableTimes,this._updateTimeDimensionMode),this._updateCurrentTime&&this._timeDimension&&this._availableTimes.length&&this._timeDimension.setCurrentTime(this._availableTimes[this._defaultTime])},eachLayer:function(e,t){for(var i in this._layers)this._layers.hasOwnProperty(i)&&e.call(t,this._layers[i]);return L.TimeDimension.Layer.prototype.eachLayer.call(this,e,t)},_onNewTimeLoading:function(e){var t=this._getLayerForTime(e.time);this._map.hasLayer(t)||this._map.addLayer(t)},isReady:function(e){var t=this._getLayerForTime(e),i=this._map.getZoom();return!!(t.options.minZoom&&i<t.options.minZoom)||(!!(t.options.maxZoom&&i>t.options.maxZoom)||t.isLoaded())},_update:function(){if(this._map){var e=this._timeDimension.getCurrentTime(),t=this._getLayerForTime(e);null==this._currentLayer&&(this._currentLayer=t),this._map.hasLayer(t)?this._showLayer(t,e):this._map.addLayer(t)}},setOpacity:function(e){for(var t in L.TimeDimension.Layer.prototype.setOpacity.apply(this,arguments),this._layers)this._layers.hasOwnProperty(t)&&this._layers[t].setOpacity&&this._layers[t].setOpacity(e)},setZIndex:function(e){for(var t in L.TimeDimension.Layer.prototype.setZIndex.apply(this,arguments),this._layers)this._layers.hasOwnProperty(t)&&this._layers[t].setZIndex&&this._layers[t].setZIndex(e)},_unvalidateCache:function(){var e=this._timeDimension.getCurrentTime();for(var t in this._layers)e!=t&&this._layers.hasOwnProperty(t)&&(this._layers[t].setLoaded(!1),this._layers[t].redraw())},_evictCachedTimes:function(e,t){var i,o=this._getLoadedTimes(),n=String(this._currentTime),a=o.indexOf(n),r=[];t>-1&&((i=a-t)>0&&(r=o.splice(0,i),this._removeLayers(r)));e>-1&&(a=o.indexOf(n),(i=o.length-a-e-1)>0&&(r=o.splice(a+e+1,i),this._removeLayers(r)))},_showLayer:function(e,t){this._currentLayer&&this._currentLayer!==e&&this._currentLayer.hide(),e.show(),this._currentLayer&&this._currentLayer===e||(this._currentLayer=e,this._currentTime=t,this._evictCachedTimes(this._timeCacheForward,this._timeCacheBackward))},_getLayerForTime:function(e){if(0==e||e==this._defaultTime||null==e||!this._loaded)return this._baseLayer;if(this._layers.hasOwnProperty(e))return this._layers[e];var t=this._getNearestTime(e);if(this._layers.hasOwnProperty(t))return this._layers[t];if(!this._frames.hasOwnProperty(t))return this._baseLayer;var i=this._createLayerForTime(t);return this._layers[e]=i,i.on("load",function(e,t){e.setLoaded(!0),this._layers[t]||(this._layers[t]=e),this._timeDimension&&t==this._timeDimension.getCurrentTime()&&!this._timeDimension.isLoading()&&this._showLayer(e,t),this.fire("timeload",{time:t})}.bind(this,i,e)),i.onAdd=function(e){Object.getPrototypeOf(this).onAdd.call(this,e),this.hide()}.bind(i),i},_createLayerForTime:function(e){var t=this.options,i=this._metadata.host;let o=2;return"satellite"==this._type&&(o=0),new L.TileLayer(i+this._frames[e].path+"/256/{z}/{x}/{y}/"+o+"/1_1.png",t)},_getLoadedTimes:function(){var e=[];for(var t in this._layers)this._layers.hasOwnProperty(t)&&e.push(t);return e.sort((function(e,t){return e-t}))},_removeLayers:function(e){for(var t=0,i=e.length;t<i;t++)this._map&&this._map.removeLayer(this._layers[e[t]]),delete this._layers[e[t]]},setMinimumForwardCache:function(e){e>this._timeCacheForward&&(this._timeCacheForward=e)},_getNearestTime:function(e){if(this._layers.hasOwnProperty(e))return e;if(0==this._availableTimes.length)return e;for(var t=0,i=this._availableTimes.length;t<i&&!(e<this._availableTimes[t]);t++);return t>0&&t--,e!=this._availableTimes[t]&&(console.log("Search layer time: "+new Date(e).toISOString()),console.log("Return layer time: "+new Date(this._availableTimes[t]).toISOString())),this._availableTimes[t]}}),L.timeDimension.layer.rainviewer=function(e,t){return new L.TimeDimension.Layer.Rainviewer(e,t)},document.addEventListener("DOMContentLoaded",(function(){console.log("DOM content loaded, initializing map");const e=G();navigator.geolocation.getCurrentPosition((t=>{console.log("Geolocation received");const i=t.coords.latitude,o=t.coords.longitude;e.setView([i,o],10);const n=new CustomEvent("user_location_ready",{detail:{lat:i,lng:o}});document.dispatchEvent(n),console.log("User location event dispatched")}))})),document.addEventListener("user_location_ready",(function(e){console.log("Handling user location ready event"),setTimeout((()=>{if("function"==typeof window.fetchWindStations&&window.mapInitialized&&window.map.hasLayer(window.windLayer))try{console.log("Fetching wind stations"),window.fetchWindStations(e.detail.lat,e.detail.lng)}catch(e){console.error("Error fetching wind stations:",e)}if("function"==typeof window.fetchAirspaces&&window.mapInitialized&&window.map.hasLayer(window.airspaceEFG))try{console.log("Fetching airspaces"),window.fetchAirspaces()}catch(e){console.error("Error fetching airspaces:",e)}if("function"==typeof window.fetchAirspacesGliding&&window.mapInitialized&&window.map.hasLayer(window.airspaceGliding))try{console.log("Fetching airspaces"),window.fetchAirspacesGliding()}catch(e){console.error("Error fetching airspaces:",e)}if("function"==typeof window.fetchAirspacesNotam&&window.mapInitialized&&window.map.hasLayer(window.airspaceNotam))try{console.log("Fetching airspaces"),window.fetchAirspacesNotam()}catch(e){console.error("Error fetching airspaces:",e)}if("function"==typeof window.fetchAirspacesXC&&window.mapInitialized&&window.map.hasLayer(window.airspaceXC))try{console.log("Fetching airspaces"),window.fetchAirspacesXC()}catch(e){console.error("Error fetching airspaces:",e)}if("function"==typeof window.fetchObstacles&&window.mapInitialized&&window.map.hasLayer(window.obstacleLayer))try{console.log("Fetching obstacles"),window.fetchObstacles()}catch(e){console.error("Error fetching obstacles:",e)}}),500)}))}},i={};function o(e){var n=i[e];if(void 0!==n)return n.exports;var a=i[e]={id:e,loaded:!1,exports:{}};return t[e].call(a.exports,a,a.exports,o),a.loaded=!0,a.exports}o.m=t,e=[],o.O=(t,i,n,a)=>{if(!i){var r=1/0;for(d=0;d<e.length;d++){for(var[i,n,a]=e[d],s=!0,l=0;l<i.length;l++)(!1&a||r>=a)&&Object.keys(o.O).every((e=>o.O[e](i[l])))?i.splice(l--,1):(s=!1,a<r&&(r=a));if(s){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[i,n,a]},o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={792:0};o.O.j=t=>0===e[t];var t=(t,i)=>{var n,a,[r,s,l]=i,c=0;if(r.some((t=>0!==e[t]))){for(n in s)o.o(s,n)&&(o.m[n]=s[n]);if(l)var d=l(o)}for(t&&t(i);c<r.length;c++)a=r[c],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(d)},i=self.webpackChunkXCmaps=self.webpackChunkXCmaps||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var n=o.O(void 0,[96],(()=>o(9896)));n=o.O(n)})();
//# sourceMappingURL=main.68c04c4ece015a6f15da.js.map